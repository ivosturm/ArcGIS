// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/arcadeProfiles/fieldCalculateProfile","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../arcade/featureset/support/RecentlyUsedCache ../support/expressionUtils ./utils".split(" "),function(e,g,p,q,r,t,u,c,f){e=new (e(null,{declaredClass:"esri.arcadeProfiles.FieldCalculateProfile",defaults:{globals:{featureSet:["$layer","$datastore"],async:["$layer","$datastore"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any"}}},_lruCache:null,constructor:function(){this._lruCache=
new u},initialize:function(a){var b=[];f.hasGeometryOperations(a)&&b.push(c.enableGeometryOperations());(f.hasFeatureSetOperations(a)||f.hasVariables(a,this.defaults.globals.featureSet))&&b.push(c.enableFeatureSetOperations());f.isAsync(a)&&b.push(c.enableAsyncOperations());return r(b)},isAsync:function(a){a=[a];return f.hasFeatureSetOperations(a)||f.hasVariables(a,this.defaults.globals.async)},parse:function(a){return c.createSyntaxTree(a.expression)},compile:function(a){var b=g.clone(this.defaults.context);
b.useAsync=a.async;return a.syntaxTree?c.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=a.expression,e=a.feature,d=a.layer,g=a.spatialReference;a=a.portal;var m,h,n,k={spatialReference:g,cache:this._lruCache};d&&(b.hasVariable("$layer")&&(m=n=d.getMap()?c.createFeatureSetFromLayer(d,k):c.createFeatureSetFromLayerUrl(d.url,k)),b.hasVariable("$datastore")&&(h=(h=f.getServiceUrl(d.url))?c.createFeatureSetCollectionFromServiceUrl(h,k):null));var b=e&&b.hasVariable("$feature")?t.createFromGraphicLikeObject(e.geometry,
e.attributes,(b.hasFunction("attachments")||b.hasFunction("featuresetbyrelationship"))&&d&&!d.getMap()?n||c.createFeatureSetFromLayerUrl(d.url,k):d):null,l;a&&(a=a.replace(/\/+$/ig,""),l={url:a,portalUrl:a+"/sharing/rest"});return{context:{vars:{$feature:b,$layer:m,$datastore:h},services:l?{portal:l}:null,lrucache:this._lruCache,spatialReference:g}}}}));p("extend-esri")&&g.setObject("arcadeProfiles.fieldCalculateProfile",e,q);return e});