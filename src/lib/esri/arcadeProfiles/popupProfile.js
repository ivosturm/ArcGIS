// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/arcadeProfiles/popupProfile","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(d,g,m,n,p,q,c,e){d=new (d(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore","$map"],async:["$layer","$datastore","$map"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any"}}},initialize:function(a){var b=[];e.hasGeometryOperations(a)&&b.push(c.enableGeometryOperations());
(e.hasFeatureSetOperations(a)||e.hasVariables(a,this.defaults.globals.featureSet))&&b.push(c.enableFeatureSetOperations());e.isAsync(a)&&b.push(c.enableAsyncOperations());return p(b)},isAsync:function(a){a=[a];return e.hasFeatureSetOperations(a)||e.hasVariables(a,this.defaults.globals.async)},parse:function(a){return c.createSyntaxTree(a.expression)},compile:function(a){var b=g.clone(this.defaults.context);b.useAsync=a.async;return a.syntaxTree?c.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=
a.expression,h=a.feature,f=a.layer,d=a.map;a=a.spatialReference;var h=h&&b.hasVariable("$feature")?q.createFromGraphicLikeObject(h.geometry,h.attributes,f):null,g,k;if(f){var l={spatialReference:a};b.hasVariable("$layer")&&(g=f.getMap()?c.createFeatureSetFromLayer(f,l):c.createFeatureSetFromLayerUrl(f.url,l));b.hasVariable("$datastore")&&(k=(k=e.getServiceUrl(f.url))?c.createFeatureSetCollectionFromServiceUrl(k,l):null)}b=d&&b.hasVariable("$map")?c.createFeatureSetCollectionFromMap(d):null;return{context:{vars:{$feature:h,
$layer:g,$datastore:k,$map:b},spatialReference:a}}}}));m("extend-esri")&&g.setObject("arcadeProfiles.popupProfile",d,n);return d});