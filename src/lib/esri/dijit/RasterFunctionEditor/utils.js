// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/RasterFunctionEditor/utils","dojo/_base/lang dojo/has dojo/on dojo/_base/array ../../kernel ../../request ../../lang ../../tasks/Geoprocessor ../../tasks/JobInfo ../../renderers/colorUtils ../../renderers/colorRampUtils".split(" "),function(g,u,k,h,v,w,x,y,z,l,p){function q(a){if(a){var b=h.map([a.FromColor,a.ToColor],function(a){a=l.toRGB({h:a.Hue,s:a.Saturation,v:a.Value});return[a.r,a.g,a.b]});return{fromColor:b[0],toColor:b[1],type:"algorithmic",algorithm:a.Algorithm}}}function r(a){if(a)return a=
l.toHSV(l.getDojoColor(a)),{type:"HsvColor",Hue:a.h,Saturation:a.s,Value:a.v,AlphaValue:255}}function t(a){if(a){var b=a.toJson?a.toJson():void 0;return{Algorithm:b&&b.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:r(a.fromColor),ToColor:r(a.toColor)}}}var m={},d,e,f;g.mixin(m,{convertRFT:function(a,b,c,n){var h=a.url,g=function(){f&&(f.remove(),f=null);e&&(e.remove(),e=null)};d||(d=new y(h),k(d,"error",g));e=k(d,"job-complete",function(a){e&&(e.remove(),e=null);a.jobInfo.jobStatus!==
z.STATUS_SUCCEEDED?(g(),n(a)):d.getResultData(a.jobInfo.jobId,"outputRasterFunction")});f=k(d,"get-result-data-complete",function(a){f&&(f.remove(),f=null);(a=a&&a.result&&a.result.value)&&a.url&&w({url:a.url,callbackParamName:"callback",content:{f:"json"},handleAs:"json",load:c,error:n})});a={inputRasterFunction:JSON.stringify(a.rft),format:a.format};return d.submitJob(a,b,null,n)},getRasterJsonFromLayer:function(a){if(!a)return null;var b=a.url;a.credential&&(b=b+"?token\x3d"+a.credential.token,
a.credential.referer&&(b+=a.credential.referer));b={url:b,name:a.name};a.renderingRule&&(b.renderingRule=a.renderingRule.toJson?a.renderingRule.toJson():a.renderingRule);a.mosaicRule&&(b.mosaicRule=a.mosaicRule.toJson?a.mosaicRule.toJson():a.mosaicRule);return b},getLayerIdfromRasterValue:function(a,b){if(a&&b){var c;h.some(b,function(b){if(b&&b.url===a.url&&b.name===a.name&&a.name)return c=b.id,!0});return c}},getColorRampFromArg:function(a){if(a){var b,c;a.type&&-1<a.type.toLowerCase().indexOf("colorramp")?
b=a:a.value&&-1<a.value.type.toLowerCase().indexOf("colorramp")&&(b=a.value);if(b)return a=b.type.toLowerCase(),"multipartcolorramp"===a?c=p.fromJson({type:"multipart",colorRamps:h.map(b.ArrayOfColorRamp,function(a){return q(a)})}):"algorithmiccolorramp"===a&&(c=p.fromJson(q(b))),c.id=c.name=b.Name,c}},getRFxArgColorRampValue:function(a){if(a){if(a.fromColor&&a.toColor)return g.mixin(t(a),{Name:a.name});if(a.colorRamps){var b=h.map(a.colorRamps,t);return{type:"MultiPartColorRamp",NumColorRamps:b.length,
ArrayOfColorRamp:b,Name:a.name}}}},RFX_VARIABLE_TYPE:"RasterFunctionVariable",RFX_TEMPLATE_TYPE:"RasterFunctionTemplate",ARGUMENT_ARRAY_TYPE:"ArgumentArray",getArgRFT:function(a){if(a){if("RasterFunctionTemplate"===a.type)return a;if(a.value&&"RasterFunctionTemplate"===a.value.type)return a.value}},getEnumData:function(a){if(Array.isArray(a))return a.forEach(function(a){a.key=a.key.toString()}),a},getImageServiceTitle:function(a){a=a.split("/");return a[a.length-2]},isReferencedObject:function(a){if(a&&
x.isDefined(a._object_ref_id))return!0},functionTypes:{local:"LocalFunction",gpAdapter:"GPAdapterFunction",pythonAdapter:"PythonAdapterFunction"},defaultRasterNodeProps:{name:"Raster",isDataset:!0,isPublic:!1,type:"RasterFunctionVariable"}});u("extend-esri")&&g.setObject("dijit.RasterFunctionEditor.utils",m,v);return m});