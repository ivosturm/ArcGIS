// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/analysis/templates/JoinFeatures.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"margin-top:0.5em; margin-bottom: 0.5em;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_joinFeaturesToolContentTitle" class\x3d"analysisTitle"\x3e\r\n        \x3ctable class\x3d"esriFormTable" \x3e \r\n          \x3ctr\x3e\r\n            \x3ctd class\x3d"esriToolIconTd"\x3e\x3cdiv class\x3d"joinFeaturesIcon"\x3e\x3c/div\x3e\x3c/td\x3e\r\n            \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" data-dojo-attach-point\x3d"_toolTitle"\x3e\r\n\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"_titleLbl"\x3e${i18n.joinFeaturesTitle}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\x3cnav class\x3d"breadcrumbs"  data-dojo-attach-point\x3d"_analysisModeLblNode" style\x3d"display:none;"\x3e\r\n\t\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"crumb breadcrumbs__modelabel" data-dojo-attach-event\x3d"onclick:_handleModeCrumbClick" data-dojo-attach-point\x3d"_analysisModeCrumb"\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"crumb is-active" data-dojo-attach-point\x3d"_analysisTitleCrumb" style\x3d"font-size:16px;"\x3e${i18n.joinFeaturesTitle}\x3c/a\x3e\r\n\t\t\t\t\t\t\t\x3c/nav\x3e \t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n            \x3ctd\x3e\r\n              \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                  \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n                    \x3ca href\x3d"#" class\x3d\'esriFloatLeading helpIcon\' esriHelpTopic\x3d"toolDescription"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n                    \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e              \r\n              \x3c/div\x3e                \r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:15px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_targetLayerTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_targetLayerLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.targetLayerLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"targetLayer"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-attach-point\x3d"_targetLayerRow"  style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd style\x3d"padding-top: 0px; padding-bottom: 1em;" \x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_targetLayerSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"overflow:hidden!important;" data-dojo-attach-event\x3d"onChange:_handleTargetLayerChange" required\x3d"true"\x3e\r\n\t \t              \t\x3c/select\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_joinLayerTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_joinLayerLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.twoLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.joinLayerLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"joinLayer"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-attach-point\x3d"_joinLayerRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd style\x3d"padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_joinLayerSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"overflow:hidden!important;" data-dojo-attach-event\x3d"onChange:_handleJoinLayerChange" required\x3d"true"\x3e\x3c/select\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_JoinOptionsLabelRow"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.threeLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel" data-dojo-attach-point\x3d"_joinOptionsLabel"\x3e${i18n.joinOptionsLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" data-dojo-attach-point\x3d"_joinOptionsHelpNode" esrihelptopic\x3d"joinOptions"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" data-dojo-attach-point\x3d"_spatialJoinNode" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-top: 0px;"\x3e\r\n\t\t            \t\x3clabel class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin2 esriTrailingMargin025 hide" style\x3d"display:none;padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t\t\t\t     \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_spatialCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false"  data-dojo-attach-event\x3d"onChange:_handleSpatialCheckChange" required\x3d"true"/\x3e${i18n.spatialJoinLabel}\r\n\t\t\t\t\t   \t\x3c/label\x3e\r\n\t\t\t\t\t\t\t    \x3cdiv data-dojo-attach-point\x3d"_spatialJoinCtr" class\x3d"esriSelectLabel" style\x3d"width:100%;"\x3e\r\n\t\t\t        \t    \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin2 bufferSelector iconSelector" data-dojo-attach-point\x3d"_spatialJoin"\x3e\r\n                       \x3cdiv class\x3d"bufferIcon spatialJoinIcon"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n\t\t\t\t\t\t\t      \x3cdiv class\x3d"esriLeadingMargin6 padTop075"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel class\x3d"esriSelectLabel" data-dojo-attach-point\x3d"_spatialJoinLabel"\x3e ${i18n.chooseSpatialJoin}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t    \x3c/div\x3e\r\n\t\t\t\t\t    \x3c/td\x3e\r\n\t\t\t\t\t\t  \x3ctd class\x3d"shortTextInput padTop075"\x3e\r\n\t\t\t            \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"spatialRelationship"\x3e\x3c/a\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t    \x3c/tr\x3e\r\n\t        \t\x3ctr\x3e\r\n\t        \t\t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cspan data-dojo-attach-point\x3d"_spatialRelationshipRow" class\x3d"hide"\x3e\r\n\t\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_spatialRelationshipSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleSpatialRelationshipChange"\x3e\x3c/select\x3e\r\n\t\t\t            \x3c/span\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t        \x3c/tr\x3e\r\n\t\t\t    \x3ctr data-dojo-attach-point\x3d"_spatialDistanceRow" class\x3d"hide"\x3e\r\n\t\t\t    \t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cinput class\x3d"esriLeadingMargin1 esriTrailingMargin05" style\x3d"width:40%;overflow:hidden!important;" data-dojo-attach-point\x3d"_spatialDistanceInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"constraints:{min:0}" data-dojo-attach-event\x3d"onChange:_handleSpatialDistanceChange"\x3e\x3c/input\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin025" style\x3d"width:41.2%;overflow:hidden!important;" data-dojo-attach-point\x3d"_spatialUnitSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleSpatialUnitChange"\x3e\x3c/select\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t      \t\x3c/tr\x3e\r\n\t    \t\x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" data-dojo-attach-point\x3d"_temporalJoinNode" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-top: 0px;"\x3e\r\n\t\t            \t\x3clabel class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin2 esriTrailingMargin025 hide" style\x3d"display:none;padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t\t\t\t     \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_temporalCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false"  data-dojo-attach-event\x3d"onChange:_handleTemporalCheckChange" required\x3d"true"/\x3e${i18n.temporalJoinLabel}\r\n\t\t\t\t\t   \t\x3c/label\x3e\r\n\t\t\t\t\t\t\t    \x3cdiv data-dojo-attach-point\x3d"_temporalJoinCtr" class\x3d"esriSelectLabel" style\x3d"width:100%;"\x3e\r\n\t\t\t              \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin2 bufferSelector iconSelector" data-dojo-attach-point\x3d"_temporalJoin"\x3e\r\n                       \x3cdiv class\x3d"bufferIcon temporalJoinIcon"\x3e\x3c/div\x3e\r\n\t\t\t              \x3c/div\x3e\r\n\t\t\t\t\t\t\t      \x3cdiv class\x3d"esriLeadingMargin6 padTop075"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel class\x3d"esriSelectLabel" data-dojo-attach-point\x3d"_temporalJoinLabel"\x3e ${i18n.chooseTemporalJoin}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t    \x3c/div\x3e\r\n\t\t          \x3c/td\x3e\r\n\t\t\t        \x3ctd class\x3d"shortTextInput padTop075"\x3e\r\n\t\t\t            \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"temporalRelationship"\x3e\x3c/a\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t    \x3c/tr\x3e\r\n\t        \t\x3ctr\x3e\r\n\t        \t\t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cspan data-dojo-attach-point\x3d"_temporalRelationshipRow" class\x3d"hide"\x3e\r\n\t\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_temporalRelationshipSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleTemporalRelationshipChange"\x3e\x3c/select\x3e\r\n\t\t\t            \x3c/span\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t      \x3c/tr\x3e\r\n\t\t\t    \x3ctr data-dojo-attach-point\x3d"_temporalDistanceRow" class\x3d"hide"\x3e\r\n\t\t\t    \t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cinput class\x3d"esriLeadingMargin1 esriTrailingMargin05" style\x3d"width:40%;overflow:hidden!important;" data-dojo-attach-point\x3d"_temporalDistanceInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"constraints:{min:0}" data-dojo-attach-event\x3d"onChange:_handleTemporalDistanceChange"\x3e\x3c/input\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin025" style\x3d"width:41.2%;overflow:hidden!important;" data-dojo-attach-point\x3d"_temporalUnitSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleTemporalUnitChange"\x3e\x3c/select\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t    \t\x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" data-dojo-attach-point\x3d"_attributeJoinNode" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"3" style\x3d"padding-top: 0px;"\x3e\r\n\t\t            \t\x3clabel class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin2 esriTrailingMargin025 hide" style\x3d"display:none;padding-top: 0px;"\x3e\r\n\t\t\t\t\t     \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_attributeCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false"  data-dojo-attach-event\x3d"onChange:_handleAttributeCheckChange" required\x3d"true"/\x3e${i18n.attributeJoinLabel}\r\n\t\t\t\t\t   \t\x3c/label\x3e\r\n\t\t\t\t\t\t\t   \x3cdiv data-dojo-attach-point\x3d"_attributeJoinCtr" style\x3d"width:100%;" class\x3d"esriSelectLabel"\x3e\r\n\t\t                \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin2 bufferSelector iconSelector" data-dojo-attach-point\x3d"_attributeJoin"\x3e\r\n                       \x3cdiv class\x3d"bufferIcon attributeJoinIcon"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n\t\t\t\t\t\t\t      \x3cdiv class\x3d"esriLeadingMargin6 padTop075"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel class\x3d"esriSelectLabel" data-dojo-attach-point\x3d"_attrJoinLabel"\x3e ${i18n.chooseAttrJoin}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t    \x3c/div\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t\t\t       \x3ctd class\x3d"shortTextInput padTop075"\x3e\r\n\t       \t            \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"attributeRelationship"\x3e\x3c/a\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t    \t\x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable esriLeadingMargin1 attributeJoin" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:10px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t\t      \t\x3ctr data-dojo-attach-point\x3d"_attributeRelationshipRow" class\x3d"hide longInput"\x3e\r\n\t\t          \t\r\n\t\t        \x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px; margin-top:10px;margin-bottom:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_summaryStatisticTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_summaryStatisticLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.fourLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.joinTypeLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"joinOperation"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-attach-point\x3d"_joinOperationRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" style\x3d"overflow:hidden!important;" data-dojo-attach-point\x3d"_joinOperation" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleJoinOperationChange"\x3e\r\n\t\t              \t\x3c/select\x3e\r\n\t\t            \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"_joinOneOneOptionRow" style\x3d"display: table-row;"\x3e\r\n                \x3ctd colspan\x3d"3"\x3e\r\n                  \x3cselect data-dojo-attach-point\x3d"_joinOptionSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleJoinOneToOneOptionChange" class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel"\x3e\r\n                    \x3coption value\x3d"RECORD"\x3e${i18n.recordKept}\x3c/option\x3e\r\n                    \x3coption value\x3d"STATS"\x3e${i18n.addStats}\x3c/option\x3e\r\n                  \x3c/select\x3e\r\n                \x3c/td\x3e\r\n\t\t            \x3ctd data-dojo-attach-point\x3d"_joinOneOneOptionsHelpTd" class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"summaryFields"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3c!--\x3ctr\x3e\r\n                \x3ctd colspan\x3d"4"\x3e\r\n                    \x3clabel class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_joinRecordRowLabel"\x3e${i18n.recordKept}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e--\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"_joinRecordRow" style\x3d"display: table-row;"\x3e\r\n                \x3ctd colspan\x3d"4"\x3e\r\n                  \x3cdiv class\x3d"esriLeadingMargin2" style\x3d"width:100%;"\x3e\r\n                    \x3clabel class\x3d"esriSelectLabel"\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_firstRecRadioBtn" data-dojo-props\x3d"\'class\':\'esriSelectLabel\',checked:true" name\x3d"chooserecord"/\x3e\r\n                      ${i18n.chooseFirstRecord}\r\n                    \x3c/label\x3e\r\n                    \x3cbr/\x3e\r\n                    \x3clabel class\x3d"esriSelectLabel"\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_exprRadioBtn" data-dojo-attach-event\x3d"onChange:_handleExprRadioChange" data-dojo-props\x3d"\'class\':\'esriSelectLabel\'" name\x3d"chooserecord"/\x3e \r\n                      ${i18n.orderByField}\r\n                    \x3c/label\x3e\r\n                    \x3cbr/\x3e\r\n                    \x3cselect class\x3d"padTop05 esriTableFixedLayout mediumDivInput"  data-dojo-type\x3d"dijit/form/Select"  data-dojo-attach-event\x3d"onChange:_handleExpFieldChange" data-dojo-attach-point\x3d"_expFieldsSelect"\x3e\r\n                    \x3c/select\x3e\r\n                    \x3cselect class\x3d"padTop05 esriTableFixedLayout mediumDivInput"  data-dojo-type\x3d"dijit/form/Select"  data-dojo-attach-point\x3d"_expFilterSelect"\x3e\r\n                    \x3c/select\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"_joinOperationLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.statisticsLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"summaryFields"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-type\x3d"esri/dijit/analysis/components/AddSummaryFields" data-dojo-attach-point\x3d"_summaryWidget" \r\n\t\t\t\t\t\t\t\tdata-dojo-props\x3d"layer:\'\', showGeoAnalyticsParams:${showGeoAnalyticsParams}, addAsRow:true, allowDateType:true, isGPStringObjType: true"\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t\t\t\x3ctable data-dojo-attach-point\x3d"_joinConditionNode" class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px; margin-top:10px;margin-bottom:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_joinOperationTable"\x3e \r\n\t\t\t  \x3ctr data-dojo-attach-point\x3d""\x3e\r\n            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t\t\t\t\t\t\x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.fiveLabel}\x3c/label\x3e\r\n\t\t          \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.joinOperationLbl}\x3c/label\x3e\r\n            \x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t          \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"joinCondition"\x3e\x3c/a\x3e\r\n\t\t        \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\t\t\t  \x3ctr data-dojo-attach-point\x3d"_bufFielExpRow"\x3e\r\n          \x3ctd colspan\x3d"4"\x3e\r\n            \x3ctable style\x3d"width:85%" class\x3d"esriFormTable"\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd colspan\x3d"3"\x3e\r\n                  \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" style\x3d"width:90%;" class\x3d"esriLeadingMargin1 longInput" data-dojo-props\x3d"trim:true" data-dojo-attach-point\x3d"_bufFieldOutput" value\x3d""\x3e\x3c/input\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"shortTextInput"\x3e\r\n                  \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.add}\',iconClass:\'esriAnalysisExpIcon\',showLabel: false" data-dojo-attach-point\x3d"_expBtn" data-dojo-attach-event\x3d"onClick:_handleExpBtnClick"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n             \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:15px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_outputNameTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n\t\t              \x3clabel data-dojo-attach-point\x3d"_resultStepLabel" class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.sixLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"longTextInput esriAnalysisStepsLabel"\x3e${i18n.resultLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"outputName"\x3e\x3c/a\x3e \r\n\t\t            \x3c/td\x3e             \r\n\t            \x3c/tr\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t\t        \x3ctd colspan\x3d"3" style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n\t\t\t          \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" class\x3d"esriOutputText esriLeadingMargin1 longInput" data-dojo-attach-point\x3d"_outputName"\x3e\x3c/input\x3e\r\n\t\t\t        \x3c/td\x3e                \r\n\t\t        \x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:15px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_outputNameTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n\t\t              \x3cdiv class\x3d"esriLeadingMargin1 attrSelect" data-dojo-attach-point\x3d"_chooseFolderRow"\x3e\r\n\t\t                \x3clabel style\x3d"width:9px;font-size:smaller;"\x3e${i18n.saveResultIn}\x3c/label\x3e\r\n\t\t                \x3cinput class\x3d"longInput esriFolderSelect" data-dojo-attach-point\x3d"_webMapFolderSelect" dojotype\x3d"dijit/form/FilteringSelect" trim\x3d"true"\x3e\x3c/input\x3e\r\n\t\t              \x3c/div\x3e              \r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e   \r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t\x3c/div\x3e\r\n  \t\x3cdiv style\x3d"padding:5px;margin-top:5px;border-top:solid 1px #BBB;"\x3e\r\n      \t\x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n        \x3ca class\x3d"esriFloatTrailing esriSmallFont"  href\x3d"#" data-dojo-attach-point\x3d"_showCreditsLink"\x3e${i18n.showCredits}\x3c/a\x3e\r\n       \t\x3clabel data-dojo-attach-point\x3d"_chooseExtentDiv" class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin025"\x3e\r\n         \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_useExtentCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_handleExtentChange" data-dojo-props\x3d"checked:true" name\x3d"extent" value\x3d"true"/\x3e\r\n           \t${i18n.useMapExtent}\r\n       \t\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_outputTypeRow" class\x3d"padBottom1"\x3e\r\n        \x3ctable style\x3d"width:100%;"\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n              \x3clabel data-dojo-attach-point\x3d"" class\x3d"esriSelectLabel esriExtentLabel"\x3e\r\n                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_checkCreateView" data-dojo-attach-event\x3d"onChange:_handleCreateViewChange" data-dojo-type\x3d"dijit/form/CheckBox" name\x3d"storeResultAsView"/\x3e\r\n                ${i18n.saveResultAsView}\r\n              \x3c/label\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"shortTextInput"\x3e\r\n              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"isView"\x3e\x3c/a\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n        \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\x3c/a\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-point\x3d"_saveBtn" class\x3d"esriLeadingMargin4 esriAnalysisSubmitButton" data-dojo-attach-event\x3d"onClick:_handleSaveBtnClick"\x3e\r\n          ${i18n.runAnalysis}\r\n      \x3c/button\x3e\r\n    \x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_exprDialog" class\x3d"esriBufExpressDialog" data-dojo-props\x3d"title:\'${i18n.addJoinCondition}\'"\x3e\r\n      \x3cdiv class\x3d"esriBufExpressionFormCtr"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_expressionCtr"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.creditTitle}" data-dojo-attach-point\x3d"_usageDialog" style\x3d"width:40em;"\x3e\r\n      \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/CreditEstimator"  data-dojo-attach-point\x3d"_usageForm"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e    \r\n  \t\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/analysis/JoinFeatures","esri/layers/FeatureLayer require dojo/aspect dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/on dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/store/Memory dojo/_base/fx dojo/fx/easing dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/layout/AccordionContainer dijit/TitlePane dijit/form/FilteringSelect dijit/form/Select dijit/form/TextBox dijit/Dialog ../../kernel ../../lang ./utils ./AnalysisBase ./CreditEstimator ./_AnalysisOptions ../CalculateField ../../geometry/Point ../../geometry/Polyline ../../geometry/Polygon ../../SpatialReference ./AnalysisRegistry ./ItemTypes ./ViewJsonTypes ./components/AddSummaryFields dojo/i18n!../../nls/jsapi dojo/text!./templates/JoinFeatures.html".split(" "),
function(y,J,K,L,k,l,z,p,M,A,ea,N,t,w,r,fa,d,ga,C,D,E,O,P,Q,R,S,T,F,ha,ia,ja,G,ka,la,U,m,h,V,ma,W,x,X,Y,Z,H,v,B,aa,na,I,ba){y=L([P,Q,R,S,T,W,V],{declaredClass:"esri.dijit.analysis.JoinFeatures",templateString:ba,widgetsInTemplate:!0,showGeoAnalyticsParams:!0,showTemporalJoin:!0,showAttributeJoin:!0,showSpatialJoin:!0,showJoinCondition:!0,allowAllAttributesTypes:!0,showRecordToKeepOption:!0,i18n:null,toolName:"JoinFeatures",helpFileName:"JoinFeatures",resultParameter:"output",removeJobParamKeys:["polyExpressionObject"],
_spatialDistanceOperators:["Near","NearGeodesic","withindistance"],_temporalDistanceOperators:["Near","NearAfter","NearBefore"],constructor:function(a,b){this.targetLayers=[];this.joinLayers=[];this._pbConnects=[];this._attrJoinRows=[];a.containerNode&&(this.container=a.containerNode)},postCreate:function(){this.inherited(arguments);this.filterObjects=[{layer:"targetLayer",layers:this.targetLayers,select:this._targetLayerSelect,expressionObj:"attributeExprObj"},{layer:"joinLayer",layers:this.joinLayers,
select:this._joinLayerSelect,expressionObj:"polyExpressionObject"}];this._buildUI()},postMixInProperties:function(){this.inherited(arguments);k.mixin(this.i18n,I.expressionForm);k.mixin(this.i18n,I.joinFeaturesTool);this.joinOperation||(this.joinOperation="JoinOneToOne");this.joinOperationTypes=[{value:"JoinOneToOne",label:this.i18n.oneToOneLabel},{value:"JoinOneToMany",label:this.i18n.oneToManyLabel}];this.spatialDistance=this.spatialRelationshipDistance||this.spatialNearDistance||0;this.spatialUnit=
this.spatialRelationshipDistanceUnits||this.spatialNearDistanceUnit||this.i18n.feet;this.spatialUnitTypes=[{value:"Miles",label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{value:"NauticalMiles",label:this.i18n.nautMiles},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}];this.temporalDistance=0;this.temporalUnit=this.i18n.years;this.temporalUnitTypes=[{value:"Years",label:this.i18n.years},{value:"Months",
label:this.i18n.months},{value:"Weeks",label:this.i18n.weeks},{value:"Days",label:this.i18n.days},{value:"Hours",label:this.i18n.hours},{value:"Minutes",label:this.i18n.minutes},{value:"Seconds",label:this.i18n.seconds},{value:"Milliseconds",label:this.i18n.milliseconds}];this.attributeType=[{value:"Equal",label:this.i18n.equalSign}]},startup:function(){},_buildUI:function(){var a=!0,b,c=!0,e,f,g;this._outputName.set("validator",k.hitch(this,this.validateServiceName));this.signInPromise.then(k.hitch(this,
h.initHelpLinks,this.domNode,this.showHelp,{analysisGpServer:this.analysisGpServer}));h.updateDisplay([this._temporalJoinNode],this.showTemporalJoin,"table");h.updateDisplay([this._spatialJoinNode],this.showSpatialJoin,"table");h.updateDisplay([this._attributeJoinNode],this.showAttributeJoin,"table");h.updateDisplay([this._joinConditionNode],this.showJoinCondition,"table");h.updateDisplay([this._outputTypeRow],this.get("showOutputType")&&!this.showGeoAnalyticsParams,"block");h.updateDisplay([this._joinOneOneOptionRow,
this._joinRecordRow],this.showRecordToKeepOption&&!this.showGeoAnalyticsParams,"table-row");this.allowAllAttributesTypes=this.showGeoAnalyticsParams?!1:this.allowAllAttributesTypes;this.showJoinCondition||w.set(this._resultStepLabel,"innerHTML",this.i18n.fiveLabel);this.showGeoAnalyticsParams||(w.set(this._joinOptionsLabel,"innerHTML",this.i18n.joinOptionsStdLabel),w.set(this._joinOptionsHelpNode,"esriHelpTopic","joinType"));l.forEach(this.joinOperationTypes,function(a,b){this._joinOperation.addOption({value:a.value,
label:a.label})},this);this.joinOperation&&(this._joinOperation.set("value",this.joinOperation),"JoinOneToMany"===this.joinOperation&&h.updateDisplay([this._joinOperationLabelRow,this._joinRecordRow,this._joinOneOneOptionRow].concat(this._summaryWidget.rows),"JoinOneToOne"===this.joinOperation,"table-row"));l.forEach(this.spatialUnitTypes,function(a,b){this._spatialUnitSelect.addOption({value:a.value,label:a.label})},this);this.spatialUnit&&this._spatialUnitSelect.set("value",this.spatialUnit);l.forEach(this.temporalUnitTypes,
function(a,b){this._temporalUnitSelect.addOption({value:a.value,label:a.label})},this);this.temporalUnit&&this._temporalUnitSelect.set("value",this.temporalUnit);m.isDefined(this.targetLayer)&&(b=l.indexOf(this.targetLayers,this.targetLayer),-1===b&&l.forEach(this.targetLayers,function(a,c){a&&(a.url&&this.targetLayer.url&&a.url===this.targetLayer.url||a.name===this.targetLayer.name)&&(b=c)},this),-1===b&&this.targetLayers.push(this.targetLayer));m.isDefined(this.joinLayer)&&(b=l.indexOf(this.joinLayers,
this.joinLayer),-1===b&&l.forEach(this.joinLayers,function(a,c){a&&(a.url&&this.joinLayer.url&&a.url===this.joinLayer.url||a.name===this.joinLayer.name)&&(b=c)},this),-1===b&&this.joinLayers.push(this.joinLayer));if(m.isDefined(this.targetLayers)&&0<this.targetLayers.length){var d=[];this.rerun&&!this.targetLayer&&h.addBlankOption(this._targetLayerSelect,d);l.forEach(this.targetLayers,function(a,b){d.push({value:this._toString(b),label:a.name,selected:a.url&&this.targetLayer&&this.targetLayer.url&&
a.url===this.targetLayer.url||a&&this.targetLayer&&!a.url&&!this.targetLayer.url&&a.name===this.targetLayer.name})},this);this._targetLayerSelect.addOption(d);m.isDefined(this.targetLayer)||this.rerun||this.set("targetLayer",this.targetLayers[this._targetLayerSelect.get("value")])}if(m.isDefined(this.joinLayers)&&0<this.joinLayers.length){var q=[];this.rerun&&!this.joinLayer&&h.addBlankOption(this._joinLayerSelect,q);l.forEach(this.joinLayers,function(a,b){q.push({value:this._toString(b),label:a.name,
selected:a.url&&this.joinLayer&&this.joinLayer.url&&a.url===this.joinLayer.url||a&&this.joinLayer&&!a.url&&!this.joinLayer.url&&a.name===this.joinLayer.name})},this);this._joinLayerSelect.addOption(q);m.isDefined(this.joinLayer)||this.rerun||this.set("joinLayer",this.joinLayers[this._joinLayerSelect.get("value")])}h.addReadyToUseLayerOption(this,[this._targetLayerSelect,this._joinLayerSelect]);t.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":"none");this.showSelectFolder&&
this.getFolderStore().then(k.hitch(this,function(a){this.folderStore=a;h.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}));t.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none");this._loadConnections();this.outputLayerName&&(this._outputName.set("value",this.outputLayerName),a=!1);a=!(this.outputLayerName||this.spatialRelationship||this.temporalRelationship||
this.attributeRelationship);this.joinCondition&&this._bufFieldOutput.set("value",this.joinCondition);this._checkCreateView.set("checked",this.outputType===B.FLAYERVIEW);this._updateAnalysisLayerUI(a);this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&(h.updateDisplay([this._joinOperationLabelRow],!1),this._joinOptionSelect.set("value",this.summaryFields&&0<this.summaryFields.length?"STATS":"RECORD"),this._handleJoinOneToOneOptionChange(this._joinOptionSelect.get("value")),this._buildOrderByField(this.joinLayer,
{priorityChange:!1}),this.recordsToMatch&&this.recordsToMatch.orderByFields&&this.joinLayer&&this.joinLayer.fields&&(f=this.recordsToMatch.orderByFields.split(" "),e=f[0],c=e===this.joinLayer.objectIdField,f=f[1]),this._exprRadioBtn.set("checked",!c),this._handleExprRadioChange(this._exprRadioBtn.get("checked")),!c&&e&&this._expFieldsSelect.set("value",e,!1),this._handleExpFieldChange(this._expFieldsSelect.get("value")),!c&&e&&(c=this._expFieldsSelect.getOptions(e),"number"===c.type?g="ASC"===f?"Smallest":
"Largest":"date"===c.type&&(g="ASC"===f?"Oldest":"Newest"),this._expFilterSelect.set("value",g)));m.isDefined(this.temporalNearDistance)&&this._temporalDistanceInput.set("value",this.temporalNearDistance);m.isDefined(this.temporalNearDistanceUnit)&&this._temporalUnitSelect.set("value",this.temporalNearDistanceUnit);this._createFilterAndSelections()},_handleTargetLayerChange:function(a){this._isAnalysisSelect=!0;"browse"===a||"browselayers"===a?this._createBrowseItems({browseValue:a,disabledSubResources:[this.targetLayer,
this.joinLayer]},{layerTypes:[]},this._targetLayerSelect):(this.set("targetLayer",this.targetLayers[a]),this._updateAnalysisLayerUI(!0))},_toString:function(a){return""+a},_handleJoinLayerChange:function(a){this._isAnalysisSelect=!1;"browse"===a||"browselayers"===a?this._createBrowseItems({browseValue:a,disabledSubResources:[this.joinLayer]},{layerTypes:[]},this._joinLayerSelect):(this.set("joinLayer",this.joinLayers[a]),this._updateAnalysisLayerUI(!0),this.showRecordToKeepOption&&this._buildOrderByField(this.joinLayer))},
_buildOrderByField:function(a,b){a={selectWidget:this._expFieldsSelect,layer:a,allowStringType:!1,allowDateType:!this.showGeoAnalyticsParams};m.isDefined(b)&&m.isDefined(b.priorityChange)&&(a.priorityChange=b.priorityChange);h.addAttributeOptions(a)},_handleJoinOperationChange:function(a){if(a!==this.joinOperation){this._summaryWidget.set("required",!1);this._summaryWidget.hide();var b=[this._joinRecordRow,this._joinOneOneOptionRow];this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&h.updateDisplay(b,
"JoinOneToOne"===a,"table-row");"JoinOneToOne"!==a||this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&"STATS"!==this._joinOptionSelect.get("value")||("STATS"===this._joinOptionSelect.get("value")&&this._summaryWidget.set("required",!0),this._summaryWidget.show(),h.updateDisplay([this._joinRecordRow],!0,"none"));this.showGeoAnalyticsParams&&h.updateDisplay([this._joinOperationLabelRow],"JoinOneToOne"===a,"table-row");this.joinOperation=a;this._updateCreateViewUI()}},_handleSpatialCheckChange:function(a,
b){d.toggle(this._spatialJoin,"selected");this.spatialJoin=d.contains(this._spatialJoin,"selected");m.isDefined(this.targetLayer)&&m.isDefined(this.joinLayer)&&this._repopulateSpatialTypes(this.targetLayer.geometryType,this.joinLayer.geometryType,b);this.spatialJoin||d.add(this._spatialDistanceRow,"hide");d.toggle(this._spatialRelationshipRow,"hide");d.contains(this._spatialRelationshipRow,"hide")&&this._spatialDistanceInput.set("required",!1);this._updateCreateViewUI();this._firstRecRadioBtn.set("checked",
!0);this._exprRadioBtn.set("disabled",this.spatialJoin);this._firstRecRadioBtn.set("disabled",this.spatialJoin)},_handleSpatialRelationshipChange:function(a){this.spatialRelationship=a;-1!==this._spatialDistanceOperators.indexOf(a)?(this._spatialDistanceInput.set("required",!0),d.remove(this._spatialDistanceRow,"hide")):(d.add(this._spatialDistanceRow,"hide"),this._spatialDistanceInput.set("required",!1));this._updateCreateViewUI()},_handleSpatialDistanceChange:function(a){this.spatialDistance=a},
_handleSpatialUnitChange:function(a){this.spatialUnit=a},_handleExpBtnClick:function(){this._calcField.set("expression",this._bufFieldOutput.get("value"));this._calcField.reset();this._exprDialog.show()},_repopulateSpatialTypes:function(a,b,c){this._spatialRelationshipSelect.removeOption(this._spatialRelationshipSelect.getOptions());var e;e={value:this.showGeoAnalyticsParams?"Equals":"identicalto",label:this.showGeoAnalyticsParams?this.i18n.equalsLabel:this.i18n.identical};var f={value:this.showGeoAnalyticsParams?
"Intersects":"intersects",label:this.i18n.intersectsLabel},g={value:this.showGeoAnalyticsParams?"Contains":"completelycontains",label:this.showGeoAnalyticsParams?this.i18n.containsLabel:this.i18n.completelyContains},d={value:this.showGeoAnalyticsParams?"Within":"completelywithin",label:this.showGeoAnalyticsParams?this.i18n.withinLabel:this.i18n.completelyWithin},q={value:"Crosses",label:this.i18n.crossesLabel},k={value:"Touches",label:this.i18n.touchesLabel},h={value:"Overlaps",label:this.i18n.overlapsLabel},
n={value:this.showGeoAnalyticsParams?"Near":"withindistance",label:this.showGeoAnalyticsParams?this.i18n.nearPlanar:this.i18n.withinDistance},u={value:"NearGeodesic",label:this.i18n.nearGeodesic};e={esriGeometryPoint:{esriGeometryPoint:this.showGeoAnalyticsParams?[e,f,g,d,n,u]:[e,f,g,d,n],esriGeometryPolyline:this.showGeoAnalyticsParams?[f,d,k,n,u]:[f,d,n],esriGeometryPolygon:this.showGeoAnalyticsParams?[f,d,k,n,u]:[f,d,n]},esriGeometryPolyline:{esriGeometryPoint:this.showGeoAnalyticsParams?[f,g,
k,n,u]:[f,g,n],esriGeometryPolyline:this.showGeoAnalyticsParams?[e,f,g,d,q,k,h,n,u]:[e,f,g,d,n],esriGeometryPolygon:this.showGeoAnalyticsParams?[f,d,q,k,n,u]:[f,d,n]},esriGeometryPolygon:{esriGeometryPoint:this.showGeoAnalyticsParams?[f,g,k,n,u]:[f,g,n],esriGeometryPolyline:this.showGeoAnalyticsParams?[f,g,q,k,n,u]:[f,g,n],esriGeometryPolygon:this.showGeoAnalyticsParams?[e,f,g,d,k,h,n,u]:[e,f,g,d,n]}};c||(this.spatialRelationship=e[a][b][0].value);l.forEach(e[a][b],function(a,b){this._spatialRelationshipSelect.addOption({value:a.value,
label:a.label})},this);this._spatialRelationshipSelect.set("value",this.spatialRelationship)},_handleTemporalCheckChange:function(a,b){d.toggle(this._temporalJoin,"selected");this.temporalJoin=d.contains(this._temporalJoin,"selected");if(m.isDefined(this.targetLayer)&&m.isDefined(this.joinLayer)){var c,e;c=h.isTimeInstantLayer(this.targetLayer)?"TimeInstant":"TimeInterval";e=h.isTimeInstantLayer(this.joinLayer)?"TimeInstant":"TimeInterval";this._repopulateTemporalTypes(c,e,b)}a||d.add(this._temporalDistanceRow,
"hide");d.toggle(this._temporalRelationshipRow,"hide");d.contains(this._temporalRelationshipRow,"hide")&&this._temporalDistanceInput.set("required",!1)},_handleTemporalRelationshipChange:function(a){this.temporalRelationship=a;-1!==this._temporalDistanceOperators.indexOf(a)?(this._temporalDistanceInput.set("required",!0),d.remove(this._temporalDistanceRow,"hide")):(d.add(this._temporalDistanceRow,"hide"),this._temporalDistanceInput.set("required",!1))},_handleTemporalDistanceChange:function(a){this.temporalDistance=
a},_handleTemporalUnitChange:function(a){this.temporalUnit=a},_repopulateTemporalTypes:function(a,b,c){this._temporalRelationshipSelect.removeOption(this._temporalRelationshipSelect.getOptions());var e,f={value:"Equals",label:this.i18n.equalsLabel},g={value:"Intersects",label:this.i18n.intersectsLabel},d={value:"During",label:this.i18n.duringLabel},q={value:"Contains",label:this.i18n.containsLabel},k={value:"Finishes",label:this.i18n.finishesLabel},h={value:"Finished By",label:this.i18n.finishedByLabel},
n={value:"Meets",label:this.i18n.meetsLabel},u={value:"Met By",label:this.i18n.metByLabel},m={value:"Near",label:this.i18n.near},p={value:"NearAfter",label:this.i18n.nearAfter},r={value:"NearBefore",label:this.i18n.nearBefore},ca={value:"Overlaps",label:this.i18n.overlapsLabel},da={value:"Overlapped By",label:this.i18n.overlappedByLabel},t={value:"Starts",label:this.i18n.startsLabel},v={value:"Started By",label:this.i18n.startedByLabel};a&&b&&(e={TimeInstant:{TimeInstant:[f,g,m,p,r],TimeInterval:[g,
d,k,t,m,p,r]},TimeInterval:{TimeInstant:[g,q,h,v,m,p,r],TimeInterval:[f,g,d,q,k,h,n,u,ca,da,t,v,m,p,r]}});c||(this.temporalRelationship=e[a][b][0].value);l.forEach(e[a][b],function(a,b){this._temporalRelationshipSelect.addOption({value:a.value,label:a.label})},this)},_handleAttributeCheckChange:function(a,b){d.toggle(this._attributeJoin,"selected");this.attributeJoin=d.contains(this._attributeJoin,"selected");d.toggle(this._attributeRelationshipRow,"hide");b||(!0===this.attributeJoin?this._createAttrJoinRow():
this._removeAttrJoinRows())},_createAttrJoinRow:function(a){var b,c,e,f;a=r.create("tr",{style:{height:"40px"}},this._attributeRelationshipRow,"before");c=r.create("td",{style:{width:"39%"}},a);e=r.create("td",{style:{width:"8%"}},a);b=r.create("td",{style:{width:"39%"}},a);f=new G({maxHeight:200,"class":"esriLeadingMargin1 esriTrailingMargin1 mediumInput esriVeryShortlabel",style:{width:"90%",overflow:"hidden",tableLayout:"fixed"}},r.create("select",null,c));f.addOption({value:"",label:this.i18n.selectTargetField});
this.targetLayer.fields.forEach(function(a,b){a.type!==v.FieldTypes.ObjectId&&f.addOption({value:this._toString(b+1),label:a.name})},this);f.set("targetLayer",this.targetLayer);f.set("joinLayer",this.joinLayer);e.innerHTML="\x3d";t.set(e,"text-align","center");b=new G({"class":"mediumInput esriLeadingMargin05 esriVeryShortlabel",style:{width:"90%",overflow:"hidden",tableLayout:"fixed"}},r.create("select",null,b));b.addOption({value:"",label:this.i18n.selectJoinField});f.set("statisticSelect",b);z.connect(f,
"onChange",this._handleAttrTargetChange);c=r.create("td",{"class":"shortTextInput removeTd",style:{display:"none",width:"10%",paddingTop:"1em"}},a);e=r.create("a",{title:this.i18n.remove,"class":"closeIcon statsRemove",innerHTML:"\x3cimg src\x3d'"+J.toUrl("./images/close.gif")+"' border\x3d'0''/\x3e"},c);z.connect(e,"onclick",k.hitch(this,this._removeAttrJoinRow,a));this._attrJoinRows.push(a);1===this._attrJoinRows.length&&(f.set("required","true"),b.set("required","true"));a=r.create("td",{style:{width:"10%",
display:"block"}},a);b.set("attributeSelect",f);b.set("removeTd",c);b.set("stylingTd",a);b.set("isnewRowAdded",!1);b.set("referenceWidget",this);f.set("referenceWidget",this);b._watchHandle=b.watch("value",this._handleAttrJoinUpdate);this._currentJoinSelect=b;this._currentTargetSelect=f;return!0},_removeAttrJoinRow:function(a){l.forEach(F.findWidgets(a),function(a){a.destroyRecursive()});r.destroy(a)},_removeAttrJoinRows:function(){l.forEach(this._attrJoinRows,this._removeAttrJoinRow,this);this._attrJoinRows=
[]},_handleAttrTargetChange:function(a,b,c){var e,f,g,d,q=[],h;e=this.get("statisticSelect");a!==this._curTargetAttrValue&&(b&&c||l.forEach(e.getOptions(),function(a){""!==a.value&&e.removeOption(a)},this),""!==a&&(b&&c&&(e.removeOption(e.getOptions()),q.push({value:"",label:this.referenceWidget.i18n.selectJoinField,selected:!1})),g=this.get("targetLayer").fields[a-1]&&this.get("targetLayer").fields[a-1].type,this.get("joinLayer").fields.forEach(function(a,e){a.type!==v.FieldTypes.ObjectId&&(this.referenceWidget.showGeoAnalyticsParams&&
a.type===g||this.referenceWidget.allowAllAttributesTypes)&&(b&&c&&c.joinField===a.name&&(h=e+1+""),q.push({value:e+1+"",label:a.name,selected:b&&c&&c.joinField===a.name}))},this),e._watchHandle&&b&&c&&e._watchHandle.unwatch(),e.addOption(q),e.set("value",h),""===e.get("value")||e.get("isnewRowAdded")||(f=e.get("removeTd"),d=e.get("stylingTd"),t.set(f,"display","block"),t.set(d,"display","none"),f=e.get("referenceWidget"),k.hitch(f,f._createAttrJoinRow)(),e.set("isnewRowAdded",!0))),this._curTargetAttrValue=
a)},_handleAttrJoinUpdate:function(a,b,c){this.get("attributeSelect")&&""!==this.get("attributeSelect").get("value")&&""!==c&&!this.get("isnewRowAdded")&&(a=this.get("removeTd"),t.set(a,"display","block"),a=this.get("referenceWidget"),k.hitch(a,a._createAttrJoinRow)(),this.set("isnewRowAdded",!0))},addExpOperators:function(a){var b=a.selectWidget,c=[{value:"Largest",label:this.i18n.largest},{value:"Smallest",label:this.i18n.smallest}],e=[{value:"Newest",label:this.i18n.newest},{value:"Oldest",label:this.i18n.oldest}],
f=m.isDefined(a.emptyValue)?a.emptyValue:"";b.removeOption(b.getOptions());b.addOption([{value:f,label:this.i18n.sortBy}]);a.type&&"number"===a.type?b.addOption(c):a.type&&"date"===a.type&&b.addOption(e);b.set("value",f)},_handleShowCreditsClick:function(a){var b={};a.preventDefault();this._form.validate()&&(b=this._buildJobParams(),this.getCreditsEstimate(this.toolName,b).then(k.hitch(this,function(a){b.outputType===B.FLAYERVIEW&&(a.cost=0,a.infoMessage=this.i18n.zeroCreditsViewResult);this._usageForm.set("content",
a);this._usageDialog.show()})))},_canCreateView:function(a){var b=!1;return b=!!a&&!!this.joinLayer&&!!this.targetLayer&&this._isOwner(this.joinLayer,a)&&this._isOwner(this.targetLayer,a)&&!this._isMultiServiceViewLayer(this.targetLayer)&&!this._isMultiServiceViewLayer(this.joinLayer)&&!this.spatialJoin},_isMultiServiceViewLayer:function(a){var b=!1;a._json&&(a=p.fromJson(a._json),b=a.isMultiServicesView);return b},_isOwner:function(a,b){return this.isOwner(a,b)&&(a.url?-1!==a.url.indexOf(b.orgId):
!0)},_enableCreateViewUI:function(a){!a&&this._checkCreateView.get("checked")&&this._checkCreateView.set("checked",a);this._checkCreateView.set("disabled",!a)},_handleCreateViewChange:function(a){this._useExtentCheck.get("checked")&&a&&this._useExtentCheck.set("checked",!a)},_handleExtentChange:function(a){this._checkCreateView.get("checked")&&a&&this._checkCreateView.set("checked",!a)},_handleJoinOneToOneOptionChange:function(a){h.updateDisplay([this._joinRecordRow],"RECORD"===a);h.updateDisplay([this._joinOneOneOptionsHelpTd],
"STATS"===a,"table-cell");this._summaryWidget.set("required",!1);this._summaryWidget.hide();"STATS"===a&&(this._summaryWidget.set("required",!0),this._summaryWidget.show());this._handleExprRadioChange(this._exprRadioBtn.get("checked"))},_handleExprRadioChange:function(a){this._expFieldsSelect.set("disabled",!a);this._expFilterSelect.set("disabled",!a);this._expFieldsSelect.set("required","RECORD"===this._joinOptionSelect.get("value")&&a);this._expFilterSelect.set("required","RECORD"===this._joinOptionSelect.get("value")&&
a)},_handleExpFieldChange:function(a){a=this._expFieldsSelect.getOptions(a);this.addExpOperators({selectWidget:this._expFilterSelect,type:a&&a.type,showGeoAnalyticsParams:this.showGeoAnalyticsParams})},_getSourceLayerFields:function(a){a=l.filter(a,function(a){return a.type!==v.FieldTypes.ObjectId});return l.map(a,function(a){var b={name:a.name,alias:a.alias,source:a.source?a.source:a.name};a.statisticType&&(b.statisticType=a.statisticType,"MEAN"===b.statisticType&&(b.statisticType="AVG"));return b})},
_getSourceServiceName:function(a){return a.substring(a.indexOf("/services/")+10,a.indexOf("/FeatureServer/"))},_getLogicalTableName:function(a){return a+"_"+(new Date).getTime()},_arrIntersections:function(a,b,c){return l.filter(a,function(a){if(c){var e=b.map(function(a){return a[c]});return-1!==l.indexOf(e,a[c])}return-1!==l.indexOf(b,a)})},_updateSameFieldsInRelTable:function(a,b){a=this._arrIntersections(a,b,"name");var c=l.map(a,function(a){return a.name});0<a.length&&l.forEach(b,function(a){-1!==
l.indexOf(c,a.name)&&(a.name=this._getLogicalTableName(a.name))},this)},_createIntermediateTableView:function(a){var b=new E,c={layers:[{name:"",description:"tablestatsjoin",adminLayerInfo:{viewLayerDefinition:{table:{materialized:!1}}}}]},e=a.jobParams;a=a.resultService;var f=this._getSourceServiceName(this.joinLayer.url),g=[],d=[],q,h,m,n;h=c.layers[0].adminLayerInfo.viewLayerDefinition.table;h.name=this._getLogicalTableName(f)+"_StatsTable";c.layers[0].name=f+"_StatsTable";n=p.fromJson(e.joinLayer);
h.sourceServiceName=f;h.sourceLayerId=this.joinLayer.layerId;n.filter&&(h.filter={sqlExpression:n.filter});l.forEach(e.attributeRelationship,function(a){a=p.fromJson(a);g.push(a.targetField);d.push(a.joinField)},this);q=l.filter(this.joinLayer.fields,function(a){return-1!==l.indexOf(d,a.name)});e.summaryFields&&(m=!1,l.forEach(e.summaryFields,function(a){var b=p.fromJson(a);a=this.joinLayer.fields.findIndex(k.hitch(this,function(a){return a.name===b.onStatisticField}));a=k.mixin({},this.joinLayer.fields[a],
{statisticType:b.statisticType});m||(q.push({name:"Join_Count",alias:"Join_Count",statisticType:"Count",source:"esriFieldTypeDate"===a.type?d[0]+"":a.name+""}),m=!0);a.source=a.name+"";a.name=a.name+"_"+a.statisticType;a.alias=a.alias+"_"+a.statisticType;q.push(a)},this));h.sourceLayerFields=this._getSourceLayerFields(q);h.groupBy=d.join();this._addToDefinition(a.url,c).then(k.hitch(this,function(a){b.resolve({interTableViewParams:c,response:a})}),k.hitch(this,function(a){b.reject(a)}));return b.promise},
getViewParams:function(a){var b=new E,c=a.jobParams,e=a.resultService,f;O([this._getAdminLayerInfo(this.targetLayer.url),this._getAdminLayerInfo(this.joinLayer.url)]).then(k.hitch(this,function(a){var d=k.clone(aa.joinFeatures),g,h,m=[],n=[];h=a[0].adminLayerInfo;a=a[1].adminLayerInfo;var u=this._getSourceServiceName(this.targetLayer.url),r=this._getSourceServiceName(this.joinLayer.url),t,v;f=p.fromJson(c[this.outputName]);t=p.fromJson(c.targetLayer);v=p.fromJson(c.joinLayer);d.layers[0].name=f.serviceProperties?
f.serviceProperties.name:this._outputName.get("value");g=d.layers[0].adminLayerInfo.viewLayerDefinition.table;g.name=this._getLogicalTableName(u)+"_target";g.sourceServiceName=u;g.sourceLayerId=this.targetLayer.layerId;g.sourceLayerFields=this._getSourceLayerFields(this.targetLayer.fields);t.filter&&(g.filter={sqlExpression:t.filter});h.geometryField&&h.geometryField.name?d.layers[0].adminLayerInfo.geometryField.name=g.name+"."+h.geometryField.name:d.layers[0].adminLayerInfo.geometryField=null;g.relatedTables[0].type=
"INNER";if("JoinOneToOne"===c.joinOperation&&c.summaryFields&&0<c.summaryFields.length)this._createIntermediateTableView({viewParams:d,targetALinfo:h,joinALinfo:a,jobParams:c,resultService:e}).then(k.hitch(this,function(a){a=a.interTableViewParams.layers[0];g.relatedTables[0].name=a.name;g.relatedTables[0].sourceServiceName=d.layers[0].name;g.relatedTables[0].sourceLayerId=0;g.relatedTables[0].sourceLayerFields=l.map(a.adminLayerInfo.viewLayerDefinition.table.sourceLayerFields,function(a){return{name:a.name,
alias:a.alias,source:a.name}});l.forEach(c.attributeRelationship,function(a){a=p.fromJson(a);m.push(a.targetField);n.push(a.joinField)},this);g.relatedTables[0].parentKeyFields=m;g.relatedTables[0].keyFields=n;b.resolve(d)}),k.hitch(this,function(){b.reject()}));else{g.relatedTables[0].name=this._getLogicalTableName(r)+"_join";g.relatedTables[0].sourceServiceName=r;g.relatedTables[0].sourceLayerId=this.joinLayer.layerId;v.filter&&(g.relatedTables[0].filter={sqlExpression:v.filter});if("JoinOneToMany"===
c.joinOperation||"JoinOneToOne"===c.joinOperation&&!c.summaryFields)g.relatedTables[0].sourceLayerFields=this._getSourceLayerFields(this.joinLayer.fields),this._updateSameFieldsInRelTable(g.sourceLayerFields,g.relatedTables[0].sourceLayerFields);c.spatialRelationship?(g.relatedTables[0].parentKeyFields=[h.geometryField.name],g.relatedTables[0].keyFields=[a.geometryField.name],g.relatedTables[0].operator="completelycontains"===c.spatialRelationship?"esriSpatialRelContains":"intersects"===c.spatialRelationship?
"esriSpatialRelIntersects":"esriSpatialRelWithin"):(h=c.attributeRelationship,l.forEach(h,function(a){a=p.fromJson(a);m.push(a.targetField);n.push(a.joinField)},this),g.relatedTables[0].parentKeyFields=m,g.relatedTables[0].keyFields=n,"JoinOneToOne"===c.joinOperation&&this.showRecordToKeepOption&&!c.summaryFields&&(g.relatedTables[0].topFilter=this._getTopFilter(n)));b.resolve(d)}}),k.hitch(this,function(a){b.reject(a)}));return b.promise},_getTopFilter:function(a){var b={};a||(a=[]);return b=this._exprRadioBtn.get("checked")?
{groupByFields:a.join(","),orderByFields:this._getOrderByFields(),topCount:1}:{groupByFields:a.join(","),orderByFields:this.joinLayer.objectIdField+" ASC",topCount:1}},_getOrderByFields:function(){var a="",b=this._expFilterSelect.get("value");this._exprRadioBtn.get("checked")&&(a=this._expFieldsSelect.get("value"),a="Largest"===b||"Newest"===b?a+" DESC":a+" ASC");return a},_buildJobParams:function(){var a={},b;a.targetLayer=this.constructAnalysisInputLyrObj(this.targetLayer);this.doRefreshItem="table"!==
this.targetLayer.type.toLowerCase();a.joinLayer=this.constructAnalysisInputLyrObj(this.joinLayer);this.showGeoAnalyticsParams||(a.targetLayer=p.toJson(a.targetLayer),a.joinLayer=p.toJson(a.joinLayer));a.joinOperation=this.get("joinOperation");this._bufFieldOutput.get("value")&&(a.joinCondition=this._bufFieldOutput.get("value"));this.spatialJoin&&(a.spatialRelationship=this._spatialRelationshipSelect.get("value"),-1!==this._spatialDistanceOperators.indexOf(a.spatialRelationship)&&(this.showGeoAnalyticsParams?
(a.spatialNearDistance=parseFloat(this.get("spatialDistance")),a.spatialNearDistanceUnit=this._spatialUnitSelect.get("value")):(a.spatialRelationshipDistance=parseFloat(this.get("spatialDistance")),a.spatialRelationshipDistanceUnits=this._spatialUnitSelect.get("value"))));this.temporalJoin&&(a.temporalRelationship=this._temporalRelationshipSelect.get("value"),-1!==this._temporalDistanceOperators.indexOf(a.temporalRelationship)&&(a.temporalNearDistance=parseFloat(this.get("temporalDistance")),a.temporalNearDistanceUnit=
this._temporalUnitSelect.get("value")));if(this.attributeJoin){var c=[],e=0;l.forEach(this._attrJoinRows,function(a,b,d){var g={},f=0,h="";l.forEach(a.children,function(a,b){if(3>b){if(1!==b)var c=F.byNode(a.children[0]).get("value");0===b&&""!==c&&(f++,h=this.targetLayer.fields[parseInt(c,10)-1].type,g.targetField=a.textContent);1===b&&(f++,g.operator="\x3d"===a.textContent?this._getEqualParamValue(h):a.textContent);2===b&&""!==c&&(f++,g.joinField=a.textContent)}},this);3===f&&(c.push(this.showGeoAnalyticsParams?
g:p.toJson(g)),e++)},this);a.attributeRelationship=this.showGeoAnalyticsParams?p.toJson(c):c}"JoinOneToOne"===this._joinOperation.get("value")&&(b=this._summaryWidget.get("summaryFields"),0<b.length?a.summaryFields=this.showGeoAnalyticsParams?p.toJson(b):b:this.showRecordToKeepOption&&!this.spatialJoin&&"RECORD"===this._joinOptionSelect.get("value")&&(a.recordsToMatch=p.toJson(this._getTopFilter())));this.showChooseExtent&&this._useExtentCheck.get("checked")&&(a.context=p.toJson({extent:this.map.extent._normalize(!0)}));
a.OutputName=p.toJson({serviceProperties:{name:this._outputName.get("value")}});!this.showGeoAnalyticsParams&&this._checkCreateView.get("checked")&&(a.outputType=B.FLAYERVIEW);return this._updateJobFilterAndSelection(a)},_getEqualParamValue:function(a){return this.showGeoAnalyticsParams&&a===v.FieldTypes.String?"equalIgnoreCaseTrimWhitespace":"equal"},_handleSaveBtnClick:function(){var a={},b={};this._summaryWidget.updateRequiredAttributes();if(this._form.validate())if("_NOVALUE_"===this._joinLayerSelect.get("value"))this._showMessages(this.i18n.joinLayerErrorMsg);
else if("_NOVALUE_"===this._joinOperation.get("value"))this._showMessages(this.i18n.joinOpErrorMsg);else if(this.attributeJoin||this.temporalJoin||this.spatialJoin){this._handleCloseMsg();this._saveBtn.set("disabled",!0);a=this._buildJobParams();b.jobParams=a;b.itemParams={description:this.i18n.itemDescription,tags:this.i18n.itemTags,snippet:this.i18n.itemSnippet};this.showSelectFolder&&(b.itemParams.folder=this.get("folderId"));if(this.showGeoAnalyticsParams){a=h.checkPCSforAnalysis({widget:this,
jobParams:a});if(!a)return;b.isSpatioTemporalDataStore=!0}this.resultParameter=this.showGeoAnalyticsParams?"output":"outputLayer";this.execute(b)}else this._showMessages(this.i18n.joinTypesErrorMsg)},_setDisableRunAnalysisAttr:function(a){this._saveBtn.set("disabled",a)},_setTargetLayerAttr:function(a){this._set("targetLayer",a||null)},_setTargetLayersAttr:function(a){this._set("targetLayers",a||[])},_setJoinLayerAttr:function(a){this._set("joinLayer",a||null)},_setShowSpatialJoinAttr:function(a){this._set("showSpatialJoin",
a)},_setShowAttributeJoinAttr:function(a){this._set("showAttributeJoin",a)},_setShowTemporalJoinAttr:function(a){this._set("showTemporalJoin",a)},_setShowJoinConditionAttr:function(a){this._set("showJoinCondition",a)},_setJoinLayersAttr:function(a){this._set("joinLayers",a||[])},_handleBrowseItemsSelect:function(a,b){a&&a.selection&&h.addAnalysisReadyLayer({item:a.selection,layers:this._isAnalysisSelect?this.targetLayers:this.joinLayers,layersSelect:this._isAnalysisSelect?this._targetLayerSelect:
this._joinLayerSelect,posIncrement:0,browseDialog:a.dialog||this._browsedlg,widget:this},b)},_save:function(){},_onClose:function(a){a&&(this._save(),this.emit("save",{save:!0}));this.emit("close",{save:a})},_loadConnections:function(){this.on("start",k.hitch(this,"_onClose",!0));this._connect(this._closeBtn,"onclick",k.hitch(this,"_onClose",!1));this._spatialJoinHandle=A.pausable(this._spatialJoinCtr,"click",k.hitch(this,this._handleSpatialCheckChange));this._temporalJoinHandle=A.pausable(this._temporalJoinCtr,
"click",k.hitch(this,this._handleTemporalCheckChange));this._attributeJoinHandle=A.pausable(this._attributeJoinCtr,"click",k.hitch(this,this._handleAttributeCheckChange));this.own(this._spatialJoinHandle,this._temporalJoinHandle,this._attributeJoinHandle)},_connect:function(a,b,c){this._pbConnects.push(z.connect(a,b,c))},_updateAnalysisLayerUI:function(a){this._expBtn.set("disabled",!this.targetLayer);this._bufFieldOutput.set("disabled",!this.targetLayer);if(this.targetLayer){var b=this._joinLayerSelect.getOptions(),
c=!1,c=!1;a&&(this.outputLayerName=N.substitute(this.i18n.outputLayerName,{targetLayerName:this.targetLayer.name}),this._outputName.set("value",this.outputLayerName));this._isAnalysisSelect&&(c=l.some(b,function(a,b){return a.label===this.targetLayer.title},this),c||(c=this.showBrowseLayers&&this.showReadyToUseLayers?3:!this.showBrowseLayers&&this.showReadyToUseLayers?2:this.showBrowseLayers&&!this.showReadyToUseLayers?2:0,b=b.splice(b.length-c,c),c=l.some(this.joinLayers,function(a){return a&&a.analysisReady&&
this.targetLayer.analysisReady&&a.itemId===this.targetLayer.itemId},this),c||(this.joinLayers.push(this.targetLayer),1===this.joinLayers.length&&this._handleJoinLayerChange(0)),b.unshift({value:this.joinLayers.length-1,label:this.targetLayer.title}),this._joinLayerSelect.addOption(b),1===this.joinLayers.length&&this._joinLayerSelect.set("value",0)));var b={},e;e=l.map(this.targetLayer.fields,function(a){var b=k.clone(a);k.mixin(b,{name:'target["'+a.name+'"]',alias:'target["'+a.alias+'"]'});return b},
this);c=l.map(this.joinLayer.fields,function(a){var b=k.clone(a);k.mixin(b,{name:'join["'+a.name+'"]',alias:'join["'+a.alias+'"]'});return b},this);b.fields=[].concat(c,e);if(this.showJoinCondition)if(c=[],c.push(this.makeArcadeProfile(this.joinLayer,"$join")),c.push(this.makeArcadeProfile(this.targetLayer,"$target")),this._calcField)this._calcField&&this._calcField.layer!==this.inputLayer&&(this._bufFieldOutput.set("value",""),this._calcField.reset(),this._calcField.set("arcadeProfile",c),this._calcField.set("layer",
b));else{e=h.getExprFunctions();e=l.filter(e,function(a){return a&&a.name&&-1===a.name.indexOf("as_")});this._calcField=new x({expressionMode:x.MODE_ARCADE,arcadeEditor:this.arcadeEditor,map:this.map,layer:b,field:this.i18n.bufField,baseClass:"esriBufFieldExp",helperMethods:e,showHelp:!0,helpUrl:h.getHelpUrl({widget:this,topic:"BufferExpression"}),css:{base:"esriBufFieldExp",addButton:"btn calcite primary",closeButton:"btn calcite cancel"},helperType:"numeric",showHeader:!1,arcadeProfile:c,calculateLabel:this.i18n.add,
expression:this._bufFieldOutput.get("value")},this._expressionCtr);this._calcField.startup();if(this._calcField.expressionMode===x.MODE_SQL)t.set(this._calcField._validateBtn.domNode,"display","none"),this._calcField._handleHelperTypeChange("value",null,{functionType:"NumType"}),this._aspectHandle=K.around(this._calcField,"_handleAddButtonClick",k.hitch(this,function(a){return k.hitch(this,function(a,b){a=this._calcField.get("expression")[0];this._bufFieldOutput.set("value",a.sqlExpression);this._exprDialog.hide()})}));
else if(this._calcField.expressionMode===x.MODE_ARCADE)this._calcField.on("expression-add",k.hitch(this,function(a){this._bufFieldOutput.set("value",a.expression)}));this._calcField.on("close",k.hitch(this,function(){this._exprDialog.hide()}))}}m.isDefined(this.joinLayer)&&this._summaryWidget.set("layer",this.joinLayer);a?(this.temporalJoin=this.attributeJoin=this.spatialJoin=!1,this._summaryWidget.hide(),this._removeAttrJoinRows(),d.contains(this._spatialJoin,"selected")&&(d.remove(this._spatialJoin,
"selected"),d.add(this._spatialDistanceRow,"hide"),d.add(this._spatialRelationshipRow,"hide"),this._spatialRelationshipSelect.reset(),this._spatialDistanceInput.set("required",!1)),d.contains(this._temporalJoin,"selected")&&(d.remove(this._temporalJoin,"selected"),d.add(this._temporalRelationshipRow,"hide"),d.add(this._temporalDistanceRow,"hide"),this._temporalDistanceInput.set("required",!1)),d.contains(this._attributeJoin,"selected")&&(d.remove(this._attributeJoin,"selected"),d.add(this._attributeRelationshipRow,
"hide")),m.isDefined(this.targetLayer)&&m.isDefined(this.joinLayer)&&"_NOVALUE_"!==this._joinLayerSelect.get("value")?("JoinOneToOne"!==this._joinOperation.get("value")||this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&"STATS"!==this._joinOptionSelect.get("value")||this._summaryWidget.show(),d.remove(this._spatialJoin,"disabled"),d.remove(this._attributeJoin,"disabled"),d.remove(this._spatialJoinLabel,"esriAnalysisTextDisabled"),d.remove(this._attrJoinLabel,"esriAnalysisTextDisabled"),this._spatialJoinHandle.resume()):
(d.add(this._spatialJoin,"disabled"),d.add(this._attributeJoin,"disabled"),d.add(this._temporalJoin,"disabled"),d.add(this._spatialJoinLabel,"esriAnalysisTextDisabled"),d.add(this._attrJoinLabel,"esriAnalysisTextDisabled"),d.add(this._temporalJoinLabel,"esriAnalysisTextDisabled"),this._attributeJoinHandle.pause(),this._spatialJoinHandle.pause(),this._temporalJoinHandle.pause())):(this.spatialRelationship&&(this.spatialJoin=!0,this._spatialRelationshipSelect.set("value",this.spatialRelationship),this._handleSpatialCheckChange(this.spatialJoin,
!a),this.spatialDistance&&this._spatialDistanceInput.set("value",this.spatialDistance)),this.attributeRelationship&&(this.attributeJoin=!0,this._handleAttributeCheckChange(this.attributeJoin,!a),this.attributeRelationship&&this.targetLayer&&this.joinLayer&&(this._isAttrAdded=!1,this._createAttrJoinRow(this.attributeRelationship),this.attributeRelationship&&!this.attributeRelationship.length&&(this.attributeRelationship=[this.attributeRelationship]),l.forEach(this.attributeRelationship,function(b){var c=
l.map(this.targetLayer.fields,function(a){return a.name}),c=l.indexOf(c,b.targetField);this._currentTargetSelect.set("value",c+1+"");k.hitch(this._currentTargetSelect,this._handleAttrTargetChange,this._currentTargetSelect.get("value"),!a,b)()},this),this._isAttrAdded=!0)),this.temporalRelationship&&(this.temporalJoin=!0,this._handleTemporalCheckChange(this.temporalJoin,!a),this._temporalRelationshipSelect.set("value",this.temporalRelationship)),this.summaryFields&&this._summaryWidget.set("summaryFields",
this.summaryFields));m.isDefined(this.targetLayer)&&m.isDefined(this.joinLayer)&&"_NOVALUE_"!==this._joinLayerSelect.get("value")&&(b=!(h.isTimeEnabled(this.joinLayer)&&h.isTimeEnabled(this.targetLayer)),d.toggle(this._temporalJoin,"disabled",b),d.toggle(this._temporalJoinLabel,"esriAnalysisTextDisabled",b),this._attributeJoinHandle.resume(),b?this._temporalJoinHandle.pause():this._temporalJoinHandle.resume());m.isDefined(this.targetLayer)&&m.isDefined(this.joinLayer)&&(this.targetLayer.type&&"table"===
this.targetLayer.type.toLowerCase()||this.joinLayer.type&&"table"===this.joinLayer.type.toLowerCase())&&(d.add(this._spatialJoin,"disabled"),d.add(this._spatialJoinLabel,"esriAnalysisTextDisabled"),this._spatialJoinHandle.pause());this._updateCreateViewUI()},_updateCreateViewUI:function(){this.getUserProfile().then(k.hitch(this,function(a){this.spatialRelationship=this._spatialRelationshipSelect.get("value");this._enableCreateViewUI(this._canCreateView(a))}))},_setAttributeRelationshipAttr:function(a){var b,
c=[];a&&"string"===typeof a&&(b=a.split(" and "),l.forEach(b,function(a){a=a.split(" \x3d ");c.push({targetField:-1!==a[0].indexOf('["')?a[0].substring(a[0].indexOf('["')+2,a[0].indexOf('"]')):a[0],operator:"equal",joinField:-1!==a[1].indexOf('["')?a[1].substring(a[1].indexOf('["')+2,a[1].indexOf('"]')):a[1]})}),a=c);l.forEach(a,function(b,c){"string"===typeof b&&-1!==b.indexOf("{")&&(a[c]=h.tryParseJSON(b))},this);this.attributeRelationship=a},_setAnalysisGpServerAttr:function(a){a&&(this.analysisGpServer=
a,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},validateServiceName:function(a){return h.validateServiceName(a,{textInput:this._outputName})},_showMessages:function(a){w.set(this._bodyNode,"innerHTML",a);C.fadeIn({node:this._errorMessagePane,easing:D.quadIn,onEnd:k.hitch(this,function(){t.set(this._errorMessagePane,{display:""})})}).play()},_handleCloseMsg:function(a){a&&a.preventDefault();C.fadeOut({node:this._errorMessagePane,easing:D.quadOut,onEnd:k.hitch(this,function(){t.set(this._errorMessagePane,
{display:"none"})})}).play()},makeArcadeProfile:function(a,b){if(a){var c=a.fields,e={layer:a,popupInfo:a.infoTemplate?a.infoTemplate.toJson():null},d;b={type:"Feature",value:{attributes:null,geometry:null,layer:{fields:l.map(c,function(a){a.domain&&-1<l.indexOf(["range","codedValue"],a.domain.type)&&(a=k.clone(a),a.domain=a.domain.toJson?a.domain.toJson():a.domain);return a}),objectIdField:a.objectIdField,typeIdField:a.typeIdField,types:a.types?l.map(a.types,function(a){return a.toJson?a.toJson():
a}):null,templates:a.templates}},id:m.isDefined(b)?b:"$feature"};e._queryResponse&&e._queryResponse.features&&e._queryResponse.features.length?(b.value.attributes=k.clone(e._queryResponse.features[0].attributes),b.value.geometry=e._queryResponse.features[0].geometry):e._queryResponse&&e._queryResponse[a.url]&&e._queryResponse[a.url].features&&e._queryResponse[a.url].features.length?(b.value.attributes=k.clone(e._queryResponse[a.url].features[0].attributes),b.value.geometry=e._queryResponse[a.url].features[0].geometry):
a.graphics&&a.graphics.length&&a.geometryType?(b.value.attributes=k.clone(a.graphics[0].attributes),b.value.geometry=a.graphics[0].geometry.toJson()):(d={},l.forEach(c,function(a){-1<l.indexOf("esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGlobalID".split(" "),a.type)?!1===a.nullable?a.defaultValue?d[a.name]=a.defaultValue:-1<l.indexOf(["esriFieldTypeString"],a.type)?d[a.name]="":d[a.name]=
0:d[a.name]=null:d[a.name]=null}),b.value.attributes=d,c=this.map.extent,"esriGeometryPolygon"==a.geometryType||a.getCustomRasterFields?(b.value.geometry=new Z(new H(this.map.spatialReference.toJson())),b.value.geometry.addRing([[c.xmin,c.ymin],[c.xmax,c.ymin],[c.xmax,c.ymax],[c.xmin,c.ymax],[c.xmin,c.ymin]])):"esriGeometryPoint"==a.geometryType||a.geometryType==v.GeometryTypes.MultiPoint?b.value.geometry=new X(c.getCenter().toJson()):"esriGeometryPolyline"==a.geometryType&&(b.value.geometry=new Y(new H(this.map.spatialReference.toJson())),
b.value.geometry.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]])));return b}}});M("extend-esri")&&k.setObject("dijit.analysis.JoinFeatures",y,U);return y});