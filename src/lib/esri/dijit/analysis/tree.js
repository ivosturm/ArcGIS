// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/analysis/tree","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/query dojo/on dojo/has dojo/aspect dgrid/util/has-css3 dgrid/Grid dojo/has!touch?dgrid/util/touch put-selector/put ../../kernel".split(" "),function(F,y,z,A,t,B,C,e,u,D,v,m,E){function w(c,e,h,d){d=this.grid.isRTL?"right":"left";var b=".dgrid-expando-icon";e&&(b+=".ui-icon.ui-icon-triangle-1-"+(h?"se":"e"));c=m("div"+b+"[style\x3dmargin-"+d+": "+c*(this.indentWidth||9)+"px; float: "+d+"]");
c.innerHTML="\x26nbsp;";return c}function x(c){var e=this,h=this.style.height;h&&(this.style.display="0px"==h?"none":"block");c&&(m(this,".dgrid-tree-resetting"),setTimeout(function(){m(e,"!dgrid-tree-resetting")}));this.style.height=""}function k(c){var k=c.renderCell||D.defaultRenderCell,h,d;c||(c={});c.shouldExpand=c.shouldExpand||function(b,c,f){return f};e.after(c,"init",function(){var b=c.grid,k=".dgrid-content .dgrid-column-"+c.id,f=[];b.cleanEmptyObservers=!1;if(!b.store)throw Error("dgrid tree column plugin requires a store to operate.");
c.renderExpando||(c.renderExpando=w);f.push(b.on(c.expandOn||".dgrid-expando-icon:click,"+k+":dblclick,"+k+":keydown",function(a){var c=b.row(a);b.store.mayHaveChildren&&!b.store.mayHaveChildren(c.data)||"keydown"==a.type&&32!=a.keyCode||"dblclick"==a.type&&d&&1<d.count&&c.id==d.id&&-1<a.target.className.indexOf("dgrid-expando-icon")||b.expand(c);-1<a.target.className.indexOf("dgrid-expando-icon")&&(d&&d.id==b.row(a).id?d.count++:d={id:b.row(a).id,count:1})}));u("touch")&&f.push(b.on(v.selector(k,
v.dbltap),function(){b.expand(this)}));b._expanded||(b._expanded={});f.push(e.after(b,"insertRow",function(a){var b=this.row(a);c.shouldExpand(b,h,this._expanded[b.id])&&this.expand(a,!0,!0);return a}));f.push(e.before(b,"removeRow",function(a,c){if(a=a.connected)t("\x3e.dgrid-row",a).forEach(function(a){b.removeRow(a,!0)}),c||m(a,"!")}));c.collapseOnRefresh&&f.push(e.after(b,"cleanup",function(){this._expanded={}}));b._calcRowHeight=function(a){var b=a.connected;return a.offsetHeight+(b?b.offsetHeight:
0)};b.expand=function(a,g,f){var n=a.element?a:b.row(a),d=u("transitionend");a=n.element;if((a=-1<a.className.indexOf("dgrid-expando-icon")?a:t(".dgrid-expando-icon",a)[0])&&a.mayHaveChildren&&(f||g!==!!this._expanded[n.id])){var e=void 0===g?!this._expanded[n.id]:g;m(a,".ui-icon-triangle-1-"+(e?"se":"e")+"!ui-icon-triangle-1-"+(e?"e":"se"));var k=a.preloadNode;g=n.element;var l,h,q,r={originalQuery:this.query};if(!k){l=g.connected=m("div.dgrid-tree-container");var k=a.preloadNode=m(g,"+",l,"div.dgrid-preload"),
p=function(a){return b.store.getChildren(n.data,a)};c.allowDuplicates&&(r.parentId=n.id);"level"in a&&(p.level=a.level);z.when(b.renderQuery?b._trackError(function(){return b.renderQuery(p,k,r)}):b.renderArray(p(r),k,"level"in p?{queryLevel:p.level}:{}),function(){if(b._expanded[n.id]&&d){var a=l.scrollHeight;l.style.height=a?a+"px":"auto"}});d?B(l,d,x):x.call(l)}l=g.connected;l.hidden=!e;h=l.style;!d||f?(h.display=e?"block":"none",h.height=""):(e?(h.display="block",q=l.scrollHeight,h.height="0px"):
(m(l,".dgrid-tree-resetting"),h.height=l.scrollHeight+"px"),setTimeout(function(){m(l,"!dgrid-tree-resetting");h.height=e?q?q+"px":"auto":"0px"}));e?this._expanded[n.id]=!0:delete this._expanded[n.id]}};e.after(c,"destroy",function(){y.forEach(f,function(a){a.remove()});delete b.expand;delete b._calcRowHeight})});c.renderCell=function(b,e,d,a){var g=c.grid,f=Number(a&&a.queryLevel)+1,n=!g.store.mayHaveChildren||g.store.mayHaveChildren(b),m=a.parentId,f=h=isNaN(f)?0:f,g=c.renderExpando(f,n,g._expanded[(m?
m+"-":"")+g.store.getIdentity(b)],b);g.level=f;g.mayHaveChildren=n;a.level=f;k.call(c,b,e,d,a);d.insertBefore(g,d.firstChild)};return c}k.defaultRenderExpando=w;C("extend-esri")&&A.setObject("dijit.analysis.tree",k,E);return k});