// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/columnBarLine/_ColumnBarChartSeriesCalculator","dojo/_base/lang ../../ThemeCalculator ../../ChartSorting ../../ChartLineStyles ../../../../supportClasses/conditionalStyling/ConditionalStyleUtil ../utils/TooltipInfoBuilder ./_ComparisonUtil ./_AxisBuilder ./_PointLabelUtil ./_StatsBuilder esri/dijit/geoenrichment/utils/ColorUtil".split(" "),function(I,A,t,u,J,K,L,v,B,M,G){var N={calcLineStyle:function(a,d){return{color:G.getColorWithAlpha(d.outlineColor||
a,d.outlineOpacity),width:d.outlineThickness,style:u.toGFXValue(d.outlineStyle||u.SOLID)}}};return{calcSeriesColumnBar:function(a){var d=a.chart,e=a.visualProperties,f=a.seriesItems,u=1===f.length,n=a.seriesItemsWithComparison||f,m=a.chartType,D=a.comparisonInfo,E=a.themeSettings,w=a.viewModel,p=1===n.length&&a.sorting,O=1<n.length&&e.renderColumnBarsInOppositeDirections,q=[],H=new M({visualProperties:e,seriesItems:n,viewModel:w,currentFeatureIndex:a.currentFeatureIndex,isMultiFeatureChart:a.isMultiFeatureChart,
excludedSeriesHash:a.excludedSeriesHash,comparisonFeatureAttributes:a.comparisonFeatureAttributes,chartType:m});B.createPointToLabelMap(d);var F={};n.forEach(function(g,f){if(g.points.length){var x={name:g.label,data:[],isComparisonSeries:g.isComparisonSeries,params:{plot:g.isComparisonSeries&&L.getComparisonPlotName(m,D)||void 0}},b=H.gettatisticsForSeriesAt(f);A.provideMissingIconsForPoints(g.points,m);var v=[];g.points.forEach(function(c,l){var d=b.values[l],C=d.value,h=C||0,k;if(e.conditionalStyling){var r=
J.getConditionalStyle(d.isBenchmarked?d.ownValue:h,e.conditionalStyling);k=r&&r.backgroundColor}k=k||A.calcColorForPoint({point:c,seriesItem:g,pointIndex:l,seriesIndex:f,numSeries:u?1:n.length,chartType:m,themeSettings:E,isComparisonSeries:g.isComparisonSeries,comparisonInfo:D,isMultiFeature:a.isMultiFeatureChart});var y=N.calcLineStyle(k,e),p=k;k=1>e.columnBarOpacity?G.getColorWithAlpha(k,e.columnBarOpacity):k;var z;c.hidden&&(z=k,k=p="transparent");var q;c.hidden&&(q=y.color,y.color="transparent");
r=l+1;h={x:r,y:h*(O&&f>=n.length/2?-1:1),originalValue:C,isUnavailableData:isNaN(C),valueProp:"y",unsortedIndex:l,originalIndex:c.originalIndex||l,seriesIndex:f,name:B.getPointLabel(c,w),valuesSumsInSeries:b.absSumInSeries,point:c,fill:k,icon:A.calcIconForPoint(c,p,m),bgIcon:A.calcBackgroundIconForPoint(c,m,E,e),stroke:{color:y.color,width:y.width,style:y.style},unhiddenFillColor:z,unhiddenLineColor:q,isBenchmarked:d.isBenchmarked,unbenchmarkedValue:d.ownValue};e.isStacked&&(z=e.showValuesAsWeightInStack?
b.stackValuesAsWeighedPercents:b.stackValues,h.stackValues=z&&z[l]);e.showValuesAsWeightInStack?h.y=b.weightsInStack?100*b.weightsInStack[l]:0:e.yAxis.showValuesAsWeightsInSeries&&(h.y/=b.absSumInSeries/100);c=K.getTooltipInfo({yValue:C,pointLabel:B.getPointLabel(n[0].points[l]||c,w),seriesLabel:g.label,isSinglePointInSeries:1===g.points.length,minInSeriesValue:b.minInSeries,maxInSeriesValue:b.maxInSeries,sumInSeriesValue:b.sumInSeries,absSumInSeriesValue:b.absSumInSeries,avgInSeriesValue:b.avgInSeries,
weightInStack:b.weightsInStack&&b.weightsInStack[l],minInAreasValue:b.minInSeries,maxInAreasValue:b.maxInSeries,sumInAreasValue:b.sumInSeries,absSumInAreasValue:b.absSumInSeries,avgInAreasValue:b.avgInSeries,visualProperties:e,chartType:m,isMultiFeature:a.isMultiFeatureChart,conditionalStyling:e.conditionalStyling,fieldInfo:c.fieldInfo,isThisAreaSpecific:D&&!a.isMultiFeatureChart?!g.isComparisonSeries:void 0,isThisAreaSingleSeries:u,decimals:c.value&&c.value.decimals,fill:h.fill,stroke:0<h.stroke.width?
h.stroke.color:void 0,isBenchmarked:d.isBenchmarked,unbenchmarkedValue:d.ownValue});var t=F[r]=F[r]||[];a.excludedSeriesHash[g.label]||(t.push(c),v.push(c));c.getGroup=function(){return a.isMultiFeatureChart?v:t};h.tooltip=c;x.data.push(h)});p&&p!==t.NONE&&(x.data.sort(function(a,b){return(a.y-b.y)*(p===t.DESC?-1:1)}),x.data.forEach(function(a,b){a.x=b+1}));x.data.forEach(function(a){B.updatePointIndexToLabelMap(d,a.x,f,a.point,w)});q.push(x)}},this);f=H.getTotalStats();v.prettifyYAxis(f.minYValue,
f.maxYValue,d,e,m,E,w,q);a.plotStats&&(I.mixin(a.plotStats,f),a.plotStats.pointIndexToTooltipsHash=F);return q},prettifyColumnBarYAxis:function(a){v.prettifyYAxis(a.totalStat.minYValue,a.totalStat.maxYValue,a.chart,a.visualProperties,a.chartType,a.themeSettings,a.viewModel,a.chartSeries,!0,a.chartSize);a.chart.dirty=!0}}});