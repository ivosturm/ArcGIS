// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/plots/labelsRendering/LabelOverlapFixer",["dojo/_base/lang"],function(y){function w(c,b,a,h){for(var r,d=0,e=b.length;d<e;d++){var v=b[d],k;if(k=v!==c){var p=c;k=v;var t=h,l;if(1===a)l=!1;else{var u=p.w*a/2,f=k.w*a/2;l=p.x+u;var u=p.x+p.w-u,m=k.x+f,f=k.x+k.w-f;l=m>=l&&m<=u||l>=m&&l<=f}l&&(1===t?l=!1:(f=p.h*t/2,l=k.h*t/2,t=p.y+f,p=p.y+p.h-f,f=k.y+l,k=k.y+k.h-l,l=f>=t&&f<=p||t>=f&&t<=k));k=l}k&&(r=r||[],r.push(v))}return r}function z(c,
b,a){var h={boxWithMaxOverlappingNeighbours:null},r=0;c.forEach(function(d){var e=w(d,c,b,a);d._numOverlaps=e?e.length:0;d._overlappingBoxes=e;d._numOverlaps>r&&(r=d._numOverlaps,h.boxWithMaxOverlappingNeighbours=d)});return h}var x={},A={hideIncorrectLabels:function(c,b,a,h,r){for(c=c.filter(function(e,c){c=b[e._index];if(Math.abs(c.x-e.x)>2*e.w||Math.abs(c.y-e.y)>3*e.h||e.x<a.minX-3||e.x>a.maxX-e.w+3||e.y<a.minY-3||e.y>a.maxY-e.h+3)e.hidden=!0;return!e.hidden});;){var d=z(c,h,r);if(d.boxWithMaxOverlappingNeighbours)d.boxWithMaxOverlappingNeighbours.hidden=
!0,d=c.indexOf(d.boxWithMaxOverlappingNeighbours),-1!==d&&c.splice(d,1);else break}}};x.fixLabelsOverlap=function(c,b,a,h,r){function d(){c.sort(function(a,m){return a.x-m.x});v&&c.sort(function(a,m){return m.y-a.y});for(var m=0,d=c.length;m<d;m++){var a=c[m],h=w(a,c,t,l);if(h){m=0;for(d=h.length;m<d;m++){var g=h[m],n=v?-(g.y+g.h-a.y+p):!1;!1!==n&&g.y+n<f.minY-3&&(n=!1);var b=e&&a.x<g.x?a.x+a.w-g.x+k:!1;!1!==b&&g.x+b>f.maxX-g.w+3&&(b=!1);var q=e&&a.x>g.x?g.x+g.w-a.x+k:!1;!1!==q&&a.x+q>f.maxX-a.w+
3&&(q=!1);if(!1!==n||!1!==b||!1!==q)n&&!1===b&&!1===q?g.y+=n:!1===n&&b&&!1===q?g.x+=b:!1===n&&!1===b&&q?a.x+=q:n&&b&&!1===q?-n<b?g.y+=n:g.x+=b:n&&!1===b&&q&&(-n<q?g.y+=n:a.x+=q)}return!0}}}var e=h.allowXShift,v=h.allowYShift,k=h.xGap||0,p=h.yGap||0,t=h.xTolerance||0,l=h.yTolerance||0,u={};c.forEach(function(a,b){u[b]=y.mixin({},a);a._index=b});var f={minX:a.l+1,maxX:b.width-a.r,minY:a.t,maxY:b.height-a.b+11};c.forEach(function(a){a.x=Math.max(a.x,f.minX);a.x=Math.min(a.x+a.w,f.maxX)-a.w;a.y=Math.max(a.y,
f.minY);a.y=Math.min(a.y+a.h,f.maxY)-a.h});for(b=0;50>b&&d();b++);A.hideIncorrectLabels(c,u,f,t,l)};return x});