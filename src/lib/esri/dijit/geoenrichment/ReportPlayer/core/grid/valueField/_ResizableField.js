// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/valueField/_ResizableField","dojo/_base/declare dojo/aspect dojo/on dojo/string dojo/dom-class dojo/dom-construct dojo/dom-style ./supportClasses/ResizeColumnRowTooltipVisualizer ./supportClasses/ResizeEngine esri/dijit/geoenrichment/utils/PageUnitsConverter esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/MouseUtil esri/dijit/geoenrichment/utils/TooltipUtil dojo/i18n!esri/nls/jsapi".split(" "),function(q,r,l,t,e,m,u,h,k,
n,f,v,p,g){g=g.geoenrichment.dijit.ReportPlayer.ValueField;return q(null,{resizable:!0,hasAllSidesSizers:!1,showSizeLabel:!1,showSizeLabelsInAllRelatedCells:!1,showColumnRowSizeTooltip:!1,showSizersOnFocus:!1,createSizersOnDemand:!0,resizeSnapNode:null,resizeRestrictNode:null,allowHorizontalResizing:!0,allowVerticalResizing:!0,sizeLabel:null,_tooltipHandles:null,postCreate:function(){this._tooltipHandles=[];this.inherited(arguments);this.resizable&&this._addCreateSizersTrigger()},_isBeingResized:!1,
_isBeingResizedDelayed:!1,_sizers:null,isBeingResized:function(){return this.resizable&&this._sizers?this._isBeingResized||this._sizers.some(function(a){return v.isMouseOver(a)})||!this.hasAllSidesSizers&&this._sizers.some(function(a){return 0<u.get(a,"opacity")}):!1},wasResizedRecently:function(){return this.isBeingResized()||this._isBeingResizedDelayed},_addCreateSizersTrigger:function(){var a=this;this.createSizersOnDemand||this._updateSizers();l(this.domNode,"mouseover",function(){a._updateSizers()})},
_createSizers:function(){var a=this;this.resizable&&!this._sizers&&(this._sizers=(this.hasAllSidesSizers?k.ALL_DIRECTIONS:[this.allowHorizontalResizing?"e":null,this.allowVerticalResizing?"s":null].filter(function(a){return!!a})).map(function(c){var d=m.create("div",null,a.domNode);a.hasAllSidesSizers?(e.add(d,(a.showSizersOnFocus?"valueField_allSidesSizer_showOnFocus":"valueField_allSidesSizer")+" "+c+"_fieldSizer"),a.fieldCellClass&&e.add(d,"fieldSizer_"+a.fieldCellClass)):"e"===c?(e.add(d,"valueField_widthSizer"),
a._tooltipHandles.push(p.setTooltipToNode(d,g.dragToChangeWidth)),a.fieldCellClass&&e.add(d,"widthSizer_"+a.fieldCellClass)):(e.add(d,"valueField_heightSizer"),a._tooltipHandles.push(p.setTooltipToNode(d,g.dragToChangeHeight)),a.fieldCellClass&&e.add(d,"heightSizer_"+a.fieldCellClass));d._dir=c;return d}),this._addResizeHandlers())},unitTesting_getSizerByDirection:function(a){this._updateSizers();return this._sizers.filter(function(c){return c._dir===a})[0]},_addResizeHandlers:function(){var a=this;
this._sizers.forEach(function(c){l(c,"mousedown",function(d){d.preventDefault();d.stopPropagation();a._setIsBeingResized(!0);a.stopEdit&&a.stopEdit();k.trackSizer({dir:c._dir,w:a.getWidth(),h:a.getHeight(),angle:a.getAngle(),supportsCtrlShift:a.hasAllSidesSizers,getThisBox:function(){return f.noTransformPosition(a.domNode)},getThisFullBox:function(){return a.getBBox({noTransformation:!0})},getSnapNodeBoxes:function(){if(!a.hasAllSidesSizers)return null;var b=a._getResizeSnapElements()||[],b=b.map(function(a){return{box:a.getBBox({noTransformation:!0}),
tolerance:3}});a.resizeSnapNode&&b.push({box:f.noTransformPosition(a.resizeSnapNode),tolerance:7});return b.length?b:null},getRestrictNodeBox:function(){return a.hasAllSidesSizers?a.resizeRestrictNode&&f.noTransformPosition(a.resizeRestrictNode):null},onPreChange:function(){a._onManualSizePreChange()},onSizeChanged:function(){a._onManualSizeChange(c._dir);a.onManualSizeChange();a._updateSizers()},onWidthChanged:function(b){a.onManualWidthChange(b)},onHeightChanged:function(b){a.onManualHeightChange(b)},
setWidth:function(b){a.parentGrid&&a.parentGrid.layoutDefaults.columnMinWidth&&(b=Math.max(b,a.parentGrid.layoutDefaults.columnMinWidth));a.setWidth(b)},setHeight:function(b){a.parentGrid&&a.parentGrid.layoutDefaults.rowMinHeight&&(b=Math.max(b,a.parentGrid.layoutDefaults.rowMinHeight));a.setHeight(b)},applyShift:function(b,c){a.onNeedShiftPositionFromResizing(b,c)},onEnd:function(){a._setIsBeingResized(!1)},onSnapped:function(b){a.onResizeSnapped(b)}})})});this.hasAllSidesSizers&&this.own(r.after(this,
"onSizeChanged",function(){(f.isNodeInLayout(a._sizers[0])||f.isNodeInLayout(a._sizers[1]))&&a._updateSizers()}))},_getResizeSnapElements:function(){},_setIsBeingResized:function(a){a?(this._isBeingResizedDelayed=this._isBeingResized=!0,e.add(this.domNode,"isBeingResized"),this.parentGrid&&e.add(this.parentGrid.domNode,"isBeingResized")):(this._isBeingResized&&this._onManualSizeChangeEnd(),this._isBeingResized=!1,e.remove(this.domNode,"isBeingResized"),this.parentGrid&&e.remove(this.parentGrid.domNode,
"isBeingResized"),f.stealFocus(),setTimeout(function(){this._isBeingResizedDelayed=!1}.bind(this),100));this._tooltipHandles.forEach(function(c){a?c.suspend():c.resume()})},updateSizers:function(){this._updateSizers()},_updateSizers:function(){function a(){var a=c.getAngle();c._sizers.forEach(function(b){k.positionSizer({sizer:b,dir:b._dir,w:c.getWidth(),h:c.getHeight(),angle:a})})}this._createSizers();if(this._sizers&&this.hasAllSidesSizers){var c=this;5<this.domNode.clientHeight?a():setTimeout(a,
100)}},_onManualSizePreChange:function(){this.onManualSizePreChange()},_onManualSizeChange:function(a){this.inherited(arguments);this.showSizeLabel&&this._showAndUpdateSizeLabel();this.showSizeLabelsInAllRelatedCells&&this._showAndUpdateRelatedCellsSizeLabels();this.showColumnRowSizeTooltip&&("e"===a?h.showColumnTooltip(this):"s"===a&&h.showRowTooltip(this))},_onManualSizeChangeEnd:function(){f.hide(this.sizeLabel);this.showSizeLabelsInAllRelatedCells&&this._hideRelatedCellsSizeLabels();this.showColumnRowSizeTooltip&&
h.removeTooltip();this.onManualSizeChangeEnd()},tryUpdateSizeLabel:function(){f.isNodeInLayout(this.sizeLabel)&&(this.showSizeLabel&&this._showAndUpdateSizeLabel(),this.showSizeLabelsInAllRelatedCells&&this._showAndUpdateRelatedCellsSizeLabels())},_showAndUpdateSizeLabel:function(){if(this.domNode){this.sizeLabel=this.sizeLabel||m.create("div",{"class":"elementSizeLabel"},this.domNode);f.show(this.sizeLabel);var a=this.domNode.clientWidth,c=this.domNode.clientHeight,d=n.convert(a,"px",this.viewModel.getUnits()),
b=n.convert(c,"px",this.viewModel.getUnits());this.sizeLabel.innerHTML=t.substitute(this.viewModel.provideUnits(g.elementSizeFormat),{width:this.viewModel.roundForUnits(d),height:this.viewModel.roundForUnits(b)});d=this.sizeLabel.clientHeight;this.sizeLabel.style.left=Math.round((a-this.sizeLabel.clientWidth)/2)+"px";this.sizeLabel.style.top=Math.round(20<c?(c-d)/2:-d-5)+"px"}},_showAndUpdateRelatedCellsSizeLabels:function(){this._getRelatedCells().forEach(function(a){a._showAndUpdateSizeLabel()})},
_hideRelatedCellsSizeLabels:function(){this._getRelatedCells().forEach(function(a){f.hide(a.sizeLabel)})},_getRelatedCells:function(){return this.parentGrid?this.parentGrid.getFieldCells().filter(function(a){return a!==this},this):[]},onManualSizePreChange:function(){},onManualSizeChangeEnd:function(){},onManualSizeChange:function(){},onManualWidthChange:function(a){},onManualHeightChange:function(a){},onNeedShiftPositionFromResizing:function(a,c){},onResizeSnapped:function(a){}})});