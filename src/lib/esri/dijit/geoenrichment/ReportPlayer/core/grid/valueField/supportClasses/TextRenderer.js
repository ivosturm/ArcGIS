// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/valueField/supportClasses/TextRenderer","dojo/_base/lang dojo/when dojo/dom-construct dojo/dom-style esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/MathUtil esri/dijit/geoenrichment/utils/RegExpUtil esri/dijit/geoenrichment/utils/UrlUtil ./BenchmarkUtil".split(" "),function(t,u,q,e,l,v,m,w,x){return{renderText:function(a,b,c){a.valueLabel&&void 0!==b&&this._applyNewText(a,b,c);a.valueLabel&&(a.valueLabel.__hasTrimmedText=
!1);c&&(a.trimTextIfOverflows=!1);if(a.trimTextIfOverflows&&a.valueLabel&&this._getLabelInnerHTML(a)&&!m.isRichText(this._getLabelInnerHTML(a))&&(b=this.getFullText(a),b!==this._getLabelInnerHTML(a)&&this._setLabelInnerHTML(a,b),a.valueLabel.__untrimmedText=b,a.domNode.clientWidth)){b=b.trim();c=this._measureValueField(a,b);var d=c.parentH;if(!(a.valueLabel.clientHeight<=d)){var g=Math.floor(c.parentW/c.charWidth),k=b.length;b=b.substr(0,Math.max(1,Math.floor(d/c.lineHeight))*g);k>b.length&&(b=b.substr(0,
b.length-3),this._setLabelInnerHTML(a,b+"..."),a.valueLabel.__hasTrimmedText=!0);if(a.valueLabel.clientHeight>d)for(;!(!b||a.valueLabel.clientHeight<=d||this._getLabelInnerHTML(a).length<=g);)b=b.substr(0,b.length-1),this._setLabelInnerHTML(a,b+"..."),a.valueLabel.__hasTrimmedText=!0}}},_measureValueField:function(a,b){var c=l.getNodeFontSize(a.domNode),c=l.getTextBox(b,{style:"font-family:"+e.get(a.valueLabel,"fontFamily")+";font-size:"+c+"px;"});return{parentW:a.domNode.clientWidth-e.get(a.valueLabel,
"paddingLeft")-e.get(a.valueLabel,"paddingRight"),parentH:a.domNode.clientHeight-e.get(a.valueLabel,"paddingTop")-e.get(a.valueLabel,"paddingBottom"),lineHeight:c.h,charWidth:c.w/b.length,textBox:c}},getFullText:function(a){return a.valueLabel&&(a.valueLabel.__untrimmedText||this._getLabelInnerHTML(a))},hasOverflowText:function(a){return a.valueLabel&&a.valueLabel.__hasTrimmedText||a.valueLabel.clientHeight>a.domNode.clientHeight},_applyNewText:function(a,b,c){delete a.valueLabel.__untrimmedText;
c?this._applyTextForBenchmark(a,b,c):this._getLabelInnerHTML(a)!==b&&this._setLabelInnerHTML(a,b)},_applyTextForBenchmark:function(a,b,c){function d(d){return x.createBenchmarkedValue(t.mixin({text:b,fontSize:e,isGreater:c.isGreater,formattedValue:c.formattedValue,color:a.fieldStyle.color,nowrap:!0,noTextLimit:c.noTextLimit},d))}var g=this,k=a.parentGrid,e=l.getNodeFontSize(a.domNode);a.__benchmarkLabel&&q.destroy(a.__benchmarkLabel);delete a.__benchmarkLabel;if(k.infographicBenchmarkController)if(k.infographicBenchmarkController.isVariableInShape){var m=
k.infographicBenchmarkController.getIconTable();u(m.getRenderPromise(),function(){function c(a){return l.getNodesBox(a.getBoundingClientRect?[a]:a)}g._setLabelInnerHTML(a,d());var f=g._getInnerHTMLNode(a),e=c(f.children[0]),h=m.getFirstCell().content;if((h=c(h.getSvgNode?h.getSvgNode().children:h.content))&&!v.isRectInRect(e,h)){g._setLabelInnerHTML(a,b);e=c(f);f=q.create("div",null,a.domNode);f.style.position="absolute";f.style.fontSize="0px";f.innerHTML=d({text:"",color:k.infographicBenchmarkController.getOutsideShapeTextColor()});
a.__benchmarkLabel=f;var n=c(f),p=c(a.domNode),r=p.w/l.noTransformPosition(a.domNode).w;f.style.left=(h.x+h.w-p.x)/r+5+"px";f.style.top=(e.y+(e.h-n.h)/2-p.y)/r+"px"}})}else if(this._setLabelInnerHTML(a,d()),"center"===a.fieldStyle.horizontalAlign){var n=g._getInnerHTMLNode(a);a.domNode.style.marginLeft=Math.min(0,(a.getWidth()-n.children[0].clientWidth)/2)+"px"}else"right"===a.fieldStyle.horizontalAlign&&(n=g._getInnerHTMLNode(a),a.domNode.style.marginLeft=Math.min(0,a.getWidth()-n.children[0].clientWidth)+
"px");else this._setLabelInnerHTML(a,d())},_getLabelInnerHTML:function(a){return this._getInnerHTMLNode(a).innerHTML},_setLabelInnerHTML:function(a,b){b=String(b);var c=a.valueLabel;if(a.autoDetectUrl){var d=this.getFullText(a)||b;m.isUrl(d)?(a=this._getInnerHTMLNode(a),"A"===a.nodeName?(a.innerHTML=b,a.hasAttribute("href")&&a.removeAttribute("href"),a.setAttribute("href",d)):c.innerHTML="\x3ca href\x3d'"+w.toHttpsUrl(d)+"' target\x3d'_blank'\x3e"+b+"\x3c/a\x3e"):c.innerHTML=b}else c.innerHTML=b},
_getInnerHTMLNode:function(a){var b=a.valueLabel;return a.autoDetectUrl&&b.childNodes&&1===b.childNodes.length&&b.childNodes[0]&&"A"===b.childNodes[0].nodeName?b.childNodes[0]:b}}});