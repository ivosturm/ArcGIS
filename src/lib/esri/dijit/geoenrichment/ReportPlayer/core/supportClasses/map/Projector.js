// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/Projector",["dojo/_base/declare","esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","esri/dijit/geoenrichment/promise/all","esri/dijit/geoenrichment/utils/ProjectionUtil"],function(b,n,p,q,e){function g(a,f){return e.projectGeometries(a,f)}b=b(null,{_pendingInfos:null,_isBusy:!1,constructor:function(){this._pendingInfos=[]},addForProjection:function(a,f){if(this._isBusy)throw Error("Can't interrupt the current projection process.");
a=a&&a.geometry||a;var b=new n;this._pendingInfos.push({geom:a,mapOrSR:f,dfd:b,index:this._pendingInfos.length});return b.promise},project:function(){function a(a){var b=d[a];return p(g(b.geoms,b.mapOrSR),function(a){a.forEach(function(a,c){c=b.indexMap[c];k[c]=a;h[c].resolve(a)})})}var b=this;if(this._isBusy)throw Error("Can't interrupt the current projection process.");this._isBusy=!0;var h=[],d={};this._pendingInfos.forEach(function(a){h.push(a.dfd);var b=a.geom.type+";"+a.geom.spatialReference.wkid+
";"+e.getSpatialReference(a.mapOrSR).wkid,b=d[b]=d[b]||{geoms:[],indexMap:{},mapOrSR:a.mapOrSR};b.geoms.push(a.geom);b.indexMap[b.geoms.length-1]=a.index});this._pendingInfos.length=0;var l=[],k=[],m;for(m in d)l.push(a(m));return q(l).then(function(){b._isBusy=!1;return k})}});b.needProject=function(a,b){a=a&&a.geometry||a;return a.spatialReference&&a.spatialReference.wkid!==e.getSpatialReference(b).wkid};b.projectGeometries=g;return b});