// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/std/FeatureGeometryLoader",["esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/tasks/EnrichAreasTask","esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/GEUtil","esri/dijit/geoenrichment/utils/ArrayUtil","esri/dijit/geoenrichment/utils/InvokeUtil"],function(g,h,k,l,m){return{_countryKey:null,_cache:null,_countryId:null,_hierarchy:null,_pendingInfos:{},canLoad:function(){return k.canMakeRequests()},
getFeatureGeometry:function(a){var b=a.countryID+";"+a.hierarchy;this._countryKey!==b&&(this._cache={},this._countryKey=b,this._pendingInfos={},this._countryId=a.countryID,this._hierarchy=a.hierarchy);b=this._getKey(a.levelId,a.featureId,a.outSR);this._cache[b]||(this._cache[b]=this._addToPendingGeographies(a.levelId,a.featureId,a.outSR));return this._cache[b]},_addToPendingGeographies:function(a,b,c){var e=this._getKey(a,b,c),d=new g;a={levelId:a,featureId:b,outSR:c,dfd:d};this._pendingInfos[e]&&
d.promise.then(this._pendingInfos[e].dfd.resolve,this._pendingInfos[e].dfd.reject);this._pendingInfos[e]=a;m.invoke(this,"_doEnrichPendingGeographies",100);return d.promise},_doEnrichPendingGeographies:function(){function a(a){var d="default"===a?null:{wkid:Number(a)};l.splitArrayToBunches(c[a],50).forEach(function(a){(new h).createFeaturesForGeographies(a,{countryID:b._countryId,hierarchy:b._hierarchy,generalizationLevel:5,outSR:d}).then(function(a){a.forEach(function(a){var c=b._getKey(a.attributes.StdGeographyLevel,
a.attributes.StdGeographyID,d);g[c].dfd.resolve(a.geometry)})})})}var b=this,c={},e;for(e in this._pendingInfos){var d=this._pendingInfos[e],f=d.outSR&&d.outSR.wkid||"default";(c[f]=c[f]||[]).push({levelId:d.levelId,id:d.featureId})}var g=this._pendingInfos;this._pendingInfos={};for(f in c)a(f)},_getKey:function(a,b,c){return a+";"+b+";"+(c&&c.wkid)}}});