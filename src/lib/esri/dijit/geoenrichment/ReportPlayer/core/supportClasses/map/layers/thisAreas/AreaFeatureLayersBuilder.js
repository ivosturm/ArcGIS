// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/thisAreas/AreaFeatureLayersBuilder","dojo/_base/lang esri/Color esri/graphic esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/symbols/jsonUtils ./DefaultSymbolRenderer ../../Projector esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/areas/AreasInfoTemplateBuilder esri/dijit/geoenrichment/utils/ColorUtil".split(" "),function(n,p,v,w,x,y,q,r,z,t){var m={addAreaFeatures:function(b,h){var a=b.features.filter(function(b){return"polygon"===
b.geometry.type}),g=b.features.filter(function(b){return"point"===b.geometry.type}),f=[],d=[],e={},k=new r;a.forEach(function(a,c){c=m._addFeaturesToNewLayer(a,!1,b,k,h,c);e[d.length]=b.featureIndexToAreaIndexMap[b.features.indexOf(a)];d.push(c)});g.forEach(function(a,c){a=m._addFeaturesToNewLayer(a,!0,b,k,h,c);f.push(a)});k.project();return{pointLayers:f,polygonLayers:d,polygonLayerIndexToAreaIndex:e}},_addFeaturesToNewLayer:function(b,h,a,g,f,d){var e=new w,k=a.featureIndexToAreaIndexMap[a.features.indexOf(b)],
l=a.analysisAreas[k],l=h&&(b.locationName||l.locationName)||l.name,c=new v(null,m._getSymbolForGraphic(b,k,a),b.attributes),u=b.getLayer();c.setInfoTemplate(u&&u.infoTemplate||b.infoTemplate);!c.infoTemplate&&a.attachmentsStore&&z.buildInfoTemplateForFeature(a.attachmentsStore,c,k,l);e.name=c.infoTemplate&&c.infoTemplate.info&&c.infoTemplate.info.title||l;e.setRenderer(new x(c.symbol));r.needProject(b.geometry,a.map)?g.addForProjection(b.geometry,a.map).then(function(a){c.setGeometry(a);e.add(c)}):
(c.setGeometry(b.geometry),e.add(c));f.registerLayerInfo({layer:e,type:h?f.AREA_FEATURE_POINTS:f.AREA_FEATURE_POLYGONS,preferredIndex:d});return e},_getSymbolForGraphic:function(b,h,a){var g="point"===b.geometry.type,f=b.getLayer();if(f=f&&f.renderer&&f.renderer.getSymbol(b)||b.symbol)return f;var d;if(g)d=a.pinSymbolJson;else{var g=a.areaSymbolJsons||[],e=g[h];if(e)d=e;else if(a.areaSymbolRamp&&2===a.areaSymbolRamp.length){var k=a.analysisAreas.length-g.length,l=h-g.length;3>k?d=a.areaSymbolRamp[l]:
(h=function(a,b){var c=a[3];a=p.toJsonColor(t.toColor(t.generateGradient(b.map(function(a){return p.toDojoColor(a)}),k)[l]));a[3]=c;return a},d=n.clone(a.areaSymbolRamp[0]),g=a.areaSymbolRamp.map(function(a){return a.color}).filter(function(a){return!!a}),e=a.areaSymbolRamp.map(function(a){return a.outline&&a.outline.color}).filter(function(a){return!!a}),g.length===a.areaSymbolRamp.length&&(d.color=h(d.color,g)),e.length===a.areaSymbolRamp.length&&(d.outline.color=h(d.outline.color,e)))}}return d?
y.fromJson(n.clone(d)):f||(b?q.generateSMS():q.generateSFS())}};return m});