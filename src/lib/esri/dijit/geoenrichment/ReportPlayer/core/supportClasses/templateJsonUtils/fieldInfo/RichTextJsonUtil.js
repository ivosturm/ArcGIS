// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/templateJsonUtils/fieldInfo/RichTextJsonUtil",["./utils","esri/dijit/geoenrichment/ReportPlayer/countryConfig"],function(h,n){var d={_wrapFieldInfoInRichText:function(a){return"["+a.name+"]"}},p=/<d[^\/]*\/>/,q=/<text[^\/]*\/>/,k=/<reportname\s*\/\>/i,l=/<reporttitle2\s*\/\>/i;d.createFieldInfoFromRichText=function(a,b,e){a=a||"";b=b||[];e=e||[];for(var c=0;c<b.length;c++)a=a.replace(p,d._wrapFieldInfoInRichText(b[c]));for(c=0;c<e.length;c++){var f=
e[c],g;g="Title"===f.name&&k.test(a)?k:"Subtitle"===f.name&&l.test(a)?l:q;a=a.replace(g,d._wrapFieldInfoInRichText(f))}return{isRichText:!0,richTextJson:{fieldInfos:b,specialFieldInfos:e,xmlString:a}}};d.createRichTextFromFieldInfo=function(a,b,e){a=a.richTextJson;var c=a.xmlString;a.fieldInfos.forEach(function(a){var e=b(a);c=c.replace(d._wrapFieldInfoInRichText(a),e||"")});a.specialFieldInfos.forEach(function(a){var b=e(a);c=c.replace(d._wrapFieldInfoInRichText(a),b||"")});return c};d.updateXMLString=
function(a,b){b.forEach(function(b){a.richTextJson.xmlString=a.richTextJson.xmlString.replace(new RegExp("\\["+b.nameBefore+"\\]","g"),"["+b.name+"]")})};d.addFieldInfosToRichTextFieldInfo=function(a,b,e){var c=a.richTextJson;c.xmlString+=(e&&e.addSpaces&&c.xmlString?" ":"")+b.map(function(a){a.hasVariable?c.fieldInfos.push(a):c.specialFieldInfos.push(a);return d._wrapFieldInfoInRichText(a)}).join(", ")};d.replaceFieldInfoInRichTextFieldInfo=function(a,b,e){var c=a.richTextJson,f="@@@"+b.name+"@@@",
g=-1,m=0;c.fieldInfos.some(function(a,h){if(a.name===b.name)if(a!==b)c.xmlString=c.xmlString.replace(d._wrapFieldInfoInRichText(b),f),m++;else return g=h,c.xmlString=c.xmlString.replace(d._wrapFieldInfoInRichText(b),d._wrapFieldInfoInRichText(e)),!0});-1!==g&&(c.fieldInfos[g]=e);for(a=0;a<m;a++)c.xmlString=c.xmlString.replace(f,d._wrapFieldInfoInRichText(b))};var r={_reCache:{},getRegExp:function(){var a=n.getCurrencySymbol();this._reCache[a]||(this._reCache[a]=new RegExp("[\\"+a+"%]*\\[[^\\[]*\\]%*",
"g"));return this._reCache[a]}};d.collectFieldInfosFromRenderedXMLString=function(a,b){var e={},c={};b&&b.fieldInfos.forEach(function(a){e[h.renderer.renderFieldInfoInTableCell(a).formattedValue]=a});b&&b.specialFieldInfos.forEach(function(a){c[h.renderer.renderFieldInfoInTableCell(a).formattedValue]=a});var d=[],g=[];(b=a.match(r.getRegExp()))&&b.forEach(function(b){var f=e[b]||c[b]||h.builder.createFieldInfoFromSpecialFieldName(b.replace(/\[|\]/g,""))||h.builder.createFieldInfoFromLabel(b);f&&(f.hasVariable||
f.script?(d.push(f),a=a.replace(b,"\x3cd/\x3e")):(g.push(f),a=a.replace(b,"\x3ctext/\x3e")))});return{xmlString:a,fieldInfos:d,specialFieldInfos:g}};return d});