// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreateImageCommand","require dojo/_base/declare esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dojo/sniff ./CreateHTMLCommand ../../PlayerCommands ./supportClasses/ProgressSteps ./createHTML/CommandMode esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi".split(" "),function(q,r,t,k,h,u,v,f,w,x,g){function y(){var d=new t;q(["./imageUtils/ImageSaveUtil","./imageUtils/NodeToCanvasUtil","./imageUtils/ImagePrintUtil",
"./createHTML/CSSFilesLoader"],function(e,b,a,c){l=e;m=b;n=a;p=c;d.resolve()});return d.promise}g=g.geoenrichment.dijit.ReportPlayer.ReportPlayer;var l,m,n,p;return r(u,{id:v.IMAGE,label:g.createImageCommandLabel,errorMessage:g.createImageError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:w.SVG,_mergePageIndexes:!1,execute:function(d,e){var b=this,a=this.inherited(arguments);return y().then(function(){return k(a,function(c){function a(a){return!e.skipErrorNotification&&b._handleError(a)}if(c&&c.svgStrings){var g=
c.svgStrings.length,h=function(a){b._stepFinished(f.RENDER_IMAGE,a+1,g)};c.svgStrings=b._preProcessSVGStrings(c.svgStrings);return k(p.loadCssFontFiles(),function(){return n.printImages({svgStrings:c.svgStrings,nodeToCanvasFunc:b._nodeToCanvasFunc.bind(b),onRenderImage:h,scale:3}).then(function(a){return l.saveImages(a,{reportTitle:d.getReportTitle(),analysisAreas:d.getAnalysisAreas(),numPages:b._printableContainer.getNumberOfPages(),confirmSaveFile:b._confirmSaveFile,skipSavingFile:e.skipSavingFile||
x.createImageCommand.skipSavingFile,saveImageFunc:c.additionalFiles&&c.additionalFiles.length&&function(a){return b._saveMultipleFiles([a],c.additionalFiles)},saveMultipleImagesFunc:b._saveMultipleFiles&&function(a){return b._saveMultipleFiles(a,c.additionalFiles)}})}).otherwise(a).always(function(a){return k(b._printableContainer&&b._printableContainer.stop(),function(){return a})})})}})}.bind(this))},_saveMultipleFiles:null,_stepFinished:function(d,e,b){if(this._currentProgressBack){var a=0;switch(d){case f.REPLACE_MAPS:a=
10;break;case f.PREPARE_DOM:a=20;break;case f.RENDER_PAGE:a=20+40*e/b;break;case f.UNSET_LAYOUT:a=70;break;case f.RENDER_IMAGE:a=70+30*e/b}this._currentProgressBack(a/100)}},_preProcessSVGStrings:function(d){return d},_nodeToCanvasFunc:function(d,e,b){return m.svgNodeToCanvasFunc(d.children[0],e,b)},isBrowserSupported:function(){return!(h("ie")||h("trident"))}})});