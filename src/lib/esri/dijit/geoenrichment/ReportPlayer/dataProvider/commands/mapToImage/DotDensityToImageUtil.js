// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/mapToImage/DotDensityToImageUtil",["dojo/string","esri/dijit/geoenrichment/utils/ImageUtil","esri/dijit/geoenrichment/utils/ImageLayerUtil","../imageUtils/NodeToCanvasUtil"],function(k,l,h,m){var g={svgNodeToCanvasFunc:m.svgNodeToCanvasFunc,_createDotDensityImage:function(c,e,b){var a=c.getNode(),f=a.ownerSVGElement,d=document.createElementNS("http://www.w3.org/2000/svg","svg");c=c.getNavigationTransform();d.setAttribute("width",
b.width+"px");d.setAttribute("height",b.height+"px");d.setAttribute("viewBox",k.substitute("${dx} ${dy} ${width} ${height}",{dx:-c.dx,dy:-c.dy,width:b.width,height:b.height}));a=a.cloneNode(!0);a.hasAttribute&&a.hasAttribute("transform")&&a.removeAttribute("transform");d.appendChild(a);a=f.getElementsByTagName("defs");for(f=0;f<a.length;f++)d.appendChild(a[f].cloneNode(!0));return g.svgNodeToCanvasFunc(d,b.width,b.height).then(function(a){try{var c=a.toDataURL("image/png");return h.clipImageByExtent(c,
e,b.extent)}catch(n){return console.log(n),null}}).otherwise(function(a){console.log(a);return null})},isDotDensity:function(c){return c.renderer&&"esri.renderer.DotDensityRenderer"===c.renderer.declaredClass},createDotDensityImage:function(c,e,b){if(!c)return null;b=b||c.getMap();return g._createDotDensityImage(c,e,b).then(function(a){return a?{extent:a.extent,imageData:l.base64DataFromDataURL(a.dataURL)}:null})},createPictureMarkersFromDotDensityLayer:function(c,e,b){b=b||c.getMap();return g._createDotDensityImage(c,
e,b).then(function(a){return a?h.dataURLToPictureMarkers(b,a.dataURL,b.width,b.height):null})}};return g});