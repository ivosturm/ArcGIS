// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/printing/PrintableContainer","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dojo/dom-class dojo/dom-construct esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/async/AsyncQueue ./_PrintSettingsSupport ../PlayerResizeModes ../PlayerViewModes ./VisualStateConverter ../core/supportClasses/DocumentOptions".split(" "),function(r,t,u,d,v,l,m,g,w,x,e,y,z){return r(w,{domNode:null,_player:null,
_viewModel:null,_initRollBackFunc:null,_pageSettingsRollBackFunc:null,_pageSettings:null,_pageFitParams:null,_headerFooterParams:null,_allowDataDrilling:!1,_allowFallbackMaps:!1,_splitPages:!1,_needAutoScale:!1,_commandId:null,constructor:function(b,c){this._player=b;this._viewModel=c;this.domNode=b.printableDiv},initialize:function(b){var c=this;this._commandId=b.commandId;return d(this._doInitialize(b),function(){return d(c._checkPrintSettings(b),function(a){return"cancel"===a?null:c})})},_doInitialize:function(b){function c(){var p=
g.executeFunctions([function(){h&&l.destroy(h);f&&f.resolve();m.showNodeFromBackground(a.domNode)},function(){a.getAllReportContainers().forEach(function(a,b){a.showPageAt&&a.showPageAt(n[b])})},function(){a._player.viewMode===e.PANELS_IN_STACK_ALL&&a.getAllReportContainers()[0].setPrinted(!1);a._setPrintMode(!1);a._setAnimationSuspended(!1);return a._player.resize()},function(){if(k)return a._player.viewMode=k,a._player.refresh({waitUntilAllContentIsReady:!1})}],0);b.onShowWaiting(p);return p}var a=
this,n={},h,k;this._player.playerToolbar.closePopup();this._setAnimationSuspended(!0);var f,q=d(function(){return g.executeFunctions([function(){a._player.viewMode===e.PANELS_IN_STACK_ALL&&a.getAllReportContainers()[0].scrollToTop();a._player.resizeMode===x.FIT_WINDOW?h=l.create("div",{innerHTML:a._player.domNode.innerHTML,"class":"esriGEAbsoluteStretched esriGEReportPlayerPrintViewCopy"},a._player.printBackgroundView):(f=new u,b.onShowWaiting(f.promise))},function(){if(a._player.viewMode===e.PANELS_IN_STACK_ALL)a.getAllReportContainers()[0].setPrinted(!0);
else if(a._player.viewMode!==e.FULL_PAGES){k=a._player.viewMode;var b=a._player.getVisualState();a._player.viewMode=e.FULL_PAGES;return d(a._player.refresh({waitUntilAllContentIsReady:!0}),function(){return a._player.setVisualState(y.convertToFullPages(b,a._player.getReportData().templateJson))})}},function(){a._setPrintMode(!0);return g.executeFunctions(a.getAllReportContainers().map(function(a,b){return function(){a.resetZoom&&a.resetZoom();n[b]=a.getCurrentPageIndex&&a.getCurrentPageIndex();a.showAllPages&&
a.showAllPages();a.collapseContent&&a.collapseContent()}}),0)},function(){m.hideNodeInBackground(a.domNode,"report-player-being-printed")}],0)}(),function(){a._initRollBackFunc=c;return a._player.getRenderPromise()});b.onShowWaiting(q);return q},_setPrintMode:function(b){v[b?"add":"remove"](this.domNode,"esriGEReportPlayerPrint esriGEReportPlayer");this._player.setPrintMode(b)},_animationAllowedMemo:void 0,_setAnimationSuspended:function(b){b?(this._animationAllowedMemo=this._viewModel.isAnimationAllowed(),
this._viewModel.setAnimationAllowed(!1)):this._viewModel.setAnimationAllowed(this._animationAllowedMemo)},getViewMode:function(){return this._player.viewMode},getCurrentReportContainer:function(){return this._player.getCurrentReportContainer()},getAllReportContainers:function(){return this._player.getAllReportContainers()},getHeaderFooterParams:function(){return this._headerFooterParams},getDocumentOptions:function(){return t.mixin({},this.getCurrentReportContainer().documentOptions,this._pageSettings)},
getFitParams:function(){return this._pageFitParams},setNewPageSize:function(b,c){this._pageSettings.pagesize=z.combineCustomSizeString(b,c,"px");this._pageFitParams={w:b,h:c,hAlign:"center",vAlign:"top"}},getSelectedCommandId:function(){return this._commandId},allowDataDrilling:function(){return this._allowDataDrilling},allowFallbackMaps:function(){return this._allowFallbackMaps},splitPages:function(){return this._splitPages},needAutoScale:function(){return this._needAutoScale},getNumberOfPages:function(){return this.getCurrentReportContainer().getNumberOfPages()},
stop:function(){var b=this;return d(this._pageSettingsRollBackFunc&&this._pageSettingsRollBackFunc(),function(){return d(b._initRollBackFunc&&b._initRollBackFunc())})}})});