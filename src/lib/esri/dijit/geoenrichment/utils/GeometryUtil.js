// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/GeometryUtil","dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/geometry/Polygon esri/workers/WorkerClient ./PolygonUtil ./GeometryUtil_base".split(" "),function(p,q,r,t,u,v){function w(a,b,c){var e=new q,d=new t("./mutableWorker",function(){d.importScripts(["../dijit/geoenrichment/utils/GeometryUtil_worker","../dijit/geoenrichment/utils/GeometryUtil_base"]).then(function(){d.postMessage({rings:a,maxAllowableOffset:c}).then(function(a){var l=a.rings;b.forEach(function(a){for(var b=
a.source.length=0;b<a.count;b++)a.source.push(l.shift())});e.resolve();d.terminate()})})},!0);return e.promise}var e=p.mixin({},v);e.calculateMaxAllowableOffset=function(a,b){void 0===b&&(b=1);return a.extent.getWidth()/a.width*b};e.getNumberOfPoints=u.getNumberOfPoints;e.needGeneralizeGeometry=function(a,b,c,k){if(!a||!b)return!1;k=k||(c?c/10:500);c=c||5E3;Array.isArray(a)||(a=[a]);var d=0>b,h=0,l=Math.abs(b)/100,n=0,f=0,m;a.forEach(function(a){a=a.geometry||a;if(!a.rings||!a.getExtent)return!1;
var g=a.getExtent();if(g=g.getWidth()*g.getHeight())g=Math.sqrt(g),a=e.getNumberOfPoints(a),n+=a,f=Math.max(f,a),d&&(h=Math.max(h,g*l)),m||(m=d?n>c:a*b>4*g)});return m&&f>k?h||b:0};e.generalizeGeometry=function(a,b,c,k){if(!a||!b||0>b)return!1;c=c||500;Array.isArray(a)||(a=[a]);var d=[],h=[];a.map(function(a){var b=a.geometry||a;if(b!=a&&b.rings){a.geometry=new r;a.geometry.setSpatialReference(b.spatialReference);var f=a.geometry.rings}f&&b.rings.forEach(function(a){f.push(a.slice())});e.getNumberOfPoints(b)>
c&&(a=f||b.rings,d=d.concat(a),h.push({source:a,count:a.length}))});if(k&&window.Worker)return w(d,h,b);d.forEach(function(a){(new e.RingInfo(a)).generalize(b,.8)})};return e});