// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/mobile/GesturesUtil",["dojo/on","../DnDUtil","../animation/Animator","dojo/domReady!"],function(m,r,t){var e={},u=window._dev_emulateMultiTouch,v=window._dev_logTouch,p={_animation:null,_measures:null,start:function(){this._animation&&this._animation.stop();this._animation=null;this._measures=[];this._addMeasurePoint(0,0)},_addMeasurePoint:function(b,c){for(;9<this._measures.length;)this._measures.shift();var d={time:(new Date).getTime(),dx:b,dy:c},k=this._measures[this._measures.length-
1];this._measures.push(d);k&&(d.vx=b/(d.time-k.time),d.vy=c/(d.time-k.time))},notifyScrolled:function(b,c){this._addMeasurePoint(b,c)},flyScroll:function(b){if(!(2>this._measures.length)){var c=(new Date).getTime(),d=0,k=0,g=0;this._measures.forEach(function(b,f){"number"!==typeof b.vx||100<c-b.time||(d+=b.vx,k+=b.vy,g++)});if(g){var d=d/g,k=k/g,e=d,m=k;this._animation=t.animateProperty({duration:750,properties:{p:{start:0,end:1,easing:"sineOut"}},progressFunction:function(l,f,g){l=(new Date).getTime();
f=l-c;c=l;b(e*f,m*f);e=d*(1-g);m=k*(1-g)}})}}}};e.preventDefaultSiteBehavior=function(){document.body.style.touchAction="none"};e.preventDefaultOverflow=function(b){return b&&m(b,"touchmove",function(c){c.preventDefault()})};e.preventDoubleTapZoom=function(b){var c,d=(new Date).getTime();c=m(b,"touchstart",function(c){var b=(new Date).getTime();300>b-d&&c.preventDefault();d=b});return{remove:function(){c.remove()}}};e.enableGesturesOnNode=function(b,c){function d(h,a){if(c.logDiv){if(1E3<c.logDiv.innerHTML.length||
a)c.logDiv.innerHTML="";c.logDiv.innerHTML+=h+"\x3cbr/\x3e"}}function k(c,a){var h=c.x-a.x;c=c.y-a.y;return Math.sqrt(h*h+c*c)}function g(a){c.enableFlyingScroll&&p.start();for(var b=0;b<a.changedTouches.length;b++){var h=a.changedTouches[b];l[h.identifier]={x:h.clientX,y:h.clientY}}d("Num touches "+a.touches.length);2===a.touches.length&&(c.canZoom&&!c.canZoom(a)?d("Can't zoom"):(b=l[a.touches[0].identifier],a=l[a.touches[1].identifier],b&&a?(f=k(b,a),d("Start distance: "+Math.round(f))):l={}))}
function q(a){if(2===a.touches.length){a.preventDefault();var b=a.touches[0];a=a.touches[1];var h=l[b.identifier],e=l[a.identifier];if(h&&e&&f){if(h.x=b.clientX,h.y=b.clientY,e.x=a.clientX,e.y=a.clientY,b=k(h,e),h=Math.abs(f-b),d("Diff: "+Math.round(h),!0),h>w){d("Zoom");if(f<b)c.onZoomIn();else c.onZoomOut();f=b}}else l={}}else if(1===a.touches.length)if(c.canScroll&&!c.canScroll(a)||a.preventDefault(),b=a.touches[0],h=l[b.identifier]){var e=h.x-b.clientX,g=h.y-b.clientY;h.x=b.clientX;h.y=b.clientY;
if(!c.canScroll||c.canScroll(a))c.onScrollChanged(e,g),c.enableFlyingScroll&&p.notifyScrolled(e,g)}else l={}}function n(a){for(var b=0;b<a.changedTouches.length;b++)delete l[a.changedTouches[b].identifier];f=0;d("Num touches "+a.touches.length,!a.touches.length);c.enableFlyingScroll&&p.flyScroll(c.onScrollChanged)}if(b){e.preventDefaultSiteBehavior();var l={},f=0,w=c.zoomTolerance||50;if(u)e.dev_addMultiTouchEmulation(b,g,q,n);else var a=m(b,"touchstart",g),x=m(b,"touchmove",q),y=m(b,"touchend",n);
v&&(c.logDiv=e.dev_createLogLabel());return{remove:function(){l=null;a.remove();x.remove();y.remove()}}}};e.dev_addMultiTouchEmulation=function(b,c,d,e){function g(b,f,g){f={type:b,clientX:g&&g.clientX,clientY:g&&g.clientY,changedTouches:[f.getTouch()],touches:[],preventDefault:function(){g&&g.preventDefault()}};k.isOn&&f.touches.push(k.getTouch());n.isOn&&f.touches.push(n.getTouch());switch(b){case "touchstart":c(f);break;case "touchmove":d(f);break;case "touchend":e(f)}}b=function(b,c,e){var a=
this;a.x=c;a.y=e;a.isOn=!1;a.node=document.createElement("div");a.node.style.width="50px";a.node.style.height="50px";a.node.style.borderRadius="50%";a.node.style.cursor="pointer";a.node.style.position="absolute";a.node.style.zIndex="10000";document.body.appendChild(a.node);r.addNoDragClickHandler(a.node,function(){a.isOn=!a.isOn;a._updateStateColor();g(a.isOn?"touchstart":"touchend",a,null)},{tolerance:5});var d,f;m(a.node,"touchstart",function(a){d=a.clientX;f=a.clientY;m.once(document.body,"touchend",
function(){d=void 0})});m(a.node,"touchmove",function(b){if(void 0!==d){b.preventDefault();var c=b.clientX-d,e=b.clientY-f;d=b.clientX;f=b.clientY;a.x+=c;a.y+=e;a._updateNodePosition();a.isOn&&g("touchmove",a,b)}});a._updateStateColor=function(){a.node.style.backgroundColor=a.isOn?"#00FF00":"#CCCCCC"};a._updateNodePosition=function(){a.node.style.left=a.x-a.node.clientWidth/2+"px";a.node.style.top=a.y-a.node.clientHeight/2+"px"};a._updateStateColor();a._updateNodePosition();a.getTouch=function(){return{identifier:b,
clientX:a.x,clientY:a.y}}};var k=new b("touch_0",100,100),n=new b("touch_1",200,200)};e.dev_createLogLabel=function(){var b=document.createElement("div");document.body.appendChild(b);var c=b.style;c.position="absolute";c.zIndex="10000";c.right="0px";c.bottom="0px";c.width="150px";c.height="100px";c.backgroundColor="gray";c.color="white";c.overflow="auto";c.padding="3px";return b};return e});