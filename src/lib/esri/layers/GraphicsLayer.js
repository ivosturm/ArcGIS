// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/GraphicsLayer","require dojo/_base/declare dojo/_base/Deferred dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom dojox/gfx dojox/gfx/matrix ./gfxSniff!esri-svg?dojox/gfx/filters ./layer ./support/webglUtils ./support/WebGLSurface ../kernel ../lang ../sniff ../Color ../domUtils ../symbols/MarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/utils ../geometry/Point ../geometry/ScreenPoint ../geometry/Extent ../geometry/mathUtils ../geometry/screenUtils ../PluginTarget ./gfxSniff!esri-svg?dojox/gfx/svgext".split(" "),
function(ga,H,ha,r,x,t,X,S,N,v,ia,I,K,E,P,T,ja,z,Y,A,ka,O,pa,D,Z,aa,U,L,ba,V,la){var M=-1!==I.renderer.toLowerCase().indexOf("svg"),G=-1!==I.renderer.toLowerCase().indexOf("canvas"),W=G?"canvas-2d":I.renderer,w=9>A("ie");X=10===A("ie");var ca=void 0===A("ie")&&7==A("trident"),ma=X||ca,da=A("esri-touch"),ea=!!A("chrome"),Q=T.isWebGLEnabled(),na=M&&A("esri-will-change"),J=Q||G;T=H(null,{declaredClass:"esri.layers._GraphicsContainer",_setMap:function(a,b){var c,d=this._connects=[];this._map=a;this._useWillChange=
this._useGlobalTransform="css-transforms"===a.navigationMode&&na;J?(c=N.create("div",{style:{position:"absolute",overflow:"visible"}},b),this._surface={getEventSource:function(){return c}},G&&(d.push(r.connect(c,"onmousedown",this,this._canvasDownHandler)),d.push(r.connect(c,"onmouseup",this,this._canvasUpHandler)),d.push(r.connect(c,"onclick",this,this._canvasClickHandler))),Q&&(this._webglSurface=new ja({map:a,node:c}))):(c=(this._surface=I.createSurface(b,a.width,a.height)).getEventSource(),this._useWillChange&&
v.set(c,"will-change","transform"),v.set(c=w?c.parentNode:c,{overflow:"visible",position:"absolute"}));d.push(r.connect(a,"onResize",this,"_onResizeHandler"));this._useGlobalTransform&&(d.push(r.connect(a,"onPan",this,"_onPanHandler")),d.push(r.connect(a,"onPanEnd",this,"_onPanEndHandler")),d.push(r.connect(a,"onExtentChange",this,"_onExtentChangeHandler")));return c},_reorderLayer:function(a,b,c){b=b.getEventSource();J&&"svg"===a.surfaceType&&(b=b.parentNode);N.place(b,this._surface.getEventSource(),
c)},_onPanHandler:function(a,b){var c=this._map.__visibleRect;a=c.x+b.x;b=c.y+b.y;this._panDx=a;this._panDy=b;J||v.set(this._surface.getEventSource(),z._css.names.transform,z._css.translate(a,b))},_onPanEndHandler:function(a,b){b=this._map.__visibleRect;a=b.x;b=b.y;this._panDx=a;this._panDy=b;J||v.set(this._surface.getEventSource(),z._css.names.transform,z._css.translate(a,b))},_onExtentChangeHandler:function(a,b,c,d){c&&(this._panDy=this._panDx=0,J||v.set(this._surface.getEventSource(),z._css.names.transform,
z._css.translate(0,0)))},_getTransform:function(){return{dx:this._panDx||0,dy:this._panDy||0}},_onResizeHandler:function(a,b,c){a=this._surface.getEventSource();var d=this._map,e;w&&v.set(a=a.parentNode,{width:b+"px",height:c+"px",clip:"rect(0px "+b+"px "+c+"px 0px)"});S.set(a,"width",b);S.set(a,"height",c);this._surface.declaredClass||t.forEach(a.childNodes,function(a){S.set(a,"width",b);S.set(a,"height",c)});d.loaded&&(d.graphics.suspended||(d.graphics._resized=!0),t.forEach(d.graphicsLayerIds,
function(a){e=d.getLayer(a);e.suspended||(e._resized=!0,e._childLayer&&(e._childLayer._resized=!0));e._updateSVGFilters(null,null,b,c)}),d.graphics._updateSVGFilters(null,null,b,c),d._labels&&d._labels._updateSVGFilters(null,null,b,c))},_cleanUp:function(){t.forEach(this._connects,r.disconnect,r);this._map=this._surface=null},_processEvent:function(a){var b=this._map;a.screenPoint=new U(a.pageX-b.position.x,a.pageY-b.position.y);a.mapPoint=b.toMap(a.screenPoint)},_canvasDownHandler:function(a){this._processEvent(a);
this._downPt=a.screenPoint.x+","+a.screenPoint.y},_canvasUpHandler:function(a){this._processEvent(a);this._upPt=a.screenPoint.x+","+a.screenPoint.y},_tolerance:15,_isPrimaryMatch:function(a,b,c,d){if(!a.visible||!b)return!1;var e=b.getTransformedBoundingBox(),f;return e?(f=new L(e[0].x,e[0].y,e[2].x,e[2].y),delete f.spatialReference,da?f.intersects(c):f.contains(d)):t.some(b.children||[],function(a){e=a.getTransformedBoundingBox();f=new L(e[0].x,e[0].y,e[2].x,e[2].y);delete f.spatialReference;return da?
f.intersects(c):f.contains(d)})},_canvasClickHandler:function(a){if(this._downPt&&this._upPt&&this._downPt===this._upPt){this._processEvent(a);var b=this._map,c=t.map(b.graphicsLayerIds,function(a){return b.getLayer(a)});c.push(b.graphics);c.reverse();var c=t.filter(c,function(a){return a.loaded&&!a.hasWebGLSurface()&&a._mouseEvents&&!a.suspended&&(!Y.isDefined(a.opacity)||0<a.opacity)}),d=a.screenPoint,e=this._tolerance,f=d.x-e,g=d.y+e,k=d.x+e,e=d.y-e,h=new L(f,e,k,g),f=b.toMap(new U(f,g)),k=b.toMap(new U(k,
e)),g=f.spatialReference._getInfo(),l=new L(L.prototype._normalizeX(f.x,g).x,f.y,L.prototype._normalizeX(k.x,g).x,k.y,f.spatialReference),n;delete h.spatialReference;t.some(c,function(a){a=t.filter(a.graphics,function(a){return this._isPrimaryMatch(a,a.getDojoShape(),h,d)||!(!a._bgShape||!this._isPrimaryMatch(a,a._bgShape,h,d))},this);a.reverse();if(0<a.length){var b;t.some(a,function(a){return a.geometry&&l.intersects(a.geometry)?(b=a,!0):!1});if(b)return n=b,!0}return!1},this);n&&(c=n.getLayer())&&
(a.graphic=n,c.onClick(a))}}});P=H(P,{declaredClass:"esri.layers._GraphicsLayer",managedSuspension:!0,surfaceType:W,webglEnabled:Q,renderer:null,_eventMap:{"graphic-add":["graphic"],"graphic-remove":["graphic"],"renderer-change":["renderer"]},_suspendGraphics:!1,constructor:function(a,b){a=a||{};if(x.isString(a)||x.isObject(a)&&(a.layerDefinition||a.query))a=b;this._params=x.mixin({displayOnPan:!0,drawMode:!0,styling:!0},a);b=this._params.dataAttributes;"string"===typeof b&&(b=[b]);this.styling=M?
this._params.styling:!0;this.dataAttributes=b;this.infoTemplate=a&&a.infoTemplate;this.graphics=[];this._draw=x.hitch(this,this._draw);this._refresh=x.hitch(this,this._refresh);this._acquireSVGMarker=x.hitch(this,this._acquireSVGMarker);this._evalSurfaceType=x.hitch(this,this._evalSurfaceType);this._setSurfaceType=x.hitch(this,this._setSurfaceType);this.setWebGLEnabled(null!=this._params.webglEnabled?this._params.webglEnabled:this.webglEnabled);this.registerConnectEvents()},getNode:function(){return this._div&&
this._div.getEventSource()},setDrawMode:function(a){this._params.drawMode=a},suspendGraphics:function(a){this._suspendGraphics=a;t.forEach(this.graphics,function(b){b._suspended=a})},setWebGLEnabled:function(a){var b=this.webglEnabled;this.webglEnabled=(a||!1)&&Q;b!==this.webglEnabled&&(this._evalSurfaceType(),this.onWebGLEnabledChange())},hasWebGLSurface:function(){return"webgl"===this.surfaceType},_getSurfaceType:function(a){return a&&"webgl"===a.surfaceType?"webgl":W},_evalSurfaceType:function(a){Q&&
(a?this._setSurfaceType():null==this._evalSurfaceTimerHandle&&(this._evalSurfaceTimerHandle=setTimeout(this._setSurfaceType,0)))},_hasPendingSurfaceEval:function(){return!!this._evalSurfaceTimerHandle},_setSurfaceType:function(){clearTimeout(this._evalSurfaceTimerHandle);this._evalSurfaceTimerHandle=null;var a=this._canUseWebGLSurface()?"webgl":W;this.surfaceType!==a?(this.surfaceType=a,this._handleSurfaceChange(),this.onSurfaceChange()):this._pendingRedraw&&this._redraw()},_handleSurfaceChange:function(){this._cancelWebGLDepsLoad();
this._webglDepsPromise=this._prepareToAttach(this._map);this._webglDepsPromise.always(x.hitch(this,function(a){this._webglDepsPromise=null;a&&"cancel"===a.dojoType||this._evalSurface()}))},_cancelWebGLDepsLoad:function(){this._webglDepsPromise&&!this._webglDepsPromise.isFulfilled()&&this._webglDepsPromise.cancel();this._webglDepsPromise=null},_evalSurface:function(){var a=this._map,b=this._div;a&&b&&this._getSurfaceType(b)!==this.surfaceType&&(a._detachGraphicsLayer(this),a._attachGraphicsLayer(this))},
_canUseWebGLSurface:function(a){a=a||this._map;return this.webglEnabled&&(!a||a.webglEnabled&&(a.ownsWebGLContext(this)||a.isWebGLContextAvailable()))&&this._params.drawMode&&this._isWebGLCompatible()},_isWebGLCompatible:function(){return!1},_prepareToAttach:function(a){var b=new ha;!this.webglDeps&&this._canUseWebGLSurface(a)?ga(["./support/webglDeps"],x.hitch(this,function(a){this.webglDeps=a;b.isFulfilled()||b.resolve()})):b.resolve();return b.promise},_setMap:function(a,b){this.inherited(arguments);
this._map=a;this._evalSurfaceType(!0);this._webglChangeMapHandle=a.on("webgl-enabled-change",x.hitch(this,function(){this._evalSurfaceType()}));this._wrap=a.wrapAround180;this._srInfo=a.spatialReference._getInfo();this._svgFilters={};this._lineMarkers={};if(this.hasWebGLSurface())a.acquireWebGLContext(this),this._div=a._gc._webglSurface.createRenderer(this.webglDeps.WebGLRenderer,a.width,a.height,this);else{if("svg"===this.surfaceType)if(J){b=I.createSurface(b.getEventSource(),a.width,a.height);var c=
b.getEventSource();v.set(c,{position:"absolute",overflow:"visible",pointerEvents:"none"});a._gc._useWillChange&&v.set(c,"will-change","transform");this._div=b.createGroup();v.set(this._div.getEventSource(),"pointer-events","auto")}else this._div=b.createGroup();else b=I.createSurface(b.getEventSource(),a.width,a.height),v.set(b.rawNode,"position","absolute"),this._div=b.createGroup(),this._renderProto=this._div.constructor.prototype._render,this._div._render=x.hitch(this,this._canvasRender);this._bgGroup=
this._div.createGroup()}this._div.getEventSource().id=this.id+"_layer";this._initOpacity();return this._div},_unsetMap:function(a,b){a.releaseWebGLContext(this);"webgl"===this._div.surfaceType?a._gc._webglSurface.destroyRenderer(this._div):(t.forEach(this.graphics,function(a){a._shape=null}),"svg"===this.surfaceType?J?(b=this._div.parent,this._div.clear(),b.remove(this._div),N.destroy(this._div.getEventSource()),N.destroy(b.getEventSource())):(this._div.clear(),b.remove(this._div),N.destroy(this._div.getEventSource())):
(b=this._div.getParent(),b._parent={},N.destroy(b.rawNode),b.destroy()));this._map=this._div=this._svgFilters=this._lineMarkers=null;this._pendingRedraw=!1;clearTimeout(this._wakeTimer);this._wakeTimer=null;clearTimeout(this._evalSurfaceTimerHandle);this._evalSurfaceTimerHandle=null;this._webglChangeMapHandle&&this._webglChangeMapHandle.remove();this._cancelWebGLDepsLoad();this._disableDrawConnectors();this.inherited(arguments)},_initOpacity:function(){var a=this.opacity;Y.isDefined(a)&&1>a&&this.setOpacity(a,
!0)},_onZoomStartHandler:function(){this.hasWebGLSurface()||O.hide(this._div.getEventSource())},_onExtentChangeHandler:function(a,b,c,d){clearTimeout(this._wakeTimer);this._wakeTimer=null;c?(a=this._map.__visibleRect,b=this._div,this._evalSDRenderer(),this._refresh(!0),this._params._child||this._updateTransform(b,a.x,a.y,!0),this._renderProto&&b.surface.pendingRender?this._dirty=!0:this.suspended||O.show(b.getEventSource())):this._resized&&(this._resized=!1,this._refresh(!1));if(0<this.graphics.length)this.onUpdate()},
_canvasRender:function(){var a=this._div;this._dirty&&(delete this._dirty,this.suspended||O.show(a.getEventSource()));return this._renderProto.apply(a,arguments)},_refresh:function(a){if(!this.hasWebGLSurface()){var b=this.graphics,c=b.length,d,e=this._draw;for(d=0;d<c;d++)e(b[d],a)}},refresh:function(){this._refresh(!0)},_redraw:function(){this._pendingRedraw=!1;this.hasWebGLSurface()?this._div&&this._div.redraw():this._refresh(!0)},redraw:function(){this._hasPendingSurfaceEval()?this._pendingRedraw=
!0:this._redraw()},hasLocalNavigationTransform:function(){return!(this._map&&this._map._gc._useGlobalTransform)},getNavigationTransform:function(){var a={dx:0,dy:0};this._map&&(this.hasLocalNavigationTransform()?this._div&&!this.hasWebGLSurface()&&(a=this._div.getTransform()):a=this._map._gc._getTransform());return a},_onPanHandler:function(a,b){this._panDx=b.x;this._panDy=b.y;a=this._map.__visibleRect;this._updateTransform(this._div,a.x+b.x,a.y+b.y);ca&&this._updateSVGMarkers()},_onPanEndUpdateHandler:function(a,
b){a=this._map.__visibleRect;this._params._child||b.x===this._panDx&&b.y===this._panDy?(this._updateSVGFilters(-a.x,-a.y),this._updateSVGMarkers()):this._updateTransform(this._div,a.x,a.y,!0);this._refresh(!1);if(this.graphics.length)this.onUpdate()},_onPanStartHandler:function(){O.hide(this._div.getEventSource())},_onPanEndHandler:function(){var a=this._map.__visibleRect,b=this._div;this._updateTransform(b,a.x,a.y,!0);this._refresh(!1);this._renderProto&&b.surface.pendingRender?this._dirty=!0:O.show(b.getEventSource());
if(this.graphics.length)this.onUpdate()},_updateTransform:function(a,b,c,d){this.hasWebGLSurface()||(this.hasLocalNavigationTransform()?a.setTransform(K.translate({x:b,y:c})):J&&v.set(this._div.parent.getEventSource(),z._css.names.transform,z._css.translate(b,c)),d&&(this._updateSVGFilters(-b,-c),this._updateSVGMarkers()))},onSuspend:function(){this.inherited(arguments);O.hide(this._div.getEventSource());clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors()},onResume:function(a){this.inherited(arguments);
a.firstOccurrence&&this._evalSDRenderer();this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(x.hitch(this,function(){this.suspended||this._map.__zooming||this._onExtentChangeHandler(null,null,!0)}),0)},_enableDrawConnectors:function(){var a=this._map,b=r.connect;this._disableDrawConnectors();this._params.displayOnPan?(this._params._child||(this._onPanHandler_connect=b(a,"onPan",this,"_onPanHandler")),this._onPanEndHandler_connect=b(a,"onPanEnd",this,"_onPanEndUpdateHandler")):
(this._onPanStartHandler_connect=b(a,"onPanStart",this,"_onPanStartHandler"),this._onPanEndHandler_connect=b(a,"onPanEnd",this,"_onPanEndHandler"));this._onZoomStartHandler_connect=b(a,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=b(a,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var a=r.disconnect;a(this._onExtentChangeHandler_connect);a(this._onZoomStartHandler_connect);a(this._onPanHandler_connect);a(this._onPanStartHandler_connect);
a(this._onPanEndHandler_connect);this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null},_updateExtent:function(a){var b=a.geometry;if(!b)a._extent=null;else if(!(a._extent=b.getExtent())){var c,d;if("esri.geometry.Point"===b.declaredClass)c=b.x,d=b.y;else if("esri.geometry.Multipoint"===b.declaredClass)c=b.points[0][0],d=b.points[0][1];else{a._extent=null;return}a._extent=new L(c,d,c,d,b.spatialReference)}},
_intersects:function(a,b,c){var d=a.spatialReference,e=b.spatialReference,f=d&&e&&!d.equals(e)&&d._canProject(e)&&4326===e.wkid;if(this._wrap&&!c){c=[];var d=a._getFrameWidth(),g=this._srInfo,k=a._clip?a._getAvailExtent():a.extent,h,l,n,q,m=[];h=b._partwise;f&&(k=a.geographicExtent,g=e._getInfo());a=k._getParts(g);if(h&&h.length)for(b=[],e=0,f=h.length;e<f;e++)b=b.concat(h[e]._getParts(g));else b=b._getParts(g);e=0;for(f=b.length;e<f;e++)for(n=b[e],g=0,k=a.length;g<k;g++)if(q=a[g],q.extent.intersects(n.extent))for(h=
0,l=n.frameIds.length;h<l;h++)c.push((q.frameIds[0]-n.frameIds[h])*d);e=0;for(f=c.length;e<f;e++)h=c[e],t.indexOf(c,h)===e&&m.push(h);return m.length?m:null}return(f?a.geographicExtent:a.extent).intersects(b)?[0]:null},_defaultMarker:{type:"simplemarkersymbol",style:"square",size:1,xoffset:0,yoffset:0,angle:0},_draw:function(a,b){if(!this.hasWebGLSurface()&&this._params.drawMode&&this._map&&!this.suspended&&!this._map.__zooming&&!this._resized)try{var c=a._extent,d,e,f=!M||this.styling,g=M&&this.dataAttributes,
k=a.getDojoShape(),h;if(!a._suspended&&a.visible&&c&&(d=this._intersects(this._map,c,a.geometry._originOnly))&&(e=f?this._getSymbol(a):this._defaultMarker)){if(a._offsets&&a._offsets.join(",")===d.join(",")?h=!0:a._offsets=d,!k||b||!h){var l=a.geometry.type;b={graphic:a};var n=a._bgShape,q=f&&!a.symbol?this._getRenderer(a):null,m=q&&q.backgroundFillSymbol;if("point"===l)this._isInvalidShape(e,k)&&this._removeShape(a),a._shape=this._drawPoint(this._div,a.geometry,e,a.getDojoShape(),d,q,a),f&&this._symbolizePoint(a.getDojoShape(),
e,q,a);else if("multipoint"===l)this._drawMarkers(a,e,d,q),f&&this._symbolizeMarkers(a,e,q);else{var p,l=e,F,B,R;f&&(l=(p="simplemarkersymbol"===e.type||"picturemarkersymbol"===e.type||"textsymbol"===e.type?e:null)?m:e);f&&l&&-1<l.type.indexOf("fillsymbol")&&(F=this._bgGroup,R=!(!F||!p));n&&!R&&this._removeBgShape(a);if(l){!R&&(this._isInvalidShape(l,a._shape)||a._shape&&a._shape._isCentroidMarker)&&this._removeShape(a,!1);if(B=this._drawShape(a,d,F||this._div,R?n:a.getDojoShape()))B._isCentroidMarker=
!1;f&&this._symbolizeShape(B,l,q,l===m,a);a[R?"_bgShape":"_shape"]=B}if(p){(this._isInvalidShape(p,a._shape)||a._shape&&!a._shape._isCentroidMarker)&&this._removeShape(a,!1);var fa=a.geometry.getCentroid();if(B=fa&&this._drawPoint(this._div,fa,p,a._shape,d,q,a))B._isCentroidMarker=!0,this._symbolizePoint(B,p,q,a);a._shape=B}}G||(a._bgShape&&this._initNode(a,a._bgShape,a._bgShape!==n,b,g),a._shape&&this._initNode(a,a._shape,a._shape!==k,b,g));a._applyDataAttrs();b.node=a.getNode();this.onGraphicDraw(b)}}else k&&
this._removeShape(a)}catch(oa){this._errorHandler(oa,a)}},_initNode:function(a,b,c,d,e){if(b=b&&b.getNode())b.e_graphic=a,this._addDataAttrs(a,e,b),c&&(d.node=b,this.onGraphicNodeAdd(d))},_removeShape:function(a,b,c){var d=a.getDojoShape(),e=d&&d.getNode();d&&!c&&(d.removeShape(),d.destroy());a._shape=a._offsets=null;!1!==b&&this._removeBgShape(a,c);if(e&&(e.e_graphic=null,!G))this.onGraphicNodeRemove({graphic:a,node:e})},_removeBgShape:function(a,b){var c=a._bgShape,d=c&&c.getNode();c&&!b&&(c.removeShape(),
c.destroy());a._bgShape=null;if(d&&(d.e_graphic=null,!G))this.onGraphicNodeRemove({graphic:a,node:d})},_addDataAttrs:function(a,b,c){var d=a.attributes,e,f=b?b.length:0,g=this._getRenderer(a);if(c&&d){for(e=0;e<f;e++)(c=b[e])&&a.attr("data-"+c,d[c]);!this.styling&&g&&(g.getBreakIndex?(b=g.getBreakIndex(a),a.attr("data-class-break",-1!==b?b:null)):g.getUniqueValueInfo&&(b=g.getUniqueValueInfo(a),a.attr("data-unique-value",b?b.value:null)))}},_drawShape:function(a,b,c,d){a=a.geometry;var e=a.type,f=
this._map,g=f.extent,k=f.width,h=f.height,f=f.__visibleRect,l=[],n,q;n="extent"===e;if("rect"===e||n)l={x:0,y:0,spatialReference:a.spatialReference},l.x=n?a.xmin:a.x,l.y=n?a.ymax:a.y,e=V.toScreenPoint(g,k,h,l),l.x=n?a.xmax:a.x+a.width,l.y=n?a.ymin:a.y+a.height,a=V.toScreenPoint(g,k,h,l),b={x:e.x-f.x+b[0],y:e.y-f.y,width:Math.abs(a.x-e.x),height:Math.abs(a.y-e.y)},0===b.width&&(b.width=1),0===b.height&&(b.height=1),d=this._drawRect(c,d,b);else if("polyline"===e||"polygon"===e){n=0;for(q=b.length;n<
q;n++)l=l.concat(V._toScreenPath(g,k,h,a,-f.x+b[n],-f.y));d=this._drawPath(c,d,l);this._rendererLimits&&("polyline"===e?this._clipPolyline(d,a):this._clipPolygon(d,a))}return d},_drawRect:function(a,b,c){return b?b.setShape(c):a.createRect(c)},_drawImage:function(a,b,c){return b?b.setShape(c):a.createImage(c)},_drawCircle:function(a,b,c){return b?b.setShape(c):a.createCircle(c)},_drawPath:function(){return w?function(a,b,c,d){c=d?c:c.join(" ");if(b)return b.setShape(c);b=a.createObject(d?I.Path:I.EsriPath,
c);a._overrideSize(b.getEventSource());return b}:function(a,b,c,d){c=d?c:c.join(" ");return b?b.setShape(c):a.createPath(c)}}(),_drawText:function(a,b,c){return b?b.setShape(c):a.createText(c)},_evalSDRenderer:function(a){var b=this._map,c=this.renderer,d,e=this._rndForScale;b&&b.loaded&&c&&c.getRendererInfo&&(d="zoom"===c.rangeType?c.getRendererInfoByZoom(b.getZoom()):c.getRendererInfoByScale(b.getScale()));this._rndForScale=d&&d.renderer;a||this._rndForScale==e||this.emit("renderer-change",{renderer:this._rndForScale})},
_getRenderer:function(a){var b=this._rndForScale||this.renderer;a&&b&&b.getObservationRenderer&&(b=b.getObservationRenderer(a));return b},_getSymbol:function(a){var b=this._getRenderer();return a.symbol||b&&b.getSymbol(a)},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_applyOpacity:function(a,b,c,d){b=b.getOpacity(d,{opacityInfo:c});null!=b&&(a=new ka(a),a.a=b);return a},_symbolizeShape:function(a,b,c,d,e){var f=b.getStroke(),g=b.getFill(),k=b.type,
h,l,n=-1!==k.indexOf("linesymbol"),q=-1!==k.indexOf("fillsymbol")?null:this._getVariable(c,"sizeInfo",!1),m=this._getVariable(c,"colorInfo",!1),p=this._getVariable(c,"opacityInfo",!1),F=n?"none"!==b.style:b.outline&&"none"!==b.outline.style,B=n?null:this._getVariable(c,"sizeInfo","outline"),q=(q=d?B:B||q)?c.getSize(e,{sizeInfo:q,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):null;d&&(m=p=null);(m||p)&&"picturefillsymbol"!==k&&(n?(h=f&&f.color,m&&(h=c.getColor(e,{colorInfo:m})||
h),h&&p&&(h=this._applyOpacity(h,c,p,e))):g&&g.toCss&&(l=g,m&&(l=c.getColor(e,{colorInfo:m})||l),l&&p&&(l=this._applyOpacity(l,c,p,e))));a.setStroke(!F||null==q&&!h?f:x.mixin({},f,null!=q?{width:q}:null,h&&{color:h})).setFill(l||g);n&&Z.applyLineMarker(a,b,h,this._acquireSVGMarker)},_smsToPath:function(){return w?function(a,b,c,d,e,f,g,k,h){switch(b){case a.STYLE_SQUARE:return["M",e+","+g,"L",f+","+g,f+","+k,e+","+k,"X","E"];case a.STYLE_CROSS:return["M",c+","+g,"L",c+","+k,"M",e+","+d,"L",f+","+
d,"E"];case a.STYLE_X:return["M",e+","+g,"L",f+","+k,"M",e+","+k,"L",f+","+g,"E"];case a.STYLE_DIAMOND:return["M",c+","+g,"L",f+","+d,c+","+k,e+","+d,"X","E"];case a.STYLE_TARGET:return["M",e+","+g,"L",f+","+g,f+","+k,e+","+k,e+","+g,"M",e-h+","+d,"L",e+","+d,"M",c+","+(g-h),"L",c+","+g,"M",f+h+","+d,"L",f+","+d,"M",c+","+(k+h),"L",c+","+k,"E"]}}:function(a,b,c,d,e,f,g,k,h){switch(b){case a.STYLE_SQUARE:return["M",e+","+g,f+","+g,f+","+k,e+","+k,"Z"];case a.STYLE_TRIANGLE:return["M",c+","+g,f+","+
k,e+","+k,"Z"];case a.STYLE_CROSS:return["M",c+","+g,c+","+k,"M",e+","+d,f+","+d];case a.STYLE_X:return["M",e+","+g,f+","+k,"M",e+","+k,f+","+g];case a.STYLE_DIAMOND:return["M",c+","+g,f+","+d,c+","+k,e+","+d,"Z"];case a.STYLE_TARGET:return a=["M",e+","+g,f+","+g,f+","+k,e+","+k,e+","+g],h&&a.push("M",e-h+","+d,e+","+d,"M",c+","+(g-h),c+","+g,"M",f+h+","+d,f+","+d,"M",c+","+(k+h),c+","+k),a}}}(),_pathStyles:{square:1,cross:1,x:1,diamond:1,target:1},_typeMaps:{picturemarkersymbol:"image",picturefillsymbol:"path",
simplefillsymbol:"path",simplelinesymbol:"path",cartographiclinesymbol:"path",textsymbol:"text"},_isInvalidShape:function(a,b){b=b&&b.shape&&b.shape.type;var c=a&&a.type;a=a&&a.style;"rect"===b&&(b="path");c&&(a=this._typeMaps[c]||a);this._pathStyles[a]&&(a="path");return"shieldlabelsymbol"===c?!0:!(!b||!a||b===a)},_reArialFont:/\s*(^|,)\s*arial\s*(,|$)\s*/i,_fallbackFont:"Arial",_drawPoint:function(a,b,c,d,e,f,g){var k=c.type,h=this._map,l=h.__visibleRect,n=V.toScreenPoint(h.extent,h.width,h.height,
b).offset(-l.x+e[0],-l.y),l=n.x,q=n.y,m;b=[];var p,F=this._getVariable(f,"rotationInfo",!1),F=F?f.getRotationAngle(g,{rotationInfo:F}):null,B=this._getVariable(f,"sizeInfo",!1),h=B?f.getSize(g,{sizeInfo:B,shape:c.style,resolution:h.getResolutionInMeters(),scale:h.getScale()}):g.size;F&&b.push(K.rotategAt(F,n));if(0!==c.xoffset||0!==c.yoffset)p=K.translate(c.xoffset,-c.yoffset),b.push(p);0!==c.angle&&b.push(K.rotategAt(c.angle,n));if("simplemarkersymbol"===k)switch(m=c.style,f=Math.round,null!=h?p&&
(null!=p.dx&&(p.dx=p.dx/c.size*h),null!=p.dy&&(p.dy=p.dy/c.size*h)):h=c.size,m){case D.STYLE_SQUARE:case D.STYLE_TRIANGLE:case D.STYLE_CROSS:case D.STYLE_X:case D.STYLE_DIAMOND:c=isNaN(h)?16:h/2;m=this._drawPath(a,d,this._smsToPath(D,m,l,q,f(l-c),f(l+c),f(q-c),f(q+c)));break;case D.STYLE_TARGET:g=c._targetWidth/2;p=c._targetHeight/2;m=this._drawPath(a,d,this._smsToPath(D,m,l,q,f(l-g),f(l+g),f(q-p),f(q+p),c._spikeSize));break;case D.STYLE_PATH:m=this._drawPath(a,d,c.path,!0);c=m.getBoundingBox();a=
this._getScaleMatrix(c,h);1===a.xx&&1===a.yy||b.push(K.scaleAt(a.xx,a.yy,n));b.push(K.translate(-(c.x+c.width/2)+l,-(c.y+c.height/2)+q));break;default:c=isNaN(h)?16:h/2,m=this._drawCircle(a,d,{cx:l,cy:q,r:c})}else if("shieldlabelsymbol"===k)m=c.width,n=c.height,d=a.createGroup(),m=a.createImage({x:l-m/2,y:q-n/2,width:m,height:n,src:c.url}),d.add(m),null!=c.font&&(q+=.2*c.getHeight(),a=a.createText({type:"text",text:c.text,x:l,y:q,align:"middle",decoration:c.decoration,rotated:c.rotated,kerning:c.kerning}),
a.setFont(c.font),a.setFill(c.color),d.add(a)),m=d;else if("picturemarkersymbol"===k){if(null==h?(m=c.width,n=c.height):(n=h,m=c.width/c.height*n,p&&(null!=p.dx&&(p.dx=p.dx/c.width*m),null!=p.dy&&(p.dy=p.dy/c.height*n))),m=this._drawImage(a,d,{x:l-m/2,y:q-n/2,width:m,height:n,src:c.url}),M&&(a=m.getNode()))c=(c=this._getVariable(f,"opacityInfo",!1))?f.getOpacity(g,{opacityInfo:c}):null,null!=c?a.setAttribute("opacity",c):a.setAttribute("opacity",1)}else if("textsymbol"===k){if(f=c.font){m=null!=h;
g=f.family&&!this._reArialFont.test(f.family);if(m||g||G)f=new f.constructor(f.toJson());m&&f.setSize(h);G&&(f.size+="px");g&&f.setFamily(f.family+","+this._fallbackFont)}m=this._drawText(a,d,{type:"text",text:c.text,x:l,y:q,align:c.getSVGAlign(),decoration:c.decoration||f&&f.decoration,rotated:c.rotated,kerning:c.kerning});f&&m.setFont(f);M&&(a=m.getNode(),l=c.getSVGBaseline(),q=c.getSVGBaselineShift(),a&&(a.setAttribute("dominant-baseline",l),q&&a.setAttribute("baseline-shift",q),this._applyHalo(m,
c.haloColor,c.haloSize)))}m.setTransform(K.multiply(b));m._wrapOffsets=e;return m},_acquireSVGMarker:function(a,b,c,d){a=this._getSVGMarkerId(b,d);var e=this._getSVGMarker(a);e||(e=Z.createSVGMarker(b,a,c,d),this._div.getParent().defNode.appendChild(e),this._lineMarkers[a]=e);return e},_getSVGMarkerId:function(a,b){return"marker_"+this._map.id+"_"+a.r+"_"+a.g+"_"+a.b+"_"+b},_getSVGMarker:function(a){return this._lineMarkers[a]},_updateSVGMarkers:function(){if(M&&ma){var a=this._lineMarkers,b;for(b in a){var c=
a[b];c.setAttribute("id",b+"_temp");c.setAttribute("id",b)}}},_applyHalo:function(a,b,c){var d=b&&c?this._getHaloId(b,c):null;a.setFilter(b&&c?A("webkit")||A("ff")?this._getDilateFilter(b,c,d):this._getOffsetFilter(b,c,d):null)},_getDilateFilter:function(a,b,c){var d=this._getSVGFilter(c);d||(d=this._createSVGFilter({id:c},[E.feMorphology({operator:"dilate",radius:b,result:"dilated"}),E.feFlood({"flood-color":a.toCss(!0)}),E.feComposite({in2:"dilated",operator:"in",result:"composite"}),E.feMerge("composite",
"SourceGraphic")]));return d},_getOffsetFilter:function(a,b,c){var d=this._getSVGFilter(c);if(!d){a=a.toCss(!0);var d=this._offsetPrimitives,e,f=d.length,g=[],k=[];for(e=0;e<f;e++){var h=d[e],l="offset"+h.dir,n="composite"+h.dir;k.push(n);g.push(E.feOffset({dx:h.dx*b,dy:h.dy*b,"in":"SourceAlpha",result:l}),E.feFlood({"flood-color":a}),E.feComposite({in2:l,operator:"in",result:n}))}k.push("SourceGraphic");g.push(E.feMerge.apply(E.feMerge,k));d=this._createSVGFilter({id:c},g)}return d},_offsetPrimitives:[{dir:"L",
dx:-1,dy:0},{dir:"TL",dx:-1,dy:-1},{dir:"T",dx:0,dy:-1},{dir:"TR",dx:1,dy:-1},{dir:"R",dx:1,dy:0},{dir:"BR",dx:1,dy:1},{dir:"B",dx:0,dy:1},{dir:"BL",dx:-1,dy:1}],_getHaloId:function(a,b){return"halo_"+this._map.id+"_"+this.id+"_"+a.r+"_"+a.g+"_"+a.b+"_"+a.a+"_"+b},_getSVGFilter:function(a){return this._svgFilters[a]},_createSVGFilter:function(a,b){b=E.createFilter(a,b);var c=this._map,d=c.__visibleRect;b.x=-d.x;b.y=-d.y;b.width=c.width;b.height=c.height;return this._svgFilters[a.id]=b},_updateSVGFilters:function(a,
b,c,d){var e=this._svgFilters,f,g,k;for(g in e)if(f=e[g]){if(k=ia.byId(g))null!=a&&k.setAttribute("x",a),null!=b&&k.setAttribute("y",b),null!=c&&k.setAttribute("width",c),null!=d&&k.setAttribute("height",d);null!=a&&(f.x=a);null!=b&&(f.y=b);null!=c&&(f.width=c);null!=d&&(f.height=d)}},_getScaleMatrix:function(a,b){var c=a.width/a.height,d=1,e=1;isNaN(b)||(1<c?(d=b/a.width,e=b/c/a.height):(e=b/a.height,d=b*c/a.width));return{xx:d,yy:e}},_symbolizePoint:function(a,b,c,d){var e=b.type,f=b.style;if("shieldlabelsymbol"!==
e&&"picturemarkersymbol"!==e){var g=b.getStroke();b=b.getFill();var f=f===D.STYLE_X||f===D.STYLE_CROSS,k=g&&g.color,h=f?k:b;if(c){var l=this._getVariable(c,"colorInfo",!1),n=this._getVariable(c,"opacityInfo",!1);l&&(h=c.getColor(d,{colorInfo:l})||h);h&&n&&(h=this._applyOpacity(h,c,n,d));h&&(f?h!==k&&(g=g?x.mixin({},g):{},g.color=h):h!==b&&(b=h))}"textsymbol"===e?a.setFill(b):"simplemarkersymbol"===e&&a.setFill(b).setStroke(g)}},_drawMarkers:function(a,b,c,d){var e=a.geometry,f=e.points,g=a.getDojoShape()||
this._div.createGroup(),k,h,l=f.length,n=[],q=0,m,p=c?c.length:0;g.children[0]&&this._isInvalidShape(b,g.children[0])&&g.clear();for(h=0;h<l;h++)for(k=f[h],m=0;m<p;m++)n[0]=c[m],this._drawPoint(g,{x:k[0],y:k[1],spatialReference:e.spatialReference},b,g.children[q++],n,d,a);b=g.children.length;if(l*c.length<b)for(h=b-1;h>=l*c.length;h--)g.children[h].removeShape();a._shape=g},_symbolizeMarkers:function(a,b,c){var d=a.getDojoShape().children,e,f=d.length;for(e=0;e<f;e++)this._symbolizePoint(d[e],b,c,
a)},_errorHandler:function(a,b){b&&(a.message="Unable to draw graphic (geometry:"+(b.geometry?b.geometry.declaredClass:null)+", symbol:"+(b.symbol?b.symbol.declaredClass:null)+"): "+a.message);this.inherited(arguments)},_rendererLimits:function(){var a,b,c;w?(a=1E5,b=-1E5,c=1E5):A("chrome")&&6>A("chrome")&&(a=8150,b=-1E4,c=1E4);if(a)return{clipLimit:a,rangeMin:b,rangeMax:c,clipBBox:[-a,-a,a,a],clipSegments:[[[-a,-a],[a,-a]],[[a,-a],[a,a]],[[a,a],[-a,a]],[[-a,a],[-a,-a]]]}}(),_clipPolyline:function(a,
b){b=this._getCorners(a,b);var c=b.br,d=this._rendererLimits,e=d.rangeMin,f=d.rangeMax,g=d.clipBBox,k=d.clipSegments,d=this._isPointWithinRange,h=this._isPointWithinBBox,l=this._getClipperIntersection,n=this._getPlaneIndex;if(!d(b.tl,e,f)||!d(c,e,f)){w&&this._createSegments(a);var q=[];t.forEach(a.segments,function(a){a=a.args;var b=a.length,c=[],d;for(d=0;d<b;d+=2){var e=[a[d],a[d+1]],f=[a[d+2],a[d+3]],m=h(e,g),C=h(f,g);if(m^C){if(C=l([e,f],k))m?(d?c.push(C[1]):c.push(e,C[1]),q.push(c),c=[]):c.push(C[1],
f)}else m?d?c.push(f):c.push(e,f):(C=n(e,g),m=n(f,g),-1!==C&&-1!==m&&C!==m&&(e=l([e,f],k,!0),0<e.length&&(e[C]||(C=e[C[0]]?C[0]:C[1]),e[m]||(m=e[m[0]]?m[0]:m[1]),f=e[C],e=e[m],f&&c.push(f),e&&(c.push(e),q.push(c),c=[]))))}q.push(c)});a.setShape(this._getPathStringFromPaths(q))}},_clipPolygon:function(a,b){b=this._getCorners(a,b);var c=b.br,d=this._rendererLimits,e=d.clipLimit,f=d.rangeMin,g=d.rangeMax,k=d.clipBBox,h=d.clipSegments,d=this._isPointWithinRange,l=this._isPointWithinBBox,n=this._getClipperIntersection,
q=this._getPlaneIndex,m=ba._pointLineDistance;d(b.tl,f,g)&&d(c,f,g)||(w&&this._createSegments(a),b=t.filter(a.segments,function(a){return a.args&&a.args.length}),b=t.map(b,function(a){var b=a.args,c=b.length,d=[];a=[];var f;for(f=0;f<c;f+=2){var g=[b[f],b[f+1]],p=[b[f+2],b[f+3]];if(f===c-2){d.push(g);break}var y=l(g,k),u=l(p,k);d.push(g);if(y^u){if(u=n([g,p],h))g=u[1],g[y?"inOut":"outIn"]=!0,d.push(g),a.push([y?"INOUT":"OUTIN",d.length-1,u[0]])}else if(!y){var y=q(g,k),r=q(p,k);-1!==y&&-1!==r&&y!==
r&&(u=n([g,p],h,!0),0<u.length?(u[y]||(y=u[y[0]]?y[0]:y[1]),u[r]||(r=u[r[0]]?r[0]:r[1]),g=u[y],p=u[r],g&&(g.outIn=!0,d.push(g),a.push(["OUTIN",d.length-1,y])),p&&(p.inOut=!0,d.push(p),a.push(["INOUT",d.length-1,r]))):x.isArray(y)&&x.isArray(r)&&(u=y.concat(r),u.sort(),"0123"===u.join("")&&(u=[],3===y[0]+y[1]?u.push([e,-e],[-e,e]):u.push([-e,-e],[e,e]),y=m(u[0],[g,p]),g=m(u[1],[g,p]),d.push(y<g?u[0]:u[1]))))}}var v=k[0],w=k[1],z=k[2],A=k[3];t.forEach(d,function(a){a[0]<v&&(a[1]>=w&&a[1]<=A?a[0]=v:
(a[0]=v,a[1]=a[1]<w?w:A))});t.forEach(d,function(a){a[1]<w&&(a[0]>=v&&a[0]<=z?a[1]=w:(a[1]=w,a[0]=a[0]<v?v:z))});t.forEach(d,function(a){a[0]>z&&(a[1]>=w&&a[1]<=A?a[0]=z:(a[0]=z,a[1]=a[1]<w?w:A))});t.forEach(d,function(a){a[1]>A&&(a[0]>=v&&a[0]<=z?a[1]=A:(a[1]=A,a[0]=a[0]<v?v:z))});b=0;c=a.length;if(0<c){do{p=a[b];f=a[(b+1)%c];if(p[2]===f[2]&&"INOUT"===p[0]&&"OUTIN"===f[0])if(g=p[1],f=f[1],g<f)for(g+=1;g<f;g++)d[g][2]=!0;else if(g>f){for(g+=1;g<d.length;g++)d[g][2]=!0;for(g=0;g<f;g++)d[g][2]=!0}b=
(b+1)%c}while(0!==b)}c=d[0];b=d[d.length-1];c[2]&&(b[2]=!0,t.some(a,function(a){return 1===a[1]?(d.splice(d.length-1,0,x.clone(d[1])),!0):!1}));d=t.filter(d,function(a){return a[2]?!1:!0});for(b=0;b<d.length-1;b++)c=d[b],(f=d[b+1])&&c[0]===f[0]&&c[1]===f[1]&&(f.outIn?c.outIn=!0:f.inOut&&(c.inOut=!0),d.splice(b+1,1));c=Math.abs;a=[];for(b=0;b<d.length-1;b++){p=d[b];g=p[0];p=p[1];y=c(g)===e;u=c(p)===e;f=d[b+1];r=f[0];f=f[1];var D=c(r)===e,E=c(f)===e;y&&E?a.push([b+1,[g,f]]):u&&D&&a.push([b+1,[r,p]])}for(b=
a.length-1;0<=b;b--)f=a[b],g=d[f[0]-1],c=d[f[0]],g.outIn||g.inOut||c.outIn||c.inOut||d.splice(f[0],0,f[1]);c=d[0];b=d[d.length-1];c[0]===b[0]&&c[1]===b[1]||d.push(c);return d}),a.setShape(this._getPathStringFromPaths(b)))},_getCorners:function(a,b){if(w){a=this._map;var c=b.getExtent(),d=c.spatialReference;b=a.toScreen(new aa(c.xmin,c.ymax,d));a=a.toScreen(new aa(c.xmax,c.ymin,d));return{tl:b,br:a}}a=a.getTransformedBoundingBox();return{tl:a[0],br:a[2]}},_createSegments:function(a){a.shape.path=a.vmlPath;
a.segmented=!1;a._confirmSegmented();var b=a.segments;1<b.length&&(a.segments=t.filter(b,function(a,b,e){b=e[b+1];return"M"===a.action&&b&&"L"===b.action?(a.args=a.args.concat(b.args),!0):!1}))},_getPathStringFromPaths:function(a){w?(a=t.map(a,function(a){return"m "+t.map(a,function(a,b){return(1===b?"l ":"")+a.join(",")}).join(" ")}),a.push("e")):a=t.map(a,function(a){return"M "+t.map(a,function(a){return a.join(",")}).join(" ")});return a.join(" ")},_isPointWithinBBox:function(a,b){var c=b[1],d=
b[2],e=b[3],f=a[0];a=a[1];return f>b[0]&&f<d&&a>c&&a<e?!0:!1},_isPointWithinRange:function(a,b,c){var d=a.x;a=a.y;return d<b||a<b||d>c||a>c?!1:!0},_getClipperIntersection:function(a,b,c){var d,e=ba._getLineIntersection2,f=Math.round,g={length:0};for(d=0;4>d;d++){var k=e(a,b[d]);if(k)if(k[0]=f(k[0]),k[1]=f(k[1]),c)g[d]=k,g.length++;else return[d,k]}return c?g:null},_getPlaneIndex:function(a,b){var c=a[0];a=a[1];var d=b[0],e=b[1],f=b[2];b=b[3];return c<=d?a>=e&&a<=b?3:a<e?[0,3]:[2,3]:a<=e?c>=d&&c<=
f?0:c<d?[3,0]:[1,0]:c>=f?a>=e&&a<=b?1:a<e?[0,1]:[2,1]:a>=b?c>=d&&c<=f?2:c<d?[3,2]:[1,2]:-1},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicNodeAdd:function(){},onGraphicNodeRemove:function(){},onGraphicDraw:function(){},onGraphicsClear:function(){},onRendererChange:function(){},onOpacityChange:function(){},onInfoTemplateChange:function(){},onSurfaceChange:function(){},onWebGLEnabledChange:function(){},setInfoTemplate:function(a){this.infoTemplate=a;this._evalSurfaceType();this.onInfoTemplateChange()},
add:function(a,b){if(a._graphicsLayer===this)return a;a._suspended=this._suspendGraphics;b||this.graphics.push(a);a._graphicsLayer=this;a._sourceLayer||(a._layer&&"esri.layers.GraphicsLayer"!==a._layer.declaredClass?a._sourceLayer=a._layer:"esri.layers.GraphicsLayer"!==this.declaredClass&&(a._sourceLayer=this));a._layer=this;this.hasWebGLSurface()||(this._updateExtent(a),this._draw(a));if(!b)this.onGraphicAdd(a);return a},remove:function(a,b,c){if(!b&&!c){b=this.graphics;var d;if(-1===(d=t.indexOf(b,
a)))return null;if(!ea||64<=ea)b.splice(d,1);else{var e=b.length;if(e){for(;d<e;)b[d]=b[d+1],d++;b.length--}}}this.hasWebGLSurface()||a.getDojoShape()&&this._removeShape(a,null,c);a._shape=a._graphicsLayer=null;this.onGraphicRemove(a);return a},clear:function(a,b){a=this.graphics;var c,d=!w;for(c=a.length-1;0<=c;c--)this.remove(a[c],null,d);this.graphics=[];this.hasWebGLSurface()||this._destroyAllNodes();if(!b)this.onGraphicsClear()},_destroyAllNodes:function(){if(!w&&this._div){var a;this._childLayer&&
(a=this._childLayer.getNode())&&a.parentNode&&a.parentNode.removeChild(a);this._bgGroup.clear();this._div.clear();this._bgGroup=this._div.createGroup();a&&this._div.getEventSource().appendChild(a);this._initOpacity()}},clearNodes:function(){if(!this.hasWebGLSurface()){var a=this.graphics,b=a.length,c;for(c=0;c<b;c++)this._removeShape(a[c],!0,!0);this._destroyAllNodes()}},_graphicVisibilityChanged:function(a){},_setIEOpacity:function(a,b){var c=a&&a.getNode();if(c){var d=a.strokeStyle,e=c.stroke;d&&
e&&(e.opacity=d.color.a*b);a=a.fillStyle;d=c.fill;a&&d&&("tile"===d.type?v.set(c,"opacity",b):d.opacity=a.a*b)}},setOpacity:function(a,b){if(b||this.opacity!=a){var c=this._div;c&&!this.hasWebGLSurface()&&(w?(t.forEach(this.graphics,function(b){this._setIEOpacity(b._shape,a);this._setIEOpacity(b._bgShape,a)},this),c._esriIeOpacity=a,this._bgGroup._esriIeOpacity=a):"canvas-2d"===this.surfaceType?v.set(c.getEventSource(),"opacity",a):c.getEventSource().setAttribute("opacity",a));this.opacity=a;if(!b)this.onOpacityChange(a)}},
setRenderer:function(a){this.renderer=a;this._evalSDRenderer(!0);this._evalSurfaceType();this.emit("renderer-change",{renderer:this._rndForScale||a})}});H=H([P,la],{declaredClass:"esri.layers.GraphicsLayer",constructor:function(){this._processEvent=x.hitch(this,this._processEvent);this._initLayer()},_initLayer:function(){this.loaded=!0;this.onLoad(this)},_setMap:function(){var a=this.inherited("_setMap",arguments);this.enableMouseEvents();return a},_unsetMap:function(){this.disableMouseEvents();this.inherited("_unsetMap",
arguments)},_processEvent:function(a){var b=this._map,c=a.target,d;a.screenPoint=new U(a.pageX-b.position.x,a.pageY-b.position.y);for(a.mapPoint=b.toMap(a.screenPoint);c&&!(d=c.e_graphic);)c=c.parentNode;if(d)return a.graphic=d,a},_onMouseOverHandler:function(a){if(this._processEvent(a))this.onMouseOver(a)},_onMouseMoveHandler:function(a){if(this._processEvent(a))this.onMouseMove(a)},_onMouseDragHandler:function(a){if(this._processEvent(a))this.onMouseDrag(a)},_onMouseOutHandler:function(a){if(this._processEvent(a))this.onMouseOut(a)},
_onMouseDownHandler:function(a){this._downGr=this._downPt=null;this._processEvent(a)&&(r.disconnect(this._onmousemove_connect),r.disconnect(this._onmousedrag_connect),this._onmousedrag_connect=r.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler"),this._downGr=a.graphic,this._downPt=a.screenPoint.x+","+a.screenPoint.y,this.onMouseDown(a))},_onMouseUpHandler:function(a){this._upGr=this._upPt=null;this._processEvent(a)&&(r.disconnect(this._onmousedrag_connect),r.disconnect(this._onmousemove_connect),
this._onmousemove_connect=r.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler"),this._upGr=a.graphic,this._upPt=a.screenPoint.x+","+a.screenPoint.y,this.onMouseUp(a))},_onClickHandler:function(a){if(this._processEvent(a)){var b=this._downGr,c=this._upGr;b&&c&&b===c&&this._downPt===this._upPt&&(w&&(z._ieGraphic=a.graphic),this.onClick(a))}},_onDblClickHandler:function(a){if(this._processEvent(a))this.onDblClick(a)},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},
onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(!this._mouseEvents){var a=r.connect,b=this._div.getEventSource();G||(this._onmouseover_connect=a(b,"onmouseover",this,"_onMouseOverHandler"),this._onmousemove_connect=a(b,"onmousemove",this,"_onMouseMoveHandler"),this._onmouseout_connect=a(b,"onmouseout",this,"_onMouseOutHandler"),this._onmousedown_connect=a(b,"onmousedown",this,"_onMouseDownHandler"),
this._onmouseup_connect=a(b,"onmouseup",this,"_onMouseUpHandler"),this._onclick_connect=a(b,"onclick",this,"_onClickHandler"),this._ondblclick_connect=a(b,"ondblclick",this,"_onDblClickHandler"));this._mouseEvents=!0}},disableMouseEvents:function(){if(this._mouseEvents){var a=r.disconnect;a(this._onmouseover_connect);a(this._onmousemove_connect);a(this._onmousedrag_connect);a(this._onmouseout_connect);a(this._onmousedown_connect);a(this._onmouseup_connect);a(this._onclick_connect);a(this._ondblclick_connect);
this._mouseEvents=!1}}});H._GraphicsContainer=T;H._GraphicsLayer=P;A("extend-esri")&&(x.setObject("layers.GraphicsLayer",H,z),x.setObject("layers._GraphicsContainer",T,z),x.setObject("layers._GraphicsLayer",P,z));return H});