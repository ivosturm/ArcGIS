// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/WCSCoverageDescription","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ./TimeInfo ../geometry/Extent".split(" "),function(u,n,y,z,x,t){var w=function(a,b){var c;for(c=0;c<a.length;c++)if(b(a[c]))return c;return-1};u=u(null,{declaredClass:"esri.layers.WCSCoverageDescription",version:null,id:null,description:null,lonLatEnvelope:null,extent:null,supportedFormats:null,supportedInterpolations:null,bandInfo:null,timeInfo:null,multidimensionalInfo:null,resolution:null,columns:null,
rows:null,nativeCoverageDescription:null,_useEPSGAxis:!1,_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,
21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],constructor:function(a,b){this.version=b;this._parse=n.hitch(this,this._parse);a&&n.mixin(this,this._parse(a,b))},_parse:function(a,b){var c;this.version=b;switch(b){case "1.0.0":a=this._parse100(a);this._useEPSGAxis=!1;this.id=a.name;this.description=a.description||a.label;
this.lonLatEnvelope=a.lonLatEnvelope;this.extent=a.domainSet.spatialDomain.envelope;this.supportedFormats=a.supportedFormats;b=a.domainSet;c=a.rangeSet;a.supportedInterpolations&&0<a.supportedInterpolations.length&&(this.supportedInterpolations=a.supportedInterpolations.map(function(a){var b=null;-1<a.toLowerCase().indexOf("nearest")?b=0:-1<a.toLowerCase().indexOf("linear")?b=1:-1<a.toLowerCase().indexOf("cubic")&&(b=2);return b}).filter(function(a){return null!==a}));break;case "1.1.0":case "1.1.1":case "1.1.2":a=
this._parse110(a);this.id=a.identifier;this.description=a["abstract"]||a.title;this.extent=a.domain.spatialDomain.envelope;this.supportedFormats=a.supportedFormats;b=a.domain;c=a.range;a.range[0].supportedInterpolations&&0<a.range[0].supportedInterpolations.length&&(this.supportedInterpolations=a.range[0].supportedInterpolations.map(function(a){var b=null;-1<a.toLowerCase().indexOf("nearest")?b=0:-1<a.toLowerCase().indexOf("linear")?b=1:-1<a.toLowerCase().indexOf("bicubic")&&(b=2);return b}).filter(function(a){return null!==
a}));break;case "2.0.1":a=this._parse201(a);this._useEPSGAxis=!0;this.id=a.coverageId;this.description=a.description||a.coverageId;this.extent=a.boundedBy.envelope;this.supportedFormats=a.serviceParameters.supportedFormats;b=a.domainSet;c=a.rangeType;break;default:throw"unsupported WCS version "+b;}this.nativeCoverageDescription=a;this.resolution=a.resolution;this.columns=b.columns||b.spatialDomain.columns;this.rows=b.rows||b.spatialDomain.rows;this.bandInfo=this._getBandInfo(c);this.timeInfo=this._getTimeInfo(a);
this.multidimensionalInfo=this._getMultidimensionalInfo(a)},_getElements:function(a,b){if(!a)return null;if(!b)return a;var c=b;-1<b.indexOf("/")?(c=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";return b?this._getElement(a,c).getElementsByTagNameNS("*",b):a.getElementsByTagNameNS("*",c)},_getElement:function(a,b){if(!a)return null;if(!b)return a;var c=b;-1<b.indexOf("/")?(c=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";a=this._getElements(a,c);return 0<a.length?b?this._getElement(a[0],
b):a[0]:null},_getElementValue:function(a,b){return(a=this._getElement(a,b))?(a=a.textContent||a.text||a.nodeValue||a.innerText)?a.trim():null:null},_getElementValues:function(a,b){a=this._getElements(a,b);b=[];var c,e;for(e=0;e<a.length;e++)if(c=a[e].textContent||a[e].text||a[e].nodeValue||a[e].innerText)c=c.trim(),""!==c&&b.push(c);return b},_checkTagName:function(a,b){if(null===a||null===b||null===a.tagName||void 0===a.tagName)return!1;a=a.tagName.toLowerCase();b=b.toLowerCase();return a===b||
0<a.indexOf(":"+b)},_parseTimeResolution:function(a){if(!a)return{resolution:null,units:null};var b=a.toUpperCase(),c=["Y","M","D"],e=["H","M","S"];a="Years Months Days Hours Minutes Seconds".split(" ");var h;-1===b.indexOf("PT")?(b=b.slice(1),c=w(c,function(a){return-1<b.indexOf(a)}),-1<c&&(h=a[c])):(b=b.slice(2),c=w(e,function(a){return-1<b.indexOf(a)}),h=a[3+c]);return{resolution:parseFloat(b.substring(0,b.length-1)),units:h}},_getMultidimensionalInfo:function(a){var b,c,e=this.version,h=[];if(0===
e.indexOf("1.1"))(c=a.range.filter(function(a){return-1===a.identifier.toLowerCase().indexOf("field_1")&&!a.axis.some(function(a){return"band"===a.identifier.toLowerCase()})}))&&0<c.length&&(c.forEach(function(a){var b=a.axis.map(function(a){a={name:a.identifier.trim(),field:a.identifier.trim(),unit:a.valuesUnit?a.valuesUnit.trim():"",hasRegularIntervals:!1,values:a.values.map(function(a){return parseFloat(a.trim())})};a.extent=[Math.min.apply(null,a.values),Math.max.apply(null,a.values)];return a});
h.push({name:a.identifier.trim(),description:a.description?a.description.trim():"",unit:"",dimensions:b})}),0<h.length&&(b={variables:h}));else if(0===e.indexOf("2.0")&&(c=[],a.rangeType.forEach(function(a){c=c.concat(a.filter(function(a){return-1===a.name.toLowerCase().indexOf("band")}))}),c&&0<c.length)){var m=[],e=function(a){var b,g="";Math.abs(a-1/24)<1/24*.01?(b=1,g="Hours"):.01>Math.abs(a-1)?(b=1,g="Days"):1>a?(b=Math.round(24*a),g="Hours"):27.99<a&&31.01>a?(b=1,g="Months"):12>Math.round(a/
30)?(b=12>Math.round(a/30),g="Months"):364.99<a&&366.01>a&&(b=1,g="Years");return{interval:b,intervalUnit:g}},l=a.boundedBy,f,k,p,d;for(f=2;f<a.domainSet.axisLabels.length;f++)k=(l.uomLabels&&l.uomLabels.length)>f?l.uomLabels[f]:"",k=(p=-1<a.domainSet.axisLabels[f].toLowerCase().indexOf("time")||"iso8601"===k.toLowerCase())?e(a.domainSet.offset[f]):{interval:a.domainSet.offset[f],intervalUnit:k},d={name:a.domainSet.axisLabels[f].trim(),field:a.domainSet.axisLabels[f].trim(),unit:l.uomLabels&&l.uomLabels.length>
f?l.uomLabels[f].trim():"",hasRegularIntervals:!0},n.mixin(d,k),d.extent=p?[(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.mins[f]-25569)),(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.maxs[f]-25569))]:[l.envelopeAllDims.mins[f],l.envelopeAllDims.maxs[f]],m.push(d);c.forEach(function(a){h.push({name:a.name.trim(),description:a.description.trim(),unit:a.uom.trim(),dimensions:m})});0<h.length&&(b={variables:h})}return b},_getBandInfo:function(a){var b,c,e=!1,h;switch(this.version){case "1.0.0":for(b=
0;b<a.length&&!e;b++)for(c=0;c<a[b].axis.length;c++)if("band"===a[b].axis[c].name.toLowerCase()){h=a[b].axis[c].values;e=!0;break}break;case "1.1.0":case "1.1.1":case "1.1.2":for(b=0;b<a.length&&!e;b++)for(c=0;c<a[b].axis.length;c++)if("band"===a[b].axis[c].identifier.toLowerCase()){h=a[b].axis[c].values;e=!0;break}break;case "2.0.1":for(b=0;b<a[0].length;b++)-1<a[0][b].name.toLowerCase().indexOf("band")&&(h=h||[],h.push(a[0][b].name))}return h},_useLatLong:function(a){var b,c;for(c=0;c<this._REVERSED_LAT_LONG_RANGES.length;c++){var e=
this._REVERSED_LAT_LONG_RANGES[c];if(a>=e[0]&&a<=e[1]){b=!0;break}}return b},_getTimeInfo:function(a){var b,c;switch(this.version){case "1.0.0":case "1.1.0":case "1.1.1":case "1.1.2":(a=(a.domainSet||a.domain).temporalDomain)&&(b=new x({timeExtent:[a.begin,a.end],interval:a.resolution,intervalUnit:a.unit}));break;case "2.0.1":c=w(a.domainSet.axisLabels,function(a){return-1<a.toLowerCase().indexOf("time")}),-1<c&&(b=new x({startTimeField:a.domainSet.axisLabels[c],timeExtent:[(new Date).setTime(864E5*
(a.boundedBy.envelopeAllDims.mins[c]-25569)),(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.maxs[c]-25569))]}))}return b},_parse100:function(a){var b={name:null,label:null,lonLatEnvelope:null,supportedFormats:null,supportedCRSs:null,domainSet:null,rangeSet:null,description:null,metadataLink:null,supportedInterpolations:null},c=a.childNodes.length,e=this._checkTagName,h=n.hitch(this,function(a){var b=this._getElementValues(a,"requestResponseCRSs").map(function(a){return a.split(":")[1]});a=
this._getElementValues(a,"nativeCRSs").map(function(a){return a.split(":")[1]});return{requestResponseCRSs:b,nativeCRSs:a}}),m=n.hitch(this,function(a){var b=this._getElementValues(a,"interpolationMethod"),g=a.getAttribute("default");return void 0!==g||null!==g?[g].concat(b.filter(function(a){return a.toLowerCase()!==g.toLowerCase()})):b}),l=n.hitch(this,function(a){var b=this._getElements(a,"pos");a=this._getElementValue(b[0]).split(" ");b=this._getElementValue(b[1]).split(" ");return new t({xmin:parseFloat(a[0]),
ymin:parseFloat(a[1]),xmax:parseFloat(b[0]),ymax:parseFloat(b[1]),spatialReference:{wkid:4326}})}),f=n.hitch(this,function(a){var b=[];a=this._getElements(a,"RangeSet");var g,d,c,r,e,f,k,h;for(k=0;k<a.length;k++){g={};g.name=this._getElementValue(a[k],"name");g.label=this._getElementValue(a[k],"label");g.axis=[];d=this._getElements(a[k],"AxisDescription");for(h=0;h<d.length;h++){c={};c.name=this._getElementValue(d[h],"name");c.label=this._getElementValue(d[h],"label");r=[];r=this._getElementValues(d[h],
"singleValue");if(0===r.length&&(e=this._getElementValue(d[h],"min"),f=this._getElementValue(d[h],"max"),null!==e&&null!==f))for(e=parseInt(e,10);e<=parseInt(f,10);e++)r.push(e);c.values=r;g.axis.push(c)}b.push(g)}return b}),k=n.hitch(this,function(a){var b={},d={},g=this._getElement(a,"spatialDomain"),c=this._getElement(g,"Envelope")||this._getElement(g,"EnvelopeWithTimePeriod"),e=c.getAttribute("srsName").split(":"),e=e[e.length-1],k=this._getElements(c,"pos"),c=this._getElementValue(k[0]).split(" "),
k=this._getElementValue(k[1]).split(" ");d.envelope=new t({xmin:parseFloat(c[0]),ymin:parseFloat(c[1]),xmax:parseFloat(k[0]),ymax:parseFloat(k[1]),spatialReference:{wkid:parseInt(e,10)}});var e=this._getElement(g,"RectifiedGrid"),c=this._getElementValue(e,"low").split(" "),k=this._getElementValue(e,"high").split(" "),e=parseInt(k[0],10)-parseInt(c[0],10)+1,c=parseInt(k[1],10)-parseInt(c[1],10)+1,k=this._getElementValue(g,"origin/pos").split(" "),f=this._getElements(g,"offsetVector"),g=parseFloat(this._getElementValue(f[0]).split(" ")[0]),
f=parseFloat(this._getElementValue(f[0]).split(" ")[1]);d.columns=e;d.rows=c;d.offset={x:g,y:f};d.origin={x:parseFloat(k[0]),y:parseFloat(k[1])};b.spatialDomain=d;d={begin:null,end:null};g=[];if(e=this._getElement(a,"temporalDomain")){a=this._getElements(e,"timeposition");if(0<a.length){for(e=0;e<a.length;e++)g.push(new Date(this._getElementValue(a[e])));d.begin=g[0];d.end=g[g.length-1];d.values=g}else if(a=this._getElement(e,"timePeriod"))d.begin=new Date(this._getElementValue(a,"beginPosition")),
d.end=new Date(this._getElementValue(a,"endPosition")),a=this._getElementValue(a,"timeResolution"),d=n.mixin(d,this._parseTimeResolution(a));b.temporalDomain=d}return b}),p,d;for(p=0;p<c;p++)d=a.childNodes[p],e(d,"description")?b.description=this._getElementValue(d):e(d,"name")?b.name=this._getElementValue(d):e(d,"label")?b.label=this._getElementValue(d):e(d,"supportedFormats")?b.supportedFormats=this._getElementValues(d,"formats"):e(d,"supportedCRSs")?b.supportedCRSs=h(d):e(d,"supportedInterpolations")?
b.supportedInterpolations=m(d):e(d,"lonLatEnvelope")?b.lonLatEnvelope=l(d):e(d,"rangeSet")?b.rangeSet=f(d):e(d,"domainSet")&&(b.domainSet=k(d),b.resolution=b.domainSet.spatialDomain.offset);return b},_parse110:function(a){var b={title:null,"abstract":null,identifier:null,supportedFormats:null,supportedCRSs:null,domain:null,range:null,metadata:null},c=a.childNodes.length,e=this._checkTagName,h=n.hitch(this,function(a){var b=[];a=this._getElements(a,"Field");var d,g,c,e,f;for(d=0;d<a.length;d++){c=
{};c.identifier=this._getElementValue(a[d],"Identifier");c.description=this._getElementValue(a[d],"Description");c.definition=this._getElementValue(a[d],"Definition");c.Abstract=this._getElementValue(a[d],"Abstract");c.Title=this._getElementValue(a[d],"Title");c.supportedInterpolations=this._getElementValues(a[d],"InterpolationMethod");c.axis=[];f=this._getElements(a[d],"Axis");for(g=0;g<f.length;g++)e={},e.identifier=f[g].getAttribute("identifier"),e.valuesUnit=this._getElementValue(f[g],"valuesUnit"),
e.dataType=this._getElementValue(f[g],"DataType"),e.values=this._getElementValues(f[g],"Key"),c.axis.push(e);b.push(c)}return b}),m=n.hitch(this,function(a){for(var b={},d={},c=this._getElement(a,"SpatialDomain"),e=this._getElement(c,"GridCRS"),f=this._getElementValue(e,"GridBaseCRS"),h=this._getElementValue(e,"GridOrigin"),h=h?h.split(" "):[0,0],e=this._getElementValue(e,"GridOffsets").split(" "),q=this._getElements(c,"BoundingBox"),r,k,l,m,v,c=0;c<q.length;c++)"urn:ogc:def:crs:OGC::imageCRS"===
q[c].getAttribute("crs")?(l=this._getElementValue(q[c],"LowerCorner").split(" "),m=this._getElementValue(q[c],"UpperCorner").split(" "),r=parseInt(m[0],10)-parseInt(l[0],10)+1,k=parseInt(m[1],10)-parseInt(l[1],10)+1):0<q[c].getAttribute("crs").indexOf("EPSG")&&(v=q[c].getAttribute("crs").split("::")[1],l=this._getElementValue(q[c],"LowerCorner").split(" "),m=this._getElementValue(q[c],"UpperCorner").split(" "),d.envelope=new t({xmin:parseFloat(l[0]),ymin:parseFloat(l[1]),xmax:parseFloat(m[0]),ymax:parseFloat(m[1]),
spatialReference:{wkid:parseInt(v,10)}}));c=r>k;q=d.envelope.xmax-d.envelope.xmin>d.envelope.ymax-d.envelope.ymin;this._useLatLong(v)&&(c===q?this._useEPSGAxis=!1:(this._useEPSGAxis=!0,d.envelope=new t({xmin:d.envelope.ymin,ymin:d.envelope.xmin,xmax:d.envelope.ymax,ymax:d.envelope.xmax,spatialReference:{wkid:parseInt(v,10)}})));d.columns=r;d.rows=k;d.origin={x:parseFloat(h[0]),y:parseFloat(h[1])};d.offset={x:parseFloat(e[0]),y:parseFloat(e[1])};d.gridBaseCRS=f;b.spatialDomain=d;d={begin:null,end:null};
f=[];if(h=this._getElement(a,"temporalDomain")){a=this._getElements(h,"timeposition");if(0<a.length){for(c=0;c<a.length;c++)f.push(new Date(this._getElementValue(a[c])));d.begin=f[0];d.end=f[f.length-1];d.values=f}else a=this._getElements(h,"timePeriod"),0<a.length&&(d.begin=new Date(this._getElementValue(a[0],"beginPosition")),d.end=new Date(this._getElementValue(a[0],"endPosition")),a=this._getElementValue(a[0],"timeResolution"),d=n.mixin(d,this._parseTimeResolution(a)));b.temporalDomain=d}return b}),
l,f;for(l=0;l<c;l++)f=a.childNodes[l],e(f,"Title")?b.title=this._getElementValue(f):e(f,"Abstract")?b["abstract"]=this._getElementValue(f):e(f,"Identifier")?b.identifier=this._getElementValue(f):e(f,"SupportedFormat")?(b.supportedFormats||(b.supportedFormats=[]),b.supportedFormats.push(this._getElementValue(f))):e(f,"SupportedCRS")?(b.supportedCRSs||(b.supportedCRSs=[]),b.supportedCRSs.push(this._getElementValue(f))):e(f,"Range")?b.range=h(f):e(f,"Domain")&&(b.domain=m(f),b.resolution=b.domain.spatialDomain.offset);
return b},_parse201:function(a){var b={coverageId:null,boundedBy:null,domainSet:null,rangeType:null,serviceParameters:null,coverageFunction:null,extension:null},c=a.childNodes.length,e=function(a){return parseFloat(a)},h=function(a){return parseInt(a,10)},m=this._checkTagName,l=n.hitch(this,function(a){var b={envelope:null,axisLabels:null,uomLabels:null,envelopeAllDims:null};a=this._getElement(a,"Envelope")||this._getElement(a,"EnvelopeWithTimePeriod");var c=a.getAttribute("srsName"),c=c.slice(c.lastIndexOf("/")+
1),d=a.getAttribute("axisLabels"),f=this._getElementValue(a,"lowerCorner").split(" ").map(e),g=this._getElementValue(a,"upperCorner").split(" ").map(e);"y lat latitude north nor n b".split(" ").some(function(a){return a===d[0].toLowerCase()})?b.envelope=new t({xmin:f[1],ymin:f[0],xmax:g[1],ymax:g[0],spatialReference:{wkid:parseInt(c,10)}}):b.envelope=new t({xmin:f[0],ymin:f[1],xmax:g[0],ymax:g[1],spatialReference:{wkid:parseInt(c,10)}});b.axisLabels=d;b.envelopeAllDims={mins:f,maxs:g};a=a.getAttribute("uomLabels").trim().split(" ");
b.uomLabels=a.length?a:null;return b}),f=n.hitch(this,function(a){var b=[];a=this._getElements(a,"DataRecord");var c,d,e,f,g,h,k=function(a){return a.map(function(a){return parseFloat(a)})};for(f=0;f<a.length;f++){c=this._getElements(a[f],"field");d=[];for(g=0;g<c.length;g++){e={};e.name=c[g].getAttribute("name");e.description=this._getElementValue(c[g],"description")||"";e.uom=this._getElement(c[g],"uom").getAttribute("code")||"";if(h=this._getElementValue(c[g],"interval"))h=h.split(" "),e.allowedValues=
k(h);d.push(e)}b.push(d)}return b}),k=n.hitch(this,function(a){var b={},c=this._getElement(a,"RectifiedGrid"),d=this._getElementValue(c,"low").split(" ").map(h),f=this._getElementValue(c,"high").split(" ").map(h);a=[];var g;for(g=0;g<d.length;g++)a.push(f[g]-d[g]+1);var k=this._getElementValue(c,"axisLabels").split(" "),d=this._getElementValue(c,"origin/pos").split(" ").map(e),c=this._getElements(c,"offsetVector"),f=[];for(g=0;g<c.length;g++)f.push(parseFloat(this._getElementValue(c[g]).split(" ")[g]));
"y lat latitude north nor n b".split(" ").some(function(a){return a===k[0].toLowerCase()})?(b.columns=a[1],b.rows=a[0],b._resolution={y:f[0],x:f[1]}):(b.columns=a[0],b.rows=a[1],b._resolution={x:f[0],y:f[1]});b.gridSamples=a;b.axisLabels=k;b.offset=f;b.origin=d;return b}),p,d;for(p=0;p<c;p++)d=a.childNodes[p],m(d,"coverageId")?b.coverageId=this._getElementValue(d):m(d,"ServiceParameters")?b.serviceParameters={supportedFormats:this._getElementValues(d,"nativeFormat")}:m(d,"boundedBy")?b.boundedBy=
l(d):m(d,"rangeType")?b.rangeType=f(d):m(d,"domainSet")&&(b.domainSet=k(d),b.resolution=b.domainSet._resolution);return b}});y("extend-esri")&&n.setObject("layers.WCSCoverageDescription",u,z);return u});