// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/BandArithmeticFunction","dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(d,f,g,m,h,k,l){return d([g,k],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);
if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=f.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=l.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,
method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:h.bandArithmetic,fragmentName:"bandArithmetic"});var b=this.functionArguments.bandIndexes.trim().split(" ").map(function(a){return parseInt(a,10)});this._infraredBandID=b[0]-1;this._visibleBandID=b[1]-1;this._alterBand=2<Math.max(this._infraredBandID,
this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==b.length?{bandIDs:[this._infraredBandID,this._visibleBandID,this._infraredBandID]}:{bandIDs:[b[0]-1,b[1]-1,b[2]-1]});var c=this.gl,d=this.bindFrameBuffer();c.bindTexture(c.TEXTURE_2D,a.texture);var c=this.functionArguments.method,e=2<b.length?b.slice(2):null;this._alterBand?this._setUniforms({u_method:c,u_bandId_nir:0,u_bandId_red:1,u_constants:e}):this._setUniforms({u_method:c,u_bandId_nir:b[0]-1,u_bandId_red:b[1]-1,
u_constants:e});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:d.texture}}})});