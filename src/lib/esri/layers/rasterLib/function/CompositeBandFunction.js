// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/CompositeBandFunction","dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(h,k,l,p,m,n){return h([l,n],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.rasters)return Error("The rasters input to composite band function is invalid.");
var f=[],c=[],b=a.rasters.length,d;if(a.rasters[0].statistics)for(d=0;d<b;d++)f.push(a.rasters[d].statistics[0]);if(a.rasters[0].histograms)for(d=0;d<b;d++)c.push(a.rasters[d].histograms[0]);this.rasterInfo=k.mixin(a.rasters[0],{bandCount:b,pixelType:this._calculatePixelType(this.pixelType,a.rasters[0].pixelType),statistics:f,histograms:c});return!0},read2D:function(a){a=a.rasters;if(null!=a&&0!==a.length){for(var f=this._clonePixelData(a[0]),c=f.pixelBlock,b=[],d=[],e=0;e<a.length;e++)b.push(a[e].pixelBlock.pixels[0]),
d.push(a[e].pixelBlock.statistics[0]);c.pixels=b;c.stackedStatistics=d;c.planes=a.length;var g,e,d=c.width*c.height;for(e=0;e<a.length;e++)if(c=a[e].pixelBlock.mask,g&&c)for(b=0;b<d;b++)g[b]&=c[b];else g=g||c;f.maks=g;return f}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.compositeBand,fragmentName:"CompositeBand"});var f=a.rasters;if(null!=f&&0!==f.length){var f=f.length,c=this.gl,b,d,e,g=this.bindFrameBuffer();for(b=0;b<f;b++)d=this._setupTextureData(a.rasters[b],
{notOriginal:0<b}),e=0<b?b.toString():"",e=c.getUniformLocation(this.rasterProgram,"u_image"+e),c.uniform1i(e,b),c.activeTexture(c.TEXTURE0+b),c.bindTexture(c.TEXTURE_2D,d.texture);this._setUniforms({u_rasterCount:f});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:d.extent,texture:g.texture}}}})});