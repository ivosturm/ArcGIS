// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/ExtractBandFunction","dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(h,g,k,n,l,m){return h([k,m],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);
if(!a.raster)return Error("The raster input to extract band function is invalid.");var b=[],c=a.raster.statistics,e=[],d=a.raster.histograms,f=this.functionArguments.bandIDs.length||a.raster.bandCount;this.functionArguments.bandIDs.forEach(g.hitch(this,function(a){if(a>=f-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+a);a=f-1}if(0>a)return Error("missing band "+a);void 0!==c&&null!==c&&0<c.length&&b.push(c[a]);void 0!==d&&null!==d&&0<d.length&&e.push(d[a])}));this.rasterInfo=
g.mixin(a.raster,{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:b,histograms:e});return!0},read2D:function(a){a=this._clonePixelData(a.raster);if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){this._performance.start();var b=a.pixelBlock,c=b.statistics,e=b.pixels,d=e.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return a;var f=[],g=[];this.functionArguments.bandIDs.forEach(function(a){if(a>=
d-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+a;a=d-1}if(0>a)throw"missing band "+a;f.push(e[a]);void 0!==c&&null!==c&&0<c.length&&g.push(c[a])});b.pixels=f;b.statistics=g;b.planes=this.functionArguments.bandIDs.length;return a}},readGL:function(a){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:l.extractBand,
fragmentName:"ExtractBand"});var b=this.functionArguments.bandIDs;1===b.length&&(b=[b[0],b[0],b[0]]);this._bandIDs=b;this._alterBand=!(0===this.functionArguments.bandIDs.length||0===b[0]&&1===b[1]&&2===b[2]);var c=!!(this._alterBand&&a.raster&&a.raster.texture);a=this._setupTextureData(a.raster,{bandIDs:b});var e=this.gl,d=this.bindFrameBuffer();e.bindTexture(e.TEXTURE_2D,a.texture);c?this._setUniforms({u_bandIDs:b,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:b,u_alterBand:!1});this._drawGL();
this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:d.texture}}})});