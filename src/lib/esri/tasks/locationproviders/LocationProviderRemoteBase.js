// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/tasks/locationproviders/LocationProviderRemoteBase","../../declare dojo/_base/array dojo/Deferred dojo/promise/all ../../graphic ./LocationProviderBase".split(" "),function(p,q,m,r,v,t){function u(a,c){function e(a){4>f&&(a=b.shift())&&d(a.args,a.dfd)}function d(b,d){f++;b=c.apply(a,b);b.always(function(){f--;e()});b.then(d.resolve,d.reject,d.progress)}var b=[],f=0;return function(){var a=arguments,c=new m;b.push({args:a,dfd:c});e();return c.promise}}return p("esri.tasks.locationproviders.LocationProviderRemoteBase",
t,{_fields:null,constructor:function(){var a=this._getFieldMapping&&this._getFieldMapping();this._fields=[];if(a)for(var c in a)a.hasOwnProperty(c)&&this._fields.push({inField:a[c],outField:c})},_throttle:function(a){return u(this,a)},_createFeatureLookup:function(a){for(var c={},e=0;e<a.length;e++){var d=a[e],b=this._createKey(d);if(b){var f=c[b];f?f.push(d):c[b]=[d]}}return c},_createKey:function(a,c){var e=[];c=c||q.map(this._fields,function(a){return a.inField});for(var d=0;d<c.length;d++){var b=
a.attributes[c[d]];if(void 0!==b&&null!==b)e.push(b);else return}return e.join("|||")},_locate:function(a,c){var e=new m,d=this,b=[],f=[],g=[];a=this._createFeatureLookup(a);var k=function(a){return d._locateBatch(a,c).then(function(a){a&&(b=b.concat(a));e.progress(b)})},k=this._throttle(k),l;for(l in a)if(a.hasOwnProperty(l)){var h=a[l],n=this._createQueryExpression(h[0]);n&&(h={key:l,features:h,expression:n},this._batchWillOverflow(g,h)&&(f.push(k(g)),g=[]),g.push(h))}g.length&&f.push(k(g));r(f).then(function(){e.resolve(b)});
return e.promise}})});