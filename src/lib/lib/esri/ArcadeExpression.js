// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/ArcadeExpression","dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),function(d,e,f,g,h,c){d=d(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(a){e.mixin(this,a);this.returnType=this.returnType||"string";this.id=h.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));
this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var a=this._traits.geometryOperations;void 0===a&&(a=this._traits.geometryOperations=c.hasGeometryOperations(this.syntaxTree));return a},hasFeatureSetOperations:function(){var a=this._traits.featureSetOperations;void 0===a&&(a=this._traits.featureSetOperations=c.hasFeatureSetOperations(this.syntaxTree));return a},hasVariable:function(a){var b=this._traits.variables;void 0===b[a]&&(b[a]=c.hasVariable(this.syntaxTree,
a));return b[a]},hasFunction:function(a){var b=this._traits.functions;void 0===b[a]&&(b[a]=c.hasFunction(this.syntaxTree,a));return b[a]},evaluate:function(a){this._compile();var b=this._attributeCache.compiledFunc;return this.async?c.executeAsyncFunction(b,a):c.executeFunction(b,a)},_setSyntaxTree:function(a){this.syntaxTree=a;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};
this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});f("extend-esri")&&(g.ArcadeExpression=d);return d});