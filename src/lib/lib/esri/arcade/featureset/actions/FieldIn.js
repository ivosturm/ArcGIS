// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
var __extends=this&&this.__extends||function(){var l=function(k,e){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,e){g.__proto__=e}||function(e,k){for(var g in k)k.hasOwnProperty(g)&&(e[g]=k[g])};return l(k,e)};return function(k,e){function g(){this.constructor=k}l(k,e);k.prototype=null===e?Object.create(e):(g.prototype=e.prototype,new g)}}();
define("esri/arcade/featureset/actions/FieldIn","require exports ../support/FeatureSet ../support/IdSet ../support/shared ../support/sqlUtils ../../polyfill/promiseUtils ../../polyfill/sql/WhereClause".split(" "),function(l,k,e,g,n,p,m,q){return function(e){function c(a){var b=e.call(this,a)||this;b.declaredClass="esri.arcade.featureset.actions.fieldin";b.isOneToOne=!1;b._inLayer=null;b._parent=a.parentfeatureset;b.isOneToOne=a.isOneToOne;b._inLayer=a.infeatures;b.sourceField=a.sourceField;b.destinationField=
a.destinationField;return b}__extends(c,e);c.prototype._getSet=function(a){var b=this;return null===this._wset?this._getFilteredSet("",null,null,null,a).then(function(a){b._wset=a;return b._wset}):m.resolve(this._wset)};c.prototype._getFeatures=function(a,b,d,h){var c=this,f=[];-1!==b&&void 0===this._featureCache[b]&&f.push(b);f=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(a,f,h)?this._expandPagedSet(a,f,0,0,h).then(function(f){return c._getFeatures(a,b,d,h)}):m.resolve("success")};
c.prototype._isInFeatureSet=function(){return n.IdState.InFeatureSet};c.prototype._refineSetBlock=function(a){return m.resolve(a)};c.prototype._candidateIdTransform=function(a){return a};c.prototype._transformSetWithIdChanges=function(){};c.prototype._getFilteredSet=function(a,b,d,h,c){var f=this;return this._ensureLoaded().then(function(){return f._parent.isTable()&&b&&null!==a&&""!==a?new g([],[],!0,null):new g([],["GETPAGES"],!1,{relation:a,resultRecordCount:f._maxQueryRate(),resultOffset:0,geometry:null===
b?null:b,where:d,internal:{set:[],lastRetrieved:0,iterator:f._inLayer.iterator(c),fullyResolved:!1}})})};c.prototype._getPhysicalPage=function(a,b,d){var h=this;try{var c=a.pagesDefinition.internal.lastRetrieved;return a.pagesDefinition.internal.iterator.nextBatch(a.pagesDefinition.resultRecordCount).then(function(b){for(var f=[],e=0;e<b.length;e++)f.push(b[e].attributes[h.destinationField]);if(0===b.length)return a.pagesDefinition.internal.fullyResolved=!0,"done";b.length<a.pagesDefinition.resultRecordCount&&
(a.pagesDefinition.internal.fullyResolved=!0);b=q.WhereClause.create(h.sourceField+" IN @ids",h._parent.getFieldsIndex());b.parameters={ids:f};a.pagesDefinition.where&&(b=p.combine(b,a.pagesDefinition.where,"AND"));f=h._parent.filter(b);f=h._applySpatialFilter(a.pagesDefinition.relation,a.pagesDefinition.relationshape,f);return f.iterator(d).nextBatch(a.pagesDefinition.resultRecordCount).then(function(b){for(var d=0;d<b.length;d++)a.pagesDefinition.internal.set[c+d]=b[d].attributes[h._parent.objectIdField],
h._featureCache[b[d].attributes[h._parent.objectIdField]]=b[d];a.pagesDefinition.internal.lastRetrieved=c+b.length;return"done"})})}catch(f){return m.reject(f)}};c.prototype._expandPagedSet=function(a,b,d,c,e){return this._expandPagedSetFeatureSet(a,b,d,c,e)};c.prototype._applySpatialFilter=function(a,b,d){if(null===a||void 0===a||""===a)return d;if(0<=a.indexOf("esriSpatialRelRelation"))return d.relate(b,a.split(":")[1]);switch(a){case "esriSpatialRelIntersects":return d.intersects(b);case "esriSpatialRelContains":return d.contains(b);
case "esriSpatialRelOverlaps":return d.overlaps(b);case "esriSpatialRelWithin":return d.within(b);case "esriSpatialRelTouches":return d.touches(b);case "esriSpatialRelCrosses":return d.crosses(b);case "esriSpatialRelEnvelopeIntersects":return d.envelopeIntersects(b)}return d};c.prototype._clonePageDefinition=function(a){return null===a?null:{groupbypage:!1,relation:a.relation,resultRecordCount:a.resultRecordCount,resultOffset:0,geometry:a.geometry,where:a.where,internal:a.internal}};c.prototype._countstat=
function(a,b,d,c,e){var f=this;return this._ensureLoaded().then(function(){return f.isTable()&&d&&null!==b&&""!==b?{calculated:!0,result:0}:!0!==f.isOneToOne||null!==d||null!==c&&"1\x3d1"!==p.toWhereClause(c,n.FeatureServiceDatabaseType.Standardised)?{calculated:!1}:{calculated:!0,result:f._inLayer.count(e)}})};c.prototype._stats=function(a,b,d,c,e,f,g){var h=this;return this._ensureLoaded().then(function(){return"count"===a?h._countstat(a,d,c,e,g):{calculated:!1}})};c.prototype._stat=function(a,
b,d,c,e,f,g){return this._stats(a,b,d,c,e,f,g)};c.prototype._canDoAggregates=function(a,b,c,e,g){return this._ensureLoaded().then(function(){return!1})};return c}(e)});