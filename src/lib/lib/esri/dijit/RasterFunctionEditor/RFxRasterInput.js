// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/RasterFunctionEditor/templates/RFxRasterInput.html":"\x3cdiv class\x3d'esriRFxRasterInput' style\x3d'width:99%'\x3e\r\n  \x3cspan data-dojo-type\x3d'dijit/form/ComboBox' data-dojo-attach-point\x3d'_comboBox' data-dojo-attach-event\x3d'onChange: _handleComboBoxChange'\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n  "}});
define("esri/dijit/RasterFunctionEditor/RFxRasterInput","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin esri/domUtils ../../kernel ../../layers/ArcGISImageServiceLayer ../../layers/ImageServiceParameters ../../layers/MosaicRule ../../layers/RasterFunction ./utils ../analysis/utils ../analysis/mixins/browselayers/BrowseLayerMixin ../analysis/ItemTypes dojo/i18n!../../nls/jsapi dojo/text!./templates/RFxRasterInput.html".split(" "),function(d,
c,l,m,f,n,p,q,g,r,t,u,v,w,e,h,x,k,y,z){d=d([n,p,q,x],{templateString:z,declaredClass:"esri.dijit.RasterFunctionEditor.RFxRasterInput",allowScalar:!1,selectDefault:!0,showBrowseLayers:!0,useArcGISComponents:!0,constructor:function(a){c.mixin(this,a);this.inherited(arguments);this._i18n=y.widgets.rasterFunctionEditor},startup:function(){this._comboBox.set("validator",c.hitch(this,this.validator));this._comboBox.set("placeHolder",this._i18n.rfxRasterInput.selectLayer);this.on("add-ready-to-use-layer",
c.hitch(this,function(a){this.emit("add-layer",a)}));this.inherited(arguments);this.rfxVariable?this._setRfxVariableAttr(this.rfxVariable):this.value&&this._setValueAttr(this.value)},validator:function(a,b){if(""===a)return!1;if((b=this._getStoreItems(a))&&0<b.length||this._getFormattedValue(this.value)===a||this.rfxVariable&&this._getFormattedValueFromVariable(this.rfxVariable)===a)return!0;if(this.allowScalar&&""!==a)return!isNaN(+a)},_handleComboBoxChange:function(a){"separator"===a||""===a?this.value?
this._comboBox.set("displayedValue",this.value.name):this._comboBox.reset():"browselayers"===a?(this.set("allowedItemTypes",[k.IS]),this.defaultItemTypes=[],this._createBrowseItems({},{layerTypes:[k.IS]},this._comboBox)):this.value&&a===this.value.name||(this.value=this.get("value"),this.emit("change",c.clone(this.value)))},getSelectedLayer:function(a){a=a||this._comboBox&&this._comboBox.value;if(null!==a&&void 0!==a&&this._comboBox&&(a="object"===typeof a?a:{name:a},a=(a=this._comboBox.store&&this._comboBox.store.query(a))&&
a[0]))return this.inputLayers[a.id]},_getFormattedValue:function(a){if(null===a||void 0===a)return"";if(a.type&&"scalar"===a.type.toLowerCase())return String(a.value);if(a.name)return a.name;if(a.datasetName&&a.datasetName.name)return a.datasetName.name},_getFormattedValueFromVariable:function(a){if(a){var b=e.getArgRFT(a);return b?"\x3c"+(b.function&&b.function.name)+"."+this._i18n.rfxArgsEditor.outputRaster+"\x3e":"\x3c"+this._i18n.rfxRasterInput.rfxVariable+": "+a.name+"\x3e"}},_setInputLayersAttr:function(a){this.inputLayers=
a&&a.map(function(a){return a});this._initStore()},_setAllowScalarAttr:function(a){this.allowScalar=!!a;this.allowScalar||(this._comboBox.textbox.readOnly=!0)},_setRfxVariableAttr:function(a){this._set("rfxVariable",a);if(a){if(a.value)return this._setValueAttr(a.value);this._comboBox.attr("value",this._getFormattedValueFromVariable(a),!1);e.getArgRFT(a)&&this._comboBox.set("disabled",!0)}},_setValueAttr:function(a){if(a){var b=this._getFormattedValue(a);!this.getSelectedLayer(a.name)&&a.url&&this._addValueAsItem(a);
this._comboBox.set("value",b);this.value=a}else this._comboBox.attr("value","",!1)},_addRFTLayerValue:function(a){this.inputLayers.push(a);var b=this._comboBox.get("store"),b=b&&b.data,c=b.splice(b.length-2,2);a={id:b.length,label:a.name,name:a.name,url:a.url};b.push(a);b=b.concat(c);b=new f({data:b,idProperty:"id"});this._comboBox.set("store",b);this._comboBox.set("value",a.name)},_getValueAttr:function(){var a=this._comboBox.value,a=a.trim(),b=this.getSelectedLayer(a);if(b)return g.show(this._zoomToRaster),
"browselayers"===b.id?b:e.getRasterJsonFromLayer(b);if(!this.rfxVariable||this._getFormattedValueFromVariable(this.rfxVariable)!==a)return this.allowScalar&&this._comboBox.isValid()?(g.hide(this._zoomToRaster),{type:"Scalar",value:+a}):this.value},_addValueAsItem:function(a){if(a){a=c.clone(a);a.name||(a.name=e.getImageServiceTitle(a.url));var b=new u;a.mosaicRule&&(b.mosaicRule=new v(a.mosaicRule));a.renderingRule&&(b.renderingRule=new w(a.renderingRule));b=new t(a.url,{id:a.name+(new Date).toString(),
imageServiceParameters:b});b.name=a.name;this.inputLayers.push(b);this._initStore()}},_getStoreItems:function(a){return this._comboBox.store&&this._comboBox.store.query({name:a})},_initStore:function(){var a=[];l.forEach(this.inputLayers,function(b,c){a.push({id:c,name:b.name,label:b.name,url:b.url})},this);var b=new f({data:a,idProperty:"id"});this._comboBox.set("labelAttr","label");this._comboBox.set("labelType","html");this._comboBox.set("store",b);this._comboBox.reset();h.addReadyToUseLayerOption(this,
[this._comboBox]);this.selectDefault&&a.length&&(void 0===this.value||null===this.value)&&this.set("value",a[0])},_handleBrowseItemsSelect:function(a){a&&a.selection&&h.addAnalysisReadyLayer({item:a.selection,layers:this.inputLayers,layersSelect:this._comboBox,posIncrement:1,browseDialog:a.dialog||this._browsedlg,widget:this})},_setBrowsePropertiesAttr:function(a){a&&(this.isSingleTenant=!0,this.map=a.map?a.map:this.map,this.portalUrl=a.portalUrl?a.portalUrl:this.portalUrl,this.portalSelf=a.portalSelf?
a.portalSelf:this.portalSelf)},_onZoomToRasterClick:function(){var a=this.getSelectedLayer(this._comboBox.value);a&&a.initialExtent&&this.emit("zoom-to-extent",{layerExtent:a.initialExtent})}});m("extend-esri")&&c.setObject("dijit.RasterFunctionEditor.RFxRasterInput",d,r);return d});