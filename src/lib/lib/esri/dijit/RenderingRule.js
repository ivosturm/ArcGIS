// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/templates/RenderingRule.html":'\x3cdiv data-dojo-attach-point\x3d"_renderingRuleContainer" class\x3d"esriRenderingRuleContainer"\x3e\r\n  \x3ctable class\x3d"esriRenderingRuleTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol1"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol2"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol3"/\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleHeadingLabel" data-dojo-attach-point\x3d"rendererLabel"\x3e${_i18n.widgets.renderingRule.rendererLabelTitle}\x3c/label\x3e\r\n          \x3ca class\x3d"esriRenderingRuleWarningIcon" data-dojo-attach-point\x3d"vectorWarningIcon"\x3e\x3c/a\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"rasterFunctionRow"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"rasterFunctionList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleRasterFunctionList dijitSelect"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsLabelBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleHeadingLabel" data-dojo-attach-point\x3d"bandIdsLabel"\x3e${_i18n.widgets.renderingRule.bandCombinationLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsRedList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsRedList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsGreenList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsGreenList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsBlueList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsBlueList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsMsgBlock"\x3e\r\n        \x3ctd/\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"msgLabel" class\x3d"esriRenderingRuleMsgLabel"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleEnhancementHeadingLabel" data-dojo-attach-point\x3d"imageEnhancementLabel"\x3e${_i18n.widgets.renderingRule.imageEnhancementLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"symbologyTypeBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"symbologyTypeLabelRow" class\x3d"esriRenderingRuleVisible"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleSymbologyTypeLabel"\x3e${_i18n.widgets.renderingRule.symbologyTypeLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"symbologyTypeSelectRow" class\x3d"esriRenderingRuleVisible"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"symbologyTypeSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"labelAttr: \'label\'"\r\n            class\x3d"esriRnderingRuleSymbologyTypeSelect" data-dojo-attach-event\x3d"onChange: _onSymbologyTypeChange"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"stretchBlock"\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchDescLabel"\x3e${_i18n.widgets.renderingRule.stretchDescLabel}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodLabel"\x3e${_i18n.widgets.renderingRule.stretchMethodLabel}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cselect data-dojo-attach-point\x3d"stretchMethodList" style\x3d"width:100%;" data-dojo-type\x3d"dijit/form/Select" class\x3d"esriRenderingRuleStretchMethodList"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchMethodNoneDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodNoneDesc"\x3e${_i18n.widgets.renderingRule.stretchMethodNoneDesc}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e \r\n      \x3ctr data-dojo-attach-point\x3d"stretchMethodMinMaxDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodMinMaxDesc"\x3e${_i18n.widgets.renderingRule.stretchMethodMinMaxDesc}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"numStdDevBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDevLabel"\x3e${_i18n.widgets.renderingRule.numStdDevLabelTitle}\x3c/label\x3e\r\n          \x3cinput type\x3d"text" value\x3d"2.0" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"numStdDevText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDevLabel"\x3e${_i18n.widgets.renderingRule.numStdDevEndLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd/\x3e\r\n        \x3ctd/\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"minMaxPercentDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDescLabel"\x3e${_i18n.widgets.renderingRule.minMaxDescLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr data-dojo-attach-point\x3d"maxPercentBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"maxPercentLabel"\x3e${_i18n.widgets.renderingRule.maxPercentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" type\x3d"text" value\x3d"2.0" data-dojo-attach-point\x3d"maxPercentText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"percentLabel"\x3e${_i18n.widgets.renderingRule.percentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr data-dojo-attach-point\x3d"minPercentBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"minPercentLabel"\x3e${_i18n.widgets.renderingRule.minPercentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" type\x3d"text" value\x3d"2.0" data-dojo-attach-point\x3d"minPercentText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"percentLabel"\x3e${_i18n.widgets.renderingRule.percentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"gammaBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"gammaLabel"\x3e${_i18n.widgets.renderingRule.gammaLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv id\x3d"gammaSliderID" data-dojo-attach-point\x3d"gammaSlider" class\x3d"esriRenderingRuleGammaSlider" data-dojo-type\x3d"dijit.form.HorizontalSlider" showbuttons\x3d"true" value\x3d"0.0" minimum\x3d"-1" maximum\x3d"1" intermediatechanges\x3d"true"\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" labels\x3d"${_i18n.widgets.renderingRule.minGammaLabel}, ${_i18n.widgets.renderingRule.maxGammaLabel}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n            \x3c/div\x3e        \r\n          \x3c/div\x3e \r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"draBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cinput type\x3d"checkbox" value\x3d"true" data-dojo-attach-point\x3d"draCheckbox" class\x3d"esriRenderingRuleDraCheckbox" data-dojo-attach-event\x3d"onChange: _onDRAChange"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleDraLabel" data-dojo-attach-point\x3d"draLabel"\x3e${_i18n.widgets.renderingRule.draLabelTitle}\x3c/label\x3e\r\n        \x3ctd/\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchStatsBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\x3cdiv data-dojo-attach-point\x3d"stretchStatsGrid"\x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"classifyBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyFieldBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyFieldLabel"\x3e${_i18n.widgets.renderingRule.fieldLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"classifyFieldSelect" class\x3d"esriRenderingRuleClassifySelect"\r\n            data-dojo-props\x3d"labelAttr: \'alias\'" data-dojo-attach-event\x3d"onChange: _onClassifyFieldChange"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyMethodBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyMethodLabel"\x3e${_i18n.widgets.renderingRule.methodLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-attach-point\x3d"classifyMethodSelect" class\x3d"esriRenderingRuleClassifyMethodSelect" \r\n            data-dojo-props\x3d"labelAttr: \'label\', labelType: \'html\'" data-dojo-attach-event\x3d"onChange: _onClassifyMethodChange"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyNClassesBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyNClassesLabel"\x3e${_i18n.widgets.renderingRule.nClassesLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"classifyNClassesInput" class\x3d"esriRenderingRuleClassifyClassSelect" data-dojo-attach-event\x3d"onChange: _updateClassifyGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyIntervalsBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyIntervalLabel"\x3e${_i18n.widgets.renderingRule.intervalLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"classifyIntervalInput" class\x3d"esriRenderingRuleClassifyIntervalSelect" \r\n            data-dojo-attach-event\x3d"onChange: _updateClassifyGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"uniqueValuesBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"uniqueValuesFieldBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"uniqueValuesFieldLabel"\x3e${_i18n.widgets.renderingRule.fieldLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"uniqueValuesFieldSelect" \r\n            class\x3d"esriRenderingRuleUniqueValuesSelect" data-dojo-props\x3d"labelAttr: \'alias\'" data-dojo-attach-event\x3d"onChange: _updateUniqueValuesGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"colorRampLabelBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"esriRenderingRuleColorRampHeading"\x3e${_i18n.widgets.renderingRule.colorRampTitle}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"colorRampBlock"\x3e\r\n        \x3ctd colspan\x3d"3" \x3e\r\n          \x3cselect data-dojo-attach-point\x3d"colorRampSelect" data-dojo-type\x3d"esri/dijit/ColorRampSelector" class\x3d"esriRenderingRuleColorRampList dijitSelect" \r\n          data-dojo-props\x3d"dropDownPosition: [\'below\', \'above\'], maxHeight: 200" data-dojo-attach-event\x3d"onChange: _onColorRampChange"\x3e\x3c/select\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"classifyGridBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"classifyLoadingMsg" class\x3d"esriRenderingRuleLoadingMsg"\x3e${_i18n.widgets.renderingRule.classifyLoadingMsg}\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"classifyGrid"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e   \r\n      \x3ctr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"uniqueValuesGridBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"uniqueValuesLoadingMsg" class\x3d"esriRenderingRuleLoadingMsg"\x3e${_i18n.widgets.renderingRule.uniqueValuesLoadingMsg}\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"uniqueValuesGrid"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e   \r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3ccenter\x3e\x3cinput type\x3d"button" data-dojo-attach-point\x3d"_apply" value\x3d"APPLY" size\x3d"15" class\x3d"esriRenderingRuleApplyButton" /\x3e\x3c/center\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n   \x3cdiv data-dojo-type\x3d"dijit/TooltipDialog" data-dojo-attach-point\x3d"_vectorTooltipDlg" \r\n    class\x3d"esriRenderingRuleVectorTooltip" style\x3d"display: none;"\x3e\r\n      \x3cp\x3e${_i18n.widgets.renderingRule.createVectorLayerDesc}\x3c/p\x3e\r\n      \x3cdiv class\x3d\'dijitDialogPaneActionBar\'\x3e\r\n        \x3cbutton data-dojo-type\x3d\'dijit/form/Button\' data-dojo-attach-event\x3d\'onClick: _createVectorLayer\' class\x3d"calcite blue"\x3e${_i18n.common.yesLabel}\x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d\'dijit/form/Button\' data-dojo-attach-event\x3d\'onClick: _hideVectorWarning\' class\x3d"calcite transparent"\x3e${_i18n.common.noLabel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/RenderingRule","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom-style dojo/dom-class dojo/dom-construct dojo/i18n!../nls/jsapi dojo/text!./templates/RenderingRule.html dojo/store/Memory dojo/store/Observable dojo/data/ObjectStore dojo/has dojo/on dojo/io-query dojo/Deferred ../kernel ../lang ../layers/RasterFunction ../geometry/Extent ../geometry/Point ./ColorRampSelector ../renderers/colorUtils ./ColorPicker ../tasks/generateRenderer ../tasks/AlgorithmicColorRamp ../tasks/MultipartColorRamp ../symbols/SimpleFillSymbol ../Color ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/colorRampUtils dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/popup dijit/Tooltip dgrid/OnDemandGrid dgrid/editor dgrid/Keyboard dijit/form/NumberTextBox dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/FilteringSelect dijit/TooltipDialog".split(" "),
function(A,f,r,h,n,u,B,O,C,p,P,D,Q,E,I,R,S,J,t,T,U,ga,y,V,K,L,W,M,v,X,Y,Z,F,aa,ba,ca,z,da,G,w,H,ea,N,fa){C=A([aa,ba,ca],{declaredClass:"esri.dijit.RenderingRule",templateString:C,widgetsInTemplate:!0,layer:null,map:null,hideApplyButton:!1,_renderingRuleObject:null,_rasterFunctionData:[],_rasterFunctionStore:null,_cachedFunctionList:[],_cachedkeyProperties:{},_cachedHistogramsList:{},_cachedRATList:{},_pendingDfds:{},_redBandIdStore:null,_greenBandIdStore:null,_blueBandIdStore:null,_donotSaveChanges:!1,
_resetBandCombination:!1,_serviceBandCount:3,_defaultBandCombinationFncName:"User Defined Renderer",_firstFncInRenderingRuleList:null,_gammaSliderTooltip:null,_symbologyTypes:{classify:"classify",stretch:"stretch",uniqueValues:"uniqueValues"},_defaultNClasses:5,_defaultMaxClasses:16,_classifyMethods:{naturalBreaks:"natural-breaks",equalInterval:"equal-interval",quantile:"quantile",definedInterval:"defined-interval",manualInterval:"manual-interval"},constructor:function(a){A.safeMixin(this,a);this._i18n=
O;this._defaultBandCombinationFncName=this._i18n.widgets.renderingRule.userDefinedRendererTitle;this._renderingRuleObject=new t},startup:function(){this.inherited(arguments);r.connect(this.rasterFunctionList,"onChange",f.hitch(this,"_onRasterFunctionChange"));r.connect(this.stretchMethodList,"onChange",f.hitch(this,"_onStretchMethodChange"));r.connect(this.gammaSlider,"onChange",f.hitch(this,"_onGammaChange"));r.connect(this.gammaSlider,"onMouseLeave",f.hitch(this,"_onGammaMouseLeave"));r.connect(this._apply,
"onclick",f.hitch(this,"_onClickApplyRenderingRule"));r.subscribe("onRenderingRuleApply",f.hitch(this,"_onClickApplyRenderingRule"));r.subscribe("onRenderingRuleReset",f.hitch(this,"_onClickResetRenderingRule"));this.own(E(this.vectorWarningIcon,"mouseover",f.hitch(this,this._showVectorWarning)));this._onRasterFunctionChange(this.rasterFunctionList.value);this.hideApplyButton&&(this._apply.style.display="none");this._setupUniqueValuesGrid();this._setupClassifyGrid();this._setupStretchStatsGrid();
this._setupClassifyMethodStore();this._symbologyBlocks=[this.stretchBlock,this.colorRampBlock,this.classifyBlock,this.classifyGridBlock,this.uniqueValuesBlock,this.uniqueValuesGridBlock];this._startupCalled=!0},_getColorMapFunction:function(a){a=new t;a.functionArguments=this.colorRampSelect.colorRampName?{colorRamp:this.colorRampSelect.colorRampName}:{Colormap:this.colorRampSelect.colorMap};a.variableName="Raster";a.functionName="Colormap";return a},destroy:function(){this._pendingDfds=null;this._gammaSliderTooltip&&
(this._gammaSliderTooltip.destroy(),this._gammaSliderTooltip=null);this.inherited(arguments)},_setLayerAttr:function(a){if(a){a!==this.layer&&(this._vectorWarningShown=!1);this.inherited(arguments);this.layer=a;this._donotSaveChanges=!0;this._firstFncInRenderingRuleList=null;this._stretchReadFromRenderingRule=!1;this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp);this._customColorRamp=this._uniqueValuesColorRamp=null;this._fillStretchMethodList();this._hideStretch();var b=f.hitch(this,
"_setupDefaults");this.layer.loaded?this._setupDefaults():r.connect(this.layer,"onLoad",b);this._donotSaveChanges=!1}},_setupDefaults:function(){this._setDefaultNoneFunctionName();this._setupBandIdDefaults();this._setupStretchDefaults();this._setupRenderingRuleDefaults();this._setupColorRampDefaults();this._setupSymbologyDefaults();this._setupClassifyDefaults();this._setupUniqueValuesDefaults()},_setDefaultNoneFunctionName:function(){var a;this.layer.rasterFunctionInfos.some(f.hitch(this,function(b){if("none"===
b.name.toLowerCase())return a=b.name,!0}));this._defaultNoneFunctionName=a||"None"},_setupRFTDefaults:function(){this._setupColorRampDefaults();this._setupStretchDefaults();this._setupSymbologyDefaults();this._setupClassifyDefaults();this._setupUniqueValuesDefaults()},_setupRenderingRuleDefaults:function(){if(this.layer){this._rasterFunctionData=[];var a=new R,b;for(b=0;b<this._cachedFunctionList.length;b++){var c=this._cachedFunctionList[b];if(c&&this.layer===c.layer)return this._rasterFunctionData=
c.data,this._setupFunctionStore(),a.resolve(),a}return this._fillRasterFunctionList(this.layer)}},_clearClassifyGrid:function(){this._classifyGrid&&this._classifyGrid.set("store",new D(new p({data:[]})))},_setupClassifyDefaults:function(){if(this.layer&&this.symbologyTypeSelect.store.get(this._symbologyTypes.classify)){this._showClassifyLoadingMsg();this._clearClassifyGrid();this._setupClassifyMethodStore();this._setupClassifyGridDefaults();this._setupClassifyFieldStore();var a=this.layer,b=this.layer.id,
c=this._rasterFunctionStore.get(this.rasterFunctionList.value),d=c.name,e=c&&c.serviceInfo,c=e?e.hasRasterAttributeTable:this.layer.hasRasterAttributeTable,e=e?e.hasHistograms:this.layer.hasHistograms,g=d===this._defaultBandCombinationFncName?this._defaultNoneFunctionName:d,g=new t({functionName:g});this._cachedRATList[b]&&this._cachedRATList[b][d]?this._handleRasterAttributeTableClassify(this._cachedRATList[b][d]):c?this.rasterFunctionList.value===this._defaultBandCombinationFncName?a.getRasterAttributeTable().then(f.hitch(this,
this._handleRasterAttributeTableClassify)):a.getRenderingRuleAttributeTable({renderingRule:g}).then(f.hitch(this,this._handleRasterAttributeTableClassify)):this._cachedHistogramsList&&this._cachedHistogramsList[b]&&this._cachedHistogramsList[b][d]?this._handleHistogramsResultClassify(this._cachedHistogramsList[this.layer.id][d]):e&&this.rasterFunctionList.value===this._defaultBandCombinationFncName?this._getHistograms(f.hitch(this,this._handleHistogramsResultClassify)):(10.1<a.currentVersion||this._isSingleBitRaster(a.pixelType))&&
this._getComputeHistograms(f.hitch(this,this._handleHistogramsResultClassify),{renderingRule:g,pixelSize:this._getOverviewPixelSize()})}},_getComputeHistograms:function(a,b){if(this.layer)return this._computeHistogramsTask&&!this._computeHistogramsTask.isResolved()?this._computeHistogramsTask:this._computeHistogramsTask=this.layer.computeHistograms(b).then(a)},_getHistograms:function(a){if(this.layer)return this._getHistogramsTask&&!this._getHistogramsTask.isResolved()?this._getHistogramsTask:this._getHistogramsTask=
this.layer.getHistograms().then(a)},_getOverviewPixelSize:function(){var a=this.layer.extent;return new U((a.xmax-a.xmin)/this.map.width,(a.ymax-a.ymin)/this.map.height,a.spatialReference)},_addUniqueValuesColorRamp:function(a){var b={},c=a&&a.features;c&&c.length&&this._ratContainsColormap(a)&&(this._uniqueValuesColorRampName=this._i18n.widgets.renderingRule.uniqueValuesDefaultColorRamp,b.id=this._uniqueValuesColorRampName,b.name=this._uniqueValuesColorRampName,b.type="multipart",b.colorRamps=[],
h.forEach(c,function(a){a=this._getFeatureRGBValue(a.attributes);b.colorRamps.push({fromColor:a,toColor:a})},this),this._uniqueValuesColorRamp=b,this._setColorRampSelectValue())},_addCustomColorRamp:function(a){if(a){if(this._customColorRamp)return this.colorRampSelect.setSelected(this._customColorRamp);this._customColorRamp=a.toJson();this._customColorRampName=this._i18n.widgets.renderingRule.customColorRampName;this._customColorRamp.id=this._customColorRampName;this._customColorRamp.name=this._customColorRampName;
this.colorRampSelect.addColorRamp(this._customColorRamp);this.colorRampSelect.setSelected(this._customColorRamp)}},_getFeatureRGBValue:function(a){if(a){var b,c;b=this._getCaseInsensitiveFieldValue("red",a);c=this._getCaseInsensitiveFieldValue("green",a);a=this._getCaseInsensitiveFieldValue("blue",a);b=1<b?b:Math.round(255*b);c=1<c?c:Math.round(255*c);a=1<a?a:Math.round(255*a);return[b,c,a]}},_getCaseInsensitiveFieldValue:function(a,b){if(b&&a){a=a.toLowerCase();for(var c in b)if(b.hasOwnProperty(c)&&
c.toLowerCase()===a)return b[c]}},_ratContainsColormap:function(a){if(!a||!a.fields)return!1;var b,c,d;return h.some(a.fields,function(a){a&&a.name&&(a=a.name.toLowerCase(),"red"===a&&(b=!0),"green"===a&&(c=!0),"blue"===a&&(d=!0));return b&&c&&d})},_handleRasterAttributeTableClassify:function(a){if(a&&a.features&&a.features.length){var b=this.rasterFunctionList.value;this._cachedRATList[this.layer.id]=this._cachedRATList[this.layer.id]||{};this._cachedRATList[this.layer.id][b]=a;this._setupClassifyNClassesInput(a.features.length);
this._setDefaultIntervalSize();this._addUniqueValuesColorRamp(a);this._setupClassifyFieldStore();this._setupUniqueValuesFieldStore();this.symbologyTypeSelect.set("value",this._getDefaultSymbologyType());this._isClassBreaksRenderer(this.layer.renderer)||this._updateClassifyGrid();this._isUniqueValueRenderer(this.layer.renderer)||this._updateUniqueValuesGrid()}},_handleHistogramsResultClassify:function(a){if(a&&a.histograms&&a.histograms.length){a=a.histograms;var b=this.rasterFunctionList.value;this._cachedHistogramsList[this.layer.id]=
this._cachedHistogramsList[this.layer.id]||{};this._cachedHistogramsList[this.layer.id][b]=a;this._setupClassifyNClassesInput(a[0].counts&&a[0].counts.length);this._setDefaultIntervalSize();this._setupUniqueValuesFieldStore();this._getServiceMinAndMax();var b=0,c,d,e,g=[];if(a&&a.length&&a[0].size){c=a[0].counts;d=this.minValues.length?this.minValues[0]:a[0].min;e=this.maxValues.length?this.maxValues[0]:a[0].max;for(b=0;b<c.length-1;b++)g.push(d+(e-d)*b/c.length);g.push(e);a[0].dataPoints=g}this._isClassBreaksRenderer(this.layer.renderer)||
this._updateClassifyGrid();this._isUniqueValueRenderer(this.layer.renderer)||this._updateUniqueValuesGrid()}},_setDefaultIntervalSize:function(){if(this.layer){var a=this.layer,b=a.id,c=a.renderer,d=this.rasterFunctionList.value,e=this.classifyFieldSelect.value,g,l,k,f,m;this._getServiceMinAndMax();this._isSelectedRenderingRule(a.renderingRule)&&this._isClassBreaksRenderer(c)&&c.infos&&c.infos.length&&c.attributeField===e&&(g=c.infos.length,a=c.infos[0],c=c.infos[g-1],g=(c.maxValue-a.minValue)/g);
g||(this._cachedRATList&&this._cachedRATList[b]&&this._cachedRATList[b][d]?(b=this._cachedRATList[b][d],k=f=b.features[0].attributes[e],l=b.features.length,h.forEach(b.features,function(a){m=a.attributes[e];m<k&&(k=m);m>f&&(f=m)})):this._cachedHistogramsList&&this._cachedHistogramsList[b]&&this._cachedHistogramsList[b][d]&&(l=this._cachedHistogramsList[b][d],k=this.minValues.length?this.minValues[0]:l[0].min,f=this.maxValues.length?this.maxValues[0]:l[0].max,l=l[0].counts&&l[0].counts.length),l=this.classifyNClassesInput&&
this.classifyNClassesInput.value||this._getDefaultNClasses(l),g=(f-k)/l);this.classifyIntervalInput.attr("value",g,!1)}},_setupUniqueValuesDefaults:function(){this.layer&&this.symbologyTypeSelect.store.get(this._symbologyTypes.uniqueValues)&&(this._showUniqueValuesLoadingMsg(),this._setupUniqueValuesGridDefaults())},_setupSymbologyDefaults:function(){this._setupSymbologyStore();this._setSymbologySelectVisibility()},_setSymbologySelectVisibility:function(){var a=this._canApplyRenderer();u.toggle(this.symbologyTypeBlock,
"esriRenderingRuleHidden",!a);u.toggle(this.symbologyTypeBlock,"esriRenderingRuleVisible",a)},_isSingleBitRaster:function(a){return 8>=a.replace(/^\D+/g,"")},_setupSymbologyStore:function(){if(this.layer){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value),b=a&&a.serviceInfo?a.serviceInfo:null,a=this.layer.renderer,c=[],d=this.layer,e=b?b.bandCount:d.bandCount,g=b?b.hasRasterAttributeTable:d.hasRasterAttributeTable,b=b?b.pixelType:d.pixelType;this._canApplyRenderer()&&
(c.push({name:this._symbologyTypes.stretch}),e&&1===e&&(g?(c.push({name:this._symbologyTypes.uniqueValues}),c.push({name:this._symbologyTypes.classify})):(10.3<=d.currentVersion&&c.push({name:this._symbologyTypes.classify}),this._isSingleBitRaster(b)&&this._hasServiceMinMax(d)&&c.push({name:this._symbologyTypes.uniqueValues}))));this._isSelectedRenderingRule(d.renderingRule)&&(this._isUniqueValueRenderer(a)&&!h.some(c,function(a){return a.name===this._symbologyTypes.uniqueValues},this)&&c.push({name:this._symbologyTypes.uniqueValues}),
this._isClassBreaksRenderer(a)&&!h.some(c,function(a){return a.name===this._symbologyTypes.classify},this)&&c.push({name:this._symbologyTypes.classify}));h.forEach(c,function(a){a.label=this._i18n.widgets.renderingRule[a.name+"Label"];a.id=a.name},this);this.symbologyTypeSelect.set("store",new p({data:c}));(this.symbologyType=this._getDefaultSymbologyType())&&this.symbologyTypeSelect.set("value",this.symbologyType);this._onSymbologyTypeChange(this.symbologyType)}},_canApplyRenderer:function(){if(this.layer){var a=
this.rasterFunctionList.value;return 10.3<=this.layer.currentVersion||a===this._defaultBandCombinationFncName}},_getDefaultUniqueValuesField:function(a){var b,c=["classname","class_name","class_names"];h.some(a,function(a){a=a&&a.name;var d;if(a){d=a.toLowerCase();if(-1<h.indexOf(c,d))return b=a,!0;"value"===d&&(b=a)}});return b},_setupUniqueValuesFieldStore:function(){if(this.layer){var a,b=this._i18n.widgets.renderingRule.valueLabel;(a=this._getRasterAttributeTableFields())||(a=[{name:b,alias:b,
id:"Value"}]);(a=new p({data:a}),this.uniqueValuesFieldSelect)&&this.uniqueValuesFieldSelect.set("store",a);a=this._isUniqueValueRenderer(this.layer.renderer)?this.layer.renderer.attributeField:this._getDefaultUniqueValuesField(a.data);this.uniqueValuesFieldSelect.attr("value",a,!1)}},_setupStretchStatsGrid:function(){var a=this._i18n.widgets.renderingRule,b={sortable:!1,editor:ea,editOn:"click",autoSave:!0,renderCell:f.hitch(this,this._stretchStatsRenderCell),canEdit:f.hitch(this,function(){return"6"!==
this.stretchMethodList.value})};this._stretchStatsGrid=new (A([G,H]))({selectionMode:"single",className:"dgrid-autoheight",columns:[w(f.mixin({field:"esriRenderingRuleStretchMin",label:a.minLabel},b)),w(f.mixin({field:"esriRenderingRuleStretchMax",label:a.maxLabel},b)),w(f.mixin({field:"esriRenderingRuleStretchMean",label:a.meanLabel},b)),w(f.mixin({field:"esriRenderingRuleStretchStdv",label:a.stdDevLabel},b))]},this.stretchStatsGrid);this._stretchStatsGrid.startup()},_stretchStatsRenderCell:function(a,
b,c){null===b||void 0===b||isNaN(b)?c.innerHTML="":c.innerHTML=Math.round(1E4*b)/1E4},_setupUniqueValuesGrid:function(){this._uniqueValuesGrid=new (A([G,H]))({selectionMode:"single",columns:[{field:"esriRenderingRuleUniqueValuesSymbol",sortable:!1,renderCell:f.hitch(this,function(a,b,c){a=B.toDom('\x3cdiv class \x3d esriRenderingRuleSymbolCell style \x3d "background: rgba( '+a.esriRenderingRuleUniqueValuesSymbol.r+", "+a.esriRenderingRuleUniqueValuesSymbol.g+", "+a.esriRenderingRuleUniqueValuesSymbol.b+
","+255*a.esriRenderingRuleUniqueValuesSymbol.a+') " id \x3d EsriRenderingRuleUniqueValuesGrid'+a.id+"\x3e\x3c/div\x3e");B.place(a,c);a.onclick=f.hitch(this,function(a){this._openColorPickerPopup(a)})}),label:this._i18n.widgets.renderingRule.symbolLabel},{field:"esriRenderingRuleUniqueValuesValue",label:this._i18n.widgets.renderingRule.valueLabel},w({field:"esriRenderingRuleUniqueValuesLabel",sortable:!1,label:this._i18n.widgets.renderingRule.labelLabel,editor:N,editOn:"click",autoSave:!0})]},this.uniqueValuesGrid);
this._uniqueValuesGrid.startup()},_setupClassifyGrid:function(){this._classifyGrid=new (A([G,H]))({className:"dgrid-autoheight",columns:[{field:"esriRenderingRuleClassifySymbol",sortable:!1,renderCell:f.hitch(this,function(a,b,c){a=B.toDom('\x3cdiv class \x3d esriRenderingRuleSymbolCell style \x3d "background: rgba( '+a.esriRenderingRuleClassifySymbol.r+", "+a.esriRenderingRuleClassifySymbol.g+", "+a.esriRenderingRuleClassifySymbol.b+","+255*a.esriRenderingRuleClassifySymbol.a+') " id \x3d EsriRenderingRuleEditorClassifyGrid'+
a.id+"\x3e\x3c/div\x3e");B.place(a,c);a.onclick=f.hitch(this,function(a){this._openColorPickerPopup(a)})}),label:this._i18n.widgets.renderingRule.symbolLabel},w({field:"esriRenderingRuleClassifyValue",label:this._i18n.widgets.renderingRule.upperValueLabel,sortable:!1,editor:fa,editOn:"click",autoSave:!0,autoSelect:!0,get:function(a){this.editorInstance.constraints={maxValue:a.serviceMaxValue?a.serviceMaxValue:a.maxValue,minValue:a.minValue};return"\u2264 "+Math.floor(1E3*a.maxValue)/1E3},editorArgs:{required:!0,
invalidMessage:this._i18n.widgets.renderingRule.outOfRangeMessage,notANumberMessage:this._i18n.widgets.renderingRule.notANumberMessage,blankMessage:this._i18n.widgets.renderingRule.blankMessage,validator:function(a,b){var c=!0;a=a.replace("\u2264","").trim();if(null!==a&&" "!==a&&""!==a)if(isNaN(a))c=!1,this.promptMessage=this.params.notANumberMessage;else{if(a<=b.minValue||a>=b.maxValue)c=!1,this.promptMessage=this.params.invalidMessage}else c=!1,this.promptMessage=this.params.blankMessage;return c}},
set:f.hitch(this,this._setManualClassBreak)}),w({field:"esriRenderingRuleClassifyLabel",label:this._i18n.widgets.renderingRule.labelLabel,editor:N,editOn:"click",autoSave:!0,sortable:!1})]},this.classifyGrid);this._classifyGrid.startup()},_setManualClassBreak:function(a){if(a.esriRenderingRuleClassifyValue){this.classifyMethodSelect.set("value",this._classifyMethods.manualInterval);var b=this._getIntegerValue(a.esriRenderingRuleClassifyValue.replace("\u2264","").trim()),c=a.maxValue;a.maxValue=b;
a.esriRenderingRuleClassifyLabel=this._createLabelString(a.minValue,a.maxValue);h.some(this._classifySymbolData,function(a,e){a.minValue===c&&(a.minValue=b,a.esriRenderingRuleClassifyLabel=this._createLabelString(a.minValue,a.maxValue));a.serviceMaxValue===c&&e!=this._classifySymbolData.length-1&&(a.serviceMaxValue=b)},this);this._classifyGrid.refresh()}},_createLabelString:function(a,b){return this._getIntegerValue(a)+" "+this._i18n.widgets.renderingRule.toLabel+" "+this._getIntegerValue(b)},_getIntegerValue:function(a){return Math.floor(1E3*
a)/1E3},_setupClassifyGridDefaults:function(){if(this.layer&&this._isClassBreaksRenderer(this.layer.renderer)){var a=[];h.forEach(this.layer.renderer.infos,function(b){a.push({minValue:b.minValue,maxValue:b.maxValue,esriRenderingRuleClassifySymbol:b.symbol.color,esriRenderingRuleClassifyLabel:b.label})});this._updateClassifyGrid(a)}},_setupUniqueValuesGridDefaults:function(){if(this.layer&&this._isUniqueValueRenderer(this.layer.renderer)){var a=[];h.forEach(this.layer.renderer.infos,function(b){a.push({esriRenderingRuleUniqueValuesValue:b.value,
esriRenderingRuleUniqueValuesSymbol:b.symbol.color,esriRenderingRuleUniqueValuesLabel:b.label||b.value})});this._updateUniqueValuesGrid(a)}},_setupClassifyNClassesInput:function(a){if(this.layer){var b=this._getDefaultMaxClasses(a);a=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.infos.length:this._getDefaultNClasses(a);this.classifyNClassesInput.attr("value",a,!1);this.classifyNClassesInput.set("constraints",{min:0,max:b})}},_getDefaultNClasses:function(a){return void 0===a?
this._defaultNClasses:Math.min(this._defaultNClasses,a)},_getDefaultMaxClasses:function(a){return void 0===a?this._defaultMaxClasses:Math.min(this._defaultMaxClasses,a)},_isSelectedRenderingRule:function(a){var b=this._getStretchRenderingRule(a),c=this.rasterFunctionList.value;if(!a||this._isNoneRenderingRule(a)){if(this.rasterFunctionList.value===this._defaultBandCombinationFncName)return!0}else if(b){if((a=b.functionArguments)&&this._isSelectedRenderingRule(a.Raster))return!0}else if(c&&a.functionName.toLowerCase()===
c.toLowerCase())return!0},_isUniqueValueRenderer:function(a){return a&&"esri.renderer.UniqueValueRenderer"===a.declaredClass},_isClassBreaksRenderer:function(a){return a&&"esri.renderer.ClassBreaksRenderer"===a.declaredClass},_isStretchRenderer:function(a){return a&&"esri.renderer.StretchRenderer"===a.declaredClass},_isNoneRenderingRule:function(a){return a&&a.functionName&&"none"===a.functionName.toLowerCase()},_getStretchRenderingRule:function(a){if(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase())return a;
if(a&&a.functionName&&"colormap"===a.functionName.toLowerCase()&&a.functionArguments&&a.functionArguments.Raster&&a.functionArguments.Raster.functionName&&"stretch"===a.functionArguments.Raster.functionName.toLowerCase())return a=a.functionArguments.Raster}},_setupClassifyMethodStore:function(){if(this.layer){var a=[],b=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.classificationMethod:this._classifyMethods.equalInterval,c;for(c in this._classifyMethods)this._classifyMethods.hasOwnProperty(c)&&
a.push({label:"\x3cdiv class\x3d 'esriRenderingRuleFilteringSelectLabel'\x3e\x3ch4 style\x3d'font-weight:bold;'\x3e"+this._i18n.widgets.renderingRule[c]+"\x3c/h4\x3e\x3cbr/\x3e\x3ci\x3e"+this._i18n.widgets.renderingRule[c+"Desc"]+"\x3c/i\x3e\x3c/div\x3e",id:this._classifyMethods[c],name:this._i18n.widgets.renderingRule[c]});this.classifyMethodSelect.set("store",new p({data:a}));this.classifyMethodSelect.set("labelType","html");this.classifyMethodSelect.set("labelAttr","label");this.classifyMethodSelect.attr("value",
b,!1);this._handleClassifyIntervalVisibility(b)}},_setupClassifyFieldStore:function(){if(this.layer){var a;a=this._i18n.widgets.renderingRule.valueLabel;var b=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.attributeField:"Value";a=this.layer&&this.layer.rasterAttributeTable?this._getRasterAttributeTableFields(!0):[{name:a,alias:a,id:"Value"}];this.classifyFieldSelect.set("store",new p({data:a}));this.classifyFieldSelect.attr("value",b,!1)}},_getRasterAttributeTableFields:function(a){if(this.layer){var b=
this.layer.id,c=this.rasterFunctionList.value;if(b=this._cachedRATList[b]&&this._cachedRATList[b][c]||this.layer.rasterAttributeTable)return b=f.clone(b.fields),b=h.filter(b,function(b){if("esriFieldTypeOID"!==b.type&&(!a||"esriFieldTypeString"!==b.type))return!0}),b=h.map(b,function(a){a.id=a.name;return a})}},_setupFunctionStore:function(){if(this.layer){this._rasterFunctionStore=new p({data:this._rasterFunctionData,idProperty:"name"});this.rasterFunctionList.set("store",this._rasterFunctionStore);
this.rasterFunctionList.set("labelAttr","label");this.rasterFunctionList.set("labelType","html");var a=this.layer.rasterFunctionInfos;a&&0<a.length&&a[0].name&&(this._firstFncInRenderingRuleList=a[0].name);var a=this.layer.renderingRule,b="";(b=a&&a.functionName&&!this._isNoneRenderingRule(a)?"stretch"!==a.functionName.toLowerCase()&&"colormap"!==a.functionName.toLowerCase()?a.functionName:this._getRenderingRuleNameFromStretchFunction(a)||this._defaultBandCombinationFncName:this._firstFncInRenderingRuleList&&
"none"!==this._firstFncInRenderingRuleList.toLowerCase()&&!this.layer.bandIds?this._firstFncInRenderingRuleList:this._defaultBandCombinationFncName)&&(this._rasterFunctionStore.get(b)||"Colormap"===b)&&(this.rasterFunctionList.set("value",b),this._onRasterFunctionChange())}else console.log("Could not populate renderers as the layer does not exists")},_fillRasterFunctionList:function(a){if(this.layer&&(this._rasterFunctionData=[],null!==a&&null!==a.extent)){var b=new T(a.extent.xmin,a.extent.ymin,
a.extent.xmax,a.extent.ymax,a.extent.spatialReference),c=b.getWidth(),d=b.getHeight();if(2<=c/d||2<=d/c)c=Math.min(c,d)/2,d=b.getCenter(),b.update(d.x-c,d.y-c,d.x+c,d.y+c,a.extent.spatialReference);b=b.xmin+","+b.ymin+","+b.xmax+","+b.ymax;c=a._getToken();d="";c&&(d="\x26token\x3d"+c);var e=this.layer.url+"/exportImage?bbox\x3d"+b+d+"\x26imageSize\x3d400,400\x26f\x3dimage",b=this.layer.bandIds,c=e+"\x26"+I.objectToQuery({renderingRule:'{"rasterFunction":"none"}'});b&&3<=b.length&&(c=c+"\x26bandIds\x3d"+
b[0]+","+b[1]+","+b[2]);this._addFunctionItemToList(this._defaultBandCombinationFncName,this._defaultBandCombinationFncName,this._i18n.widgets.renderingRule.userDefinedRendererDesc,c,"");a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&h.forEach(a.rasterFunctionInfos,f.hitch(this,function(a){if("none"!==a.name.toLowerCase()){var b=a.thumbnail&&0<a.thumbnail.length?a.thumbnail:e+"\x26"+I.objectToQuery({renderingRule:'{"rasterFunction":"'+a.name+'"}'});this._addFunctionItemToList(a.name,a.name,
a.description,b)}}));a={};a.layer=this.layer;a.data=this._rasterFunctionData;this._cachedFunctionList.push(a);var g;h.forEach(this.layer.rasterFunctionInfos,function(a){g=new t({rasterFunction:a.name});this.layer.getRenderingRuleServiceInfo(g).then(f.hitch(this,function(b){h.some(this._rasterFunctionData,function(c,d){if(c.name===a.name)return this._rasterFunctionData[d].serviceInfo=b,a.name===this.rasterFunctionList.value&&(this._isVectorData(b)&&this._showVectorWarningIcon(),this._setupRFTDefaults()),
!0},this)}))},this);this._setupFunctionStore()}},_addFunctionItemToList:function(a,b,c,d){var e={};e.name=a;e.id=b;b=c;200<b.length&&(b=b.substring(0,200)+"...");e.description=b;e.label="\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ch4\x3e"+a+":\x3c/h4\x3e\x3ctable cellspacing\x3d'5'\x3e\x3ctr\x3e\x3ctd\x3e\x3cimg src\x3d'"+d+"' height\x3d'100' width\x3d'100'\x3e\x3c/td\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:40ex'\x3e\x3ci\x3e"+b+"\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html\x3e";
this._rasterFunctionData.push(e)},_setupColorRampDefaults:function(){this.layer&&this._setColorRampVisibility()},_setColorRampVisibility:function(){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value),b=a?a.serviceInfo:null;if(!this._canApplyRenderer())return this._hideColorRampSelector();if(this.symbologyType===this._symbologyTypes.stretch){var a=b&&b.bandCount?b.bandCount:this.layer.bandCount,b=b&&b.pixelType?b.pixelType:this.layer.pixelType,c=this.layer.renderer,
d=this.layer.renderingRule,e=this._getStretchRenderingRule(d);if(this._isSelectedRenderingRule(this.layer.renderingRule)&&(this._isStretchRenderer(c)&&c.colorRamp&&c.stretchType==this.stretchMethodList.value||d&&d.functionName&&"colormap"===d.functionName.toLowerCase()&&(e&&e.StretchType)===this.stretchMethodList.value))return this._showColorRampSelector();1<a||10.3>this.layer.currentVersion||"u8"!==b.toLowerCase()&&"0"===this.stretchMethodList.value?this._hideColorRampSelector():this._showColorRampSelector()}else this._showColorRampSelector()},
_setColorRampSelectValue:function(){if(this.layer){var a=this.layer.renderer,b=(this.layer.renderingRule&&this.layer.renderingRule.functionName)===this.rasterFunctionList.value,c=this.layer.renderingRule;this.symbologyType===this._symbologyTypes.stretch?(this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp),this._isStretchRenderer(a)&&this._isSelectedRenderingRule(this.layer.renderingRule)?this._setRendererColorRamp(a.colorRamp):c&&c.functionName&&"colormap"===c.functionName.toLowerCase()&&
c.functionArguments&&c.functionArguments.colorRamp?this.colorRampSelect.setSelected(c.functionArguments.colorRamp):this._setStretchColorRamp()):(c=a&&a.authoringInfo&&a.authoringInfo.colorRamp?F.fromJson(f.clone(a.authoringInfo.colorRamp)):null,this.symbologyTypeSelect.value===this._symbologyTypes.uniqueValues?(this._uniqueValuesColorRamp&&this.colorRampSelect.addColorRamp(this._uniqueValuesColorRamp),this._isUniqueValueRenderer(a)&&c&&b?this._setRendererColorRamp(c):this._setUniqueValuesColorRamp()):
this.symbologyTypeSelect.value===this._symbologyTypes.classify&&(this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp),this._isClassBreaksRenderer(a)&&c?this._setRendererColorRamp(c):this._setClassifyColorRamp()))}},_setRendererColorRamp:function(a){a&&this.layer?this.colorRampSelect.setSelected(a)||this._addCustomColorRamp(a):this.colorRampSelect.reset()},_hideColorRampSelector:function(){n.set(this.colorRampBlock,"display","none");n.set(this.colorRampLabelBlock,"display","none");this._colorRampVisible=
!1},_showColorRampSelector:function(){this.layer&&(this._setColorRampSelectValue(),n.set(this.colorRampBlock,"display","table-row"),n.set(this.colorRampLabelBlock,"display","table-row"),this._colorRampVisible=!0)},_getDefaultSymbologyType:function(){if(this.layer){if(this._isSelectedRenderingRule(this.layer.renderingRule)){if(this.layer.renderer&&this.layer.renderer.declaredClass){var a=this.layer.renderer.declaredClass;if("esri.renderer.StretchRenderer"===a)return this._symbologyTypes.stretch;if("esri.renderer.ClassBreaksRenderer"===
a)return this._symbologyTypes.classify;if("esri.renderer.UniqueValueRenderer"===a)return this._symbologyTypes.uniqueValues}if(this.layer.renderingRule&&((a=this.layer.renderingRule)&&a.functionName&&"stretch"===a.functionName.toLowerCase()||a&&a.functionName&&"colormap"===a.functionName.toLowerCase()&&a.functionArguments&&a.functionArguments.Raster&&a.functionArguments.Raster.functionName&&"stretch"===a.functionArguments.Raster.functionName.toLowerCase()))return this._symbologyTypes.stretch}if(this._cachedRATList[this.layer.id]&&
this._cachedRATList[this.layer.id][this.rasterFunctionList.value]&&(a=this._cachedRATList[this.layer.id][this.rasterFunctionList.value],a.features.length&&this._ratContainsColormap(a)))return this._symbologyTypes.uniqueValues;if(this._canApplyRenderer())return this._symbologyTypes.stretch}},_setupBandIdDefaults:function(){if(this.layer){var a=3,a=this.layer.bandCount,b=this.layer.id,c=this._cachedkeyProperties[b];!c&&1<a?(this.msgLabel.style.display="",this.msgLabel.innerHTML="\x3ci\x3e"+this._i18n.widgets.renderingRule.bandNamesRequestMsg+
"\x3c/i\x3e",c=this.layer.getKeyProperties(),this._pendingDfds[b]=1,c.addBoth(f.partial(this._fillBandIdList,this,this.layer))):this._fillBandIdList(this,this.layer,c);3>a?this._hideBandIds():this._showBandIds()}},_fillBandIdList:function(a,b,c){if(a.layer&&a.layer===b){var d=a._pendingDfds;b=a.layer.id;d&&d[b]&&delete d[b];a.msgLabel.style.display="none";a.msgLabel.innerHTML="";var d=3,d=a.layer.bandCount,e;c&&c.BandProperties&&0<c.BandProperties.length&&(e=c.BandProperties);var g=a._getBandIdList(d,
e,"");a._redBandIdStore=new p({data:g,idProperty:"name"});a.bandIdsRedList.set("store",a._redBandIdStore);a.bandIdsRedList.set("labelAttr","label");a.bandIdsRedList.set("labelType","html");g=a._getBandIdList(d,e,"");a._greenBandIdStore=new p({data:g,idProperty:"name"});a.bandIdsGreenList.set("store",a._greenBandIdStore);a.bandIdsGreenList.set("labelAttr","label");a.bandIdsGreenList.set("labelType","html");d=a._getBandIdList(d,e,"");a._blueBandIdStore=new p({data:d,idProperty:"name"});a.bandIdsBlueList.set("store",
a._blueBandIdStore);a.bandIdsBlueList.set("labelAttr","label");a.bandIdsBlueList.set("labelType","html");(d=a.layer.bandIds)&&2<d.length?(a.bandIdsRedList.attr("value",a._getBandName(a._redBandIdStore,d[0]),!1),a.bandIdsGreenList.attr("value",a._getBandName(a._greenBandIdStore,d[1]),!1),a.bandIdsBlueList.attr("value",a._getBandName(a._blueBandIdStore,d[2]),!1)):0<a._redBandIdStore.data.length&&1<a._greenBandIdStore.data.length&&2<a._blueBandIdStore.data.length&&(d=a._getRedBandIndex(e),g=a._getGreenBandIndex(e),
e=a._getBlueBandIndex(e),a.bandIdsRedList.attr("value",a._redBandIdStore.data[d].name,!1),a.bandIdsGreenList.attr("value",a._greenBandIdStore.data[g].name,!1),a.bandIdsBlueList.attr("value",a._blueBandIdStore.data[e].name,!1));a._cachedkeyProperties[b]=c;a.rasterFunctionList.get("value")===a._defaultBandCombinationFncName&&a._enableBandIds()}},_getRedBandIndex:function(a){if(!this.layer||!a)return 0;var b;for(b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("BandName")&&"red"===a[b].BandName.toLowerCase())return b;
return 0},_getGreenBandIndex:function(a){if(!this.layer||!a)return 1;var b;for(b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("BandName")&&"green"===a[b].BandName.toLowerCase())return b;return 1},_getBlueBandIndex:function(a){if(!this.layer||!a)return 2;var b;for(b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("BandName")&&"blue"===a[b].BandName.toLowerCase())return b;return 2},_getBandIdList:function(a,b,c){if(this.layer){var d=[];c||(c="Black");var e=!1;b&&a===b.length&&(e=!0);var g;for(g=0;g<
a;g++){var l=g,f=g;e&&b[g]&&b[g].BandName?l=b[g].BandName:l++;var h={};h.name=l;h.index=f;h.label="\x3chtml\x3e\x3cbody\x3e\x3cspan value\x3d"+f+"\x3e\x3cfont color\x3d"+c+"\x3e"+l+"\x3c/font\x3e\x3c/span\x3e\x3c/body\x3e\x3c/html\x3e";d.push(h)}return d}},_showVectorWarningIcon:function(){n.set(this.vectorWarningIcon,"display","inline-block");this._vectorWarningShown||this._showVectorWarning()},_showVectorWarning:function(){this._startupCalled&&(z.open({popup:this._vectorTooltipDlg,around:this.vectorWarningIcon,
orient:["below"],onCancel:this._hideVectorWarning}),this._vectorWarningShown=!0)},_hideVectorWarning:function(){z.close(this._vectorTooltipDlg)},_hideVectorWarningIcon:function(){n.set(this.vectorWarningIcon,"display","none");z.close(this._vectorTooltipDlg)},_showClassifyLoadingMsg:function(){n.set(this.classifyLoadingMsg,"display","block")},_hideClassifyLoadingMsg:function(){n.set(this.classifyLoadingMsg,"display","none")},_showUniqueValuesLoadingMsg:function(){n.set(this.uniqueValuesLoadingMsg,
"display","block")},_hideUniqueValuesLoadingMsg:function(){n.set(this.uniqueValuesLoadingMsg,"display","none")},_createVectorLayer:function(){this.emit("vector-rft-select",{layer:this.layer,rasterFunctionTemplate:this.rasterFunctionList.value});this._hideVectorWarning()},_getBandName:function(a,b){if(a&&a.data){var c;for(c=0;c<a.data.length;c++){var d=a.data[c];if(d.index===b)return d.name}return""}},_setupStretchDefaults:function(){if(this.layer){var a=this._getStretchRenderingRule(this.layer.renderingRule);
this._isSelectedRenderingRule(this.layer.renderingRule)&&(this._isStretchRenderer(this.layer.renderer)||a)?this._isStretchRenderer(this.layer.renderer)?this._loadStretchRenderer(this.layer.renderer):a&&this._loadStretchFunction(a):(this.stretchMethodList.attr("value","0",!1),this._onStretchMethodChange(),this.numStdDevText.set("value",2),this.minPercentText.set("value",2),this.maxPercentText.set("value",2),this.gammaSlider.setValue(0),this._updateStretchStatsGrid(),this._getServiceMinAndMax(),this.draCheckbox.checked=
this.minValues&&0<this.minValues.length&&this.maxValues&&0<this.maxValues.length?!1:!0);this._gammaSliderTooltip||(this._gammaSliderTooltip=new da({connectId:["gammaSliderID"],position:["below","above"],id:"gammaSliderTooltipID"}))}},_hasServiceMinMax:function(a){return a.minValues&&0<a.minValues.length&&a.maxValues&&0<a.maxValues.length},_getServiceMinAndMax:function(){var a=this._getCurrentServiceInfo();this.minValues=a&&a.minValues;this.maxValues=a&&a.maxValues},_loadStretchFunction:function(a){if(a&&
a.functionName&&"stretch"===a.functionName.toLowerCase()){this._stretchReadFromRenderingRule=!0;a=a.functionArguments;this.stretchMethodList.attr("value",a.StretchType.toString(),!1);this._onStretchMethodChange();a.NumberOfStandardDeviations&&this.numStdDevText.set("value",a.NumberOfStandardDeviations);this.draCheckbox.checked=a.DRA?!0:!1;if(a.UseGamma){var b=a.Gamma;0<a.Gamma.length&&(b=a.Gamma[0]);(b=Math.log(b)/Math.log(10))&&this.gammaSlider.setValue(b)}a.MinPercent&&this.minPercentText.set("value",
a.MinPercent);a.MaxPercent&&this.maxPercentText.set("value",a.MaxPercent);a.Statistics&&a.Statistics.length&&this._loadStretchStats(a.Statistics)}},_loadStretchRenderer:function(a){if(this._isStretchRenderer(a)){this._stretchReadFromRenderingRule=!1;var b=a._convertStretchTypeEnumToIndex(a.stretchType);this.stretchMethodList.set("value",b.toString());this._onStretchMethodChange();a.numberOfStandardDeviations&&this.numStdDevText.set("value",a.numberOfStandardDeviations);this.draCheckbox.checked=a.dra?
!0:!1;a.useGamma&&(b=a.gamma,0<a.gamma.length&&(b=a.gamma[0]),(b=Math.log(b)/Math.log(10))&&this.gammaSlider.setValue(b));a.minPercent&&this.minPercentText.set("value",a.minPercent);a.maxPercent&&this.maxPercentText.set("value",a.maxPercent);a.statistics&&a.statistics.length&&this._loadStretchStats(a.statistics)}},_loadStretchStats:function(a){if(a&&a.length){var b=[];h.forEach(a,function(a){a&&a.length&&b.push({esriRenderingRuleStretchMin:a[0],esriRenderingRuleStretchMax:a[1],esriRenderingRuleStretchMean:a[2],
esriRenderingRuleStretchStdv:a[3]})});this._updateStretchStatsGrid(b);this._setStretchStatsGridVisibility()}},_getRenderingRuleNameFromStretchFunction:function(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase())return(a=a.functionArguments.Raster)&&a.functionName||null},_fillStretchMethodList:function(){this.stretchMethodList.removeOption(this.stretchMethodList.getOptions());this.stretchMethodList.addOption([{value:"0",label:this._i18n.widgets.renderingRule.noneStretchAlias},{value:"5",
label:this._i18n.widgets.renderingRule.minMaxStretchAlias},{value:"3",label:this._i18n.widgets.renderingRule.stdDevStretchAlias},{value:"6",label:this._i18n.widgets.renderingRule.percentClipStretchAlias}]);this.stretchMethodList.set("value","0");this._onStretchMethodChange()},_onDRAChange:function(){this.symbologyType===this._symbologyTypes.stretch&&"0"!==this.stretchMethodList.value&&(this._updateStretchStatsGrid(),this._setStretchStatsGridVisibility())},_setStretchStatsGridVisibility:function(){var a=
this.stretchMethodList.value,b="0"!==a&&!this.draCheckbox.checked&&this._stretchStatsData&&this._stretchStatsData.length?"":"none";u.toggle(this.stretchStatsBlock,"esriRenderingRuleDisabledGrid","6"===a);this.stretchStatsBlock.style.display=b},_getCurrentServiceInfo:function(){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value);return this.rasterFunctionList.value===this._defaultBandCombinationFncName?this.layer:a&&a.serviceInfo?a.serviceInfo:this.layer},
_updateStretchStatsGrid:function(a){if(this._stretchStatsGrid){if(!a||"number"===typeof a||"string"===typeof a){var b=this._getCurrentServiceInfo(),c=b&&b.bandCount,d={},e=0,g=1,l=2,f,q,m;a=[];h.forEach(["minValues","maxValues","meanValues","stdvValues"],function(a){d[a]=b&&b[a]?b[a]:this.layer[a]?this.layer[a]:Array(c)},this);this.rasterFunctionList.value===this._defaultBandCombinationFncName&&3<=c&&(f=this._redBandIdStore&&this._redBandIdStore.get(this.bandIdsRedList.value),q=this._greenBandIdStore&&
this._greenBandIdStore.get(this.bandIdsGreenList.value),m=this._blueBandIdStore&&this._blueBandIdStore.get(this.bandIdsBlueList.value),e=f?f.index:e,g=q?q.index:g,l=m?m.index:l);h.forEach(3<=c?[e,g,l]:[e],function(b,c){a.push({id:c,esriRenderingRuleStretchMin:d.minValues[b],esriRenderingRuleStretchMax:d.maxValues[b],esriRenderingRuleStretchMean:d.meanValues[b],esriRenderingRuleStretchStdv:d.stdvValues[b]})})}a=this._sanitizeStretchStatsData(a);e=new D(new p({data:a,idProperty:"id"}));this._stretchStatsGrid.set("store",
e);this._stretchStatsData=a}},_onSymbologyTypeChange:function(a){if(this.layer){this.symbologyType=a;var b=this.layer.renderer,c=this.layer.renderingRule,d=this._getStretchRenderingRule(c),c=this._isSelectedRenderingRule(c);this._showBlocks([]);a===this._symbologyTypes.classify?(this._showBlocks([this.classifyBlock,this.classifyGridBlock]),this._isClassBreaksRenderer(b)&&c?this._setupClassifyGridDefaults():this._updateClassifyGrid()):a===this._symbologyTypes.uniqueValues?(this._showBlocks([this.uniqueValuesBlock,
this.uniqueValuesGridBlock]),this._isUniqueValueRenderer(b)&&c?this._setupUniqueValuesGridDefaults():this._updateUniqueValuesGrid()):a===this._symbologyTypes.stretch&&(c?this._isStretchRenderer(b)?this._loadStretchStats(b.statistics):d&&d.functionArguments?this._loadStretchStats(d.functionArguments.Statistics):this._updateStretchStatsGrid():this._updateStretchStatsGrid(),this._showBlocks([this.stretchBlock]))}},_onClassifyFieldChange:function(){this.classifyMethodSelect.value===this._classifyMethods.definedInterval&&
this._setDefaultIntervalSize();this._updateClassifyGrid()},_onClassifyMethodChange:function(a){this.classifyMethodSelect.value!==this._classifyMethods.manualInterval&&(this.classifyMethodSelect.value===this._classifyMethods.definedInterval&&this._setDefaultIntervalSize(),this._handleClassifyIntervalVisibility(a),this._updateClassifyGrid())},_handleClassifyIntervalVisibility:function(a){a===this._classifyMethods.definedInterval?(n.set(this.classifyIntervalsBlock,"display","table-row"),this.classifyNClassesInput.set("disabled",
!0)):(n.set(this.classifyIntervalsBlock,"display","none"),this.classifyNClassesInput.set("disabled",!1))},_showBlocks:function(a){h.forEach(this._symbologyBlocks,function(b){-1<h.indexOf(a,b)?(u.remove(b,"esriRenderingRuleHidden"),u.add(b,"esriRenderingRuleVisible")):(u.remove(b,"esriRenderingRuleVisible"),u.add(b,"esriRenderingRuleHidden"))});this._setColorRampVisibility()},_onRasterFunctionChange:function(){var a=this.rasterFunctionList.get("value");if(a){var b=this._rasterFunctionStore.get(a).description,
c=this._isVectorData(this._getCurrentServiceInfo());this._setupRFTDefaults();this.rasterFunctionList.set("title",b);c?this._showVectorWarningIcon():this._hideVectorWarningIcon();b=this.layer.id;this._setColorRampVisibility();a===this._defaultBandCombinationFncName?(this.rasterFunctionRow.width="",1<this.layer.bandCount?(this._showBandIds(),this._pendingDfds[b]?this._disableBandIds():this._enableBandIds()):this._hideBandIds()):(0<this.domNode.clientWidth&&(this.rasterFunctionRow.width=this.domNode.clientWidth),
this._hideBandIds());a===this._defaultBandCombinationFncName||10.3<=this.layer.version?(this.imageEnhancementLabel.style.display="",this.stretchMethodLabel.style.display="",this.stretchDescLabel.style.display="",this.stretchMethodList.domNode.style.display="",this._onStretchMethodChange()):this._hideStretch()}},_isVectorData:function(a){a=a&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_setClassifyColorRamp:function(){this.colorRampSelect.setSelected("Yellow to Red")},
_setUniqueValuesColorRamp:function(){this._uniqueValuesColorRamp?this.colorRampSelect.setSelected(this._uniqueValuesColorRampName):this.colorRampSelect.setSelected("Aspect")},_setStretchColorRamp:function(){this.colorRampSelect.reset()},_updateUniqueValuesGrid:function(a,b){this._uniqueValuesGrid&&(a=a&&a.length&&a[0].esriRenderingRuleUniqueValuesSymbol?a:this._getUniqueValuesGridData(b))&&a.length&&(void 0===a[0].id&&h.forEach(a,function(a,b){a.id=b}),b=new P(new p({data:a,idProperty:"id"})),this._uniqueValuesGrid.set("store",
b),this._uniqueValuesSymbolData=a,this._hideUniqueValuesLoadingMsg())},_updateClassifyGrid:function(a,b){if(this._classifyGrid&&(a=a&&a.length&&a[0].esriRenderingRuleClassifySymbol?a:this._getClassifyGridData(b))&&a.length){b=a[0]?a[0].maxValue-a[0].minValue:this.classifyIntervalInput.value;void 0===a[0].id&&h.forEach(a,function(a,b){a.id=b});var c=new D(new p({data:a,idProperty:"id"}));this._classifyGrid.set("store",c);this._classifySymbolData=a;this.classifyIntervalInput.attr("value",b,!1);this.classifyNClassesInput.attr("value",
a.length,!1);this._hideClassifyLoadingMsg()}},_openColorPickerPopup:function(a){if(!this._colorPickerOpen){a.stopPropagation();this._colorPicker||(this._colorPicker=new V({showTransparencySlider:!1}),this._colorPicker.startup());var b=a.target,c,d;this._colorPicker.set("color",b.style.backgroundColor,!1);z.open({popup:this._colorPicker,around:b,orient:["below","above"]});this._colorPickerOpen=!0;c=E(document.body,"click",f.hitch(this,function(a){this._colorPicker.domNode.contains(a.target)||a.target===
this._colorPicker.domNode||(d.remove(),c.remove(),z.close(this._colorPicker),this._colorPickerOpen=!1)}));d=E(this._colorPicker,"color-change",f.hitch(this,function(a){c.remove();d.remove();var e=a.color,l=this.symbologyType===this._symbologyTypes.classify?parseInt(b.id.replace("EsriRenderingRuleEditorClassifyGrid",""),10):parseInt(b.id.replace("EsriRenderingRuleUniqueValuesGrid",""),10);z.close(this._colorPicker);this._colorPickerOpen=!1;"no-color"===e?b.style.background="rgba(0,0,0,0)":(e.a=1,b.style.background=
"rgba("+e.r+", "+e.g+","+e.b+", 255)");this.symbologyType===this._symbologyTypes.classify?h.some(this._classifySymbolData,f.hitch(this,function(a){if(a.id===l)return a.esriRenderingRuleClassifySymbol={r:e.r,g:e.g,b:e.b,a:e.a}})):h.some(this._uniqueValuesSymbolData,f.hitch(this,function(a){if(a.id===l)return a.esriRenderingRuleUniqueValuesSymbol={r:e.r,g:e.g,b:e.b,a:e.a}}))}))}},_onColorRampChange:function(){if(this.symbologyType===this._symbologyTypes.uniqueValues)return this._updateUniqueValuesGrid(null,
!0);if(this.symbologyType===this._symbologyTypes.classify)return this._updateClassifyGrid(null,!0)},_onStretchMethodChange:function(){if(!(1>this.stretchMethodList.getOptions.length)){var a=this.stretchMethodList.get("value");"0"===a?this._hideStretchOptions(!0):this._hideStretchOptions(!1);"6"!==a||this.draCheckbox.checked||this._updateStretchStatsGrid();this._setColorRampVisibility();this._setStretchStatsGridVisibility();switch(a){case "0":this.stretchMethodNoneDescBlock.style.display="";break;
case "3":this.numStdDevBlock.style.display="";break;case "5":this.stretchMethodMinMaxDescBlock.style.display="";break;case "6":this.minMaxPercentDescBlock.style.display="",this.minPercentBlock.style.display="",this.maxPercentBlock.style.display=""}}},_onClickApplyRenderingRule:function(){this.rasterFunctionList.get("value")!==this._defaultBandCombinationFncName?this._onRasterFunctionApply():this._onBandIdsApply()},_onClickResetRenderingRule:function(){this.layer&&(this.layer.renderingRule=null,this.layer.bandIds=
null,this.layer.renderer=null,this._setupDefaults(),this._onClickApplyRenderingRule())},_onRasterFunctionApply:function(){if(!this._donotSaveChanges&&this.layer){var a;this.layer.setBandIds([],!0);a=new t;a.functionName=this.rasterFunctionList.get("value");var b=this._getStretchFunction();10.3<=this.layer.version?this.symbologyType===this._symbologyTypes.stretch&&this._stretchReadFromRenderingRule?b&&(b.functionArguments.Raster=a,this._colorRampVisible&&"none"!==this.colorRampSelect.value?(a=this._getColorMapFunction(),
a.functionArguments.Raster=b,this.layer.setRenderingRule(a)):this.layer.setRenderingRule(b)):(this._onRendererApply(!0),this.layer.setRenderingRule(a)):(this.layer.setRenderer(null,!0),this.layer.setRenderingRule(a))}},_onBandIdsApply:function(){if(!this._donotSaveChanges&&this.layer){var a=new t({functionName:"none"});if(this._redBandIdStore&&this.bandIdsGreenList&&this.bandIdsBlueList){var b=[],c=this._redBandIdStore.get(this.bandIdsRedList.value),d=this._greenBandIdStore.get(this.bandIdsGreenList.value),
e=this._blueBandIdStore.get(this.bandIdsBlueList.value);c&&d&&e&&(b.push(c.index),b.push(d.index),b.push(e.index));this.layer.setRenderingRule(a,!0);this._onRendererApply(!0);this.layer.setBandIds(b)}else this.layer.setRenderingRule(a,!0),this._onRendererApply(!1)}},_onRendererApply:function(a){!this._donotSaveChanges&&this.layer&&(this.symbologyType===this._symbologyTypes.classify?this._onClassifyApply(a):this.symbologyType===this._symbologyTypes.uniqueValues?this._onUniqueValuesApply(a):this._onStretchApply(a))},
_onStretchApply:function(a){if(!this._donotSaveChanges&&this.layer)if(this._stretchReadFromRenderingRule){var b=this._getStretchFunction();this._colorRampVisible&&"none"!==this.colorRampSelect.value?(a=this._getColorMapFunction(),a.functionArguments.Raster=b,this.layer.setRenderingRule(a)):this.layer.setRenderingRule(b,a)}else{if("0"===this.stretchMethodList.value&&(!this._colorRampVisible||"none"==this.colorRampSelect.value))return this.layer.setRenderer(null,a);var b=new X,c=this.stretchMethodList.get("value");
b.stretchType=b._convertStretchTypeIndexToEnum(parseInt(c,10));b.dra=this.draCheckbox.checked?!0:!1;var d=Math.exp(this.gammaSlider.value*Math.log(10)),d=parseFloat(parseFloat(d).toFixed(2)),e=[];e.push(d);1<this.layer.bandCount&&(e.push(d),e.push(d));6==c&&(b.minPercent=this.minPercentText.value,b.maxPercent=this.maxPercentText.value);3==c&&(b.numberOfStandardDeviations=this.numStdDevText.value);b.statistics=this._getStretchStats();b.gamma=e;b.useGamma=!0;b.outputPixelType="U8";this._colorRampVisible&&
"none"!==this.colorRampSelect.value&&(b.colorRamp=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName));this.layer.setRenderer(b,a)}},_getStretchStats:function(){var a=this._getCurrentServiceInfo().bandCount,b=[],c=this._stretchStatsData;if(a&&!this.draCheckbox.checked&&"6"!==this.stretchMethodList.value&&"0"!==this.stretchMethodList.value&&this._isStretchGridDataValid()){var d;for(d=0;d<Math.min(a,3);d++)b.push([c[d].esriRenderingRuleStretchMin,c[d].esriRenderingRuleStretchMax,
c[d].esriRenderingRuleStretchMean,c[d].esriRenderingRuleStretchStdv]);return b}return[]},_onUniqueValuesApply:function(a){var b=new Y,c=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName);c&&(b.authoringInfo={},b.authoringInfo.colorRamp=c.toJson());b.infos=this._getUniqueValueInfos(this._uniqueValuesSymbolData);b.attributeField=this.uniqueValuesFieldSelect.value;this.layer.setRenderer(b,a)},_getUniqueValueInfos:function(a){var b=[],c;h.forEach(a,function(a){c=
a.esriRenderingRuleUniqueValuesSymbol;if(isNaN(c.r)||isNaN(c.g)||isNaN(c.b))c={r:0,g:0,b:0,a:0};var d=new M("solid",null,new v(c));b.push({value:a.esriRenderingRuleUniqueValuesValue,label:a.esriRenderingRuleUniqueValuesLabel.toString(),symbol:d})});return b},_onClassifyApply:function(a){var b,c;c=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName);b=new Z({field:this.classifyFieldSelect.value,showInAscendingOrder:!0,classificationMethod:this.classifyMethodSelect.value});
c&&(b.authoringInfo={},b.authoringInfo.colorRamp=c.toJson());b.infos=this._getClassBreakInfos();b.minimumBreak=b.infos.minValue;b.attributeField=this.classifyFieldSelect.value;this.layer.setRenderer(b,a)},_getClassBreakInfos:function(){var a=[],b,c;h.forEach(this._classifySymbolData,function(d,e){b=d.esriRenderingRuleClassifySymbol;if(isNaN(b.r)||isNaN(b.g)||isNaN(b.b))b={r:0,g:0,b:0,a:0};c=new M("solid",null,new v(b));a.push({minValue:d.minValue,maxValue:d.maxValue,label:d.esriRenderingRuleClassifyLabel,
symbol:c})});return a},_getStretchFunction:function(){var a=null;"0"!==this.stretchMethodList.get("value")&&(a=new t,a.functionName="Stretch",this._buildStretchFunction(a));return a},_buildStretchFunction:function(a){a.functionName="Stretch";var b=this.stretchMethodList.get("value"),c={};c.StretchType=parseInt(b,10);c.DRA=this.draCheckbox.checked?!0:!1;var d=Math.exp(this.gammaSlider.value*Math.log(10)),d=parseFloat(parseFloat(d).toFixed(2)),e=[];e.push(d);1<this.layer.bandCount&&(e.push(d),e.push(d));
c.Gamma=e;c.UseGamma=!0;"3"===b?(c.NumberOfStandardDeviations=this.numStdDevText.value,a.outputPixelType="U8"):"6"===b?(c.MinPercent=parseFloat(this.minPercentText.value),c.MaxPercent=parseFloat(this.maxPercentText.value),a.outputPixelType="U8"):"5"===b&&(a.outputPixelType="U8");c.Statistics=this._getStretchStats();a.functionArguments=c},_onGammaChange:function(a){var b=this._gammaSliderTooltip;if(b&&this.symbologyTypeSelect.value===this._symbologyTypes.stretch){var c=Math.exp(a*Math.log(10));b.label=
c?parseFloat(c).toFixed(2):a;b.open("gammaSliderID")}},_onGammaMouseLeave:function(){this.gammaTooltipClose()},_disableBandIds:function(){this.bandIdsRedList.set("disabled",!0);this.bandIdsGreenList.set("disabled",!0);this.bandIdsBlueList.set("disabled",!0);this.bandIdsLabel.style.color="Gray"},_enableBandIds:function(){this.bandIdsRedList.set("disabled",!1);this.bandIdsGreenList.set("disabled",!1);this.bandIdsBlueList.set("disabled",!1);""===this.bandIdsRedList.value&&this.bandIdsRedList.attr("value",
"1",!1);""===this.bandIdsGreenList.value&&this.bandIdsGreenList.attr("value","2",!1);""===this.bandIdsBlueList.value&&this.bandIdsBlueList.attr("value","3",!1);this._isStretchRenderer(this.layer.renderer)||this._getStretchFunction(this.layer.renderingRule)||this._updateStretchStatsGrid();this.bandIdsLabel.style.color="Black"},_showBandIds:function(){this.bandIdsLabelBlock.style.display="";this.bandIdsBlock.style.display="";this.bandIdsMsgBlock.style.display=""},_hideBandIds:function(){this.bandIdsLabelBlock.style.display=
"none";this.bandIdsBlock.style.display="none";this.bandIdsMsgBlock.style.display="none"},_hideStretch:function(){this.imageEnhancementLabel.style.display="none";this.stretchDescLabel.style.display="none";this.stretchMethodLabel.style.display="none";this.stretchMethodList.domNode.style.display="none";this._hideStretchOptions(!0)},_hideStretchOptions:function(a){var b="";a&&(b="none");this.gammaBlock.style.display=b;this.draBlock.style.display=b;this.stretchMethodNoneDescBlock.style.display="none";
this.stretchMethodMinMaxDescBlock.style.display="none";this.numStdDevBlock.style.display="none";this.minMaxPercentDescBlock.style.display="none";this.minPercentBlock.style.display="none";this.maxPercentBlock.style.display="none";this.stretchStatsBlock.style.display="none"},_getDefaultRedBandIndex:function(){var a;this._redBandIdStore&&(a=this._redBandIdStore.get("Red"));a||(a=1);return a},_getClassifyGridData:function(a){this.classifyMethod=this.classifyMethodSelect.value===this._classifyMethods.manualInterval?
this.classifyMethod:this.classifyMethodSelect.value;var b=Math.min(this.classifyNClassesInput.value,this.classifyNClassesInput.constraints&&this.classifyNClassesInput.constraints.max),c=this.colorRampSelect.colorRamp,d=this.classifyIntervalInput.value,e=this.classifyFieldSelect.value;this._classifySymbolData||(a=!1);if(this.layer&&this.classifyMethod&&b&&c){var g=a?this._classifySymbolData:this._getClassBreaks(this.classifyMethod,b,e,d);if(g){var f=F.convertColorRampToColormap(c,g.length),k=a?this._classifySymbolData:
[],q,b=g.length;h.forEach(g,function(c,d){q={r:f[d][1],g:f[d][2],b:f[d][3],a:1};a?k[d].esriRenderingRuleClassifySymbol=q:k.push({esriRenderingRuleClassifySymbol:q,minValue:c.minValue,maxValue:c.maxValue,serviceMaxValue:d===b-1?c.maxValue:g[d+1].maxValue,esriRenderingRuleClassifyLabel:this._createLabelString(c.minValue,c.maxValue)})},this);return k}}},_getClassBreaks:function(a,b,c,d){var e=this._cachedHistogramsList&&this._cachedHistogramsList[this.layer.id]?this._cachedHistogramsList[this.layer.id][this.rasterFunctionList.value]:
null,g=this._cachedRATList&&this._cachedRATList[this.layer.id]?this._cachedRATList[this.layer.id][this.rasterFunctionList.value]:null,f,k,q;if(this.layer&&(g||e)){if(g){var e=g.features,m=[];e.sort(this._getSortFeaturesFun(c));f=k=e[0].attributes[c];h.forEach(e,function(a){a.attributes.Count&&m.push(a.attributes.Count);q=a.attributes[c];q<f&&(f=q);q>k&&(k=q)});d&&16<(k-f)/d&&(d=(k-f)/16);return K.calculateClassBreaks(e,null,c,null,null,a,b,null,m,d)}if(e&&e.length&&e[0].dataPoints&&e[0].counts)return f=
e[0].dataPoints[0],k=e[0].dataPoints[e[0].dataPoints.length-1],d&&16<(k-f)/d&&(d=(k-f)/16),K.calculateClassBreaks(null,e[0].dataPoints,null,null,null,a,b,null,e[0].counts,d)}},_getSortFeaturesFun:function(a){return function(b,c){b=b.attributes[a];c=c.attributes[a];return b-c}},_getUniqueValuesGridData:function(a){var b=this._getCurrentServiceInfo(),b=b&&b.hasRasterAttributeTable?b.hasRasterAttributeTable:this.layer.hasRasterAttributeTable,c=this.layer.rasterAttributeTable,d=this.rasterFunctionList.value,
e=this._cachedHistogramsList&&this._cachedHistogramsList[this.layer.id]?this._cachedHistogramsList[this.layer.id][this.rasterFunctionList.value]:null,g=e&&e.length&&e[0].dataPoints;d!==this._defaultBandCombinationFncName&&this._cachedRATList[this.layer.id]&&this._cachedRATList[this.layer.id][d]&&(c=this._cachedRATList[this.layer.id][d]);var f=this.colorRampSelect.colorRamp,d=this.uniqueValuesFieldSelect.value,k,q=f&&f.colorRamps?f.colorRamps.length:1,m=[],n=[],p,r,u,t,w,v=0,x=0;a?n=k=this._uniqueValuesSymbolData:
b?(k=c.features,k=this._sortFeatures(k,d)):g&&(k=e[0].dataPoints);if(f&&k&&d){for(x=0;x<q;x++)m[x]={},m[x].start=v,m[x].end=v+1/q,v=m[x].end;h.forEach(k,function(b,c){if(f===this._uniqueValuesColorRamp){if(b.features&&b.features[0]){var d=this._getFeatureRGBValue(b.features[0].attributes);a?b.esriRenderingRuleUniqueValuesSymbol={r:d[0],g:d[1],b:d[2],a:1}:n.push({esriRenderingRuleUniqueValuesSymbol:{r:d[0],g:d[1],b:d[2],a:1},esriRenderingRuleUniqueValuesValue:b.value,esriRenderingRuleUniqueValuesLabel:J.isDefined(b.value)?
b.value.toString():"",features:b.features})}}else t=(c+.5)/k.length,h.forEach(m,function(d,e){t>=d.start&&t<d.end&&(w=(t-d.start)/(d.end-d.start),1<m.length?(p=y.getDojoColor(f.colorRamps[e].fromColor),r=y.getDojoColor(f.colorRamps[e].toColor)):(p=y.getDojoColor(f.fromColor),r=y.getDojoColor(f.toColor)),u=F.interpolateLabColor(p,r,w),a?k[c].esriRenderingRuleUniqueValuesSymbol=y.correctRGBLimits(u):(d=g?Math.round(b):b.value,n.push({esriRenderingRuleUniqueValuesSymbol:y.correctRGBLimits(u),esriRenderingRuleUniqueValuesValue:d,
esriRenderingRuleUniqueValuesLabel:J.isDefined(d)?d.toString():"",features:g?b:b.features})))},this)},this);return n}},_areFieldValuesUnique:function(a,b){var c=[];return h.some(b,function(b){if(-1<c.indexOf(b.attributes[a]))return!0;c.push(b.attributes[a])})?!1:!0},_sortFeatures:function(a,b){if(a&&b){a=f.clone(a);var c=[],d=[];this._areFieldValuesUnique(b,a)||a.sort(f.hitch(this,function(a,c){return"string"===typeof a.attributes[b]?(a=a.attributes[b],c=c.attributes[b],this._isRangeValue(a,c)&&(a=
parseFloat(a.split("-")[0]),c=parseFloat(c.split("-")[0])),a<c?-1:1):a.attributes[b]-c.attributes[b]}));h.forEach(a,function(a,f){var e=a.attributes[b];0<f&&-1<d.indexOf(e)?c[d.indexOf(e)].features.push(a):(d.push(e),c.push({value:e,features:[a]}))});return c}},_isRangeValue:function(a,b){return(0<=a.indexOf("-")||0<=b.indexOf("-"))&&!isNaN(parseFloat(a.split("-")[0]))},_getColorRGB:function(a){return{r:a[0],g:a[1],b:a[2]}},_isStretchGridDataValid:function(){var a=this._stretchStatsData,b;return a&&
a.length?h.some(a,function(a){for(var c in a)if(b=a[c],a.hasOwnProperty(c)&&"id"!==c&&void 0!==b&&null!==b&&!isNaN(b))return!0}):!1},_sanitizeStretchStatsData:function(a){if(a)return h.forEach(a,function(a){for(var b in a)void 0===a[b]&&(a[b]=null)}),a},_convertColorRamps:function(a,b){if(a){var c=null;if(a.type&&"multipart"==a.type.toLowerCase()){var c=new W,d=[];h.forEach(a.colorRamps,function(a){var b=new L;b.algorithm="hsv";b.fromColor=new v(a.fromColor);b.toColor=new v(a.toColor);d.push(b)});
c.colorRamps=d}else c=new L,c.algorithm="hsv",c.fromColor=new v(a.fromColor),c.toColor=new v(a.toColor);c.name=b;return c}},gammaTooltipClose:function(){this._gammaSliderTooltip&&this._gammaSliderTooltip.close()}});Q("extend-esri")&&f.setObject("dijit.RenderingRule",C,S);return C});