// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/analysis/utils","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/fx dojo/_base/json dojo/_base/kernel dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/promise/all dojo/fx/easing dojo/number dojo/_base/window dojo/when dojo/dom dojo/on dojo/data/ItemFileWriteStore dojo/topic dojo/store/Memory dojox/mvc/equals dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../units ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter ./FeatureRecordSetLayer ./PluginLayers ./PCSList ./ItemTypes ../../layers/ArcGISImageServiceLayer ../../layers/RasterFunction ./AnalysisRegistry".split(" "),
function(z,g,q,la,T,I,U,V,D,W,ma,X,w,A,n,B,J,x,na,t,u,Y,K,y,Z,E,L,M,aa,oa,ba,ca,da,ea,N,fa,h,l,F,ga,ha,ia,C,pa,O,qa,ja,ra,P,v,G,ka,m){z={};g.mixin(z,{_helpDialog:null,systemRFTGroupName:"Raster Function Templates",i18n:null,UNITSMAP:{Feet:"esriFeet",Yards:"esriYards",Miles:"esriMiles",Meters:"esriMeters",Kilometers:"esriKilometers",NauticalMiles:"esriNauticalMiles"},initHelpLinks:function(a,b,d){if(a){var c=da.byNode(a),e=c?c.get("helpFileName"):d&&d.helpFileName?d.helpFileName:null,f=c?c.get("isSingleTenant"):
d&&d.isSingleTenant?d.isSingleTenant:!1,k=m.Modes.standard,r=c&&c.portalSelf?c.portalSelf.helpBase:d&&d.helpBase?d.helpBase:null,p=c&&c.portalSelf;this._helpDialog||(this._helpDialog=new ga({isPortal:f,portalSelf:p}));c&&(c.showGeoAnalyticsParams||c.showBigData)||d&&d.analysisMode&&d.analysisMode===m.Modes.Bigdata?(e+="_bd",k=m.Modes.Bigdata):d&&d.analysisMode&&"raster"===d.analysisMode&&(e+="_ra",k=m.Modes.Raster);B("[esriHelpTopic]",a).forEach(function(p,l,m){p&&(x.set(p,"display",h.isDefined(b)&&
!0!==b?"none":""),h.isDefined(p._helpClickHandler)&&(p._helpClickHandler.remove(),p._helpClickHandler=null),p._helpClickHandler=M(p,"click",g.hitch(this,function(b){T.stop(b);d&&d.showHelpFromUrl&&d.helpUrl?this._helpDialog.show(b,{showHelpFromUrl:d.showHelpFromUrl,helpUrl:d.helpUrl}):this._helpDialog.show(b,{helpId:D.get(p,"esriHelpTopic"),helpFileName:e,analysisGpServer:d&&d.analysisGpServer?d.analysisGpServer:null,helpParentNode:a,isPortal:f,analysisMode:k,helpBase:r,portalSelf:c&&c.portalSelf})})))},
this)}},constructAnalysisFeatColl:function(a){var b={},d;b.featureCollection=a.layerDefinition;for(d in b.featureCollection)b.featureCollection.hasOwnProperty(d)&&"objectIdField"===d&&(b.featureCollection.objectIdFieldName=g.clone(b.featureCollection.objectIdField),delete b.featureCollection.objectIdField);b.featureCollection.features=a.featureSet.features;return b},constructAnalysisInputLyrObj:function(a,b,d){var c={},e,f="";h.isDefined(d)||(d=!0);a.getMap?e=a.getMap():a._map&&(e=a._map);if(a.url&&
!a._collection)c={url:a.url},this.isHostedService(a.url),a.getDefinitionExpression&&a.getDefinitionExpression()?c.filter=a.getDefinitionExpression():h.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(c.filter=a.definitionExpression),a.useMapTime&&a.timeInfo&&e&&e.timeExtent&&d&&(e.timeExtent.startTime?(f+=e.timeExtent.startTime.getTime(),e.timeExtent.endTime&&(f+=","+e.timeExtent.endTime.getTime())):e.timeExtent.endTime&&(f+=e.timeExtent.endTime.getTime()),f&&(c.time=f)),a.credential&&
(c.serviceToken=a.credential.token),-1!==c.url.indexOf("?")&&(d=c.url.substring(c.url.indexOf("?")+1,c.url.length),d=X.queryToObject(d),g.mixin(c,d),c.url=c.url.substring(0,c.url.indexOf("?")));else if(!a.url||a._collection)try{c=a.toJson()}catch(k){a._json=A.parse(a._json),c=a.toJson()}c.name=a.name;b&&(c=new ja(c));return c},formatDate:function(a){return J.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+J.format(a,{selector:"time",timePattern:"HH:mm:ss"})},isHostedService:function(a){if(!a)return!1;
var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},isPortalHostedService:function(a){return a?-1!==a.toLowerCase().indexOf("/hosted/"):!1},isTimeEnabled:function(a){var b=10.2<=a.version&&a._useStandardizedQueries;return a.useMapTime&&a.timeInfo&&(b||10.2<=a.version)||h.isDefined(a.time)},isTimeInstantLayer:function(a){return h.isDefined(a.timeInfo)&&h.isDefined(a.timeInfo.startTimeField)&&!h.isDefined(a.timeInfo.endTimeField)||
h.isDefined(a.time)&&h.isDefined(a.time.timeType)&&"instant"===a.time.timeType},buildReport:function(a,b){var d="";b||(b={},g.mixin(b,w.analysisMsgCodes));q.forEach(a,function(a,e){var c,k,r;"string"===typeof a.message?(c=h.isDefined(b[a.messageCode])?b[a.messageCode]:a.message,d+=a.style.substring(0,a.style.indexOf("\x3c/"))+(this._isEmptyObject(a.params)?c:n.substitute(c,a.params))+a.style.substring(a.style.indexOf("\x3c/"))):g.isArray(a.message)&&(r=[],k=g.clone(a.style),q.forEach(a.message,function(d,
e){k=k.replace(/<\//,"${"+e+"}");c=h.isDefined(b[a.messageCode+"_"+e])?b[a.messageCode+"_"+e]:d;c=this._isEmptyObject(a.params)?c:n.substitute(c,a.params);"string"===typeof c&&(c=this.safetagsReplace(c));r.push(c+"\x3c/")},this),k=n.substitute(k,r),d+=k)},this);return d},getLayerFeatureCount:function(a,b){var d=new ha,c=new u;b||(b={});d.geometry=b.geometry;d.geometryType=b.geometryType||"esriGeometryEnvelope";a.url||d.geometry?(a.url&&(d.where=b.where||"1\x3d1",a.getDefinitionExpression&&a.getDefinitionExpression()&&
!b.where?d.where=a.getDefinitionExpression():h.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&!b.where&&(d.where=a.definitionExpression)),c=a.queryCount(d)):c.resolve(a.graphics.length);return c.promise},createPolygonFeatureCollection:function(a){var b;b={layerDefinition:null,featureSet:{features:[],geometryType:m.GeometryTypes.Polygon}};b.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,
supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:m.GeometryTypes.Polygon,minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],
outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},
{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createPointFeatureCollection:function(a){var b;b={layerDefinition:null,featureSet:{features:[],geometryType:m.GeometryTypes.Point}};b.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},
description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:m.GeometryTypes.Point,fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",
editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return b},createFolderStore:function(a,b){var d=new aa({data:{identifier:"id",label:"name",items:[]}});d.newItem({name:b,id:""});q.forEach(a,function(a){d.newItem({name:a.title,id:a.id})});return d},setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",!0);a.folderSelect.set("searchAttr","name");h.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(g.hitch(this,
function(b){h.isDefined(b)?a.folderSelect.set("item",b):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:g.hitch(this,function(b){h.isDefined(b)&&0<b.length?a.folderSelect.set("item",b[0]):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)})}):a.username?a.folderSelect.set("displayedValue",a.username):a.folderStore.get("").then(function(b){a.folderSelect.set("item",b)},this)},
_isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},validateServiceName:function(a,b){var d=/(:|&|<|>|%|#|\?|\\|\"|\/|\+|=|\*|@|\'|;|\||,)/g.test(a),c=!0,e,f,k=!0;h.isDefined(b)&&b.textInput&&(f=b.textInput);h.isDefined(b)&&h.isDefined(b.isItem)&&(k=b.isItem);this.initI18n();if(0===a.length||0===n.trim(a).length)e=this.i18n.requiredValue,c=!1;else if(d)e=this.i18n.invalidServiceName,c=!1;else if(k&&98<a.length)e=this.i18n.invalidServiceNameLength,c=!1;else if(k&&170<
encodeURIComponent(a).length){for(a+="";170<encodeURIComponent(a).length;)a=a.substring(0,a.length-1);e=n.substitute(this.i18n.suggestedServiceNameLength,{count:a.length});c=!1}f&&!c&&f.set("invalidMessage",e);return c},getStepNumber:function(a){B(".esriAnalysisNumberLabel",a).forEach(function(a,d){d=this._getNumberLabel(d);D.set(a,"innerHTML",d)},this)},_getNumberLabel:function(a){var b="";this.initI18n();switch(a){case 0:b=this.i18n.oneLabel;break;case 1:b=this.i18n.twoLabel;break;case 2:b=this.i18n.threeLabel;
break;case 3:b=this.i18n.fourLabel;break;case 4:b=this.i18n.fiveLabel;break;case 5:b=this.i18n.sixLabel;break;case 6:b=this.i18n.sevenLabel;break;case 7:b=this.i18n.eightLabel;break;case 8:b=this.i18n.nineLabel}return b},populateAnalysisLayers:function(a,b,d,c){if(a){var e=[],f=a.get(b);b=a._analysisSelect||c.layerSelect;a.rerun&&!f&&(c||(c={}),c.chooseBlank=!0);a._titleRow&&x.set(a._titleRow,"display","none");a._analysisLabelRow&&x.set(a._analysisLabelRow,"display","table-row");a._selectAnalysisRow&&
(x.set(a._selectAnalysisRow,"display","table-row"),x.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);h.isDefined(c)&&c.chooseLabel&&e.push({value:-1,label:this.i18n.chooseLabel});h.isDefined(c)&&c.chooseBlank&&e.push({value:"  ",label:""});h.isDefined(c)&&h.isDefined(c.posIncrement)||(h.isDefined(c)||(c={}),c.posIncrement=0);a.get(d)||a.set(d,[]);q.forEach(a.get(d),function(a,b){b+=c.posIncrement;b={value:h.isDefined(c)&&c.chooseLabel?""+
b+1:""+b,label:a.name};f&&(a.name===f.name||a.url&&f.url&&a.url===f.url)&&(b.selected=!0);e.push(b)},this);b.addOption(e);b.set("required",!0);c.chooseBlank&&"  "===b.get("value")&&setTimeout(g.hitch(this,this._validateSelectUI,b),100)}},isValidAnalysisLayer:function(a){var b,d,c,e,f,k,r,p="",g=!0;b={isValid:g,validationMessage:p};var l,Q,H=0,R=0,S=0,t,u,v,w=!0;if(!h.isDefined(a)||!h.isDefined(a.toolName))return b;this.initI18n();b=a.toolName;d=a.layers;c=a.analysisLayer;e=b.charAt(0).toLowerCase()+
b.substring(1);r=this.i18n;a=a.showReadyToUseLayers||!1;q.forEach(d,function(a){w=!1;a instanceof G&&(t=!0);t&&1<a.bandCount&&(u=!0);t&&1===a.bandCount&&(v=!0);a.geometryType===m.GeometryTypes.Point&&(k=!0,H++);if(a.geometryType===m.GeometryTypes.Point||a.geometryType===m.GeometryTypes.MultiPoint)l=!0;a.geometryType===m.GeometryTypes.Line&&(Q=!0,S++);a.geometryType===m.GeometryTypes.Polygon&&(f=!0,R++)},this);-1!==q.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],b)&&
(!k||c&&c.geometryType!==m.GeometryTypes.Point)?(p=n.substitute(this.i18n.selectPointLayer,{toolName:r[e]}),g=!1):"AggregatePoints"!==b&&"InterpolatePoints"!==b||(!c||c.geometryType===m.GeometryTypes.Point||c.geometryType===m.GeometryTypes.MultiPoint)&&l?"CalculateDensity"===b&&(!l&&!Q||c&&c.geometryType!==m.GeometryTypes.Point&&c.geometryType!==m.GeometryTypes.MultiPoint&&c.geometryType!==m.GeometryTypes.Line)?(p=n.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:r[e]}),g=!1):"FindHotSpots"!==
b&&"FindOutliers"!==b||a||!(!l&&!f||c&&c.geometryType!==m.GeometryTypes.Point&&c.geometryType!==m.GeometryTypes.MultiPoint&&c.geometryType!==m.GeometryTypes.Polygon)?"OverlayLayers"!==b&&"AggregatePoints"!==b&&"SummarizeWithin"!==b&&"SummarizeNearby"!==b&&"FindNearest"!==b&&"MergeLayers"!==b||a||0!==d.length&&(1!==d.length||d[0]!==c&&h.isDefined(c))?"ConnectOriginsToDestinations"===b&&!a&&(w||2>H)?(p=n.substitute(this.i18n.odPointMsg,{toolName:r[e]}),g=!1):this.isFindCentroids(b)&&this.isPointLayer(c)?
(p=n.substitute(this.i18n.selectNoPointLayer,{toolName:r[e]}),g=!1):"AggregatePoints"===b&&!a&&1<d.length?(f=q.some(d,function(a){return a.geometryType===m.GeometryTypes.Polygon}),f||(p=n.substitute(this.i18n.aggregatePolyMsg,{toolName:r[e]}),g=!1)):"MergeLayers"===b&&!a&&1<d.length?1<H||1<S||1<R||(p=this.i18n.mergeValidationMsg,g=!1):"SummarizeWithin"!==b&&"DissolveBoundaries"!==b||(!c||c.geometryType===m.GeometryTypes.Polygon)&&f||a?"ExtractData"===b?(g=q.some(d,function(a){return-1!==a.capabilities.indexOf("Extract")}))||
(p=n.substitute(this.i18n.extractValidationMsg)):("ConnectOriginsToDestinations"===b||b===m.Tools.ChooseBestFacilities)&&1<d.length?(k=q.some(d,function(a){var b=h.isDefined(c)&&c.id===a.id;return a.geometryType===m.GeometryTypes.Point&&!b}),k||(p=n.substitute(b===m.Tools.ChooseBestFacilities?this.i18n.selectPointLayer:this.i18n.odPointMsg,{toolName:r[e]}),g=!1)):"CalculateSlope"===b||"DeriveAspect"===b||"RemapValues"===b?t?v||(g=!1,p=n.substitute(this.i18n.noSingleBandISMsg,{toolName:r[e]})):(g=
!1,p=n.substitute(this.i18n.noImageServiceMsg,{toolName:r[e]})):"ExtractRaster"===b?t||(g=!1,p=n.substitute(this.i18n.noImageServiceMsg,{toolName:r[e]})):"MonitorVegetation"===b&&(t?u||(g=!1,p=n.substitute(this.i18n.noMultiBandISMsg,{toolName:r[e]})):(g=!1,p=n.substitute(this.i18n.noImageServiceMsg,{toolName:r[e]}))):(p=n.substitute(this.i18n.selectPolyLayer,{toolName:r[e]}),g=!1):(p=n.substitute(this.i18n.overlayValidationMsg,{toolName:r[e]}),g=!1):(p=n.substitute(this.i18n.hotspotsLineFeatureMsg,
{toolName:r[e]}),g=!1):(p=n.substitute(this.i18n.selectPointLayer,{toolName:r[e]}),g=!1);return b={isValid:g,validationMessage:p}},isFindCentroids:function(a){return a===m.Tools.FindCentroids},isPointLayer:function(a){return a&&a.geometryType===m.GeometryTypes.Point},initI18n:function(){this.i18n||(this.i18n={},g.mixin(this.i18n,w.common),g.mixin(this.i18n,w.analysisTools),g.mixin(this.i18n,w.analysisMsgCodes),g.mixin(this.i18n,w.browseLayersDlg),g.mixin(this.i18n,w.driveTimes),g.mixin(this.i18n,
w.calculateFields))},addBrowseAnalysisDialog:function(a){if(a&&a.widget){this.i18n||this.initI18n();var b="esri/dijit/analysis/PluginAnalysisLayers",d=function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},c=function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||
a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},e=function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+a.iconUrl+"'/\x3e"},f=function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'16px' height\x3d'16px' alt\x3d'' src\x3d'"+a.iconUrl+"'/\x3e"},k=Z.doc.createDocumentFragment(),k=t.create("div",{style:"width:100%;height:100%;"},k),r=t.create("div",{style:"width:100%;height:10%;","class":""}),p=t.create("div",{style:"width:100%"},
k),h,l,m,n=this._isCustomAnalysisQuery(a.widget);1===a.browseType?(b="esri/dijit/analysis/PluginLayers",b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),itemsPerPage:100,demandList:!0,extent:a.widget.get("map").extent,useExtent:!1,fetchTimeout:600,galleryTemplate:"\x3cdiv class\x3d'listServiceTitle'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%'\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cdiv  style\x3d\"position:absolute;left:80px; top:10px; width:1px; height:1px; background: transparent;\"\x3e\x3c/div\x3e\x3cdiv style\x3d'overflow:hidden;'\x3e\x3ca style\x3d\"height:16px;\"\x3e${item.title}\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' width\x3d'100%'\x3e\x3ctr width\x3d'100%' class\x3d'bottomRowTable'\x3e\x3ctd width\x3d'20'\x3e  \x3cspan class\x3d'esriAlignLeading'\x3e${item:_formatThumbnail}\x3c/span\x3e\x3c/td\x3e\x3ctd nowrap\x3d'nowrap'\x3e  \x3cspan class\x3d'esriAlignLeading' style\x3d'color:#656565;'\x3e${item.owner}\x3c/span\x3e\x3c/td\x3e\x3ctd style\x3d'padding-right:5px;padding-left:3px;'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",
showInfoPanel:!0,isAutoClose:!1,checkIsButtonEnabled:!0,formatThumbnail:f,formatInfoPanelImage:e,"class":"esriAnalysisLayersItems"}):b={portalUrl:a.widget.get("portalUrl"),message:"",plugin:b,sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),pagingLinks:1,rowsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",extent:a.widget.get("map").extent,useExtent:!n,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatItemTitle:c,showInfoPanel:!1,showTooltip:!0,formatThumbnail:d,style:"width:48em;height:100%;clear:both;"};c=t.toDom('\x3cdiv class\x3d"esriBrowseOptions"\x3e');t.place(c,r);d=t.create("div",{"class":"esriBrowseOption"},c);a.browseType&&1===a.browseType||(c=t.create("div",{"class":"esriBrowseOption"},c),l=new N({name:"addlayer",id:a.widget.id+(a.browseType?a.browseType:"")+"_addlayercheck","class":"",value:!1,checked:!1},t.create("input",{},c)),t.create("label",{"for":a.widget.id+"_addlayercheck",
"class":"esriBrowseOption_label",innerHTML:this.i18n.addLayer},c));c=!0;a.browseType&&1===a.browseType?c=!1:n&&(c=!1);c=new N({name:"extentcheck",id:a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"",value:c,checked:c},t.create("input",{},d));t.create("label",{"for":a.widget.id+(a.browseType?a.browseType:"")+"_addextentcheck","class":"esriBrowseOption_label",innerHTML:this.i18n.withinMapArea},d);b.messageRight=r;h=new ia(b,p);c.on("change",g.hitch(this,function(a){h.set("useExtent",
a)}));m=new ea({title:1===a.browseType?this.i18n.browseLayers:n?this.i18n.browseAnalysisLayers:this.i18n.browseAnalysisTitle,content:k,browseItems:h,addlayerCheckBox:l,style:a.browseType&&1===a.browseType?"":"padding:.75em 0;background-color: #fff;width:50em;"});a.widget.own(m.on("hide",g.hitch(m,function(a){m.browseItems.reset()})));return m}},addAnalysisReadyLayer:function(a,b){function d(d){var c,f,k;"Feature Service"===e.type&&(k=new C(e.url,{outFields:["*"]}),g.mixin(e,k));"Image Service"===
e.type&&(k=new G(e.url,{outFields:["*"]}),g.mixin(e,k));g.mixin(e,d);e.id=e.title+"_"+d.id;e.title=a.item.selectedLayer?e.title+"-"+d.name:e.title.replace(/_/g," ");e.name=e.title;e.version=e.currentVersion;if(m&&a.widget.showBrowseLayers){f=(c=a.layersSelect.get("store"))&&c.data;c=2;c=f.splice(f.length-c,c);var p={id:f.length,label:e.title,name:e.title,url:e.url};f.push(p);f=f.concat(c);c=new ba({data:f,idProperty:"id"});a.layersSelect.set("store",c);a.layersSelect.set("value",p.name)}else{f=a.layersSelect.getOptions();
if(a.widget.useArcGISComponents&&(a.widget.showBrowseLayers||a.widget.showReadyToUseLayers))c=2;else if(a.widget.showBrowseLayers&&a.widget.showReadyToUseLayers)c=3;else if(a.widget.showBrowseLayers||a.widget.showReadyToUseLayers)c=2;c=f.splice(f.length-c,c);a.layersSelect.removeOption(c);f=a.layers.length;a.posIncrement&&(f+=a.posIncrement);f=""+f;c.unshift({value:f,label:e.title,selected:!0});a.layersSelect.addOption(c);a.layersSelect.set("value",f)}k&&(e.lyr=k,k.name=e.name);e.linfo=d;a.layers.push(e);
if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||l||b)this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",g.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,layerInfo:d,item:e})})),a.widget.map.addLayer(k);a.browseDialog.browseItems&&a.browseDialog.browseItems.clear()}if(h.isDefined(a)&&h.isDefined(a.item)&&h.isDefined(a.layersSelect)&&h.isDefined(a.layers)&&
h.isDefined(a.browseDialog)){a.browseDialog.hide&&a.browseDialog.hide();var c,e,f,k,r,p;(c=!a.item.selectedLayer&&a.item.url?a.item.type===v.IS?a.item.url:a.item.url+"/0":a.item.selectedLayer.url)&&-1!==window.location.protocol.indexOf("https:")&&(c=c.replace("http:","https:"));e={url:c,itemId:a.item.id,title:a.item.title,type:a.item.type,analysisReady:!0};c=q.some(a.layers,function(b,c){var d=b.analysisReady&&e.analysisReady&&b.itemId===e.itemId;a.item.selectedLayer&&a.item.selectedLayer.url&&(d=
b.itemId&&e.itemId?b.itemId===e.itemId&&b.url===e.url:b.url===e.url);d&&(f=c);return d});var l;a.browseDialog.browseItems&&B(".js-add-layer-checkbox",a.browseDialog.browseItems.infoPanel).forEach(function(a){l=a.checked});var m=-1!==a.layersSelect.baseClass.indexOf("dijitComboBox");k=new u;p="sync";if(c){a.posIncrement&&(f+=a.posIncrement);if(a.browseDialog.addlayerCheckBox&&a.browseDialog.addlayerCheckBox.get("checked")||l||b)a.posIncrement||(a.posIncrement=0),r=a.layers[f-a.posIncrement],a.widget.map.getLayer(r.lyr.id)||
(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",g.hitch(this,function(b){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:b.layer,layerInfo:r.linfo,item:r})})),a.widget.map.addLayer(r.lyr));m?a.layersSelect.set("value",a.layers[f-1].name):a.layersSelect.set("value",""+f);a.browseDialog.browseItems&&a.browseDialog.browseItems.clear();k.resolve()}else a.item.selectedLayer?(e.url=a.item.selectedLayer.url,k.then(g.hitch(this,
d)),setTimeout(function(){k.resolve(a.item.selectedLayer)},500)):(p=a.item.itemDataUrl?F({url:a.item.itemDataUrl,content:{f:"json"}}):"sync",E(p,g.hitch(this,function(a){a&&a.layers&&a.layers[0].id&&(e.url=e.url.substring(0,e.url.lastIndexOf("/0"))+"/"+a.layers[0].id);F({url:e.url,content:{f:"json"}}).then(g.hitch(this,function(a){d(a);k.resolve()}))})));return k.promise}},addReadyToUseLayerOption:function(a,b){a&&(a.showReadyToUseLayers||a.showBrowseLayers)&&(b||(b=[]),a.signInPromise||(a.signInPromise=
new u,setTimeout(g.hitch(this,function(){a.signInPromise.resolve()}),100)),a.i18n||(this.initI18n(),a.i18n=this.i18n),a.signInPromise.then(g.hitch(this,function(){q.forEach(b,function(b){var c=b.select||b;if(-1!==c.baseClass.indexOf("dijitComboBox")&&a.showBrowseLayers){if(b=c.get("store"))b.put({id:"separator",name:"separator",label:"\x3chr\x3e"}),b.put({id:"browselayers",name:"browselayers",label:a.i18n.browseLayers})}else{var d=c.getOptions();q.some(d,function(a){return"separator"===a.type},this)||
!a.showReadyToUseLayers&&!a.showBrowseLayers||c.addOption({type:"separator",value:""});this.addBrowseOptionForTool({select:c,disableLAAL:b.disableLAAL},a)}},this);a.showReadyToUseLayers&&!h.isDefined(a._browsedlg)&&(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",g.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",g.hitch(a,function(){q.forEach(b,function(a){"browse"===a.get("value")&&a.reset()});a.layersSelect&&a.layersSelect.reset()}))));
a.showBrowseLayers&&!h.isDefined(a._browseLyrsdlg)&&(a._browseLyrsdlg=this.addBrowseAnalysisDialog({widget:a,browseType:1}),a.own(a._browseLyrsdlg.on("browseitems-close",g.hitch(this,function(b){"add-layer"===b.action&&(a._browseLyrsdlg.browseItems.plugIn._grid&&(b.selection.selectedLayer=a._browseLyrsdlg.browseItems.plugIn._selectedLayer,a._handleBrowseItemsSelect({dialog:a._browseLyrsdlg,selection:b.selection})),a._browseLyrsdlg.browseItems.closeInfoPanel())})),a._browseLyrsdlg.on("hide",g.hitch(a,
function(){q.forEach(b,function(a){"browselayers"===a.get("value")&&a.reset()})}))))})))},addBrowseOptionForTool:function(a,b){var d=a.select,c=a.disableLAAL||!1,e=d.getOptions();a=[];var f=!1;if(!q.some(e,function(a){return"browselayers"===a.value||"browse"===a.value},this)){if(0<e.length&&"separator"!==e[e.length-1].type||0===e.length)a.push({type:"separator"}),f=!0;b.useArcGISComponents&&(b.showBrowseLayers||b.showReadyToUseLayers)?a.push({value:"browselayers",label:b.i18n.browseAnalysisLayers}):
(!c&&b.showReadyToUseLayers&&(c=b.i18n.browseAnalysisTitle,this._isCustomAnalysisQuery(b)&&(c=b.i18n.browseAnalysisLayers),a.push({value:"browse",label:c})),b.showBrowseLayers&&a.push({value:"browselayers",label:b.i18n.browseLayers}));(!0===f&&1<a.length||!1===f&&0<a.length)&&d.addOption(a)}},_isCustomAnalysisQuery:function(a){var b='title:"Living Atlas Analysis Layers" AND owner:esri',d=!1;a&&a.isSingleTenant&&(b='title:"Living Atlas Analysis Layers" AND owner:esri_livingatlas');a.portalSelf&&a.portalSelf.analysisLayersGroupQuery&&
a.portalSelf.analysisLayersGroupQuery!==b?d=!0:a._portal&&a._portal.analysisLayersGroupQuery&&a._portal.analysisLayersGroupQuery!==b&&(d=!0);return d},getMaxInputByMode:function(a){if(a&&a.units&&a.type&&a.limits&&a.travelMode){var b,d=a.limits.maximumBreakDistanceValue,c=a.limits.maximumBreakDistanceValueUnits,e=a.limits.maximumBreakTimeValue,f=a.limits.maximumBreakTimeValueUnits,k=this.isWalkingTravelMode(a.travelMode.travelMode);k&&(d=a.limits.maximumBreakWalkingDistanceValue,c=a.limits.maximumBreakWalkingDistanceValueUnits,
e=a.limits.maximumBreakWalkingTimeValue,f=a.limits.maximumBreakWalkingTimeValueUnits);"reachableStreets"===a.alternateLimits&&(f=this.generateLimitsForReachableStreets({limits:a.limits,isWalking:k}),d=f.driveDistanceLimit,c=f.driveDistanceUnit,e=f.driveTimeLimit,f=f.driveTimeUnit);"unreachableAreas"===a.alternateLimits&&(f=this.generateLimitsForUnreachableAreas({limits:a.limits,isWalking:k}),d=f.driveDistanceLimit,c=f.driveDistanceUnit,e=f.driveTimeLimit,f=f.driveTimeUnit);e*=this.perMinute(f);d*=
this.perMile(c);"StraightLine"===a.type?"Miles"===a.units?b=1E3:"Yards"===a.units?b=176E4:"Kilometers"===a.units?b=y.format(1609.344,{places:2}):"Meters"===a.units?b=y.format(1609344,{places:2}):"Feet"===a.units&&(b=528E4):this.isDistanceMode(a.travelMode)?"Miles"===a.units?b=d:"Yards"===a.units?b=1760*d:"Kilometers"===a.units?b=y.format(1.609344*d,{places:2}):"Meters"===a.units?b=y.format(1609.344*d,{places:2}):"Feet"===a.units&&(b=5280*d):this.isTimeMode(a.travelMode)&&("Minutes"===a.units?b=e:
"Seconds"===a.units?b=60*e:"Hours"===a.units&&(b=e/60));return"string"===typeof b?y.parse(b):parseFloat(b)}},isWalkingTravelMode:function(a){if(a&&a.restrictionAttributeNames)return a.restrictionAttributeNames.some(function(a){return"walking"===a.toLowerCase()})},isDistanceMode:function(a){return"Distance"===a.units},isTimeMode:function(a){return"Time"===a.units},generateLimitsForUnreachableAreas:function(a){var b={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};
a.isWalking?(b.driveDistanceLimit=a.limits.maximumBreakWalkingDistanceValueDetailedPolygons,b.driveDistanceUnit=a.limits.maximumBreakWalkingDistanceValueUnitsDetailedPolygons,b.driveTimeLimit=a.limits.maximumBreakWalkingTimeValueDetailedPolygons,b.driveTimeUnit=a.limits.maximumBreakWalkingTimeValueUnitsDetailedPolygons):(b.driveDistanceLimit=a.limits.maximumBreakDistanceValueDetailedPolygons,b.driveDistanceUnit=a.limits.maximumBreakDistanceValueUnitsDetailedPolygons,b.driveTimeLimit=a.limits.maximumBreakTimeValueDetailedPolygons,
b.driveTimeUnit=a.limits.maximumBreakTimeValueUnitsDetailedPolygons);return b},generateLimitsForReachableStreets:function(a){var b={driveDistanceLimit:null,driveDistanceUnit:null,driveTimeLimit:null,driveTimeUnit:null};a.isWalking?(b.driveDistanceLimit=a.limits.maximumBreakWalkingDistanceValueServiceAreaLines,b.driveDistanceUnit=a.limits.maximumBreakWalkingDistanceValueUnitsServiceAreaLines,b.driveTimeLimit=a.limits.maximumBreakWalkingTimeValueServiceAreaLines,b.driveTimeUnit=a.limits.maximumBreakWalkingTimeValueUnitsServiceAreaLines):
(b.driveDistanceLimit=a.limits.maximumBreakDistanceValueServiceAreaLines,b.driveDistanceUnit=a.limits.maximumBreakDistanceValueUnitsServiceAreaLines,b.driveTimeLimit=a.limits.maximumBreakTimeValueServiceAreaLines,b.driveTimeUnit=a.limits.maximumBreakTimeValueUnitsServiceAreaLines);return b},updateModeConstraints:function(a){var b;a&&a.validateWidget&&a.units&&a.type&&a.travelMode&&(b=a.validateWidget.get("constraints"),b.max=this.getMaxInputByMode(a),a.validateWidget.set(b))},getTravelModes:function(a){var b=
new u,d,c,e,f;h.isDefined(this.travelModes)&&0<this.travelModes.length?b.resolve(this.travelModes):a&&a.widget?a.widget.signInPromise.then(g.hitch(this,function(k){(f=a.widget.get("helperServices"))&&f.routingUtilities?(e=f.routingUtilities.url,d="sync"):d=a.widget._getSelf(a.widget.portalUrl);E(d,g.hitch(this,function(a){a&&a.helperServices&&a.helperServices.routingUtilities&&(e=a.helperServices.routingUtilities.url);h.isDefined(e)?(c=new O(e+"/GetTravelModes"),c.execute({}).then(g.hitch(this,function(a){this.travelModes=
q.map(a[0].value&&a[0].value.features,function(a){return U.fromJson(a.attributes.TravelMode)});a[1]&&a[1].paramName&&"defaultTravelMode"===a[1].paramName&&(this.defaultTravelModeId=a[1].value);b.resolve(this.travelModes)}),g.hitch(this,function(a){b.reject(a)}))):b.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(a){b.reject(a)})})):b.reject(Error("Missing parameter: params.widget required parameter"));return b.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&
a.widget){var b=[],d=a.allowmode||"all",c=!1;this.initI18n();a.addStraightLine&&b.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e",selected:a.value&&"StraightLine"===a.value});this.getTravelModes({widget:a.widget}).then(g.hitch(this,function(e){var f=h.isDefined(a.enableTravelModes)&&!a.enableTravelModes;
q.forEach(e,function(e,g){g=this.createOptionForTravelMode(e,{name:e.name,disabled:f,separator:a.separator});this.isTravelModeAllowed(d,g.units)&&("all"!==d&&(g.value=g.value.replace(g.units,"")),a.value&&a.value.id===e.id?ca(a.value,e)&&(g.selected=!g.disabled,c=!0):!a.value&&a.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===e.id&&(g.selected=!0),b.push(g))},this);!c&&this.isRequiredToAddTravelMode(a)&&this.isTravelModeAllowed(d,this.getTravelModeUnits(a.value))&&b.push(this.getOptionForCustomTravelMode(a,
f));a.selectWidget.removeOption();a.selectWidget.addOption(b);a.widget.emit("travelmodes-added",{travelOptions:b})}),g.hitch(this,function(c){b&&0<b.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(b),a.widget.emit("travelmodes-added",{travelOptions:b}))}))}},getTravelModeLabel:function(a,b){b=b?b:a.name;return'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+this.getTravelModei18nKey(a.type)+this.getTravelModeUnits(a)+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;" title\x3d"'+
a.description+'"\x3e'+b+"\x3c/div\x3e"},getTravelModeUnits:function(a){var b=a.units||name.split(/\s/)[1];return b=a.impedanceAttributeName===a.timeAttributeName?"Time":a.impedanceAttributeName===a.distanceAttributeName?"Distance":"Other"},getTravelModeValue:function(a,b){return a.replace(/\s/g,b||"")},getTravelModei18nKey:function(a){return"AUTOMOBILE"===a?"Driving":"TRUCK"===a?"Trucking":"WALK"===a?"Walking":"Other"},isTravelModeAllowed:function(a,b){return"all"===a||a.toLowerCase()===b.toLowerCase()},
isRequiredToAddTravelMode:function(a){return a.widget.rerun&&"StraightLine"!==a.value},isTrafficBasedTravelMode:function(a){var b=this.getTravelModei18nKey(a.type).toLowerCase();return"time"===this.getTravelModeUnits(a).toLowerCase()&&("driving"===b||"trucking"===b)},getOptionForCustomTravelMode:function(a,b){a=this.createOptionForTravelMode(a.value,{name:"\x26lt"+a.value.name+"\x26gt",disabled:b,separator:a.separator});a.selected=!0;return a},createOptionForTravelMode:function(a,b){return{label:this.getTravelModeLabel(a,
b.name),value:this.getTravelModeValue(b.name,b.separator),travelMode:a,disabled:b.disabled,modei18nKey:this.getTravelModei18nKey(a.type).toLowerCase(),units:this.getTravelModeUnits(a)}},updateDisplay:function(a,b,d){(new B.NodeList(a)).style("display",b?d?d:"block":"none")},isGreaterThanZero:function(){return 0<this.get("value")},getExprFunctions:function(){this.i18n||this.initI18n();this.exprFunctions||(this.exprFunctions=[{type:"NumType",label:n.substitute(this.i18n.asMetersFunc,{functionName:"as_meters(\x3ci\x3enumber\x3c/i\x3e)",
num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_meters()"},{type:"NumType",label:n.substitute(this.i18n.asKilometersFunc,{functionName:"as_kilometers(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_kilometers()"},{type:"NumType",label:n.substitute(this.i18n.asFeetFunc,{functionName:"as_feet(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_feet()"},{type:"NumType",label:n.substitute(this.i18n.asYardsFunc,{functionName:"as_yards(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),
name:"as_yards()"},{type:"NumType",label:n.substitute(this.i18n.asMilesFunc,{functionName:"as_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_miles()"},{type:"NumType",label:n.substitute(this.i18n.asNuaticalMilesFunc,{functionName:"as_nautical_miles(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"as_nautical_miles()"},{type:"NumType",label:n.substitute(this.i18n.absFunc,{functionName:"abs(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),
name:"abs()"},{type:"NumType",label:n.substitute(this.i18n.logFunc,{functionName:"log(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"log()"},{type:"NumType",label:n.substitute(this.i18n.sinFunc,{functionName:"sin(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sin()"},{type:"NumType",label:n.substitute(this.i18n.cosFunc,{functionName:"cos(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"cos()"},{type:"NumType",label:n.substitute(this.i18n.tanFunc,
{functionName:"tan(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"tan()"},{type:"NumType",label:n.substitute(this.i18n.squareRootFunc,{functionName:"sqrt(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"sqrt()"},{type:"NumType",label:n.substitute(this.i18n.minFunc,{functionName:"min(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"min()"},{type:"NumType",label:n.substitute(this.i18n.maxFunc,{functionName:"max(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),
name:"max()"},{type:"NumType",label:n.substitute(this.i18n.constrainFunc,{functionName:"constrain(\x3ci\x3enumber\x3c/i\x3e, \x3ci\x3elow\x3c/i\x3e, \x3ci\x3ehigh\x3c/i\x3e",num:"\x3ci\x3enumber\x3c/i\x3e",low:"\x3ci\x3elow\x3c/i\x3e",high:"\x3ci\x3ehigh\x3c/i\x3e"}),name:"constrain(,,)"},{type:"NumType",label:n.substitute(this.i18n.iffFunc,{functionName:"iif(\x3ci\x3econdition\x3c/i\x3e,\x3ci\x3evalue if TRUE\x3c/i\x3e,\x3ci\x3evalue if FALSE\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"iif(,,)"},
{type:"NumType",label:n.substitute(this.i18n.whenFunc,{functionName:"when(\x3ci\x3enumber\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"when(,)"},{type:"NumType",label:n.substitute(this.i18n.decodeFunc,{functionName:"decode(\x3ci\x3eexpression\x3c/i\x3e, \x3ci\x3ecase1,return1,..caseN,returnN\x3c/i\x3e, \x3ci\x3edefault\x3c/i\x3e)",num:"\x3ci\x3enumber\x3c/i\x3e"}),name:"decode(,,,)"}]);return this.exprFunctions},addAttributeOptions:function(a){this.initI18n();h.isDefined(a.allowSelectLabel)||
(a.allowSelectLabel=!0);var b,d,c,e=[],f=h.isDefined(a.emptyValue)?a.emptyValue:"";if(a.allowNumericType||void 0===a.allowNumericType)e=[m.FieldTypes.Short,m.FieldTypes.Integer,m.FieldTypes.Float,m.FieldTypes.Double];b=a.layer;d=a.selectWidget;c=b?b.fields:[];d.removeOption(d.getOptions());a.allowSelectLabel&&d.addOption({value:f,label:this.i18n.attribute});a.allowStringType&&e.push(m.FieldTypes.String);a.allowDateType&&e.push(m.FieldTypes.Date);var g=[];q.forEach(c,function(a){-1!==q.indexOf(e,a.type)&&
a.name!==b.objectIdField&&g.push({value:a.name,label:h.isDefined(a.alias)&&""!==a.alias?a.alias:a.name,type:a.type===m.FieldTypes.String?m.PseudoFieldTypes.String:a.type===m.FieldTypes.Date?m.PseudoFieldTypes.Date:m.PseudoFieldTypes.Number})},this);if(0===g.length)return!1;d.addOption(g);h.isDefined(a.priorityChange)?d.set("value",f,a.priorityChange):d.set("value",f);d.set("disabled",!b||0===b.fields.length);return!0},addStatisticsOptions:function(a){this.initI18n();var b=a.selectWidget,d=[{value:"SUM",
label:this.i18n.sum},{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum},{value:"MEAN",label:a.showGeoAnalyticsParams?this.i18n.mean:this.i18n.average},{value:"STDDEV",label:this.i18n.standardDev}],c=[{value:"MIN",label:this.i18n.minimum},{value:"MAX",label:this.i18n.maximum}],e=h.isDefined(a.emptyValue)?a.emptyValue:"";b.removeOption(b.getOptions());b.addOption([{value:e,label:this.i18n.statistic}]);a.showGeoAnalyticsParams&&(b.addOption({value:"COUNT",label:this.i18n.count}),
d.push({value:"VARIANCE",label:this.i18n.variance}),d.splice(4,0,{value:"RANGE",label:this.i18n.range}));a.type&&"number"!==a.type?a.type&&"string"===a.type?(b.addOption({value:"ANY",label:this.i18n.any}),a.selectWidget.optionsType="string"):a.type&&"date"===a.type&&(b.addOption(c),a.selectWidget.optionsType="date"):(b.addOption(d),a.selectWidget.optionsType="number");b.set("value",e)},addFillOptions:function(a){var b=a.selectWidget,d=[{value:"ZEROES",label:this.i18n.zeroes},{value:"SPATIAL_NEIGHBORS",
label:this.i18n.spatialneighbhors},{value:"SPACE_TIME_NEIGHBORS",label:this.i18n.spacetimeneighbors},{value:"TEMPORAL_TREND",label:this.i18n.temporaltrend}];b.removeOption(b.getOptions());b.addOption([{value:"0",label:this.i18n.fill}]);a.type&&"number"!==a.type||b.addOption(d)},perMeter:function(a){var b=1;switch(a){case l.MILLIMETERS:b=1E3;break;case l.CENTIMETERS:b=100;break;case l.DECIMETERS:b=10;break;case l.METERS:b=1;break;case l.KILOMETERS:b=.001;break;case l.INCHES:b=39.370079;break;case l.FEET:b=
3.2808399;break;case l.YARDS:b=1.0936133;break;case l.MILES:b=6.2137119E-4;break;case l.NAUTICAL_MILES:b=5.399568E-4;break;case l.ACRES:b=2.4710538E-4;break;case l.ARES:b=.01;break;case l.HECTARES:b=1E-4;break;case l.SQUARE_INCHES:b=1550.0031;break;case l.SQUARE_FEET:b=10.7639104;break;case l.SQUARE_YARDS:b=1.19599005;break;case l.SQUARE_MILES:b=3.86102159E-7;break;case l.SQUARE_NAUTICAL_MILES:b=2.9155335E-7;break;case l.SQUARE_MILLIMETERS:b=1E6;break;case l.SQUARE_CENTIMETERS:b=1E4;break;case l.SQUARE_DECIMETERS:b=
100;break;case l.SQUARE_METERS:b=1;break;case l.SQUARE_KILOMETERS:b=1E-6}return b},perMile:function(a){var b=1;switch(a){case "Feet":b=1.89394E-4;break;case "Yards":b=5.68182E-4;break;case "Meters":b=6.21371E-4;break;case "Kilometers":b=.621371}return b},perMinute:function(a){var b=1;switch(a){case "Seconds":b=.0166667;break;case "Hours":b=60}return b},getType:function(a){var b=null;switch(a){case l.ACRES:b=2;break;case l.ARES:b=2;break;case l.CENTIMETERS:b=1;break;case l.DECIMETERS:b=1;break;case l.FEET:b=
1;break;case l.HECTARES:b=2;break;case l.INCHES:b=1;break;case l.KILOMETERS:b=1;break;case l.METERS:b=1;break;case l.MILES:b=1;break;case l.MILLIMETERS:b=1;break;case l.NAUTICAL_MILES:b=1;break;case l.SQUARE_CENTIMETERS:b=2;break;case l.SQUARE_DECIMETERS:b=2;break;case l.SQUARE_FEET:b=2;break;case l.SQUARE_INCHES:b=2;break;case l.SQUARE_KILOMETERS:b=2;break;case l.SQUARE_METERS:b=2;break;case l.SQUARE_MILES:b=2;break;case l.SQUARE_MILLIMETERS:b=2;break;case l.SQUARE_NAUTICAL_MILES:b=2;break;case l.SQUARE_YARDS:b=
2;break;case l.YARDS:b=1;break;default:b=0}return b},unitConversion:function(a,b,d){var c=!0;h.isDefined(a)||(this.emitError("The 'From' Value must be a valid numeric value: "+a),c=!1);h.isDefined(b)||(this.emitError("The 'From' Units must be defined: "+b),c=!1);h.isDefined(d)||(this.emitError("The 'To' Units must be defined: "+d),c=!1);a instanceof Array&&(this.emitError("Only single 'From' Value supported: "+a),c=!1);b instanceof Array&&(this.emitError("Only single 'From' Units supported: "+b),
c=!1);d instanceof Array&&(this.emitError("Only single 'To' Units supported: "+d),c=!1);var e=this.getType(b),f=this.getType(d);0===e&&(this.emitError("Unsupported 'From' Units: "+b),c=!1);0===f&&(this.emitError("Unsupported 'To' Units: "+d),c=!1);e!==f&&(this.emitError("Incompatible 'From' and 'To' Units: "+b+" and "+d),c=!1);return c?b===d?+a:+a/this.perMeter(b)*this.perMeter(d):Number.NaN},emitError:function(a){console.log("error",Error(a))},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;
return A.stringify(a)===A.stringify({})},getRoutingUtilities:function(a){var b=new u,d={},c,e,f,k;a||b.reject(Error("Missing parameter: widget required parameter"));-1!==q.indexOf(["CreateDriveTimeAreas","EnrichLayer","SummarizeNearby"],a.toolName)?g.mixin(d,{toolName:"GenerateServiceAreas",serviceName:"asyncServiceArea"}):a.toolName===m.Tools.ChooseBestFacilities?g.mixin(d,{toolName:"SolveLocationAllocation",serviceName:"asyncLocationAllocation"}):"PlanRoutes"===a.toolName?g.mixin(d,{toolName:"SolveVehicleRoutingProblem",
serviceName:"asyncVRP"}):"FindNearest"===a.toolName?g.mixin(d,{toolName:"FindClosestFacilities",serviceName:"asyncClosestFacility"}):"ConnectOriginsToDestinations"===a.toolName&&g.mixin(d,{toolName:"FindRoutes",serviceName:"asyncRoute"});this.routingUtilities||(this.routingUtilities={});this.routingUtilities&&this.routingUtilities[a.toolName]?b.resolve(this.routingUtilities[a.toolName]):a.signInPromise.then(g.hitch(this,function(l){(k=a.get("helperServices"))&&k.routingUtilities?(f=k.routingUtilities.url,
c="sync"):c=a._getSelf(a.portalUrl);E(c,g.hitch(this,function(c){c&&c.helperServices&&c.helperServices.routingUtilities&&(f=c.helperServices.routingUtilities.url);h.isDefined(f)||b.reject(Error("Missing Routing Utility Service to get Network Analysis Service Limits."));e=new O(f+"/GetToolInfo");e.execute(d).then(g.hitch(this,function(c){c&&0<c.length&&c[0].value?(this.routingUtilities[a.toolName]=c[0].value,b.resolve(c[0].value)):b.reject("Routing Utility Service 'GetToolInfo' job did not return service limits.")}),
function(a){b.reject(a)})}))}),function(a){b.reject(a)});return b.promise},getNetworkAnalysisLimits:function(a){var b=new u;a||b.reject(Error("Missing parameter: widget required parameter"));this.getRoutingUtilities(a).then(g.hitch(this,function(a){a.serviceLimits?b.resolve(a.serviceLimits):b.reject()}),function(a){b.reject(a)});return b.promise},isEsriWorldGeocoder:function(a){var b=this.isAgoWorldGeocodeServer(a);a=this.isAgoWorldGeocodeServerProxy(a);return b||a},isAgoWorldGeocodeServer:function(a){return a&&
!!a.match(/(arcgis.com\/arcgis\/rest\/services\/world\/geocodeserver).*/ig)},isAgoWorldGeocodeServerProxy:function(a){return a&&!!a.match(/(\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/ig)},isWorldGeoLocator:function(a){return a&&!!a.match(/(\/rest\/services\/world\/geocodeserver).*/ig)},showMessages:function(a,b,d){D.set(b,"innerHTML",a);I.fadeIn({node:d,easing:K.quadIn,onEnd:g.hitch(this,function(){x.set(d,{display:""})})}).play()},hideMessages:function(a){I.fadeOut({node:a,easing:K.quadOut,
onEnd:function(){x.set(a,{display:"none"})}}).play()},getHelpUrl:function(a){if(a.topic&&a.widget){var b;a.widget.portalSelf&&a.widget.portalSelf.helpBase?b=a.widget.portalSelf.helpBase+"index.html#":!a.widget.isSingleTenant||a.widget.portalSelf&&a.widget.portalSelf.helpBase||(b="http://server.arcgis.com/en/portal/latest/use/");"BufferExpression"===a.topic&&(b+="Use_expressions_with_GeoAnalytics_Tools/019300000183000000/");return b}},isPCS:function(a){return!!a&&!!P&&-1!==q.indexOf(P,a)},isPCSByLayerType:function(a){var b=
!!a&&!!a.fullExtent&&this.isPCS(a.fullExtent.spatialReference.wkid);!b&&a.extent&&(b=!!a&&!!a.extent&&this.isPCS(a.extent.spatialReference.wkid));!b&&a.spatialReference&&(b=!!a&&!!a.spatialReference&&this.isPCS(a.spatialReference.wkid));return b},checkPCSforAnalysis:function(a){var b=a.widget&&a.widget.toolName,d=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&this.isPCS(a.widget.context.processSR.wkid),c=!0,e=a.jobParams||a.widget.jobParams,f,k,h=!!a.widget&&!!a.widget.context&&!!a.widget.context.processSR&&
!!a.widget.context.processSR.wkid;if(!b||!e||!a.widget.showGeoAnalyticsParams)return!1;k="\x3ca  href\x3d'#' id\x3d'"+a.widget.id+"_warn_settings_link'\x3e"+a.widget.i18n.analysisSettings+"\x3c/a\x3e\x3cdiv class\x3d'esriAnalysisSettingsIcon'\x3e\x3c/div\x3e";f=n.substitute(a.widget.i18n.PCSReqMsg,{defaultSpatialRef:a.widget.i18n.worldCylindrical,settingsIcon:k});"FindHotSpots"!==b&&"FindPointClusters"!==b||d?"CalculateDensity"!==b&&"FindPointClusters"!==b&&"GeographicallyWeightedRegression"!==b||
d?"AggregatePoints"!==b||-1===q.indexOf(["HEXAGON","SQUARE"],e.binType)||d?"SummarizeWithin"===b&&e.summaryPolygons&&!d?c=this.isPCSByLayerType(a.widget.sumWithinLayer):"SummarizeWithin"!==b||-1===q.indexOf(["HEXAGON","SQUARE"],e.binType)||d?"JoinFeatures"===b&&e.spatialNearDistance&&"Near"===e.spatialRelationship&&!d?(c=this.isPCSByLayerType(a.widget.targetLayer))||(f=n.substitute(a.widget.i18n.JFPCSReqMsg,{settingsIcon:k})):"BuildMultiVariableGrid"!==b||d||(c=q.every(a.inputLayers,function(a){return this.isPCSByLayerType(a)},
this)):c=this.isPCSByLayerType(a.widget.summaryLayer):c=this.isPCSByLayerType(a.widget.pointLayer):c=this.isPCSByLayerType(a.widget.inputLayer):(c=this.isPCSByLayerType(a.widget.analysisLayer),"FindPointClusters"!==b||c||(f=n.substitute(a.widget.i18n.FPCSReqMsg,{settingsIcon:k})));c||a.hasPCSWarnShown||(a.widget.set("disableRunAnalysis",c),this.settingsVM&&this.settingsDlg&&a.widget._bodyNode&&a.widget._errorMessagePane&&(this.showMessages(f,a.widget._bodyNode,a.widget._errorMessagePane),L.byId(a.widget.id+
"_warn_settings_link")&&M(L.byId(a.widget.id+"_warn_settings_link"),"click",g.hitch(a.widget,a.widget.showSettingsDlg))));!c&&a.hasPCSWarnShown&&h&&(c=!0);return c},tryParseJSON:function(a){try{var b=A.parse(a);if(b&&"object"===typeof b&&null!==b)return b}catch(d){}return!1},decodeTag:function(a){return{"\x26lt;":"\x3c","\x26gt;":"\x3e"}[a]||a},stringDecode:function(a){return a.replace(/(&lt;|&gt;)/g,this.decodeTag)},jobParamsToWidgetProps:function(a){if(a&&a.jobParams){var b=a.jobParams,d=new u,
c=[],e=[],f;for(f in b){var k;b.hasOwnProperty(f)&&("string"===typeof b[f]&&-1!==b[f].search(/(&lt;|&gt;)/g)&&(b[f]=this.stringDecode(b[f])),k="string"===typeof b[f]?this.tryParseJSON(b[f]):b[f])&&(-1!==f.toLowerCase().indexOf("layer")&&"object"===typeof k?e.push({key:f,obj:k}):k&&(k.Raster||k.url)&&e.push({key:f,obj:k}),b[f]=k)}for(f=0;f<e.length;f++){k=e[f].obj;var h=e[f].key;"object"===typeof k&&k.length?(b[h]=[],q.forEach(k,function(a,d){this._getFlayers(a,h,b,c,!0,d)},this)):"object"===typeof k&&
k.Raster?(k.url=k.Raster.url,this._getFlayers(k,h,b,c,!0,"Raster")):this._getFlayers(k,h,b,c)}Y(c).then(g.hitch(this,function(){d.resolve(a)}),g.hitch(this,function(){d.resolve(a)}));return d.promise}},_getLayerType:function(a){return a?-1!==a.indexOf("BigDataCatalogServer")?v.BIGDATA:-1!==a.indexOf("ImageServer")?v.IS:v.FS:null},_getFlayers:function(a,b,d,c,e,f){var k,h;a.url?(k=F({url:a.url,content:{f:"json"}}),h=new u,c.push(h),k.then(g.hitch(this,function(a,b,c,f,k){var h,l=this._getLayerType(a.url);
l===v.FS?(h=new C(a.url,{mode:C.MODE_ONDEMAND,outFields:["*"],resourceInfo:k}),a.filter&&h.setDefinitionExpression(a.filter),h.filter=a.filter):l===v.BIGDATA?(h=k,g.mixin(h,a)):l===v.IS&&(k=a.Raster||a,h=new G(k.url),k.renderingRule&&h.setRenderingRule(new ka(k.renderingRule)),k.name&&(h.name=k.name),a.Raster&&a.Raster.url===a.url&&delete a.url);a.name&&(h.name=a.name);e?d[b][f]=h:e&&l===v.IS?g.mixin(d[b][f],h):d[b]=h;c.resolve()},a,b,h,f),g.hitch(this,function(a,b,c,f,g){a={name:a.name,empty:!0};
e?d[b][f]=a:d[b]=a;c.resolve()},a,b,h,f))):(c=new C(a,{outFields:["*"]}),a.name&&(c.name=a.name),e?d[b][f]=c:d[b]=c)},isLayerInLayers:function(a,b){return q.some(b,function(b){return this.isSameLayer(a,b)},this)},addBlankOption:function(a,b){b&&b.length?b.push({value:"  ",label:""}):a.addOption({value:"  ",label:""});setTimeout(g.hitch(this,this._validateSelectUI,a),100)},_validateSelectUI:function(a){a._hasBeenBlurred=!0;a.set("focused",!0);a.validate();a.set("focused",!1);a._hasBeenBlurred=!1;setTimeout(g.hitch(this,
function(){a.reset()}),1E3)},updateExpressions:function(a){a&&a.selectedInputLayers&&a.inputLayers&&a.data&&a.expressions&&(q.forEach(a.selectedInputLayers,function(b,d){q.forEach(a.inputLayers,function(a,e){a&&b&&(!b.url&&!a.url&&b.name===a.name||b.url&&a.url&&b.url===a.url)&&(b._oldIndex=d,b._newIndex=e)})}),q.forEach(a.data,function(b,d){0<d&&b&&(d=a.expressions[d-1],h.isDefined(b.layer)&&(b.layer=d&&d.layer),h.isDefined(b.selectingLayer)&&(b.selectingLayer=d&&d.selectingLayer))}),q.forEach(a.data,
function(b){var d=!1,c=!1;q.forEach(a.selectedInputLayers,function(a){h.isDefined(b.layer)&&b.layer===a._oldIndex&&!d&&(b.layer=a._newIndex,d=!0);h.isDefined(b.selectingLayer)&&b.selectingLayer===a._oldIndex&&!c&&(b.selectingLayer=a._newIndex,c=!0)},this)},this))},isBigDataTypeTobeAdded:function(a){return-1==q.indexOf(a,'type:"Big Data File Share"')?!0:!1},removeDuplicates:function(a,b){for(var d=[],c={},e=0;e<a.length;e++)c[a[e]]?c[a[e]]+=1:(d.push(a[e]),c[a[e]]=1);return b?c:d},isPoint:function(a){return a&&
a.geometryType===m.GeometryTypes.Point},isLine:function(a){return a&&a.geometryType===m.GeometryTypes.Line},isPolygon:function(a){return a&&a.geometryType===m.GeometryTypes.Polygon},isSameLayer:function(a,b){return a&&b&&(a.name&&b.name&&a.name===b.name||a.url&&b.url&&a.url===b.url)},getTimeType:function(a){return a?h.isDefined(a.timeInfo)&&h.isDefined(a.timeInfo.startTimeField)&&!h.isDefined(a.timeInfo.endTimeField)?m.TimeTypes.Instant:h.isDefined(a.timeInfo)&&h.isDefined(a.timeInfo.startTimeField)&&
h.isDefined(a.timeInfo.endTimeField)?m.TimeTypes.Interval:h.isDefined(a.time)&&h.isDefined(a.time.timeType)?a.time.timeType:!1:!1},fetchGroupForRFT:function(a){var b=new u,d=V.locale,c=d?d.substring(0,2):"en",d=this.systemRFTGroupName+" owner: ("+("en"===c?["esri_en"]:["esri_en","esri_"+c]).join(" OR ")+")";a.queryGroups({q:d},!0).then(function(a){0<a.total&&a.results?(a=a.results,a=this.findRFTLocaleGroup(a,c)||this.findRFTLocaleGroup(a,"en"),b.resolve(a)):b.resolve(null)}.bind(this));return b},
findRFTLocaleGroup:function(a,b){var d;a.some(function(a){var c=a.owner;if(c&&c.substring(c.length-2)===b)return d=a,!0});return d},updateOptions:function(a,b){if(a){for(;0<a.getOptions().length;)a.removeOption(a.getOptions());a._setDisplay("");b&&0<b.length&&a.addOption(b)}},addOptionsFromLayers:function(a){a.select&&a.layers&&(a.customOptions=a.customOptions||[],a.forbiddenLayers=a.forbiddenLayers||[],a.layers.forEach(function(b,d){this.isLayerInLayers(b,a.forbiddenLayers)||a.customOptions.push({value:d.toString(),
label:b.name,selected:a.selectedOption&&this.isSameLayer(a.selectedOption,b)})},this),this.updateOptions(a.select,a.customOptions),this.addBrowseOptionForTool({select:a.select,disableLAAL:!0},a.widget))},replaceTag:function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;"}[a]||a},safetagsReplace:function(a){return a.replace(/[<>]/g,this.replaceTag)}});W("extend-esri")&&g.setObject("dijit.analysis.utils",z,fa);return z});