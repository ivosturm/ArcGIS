// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/annotations/shape/ShapeContainer","dojo/_base/declare dojo/_base/lang dojo/sniff dojo/dom-class dojo/dom-construct ../../grid/valueField/ValueField esri/dijit/geoenrichment/utils/DeviceUtil esri/dijit/geoenrichment/utils/MathUtil esri/dijit/geoenrichment/utils/ShapeUtil ../utils/AnnotationsUtil ./ShapeThemeUtil dojo/i18n!esri/nls/jsapi".split(" "),function(r,e,t,p,k,u,f,v,q,g,w,y){var x={borderColor:"#AAAAAA",fillColor:"#AAAAAA"};return r(u,{isShape:!0,
viewModel:null,theme:null,currentFeatureIndex:null,shapeJson:null,alignParams:null,applyThemeStyle:!0,getPreviewValueFunction:null,parentWidget:null,_g:!1,_viewBox:!1,_shapeStyle:null,_shapeThemeStyle:null,_needSaveShapeThemeStyle:!0,_preserveAspectRatio:void 0,_showAsBar:!1,_showBarBackground:!1,_barBackgroundStyle:null,_isPlaceholder:!1,_angle:0,postCreate:function(){this.content=k.create("div",{"class":"shapeContainer_content"});this.fieldStyle=this.fieldStyle||{};this.fieldStyle.width=this.shapeJson.style.width;
this.fieldStyle.height=this.shapeJson.style.height;this._g=this.shapeJson.g;this._viewBox=this.shapeJson.viewBox;this._shapeStyle=this.shapeJson.style||{};this._preserveAspectRatio=this.shapeJson.preserveAspectRatio;this._isPlaceholder=this.shapeJson.isPlaceholder;this._angle=this.shapeJson.style.angle||0;this._processThemeStyle();this._showAsBar=this.shapeJson.showAsBar;this._showBarBackground=this.shapeJson.showBarBackground;this._barBackgroundStyle=this.shapeJson.barBackgroundStyle;this.inherited(arguments);
p.add(this.domNode,"esriGEShapeContainer");this.setPosition(this.shapeJson.style.left||0,this.shapeJson.style.top||0);this._updateShapeNode();this._applyRotation();this.alignParams&&g.alignAnnotationContainer(this,this.alignParams);this.onInitialized()},_processThemeStyle:function(){this.applyThemeStyle&&(this._shapeThemeStyle=w.getThemeStylesFromShapeJson(this.shapeJson,this.parentWidget.parentGrid),this._needSaveShapeThemeStyle=!!this.shapeJson.themeStyle)},getShapeStyle:function(){return e.mixin({},
this._shapeThemeStyle,this._getOwnShapeStyleForRendering())},setAngle:function(a){this._angle=v.angleTo180_180Range(Number(a)||0);this._applyRotation()},_applyRotation:function(){this._angle=0<this._angle||0>this._angle?this._angle:0;var a=t("webkit")?"webkitTransform":"transform";this.content.style[a]="rotate("+this._angle+"deg)"},_lastAlignParams:null,resize:function(a,b){a&&(this.setWidth(a.w),this.setHeight(a.h));this._updateShapeNode();this._lastAlignParams=b||this._lastAlignParams;g.alignAnnotationContainer(this,
this._lastAlignParams)},scaleProportionallyWithinParent:function(a){this.resize({w:this.getWidth()*a.xScale,h:this.getHeight()*a.yScale});this.setPosition(this._left*a.xScale,this._top*a.yScale)},getShapeBox:function(){return{w:this.getWidth(),h:this.getHeight(),l:this._left,t:this._top}},_left:0,_top:0,getLeft:function(){return this._left},getTop:function(){return this._top},setPosition:function(a,b){void 0!==a&&(this._left=a||0,this.domNode.style.left=this._left+"px");void 0!==b&&(this._top=b||
0,this.domNode.style.top=this._top+"px")},_svgNode:null,getSvgNode:function(){return this._svgNode},_updateShapeNode:function(){function a(a){function d(a){var d=q.createSVGNode(c,{width:l+"px",height:n+"px",overflow:"visible"});b._preserveAspectRatio&&d.setAttribute("preserveAspectRatio",b._preserveAspectRatio);b._g.forEach(function(a){(a=q.createNodeByAttributes(a,g,{overrideFillOpacity:!0}))&&d.appendChild(a)});var e=k.create("div",{"class":"shapeContainer_svgContainerElement"},f);e.style.left=
a*l+"px";k.place(d,e);b._svgNode=d}var f=k.create("div",{"class":"shapeContainer_svgContainer esriGEAbsoluteStretched"},b.content),g;a?(p.add(f,"shapeContainer_svgContainerBackground"),g=e.mixin({},b._barBackgroundStyle,x)):g=e.mixin({},b._shapeThemeStyle,b._getOwnShapeStyleForRendering());var h=1;b._showAsBar&&(h=a?1:b.getPreviewValueFunction?b.getPreviewValueFunction().normalizedValue:.5+.5*Math.random(),f.style.width=h*m+"px",p.add(f,"shapeContainer_svgContainerShowAsBar"));a=b._showAsBar?Math.floor(m/
l):1;a=Math.round(h*a);for(h=0;h<a;h++)d(h)}var b=this,c=this._viewBox;if(0<this._shapeStyle.borderAlpha&&0<this._shapeStyle.borderWidth){var d=this._shapeStyle.borderWidth,c=e.mixin({},this._viewBox);c.xmin=c.xmin||0;c.ymin=c.ymin||0;c.xmin-=d/4;c.ymin-=d/4;c.width+=d/2;c.height+=d/2}var m=this.getWidth(),d=this.getHeight(),f=c.width/c.height,g=Math.min(m,d*f),l,n;"none"===this._preserveAspectRatio?(l=m,n=d):(l=g,n=g/f);this.content.style.width=(this._showAsBar?m:l)+"px";this.content.style.height=
n+"px";k.empty(this.content);this._isPlaceholder?k.create("div",{"class":"shapeContainer_svgPlaceholder"},this.content):(this._showAsBar&&this._showBarBackground&&a(!0),a())},_getOwnShapeStyleForRendering:function(){return this._shapeStyle?(f.device.ie||f.device.edge)&&0<this._shapeStyle.borderWidth?e.mixin({},this._shapeStyle,{borderWidth:.5*this._shapeStyle.borderWidth}):this._shapeStyle:null},onInitialized:function(){},toJson:function(){var a={id:"shape",g:this._g,viewBox:this._viewBox,preserveAspectRatio:this._preserveAspectRatio,
isPlaceholder:this._isPlaceholder,style:e.mixin({},this._shapeStyle,{left:this._left,top:this._top,width:this.getWidth(),height:this.getHeight(),angle:this._angle}),themeStyle:this._needSaveShapeThemeStyle?this._shapeThemeStyle:void 0,showAsBar:this._showAsBar,showBarBackground:this._showBarBackground,barBackgroundStyle:this._barBackgroundStyle};return e.clone(a)}})});