// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/_ChartComparisonSupport","dojo/_base/declare ../comparison/ComparisonSelect ./utils/ChartTypes ../../dataProvider/supportClasses/ge/LocalGEChart ./dummyData/DummyGE esri/dijit/geoenrichment/utils/DomUtil dojo/i18n!esri/nls/jsapi".split(" "),function(g,h,f,k,l,e,b){function d(a,b){return a&&b&&a.StdGeographyLevel===b.StdGeographyLevel&&a.StdGeographyID===b.StdGeographyID}b=b.geoenrichment.dijit.ReportPlayer.ChartContainer;return g(null,{comparisonSelect:null,
_comparisonAttributes:null,_additionalAttributes:null,_ge:null,_stdPolygonsController:null,_initChartComparisonSelect:function(){var a=this;this._additionalAttributes=[];e.hide(this.comparisonSelectBlock);if(this._currentComparisonInfo){this._updateComparisonLabel();var m=this._getGeoenrichment().getData().features;this.comparisonSelect=(new h({defaultLevelId:this._currentComparisonInfo.defaultLevel,fields:this._getGeoenrichment().getAttributeFields(),canAddFeatures:this._canAddRemoveFeatures(),addFeatureMessage:b.addToChart,
featureIsAlreadyAddedMessage:b.alreadyAdded,canRemoveFeatures:this._canAddRemoveFeatures(),removeFeatureMessage:b.removeFromChart,onFeatureSelected:function(b,d,c){a._setComparisonAttributes(c)},isFeatureAdded:function(b,e,c){return d(a._comparisonAttributes,c)||a._additionalAttributes.some(function(a){return d(a,c)})},canRemoveFeature:function(b,e,c){return!d(a._comparisonAttributes,c)},onAddFeature:function(b,d,c){a._additionalAttributes.push(c);a._updateSeries();a._syncWithShownFeatures()},onRemoveFeature:function(b,
e,c){a._additionalAttributes=a._additionalAttributes.filter(function(a){return!d(a,c)});a._updateSeries();a._syncWithShownFeatures()}})).placeAt(this.comparisonSelectDiv);this.own(this.comparisonSelect);this.comparisonSelect.setFeatures(m);this.comparisonSelect.setDefaultValue();this._comparisonAttributes=this.comparisonSelect.getSelectedAttributes();this.comparisonSelect.get("options").length?(e.show(this.comparisonSelectBlock),e.enableContent(this.comparisonSelectBlock,!!this.viewModel.dynamicReportInfo),
this.viewModel.dynamicReportInfo&&(this._stdPolygonsController=this.viewModel.getStdPolygonsController(this._currentComparisonInfo.calculatorName,this.currentFeatureIndex),this.own(this._stdPolygonsController),this._syncWithShownFeatures())):(this.comparisonSelect.destroy(),this._currentComparisonInfo=null)}},_canAddRemoveFeatures:function(){return this._isMultiFeatureChart&&!f.isLineLike(this._currentChartType)},_updateComparisonLabel:function(){if(this._currentComparisonInfo){var a;a=this._canAddRemoveFeatures()?
b.selectOrAddGeographyToCompare:this._tableViewInfo?b.compareWith:f.isColumnBarLike(this._getComparisonChartType())?b.comparisonLabelBars:b.comparisonLabelDots;this.comparisonLabel.innerHTML=a;this.comparisonLabel.style.color=this.viewModel.getDocumentDefaultStyles(this.theme).color}},_syncWithShownFeatures:function(){if(this._stdPolygonsController){this._stdPolygonsController.setAttributeFields(this._getGeoenrichment().getAttributeFields());var a=this._getGeoenrichment().getAllGeographyAttributes({ignoreFilters:!0});
this._stdPolygonsController.setShownFeatureAttributes(this._getComparisonFeatureAttributes());this._stdPolygonsController.setAllFeatureAttributes(a)}},_getComparisonChartType:function(){return this._currentComparisonInfo&&this._currentComparisonInfo.chartType||this._currentChartType},_getGeoenrichment:function(){return this._currentComparisonInfo?this._ge?this._ge:this._ge=this.viewModel.dynamicReportInfo?new k(this._originalSeriesItems,this._currentComparisonInfo.calculatorName,this.viewModel.dynamicReportInfo.fieldData.areaData,
this._isMultiFeatureChart,this.viewModel.dynamicReportInfo.analysisAreas.map(function(a){return a.shortName||a.name}),this.currentFeatureIndex):this._createDummyGE():null},_createDummyGE:function(){return l.getInstance()},_setFilterRangesForComparison:function(a){if(!this._currentComparisonInfo)return!1;this._getGeoenrichment().setFilterRanges(a);a=this._getGeoenrichment().getData().features;this.comparisonSelect.setFeatures(a);this.comparisonSelect.setDefaultValue();this._setComparisonAttributes(this.comparisonSelect.getSelectedAttributes());
e[this.comparisonSelect.get("options").length?"show":"hide"](this.comparisonSelectBlock);return!0},_setComparisonAttributes:function(a){this._comparisonAttributes=a;this.comparisonSelect.get("options").length?d(this.comparisonSelect.getSelectedAttributes(),this._comparisonAttributes)||this.comparisonSelect.setSelectedAttributes(this._comparisonAttributes):this._comparisonAttributes=null;a=this._updateSeries();this._syncWithShownFeatures();return a},_getComparisonFeatureAttributes:function(){if(!this._currentComparisonInfo)return null;
var a=this._additionalAttributes.filter(function(a){return 0<=this.comparisonSelect.getFeatureIndexById(a.StdGeographyLevel,a.StdGeographyID)},this),b=this._comparisonAttributes&&a.some(function(a){return d(a,this._comparisonAttributes)},this),a=a.slice();!b&&this._comparisonAttributes&&a.push(this._comparisonAttributes);return a},_getNumComparisonFeatures:function(){var a=this._getComparisonFeatureAttributes();return a&&a.length||0}})});