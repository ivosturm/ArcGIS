// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/columnBarLine/_LineChartSeriesCalculator","dojo/_base/lang ../../ThemeCalculator ../../ChartTypes ../../ChartLineStyles ../../ChartLineMarkers ../../AxisUtil ../utils/TooltipInfoBuilder ../ChartPlots esri/dijit/geoenrichment/utils/ColorUtil ./_AxisBuilder ./_PointLabelUtil ./_StatsBuilder".split(" "),function(H,g,G,z,w,I,J,K,x,L,F,M){var N={calcLineStyle:function(a,A,f,e){var b=e.comparisonInfo,B=e.themeSettings,c=e.visualProperties,
r=a.lineThickness||c.lineThickness||1,l=1,E=1,v=1;c.fillLineArea?(l="number"===typeof c.lineOpacity?c.lineOpacity:c.lineAreaOpacity,E=c.lineAreaOpacity):"number"===typeof c.lineOpacity&&(l=c.lineOpacity);f=g.calcColorForPoint({point:null,seriesItem:a,pointIndex:0,seriesIndex:A,numSeries:f.length,chartType:G.LINE,themeSettings:B,isComparisonSeries:a.isComparisonSeries,comparisonInfo:b,isMultiFeature:e.isMultiFeatureChart});1>l&&f&&(f=x.toColor(f),f.a=l);var B=a.lineStyle||z.SOLID,d,h,y,p=a.lineMarkerSize,
t=x.toColor(a.fillColor||f);t.a=E;y=x.toColor(a.lineMarkerColor||f);y.a=l;v="number"===typeof c.lineMarkersFillOpacity?c.lineMarkersFillOpacity:E;c=x.toColor(a.lineMarkerFillColor||t);c.a=v;a.isComparisonSeries&&b?(b.lineThickness&&(r=b.lineThickness),b.lineStyle&&(B=b.lineStyle),b.lineMarkerSize&&(p=b.lineMarkerSize),b.lineMarker?(h=w.getMarkerPath(b.lineMarker),d=w.getMarkerPath(b.lineMarker,p)):(h=g.getComparisonSymbol(),d=g.getComparisonSymbol(p)),b.lineMarkerColor&&(y=x.toColor(b.lineMarkerColor),
y.a=l),b.lineMarkerFillColor&&(c=x.toColor(b.lineMarkerFillColor),c.a=E)):e.viewModel.isGraphicStyle&&(h=a.lineMarker&&w.getMarkerPath(a.lineMarker)||w.getMarkerPathAt(A),d=a.lineMarker&&w.getMarkerPath(a.lineMarker,p)||w.getMarkerPathAt(A,p));return{lineColor:f,width:r,style:z.toGFXValue(B),marker:d,unscaledMarker:h,markerColor:y,markerFillColor:c,fillColor:t}}};return{calcSeriesLine:function(a){var A=a.chart,f=a.chartType,e=a.visualProperties,b=a.seriesItems,w=1===b.length,c=a.seriesItemsWithComparison||
b,r=a.isSecondaryPlot,l=a.reverseXY||f===G.VERTICAL_LINE,x=a.comparisonInfo,b=a.themeSettings,v=a.viewModel,d=[],h=new M({visualProperties:e,seriesItems:c,viewModel:v,currentFeatureIndex:a.currentFeatureIndex,isMultiFeatureChart:a.isMultiFeatureChart,comparisonFeatureAttributes:a.comparisonFeatureAttributes,chartType:f,isSecondaryPlot:r,oppositeDirections:a.oppositeDirections,excludedSeriesHash:a.excludedSeriesHash}),y=a.primaryPlotStat&&a.primaryPlotStat.pointIndexToTooltipsHash||{},p=h.getTotalStats();
c.forEach(function(b,C){if(b.points.length){var m=N.calcLineStyle(b,C,c,a),g={name:b.label,data:[],isComparisonSeries:b.isComparisonSeries,params:{plot:r?K.SECONDARY:void 0,fill:e.fillLineArea?m.fillColor:"transparent",stroke:{color:m.lineColor,width:m.width,style:m.style},marker:m.marker,unscaledMarker:m.unscaledMarker,markerStroke:{color:m.markerColor,width:m.width,style:z.toGFXValue(z.SOLID)},markerFill:e.fillLineMarkers?m.markerFillColor:"transparent",outline:!1}},n=h.gettatisticsForSeriesAt(C);
b.points.forEach(function(k,d){function m(){return r&&!a.oppositeDirections&&2===a.primarySeries.length?0===C?-.15:.15:0}if(!k.hidden){var h=n.values[d],t=h.value,z=t||0,D=d+1;r||F.updatePointIndexToLabelMap(A,D,C,k,v);var u=a.isMultiFeatureChart&&p.crossSeriesStats[d],q={originalValue:t,isUnavailableData:isNaN(t),unsortedIndex:d,originalIndex:k.originalIndex||d,name:F.getPointLabel(k,v),valuesSumsInSeries:n.absSumInSeries,seriesItem:b,seriesIndex:C,point:k,isBenchmarked:h.isBenchmarked,unbenchmarkedValue:h.ownValue};
l?(q.x=z*(r&&a.oppositeDirections&&1===C?-1:1),q.y=D+m(),q.valueProp="x"):(q.x=D+m(),q.y=z*(r&&a.oppositeDirections&&1===C?-1:1),q.valueProp="y");e.showValuesAsWeightInStack?q[l?"x":"y"]=n.weightsInStack?100*n.weightsInStack[d]:0:e.yAxis.showValuesAsWeightsInSeries&&(q[l?"x":"y"]/=n.absSumInSeries/100);k=J.getTooltipInfo({yValue:t,pointLabel:F.getPointLabel(c[0].points[d]||k,v),seriesLabel:b.label,minInSeriesValue:n.minInSeries,maxInSeriesValue:n.maxInSeries,sumInSeriesValue:n.sumInSeries,absSumInSeriesValue:n.absSumInSeries,
avgInSeriesValue:n.avgInSeries,weightInStack:n.weightsInStack&&n.weightsInStack[d],minInAreasValue:u&&u.min,maxInAreasValue:u&&u.max,sumInAreasValue:u&&u.sum,absSumInAreasValue:u&&u.absSum,avgInAreasValue:u&&u.avg,visualProperties:e,chartType:f,isMultiFeature:a.isMultiFeatureChart,conditionalStyling:null,fieldInfo:k.fieldInfo,isThisAreaSpecific:x&&!a.isMultiFeatureChart?!b.isComparisonSeries:void 0,isThisAreaSingleSeries:w,decimals:k.value&&k.value.decimals,fill:g.params.markerFill,stroke:g.params.markerStroke.color,
marker:g.params.unscaledMarker||g.params.marker,isBenchmarked:h.isBenchmarked,unbenchmarkedValue:h.ownValue});var B=y[D]=y[D]||[];B.push(k);k.getGroup=function(){return B};q.tooltip=k;g.data.push(q)}});d.push(g)}},this);if(r){if(a.primaryPlotStat&&(a.primaryPlotStat.minYValue=Math.min(p.minYValue,a.primaryPlotStat.minYValue),a.primaryPlotStat.maxYValue=Math.max(p.maxYValue,a.primaryPlotStat.maxYValue),b=I.getPrettifyYAxisParameters(a.primaryPlotStat.minYValue,a.primaryPlotStat.maxYValue,{baseLineValue:e.yAxis.baseLineValue,
renderColumnBarsInOppositeDirections:a.oppositeDirections,previewBelowZero:!v.dynamicReportInfo,nonZeroInclusive:e.yAxis.nonZeroInclusive}),H.mixin(A.axes.y.opt,{majorTickStep:b.majorTickStep,minorTickStep:b.minorTickStep,min:b.min,max:b.max})),1===a.primarySeries.length){var t=l?"y":"x",g=[];a.primarySeries[0].data.forEach(function(a){var b=d[0].data[a.unsortedIndex];b[t]=a.x;g.push(b)});d[0].data=g}}else L.prettifyYAxis(p.minYValue,p.maxYValue,A,e,f,b,v);return d}}});