// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/utils/ChartDataUtil",["../../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoRenderer","esri/dijit/geoenrichment/utils/ObjectUtil","../../ChartTypes","esri/dijit/geoenrichment/ReportPlayer/countryConfig"],function(k,l,m,v){function p(a){return q||(a&&a.yAxis&&a.yAxis.nonZeroInclusive?w:x)}var f={formatNumber:function(a,b,e,h){a=a||0;b={places:b.dataLabelsDecimals||0,preserveTrailingZeroes:!0};if(h)return l.formatNumberAsCurrency(a,
v.getCurrencyFormat(),b);a=l.formatNumber(a,b);e&&(a+="%");return a},undefinedToDefault:function(a,b){return void 0===a?b:a}},q,x=[1E3,1100,1200,150,70,900,110,300,80,200,1700],w=[1E3,1100,1250,1200,1050,990],r=[1,.7,1.2,.5,1.1,1.3,.3,2,.4],t=[.91,.92,.9,1.2,1.2,1.3];f.CHART_DATA_SMOOTH=[1145,1134,1159,1275,1404,1408,1337,1149,1074,1040,1065,1078,964,798,531,360,254,258];f.getPointValue=function(a){var b=a.point,e=a.index,h=a.seriesIndex,g=a.chartType,c=a.visualProperties,n=a.viewModel,y=a.currentFeatureIndex,
d=a.chartData,f=a.isComparisonSeries,u=a.comparisonFeatureAttribute;a=a.numPoints;if(b.value&&(b.value.value||n.dynamicReportInfo))return b.value.value;if(n.dynamicReportInfo)d=f?u&&u[b.fieldInfo.name]||0:k.getFieldDataValue(b.fieldInfo,n.dynamicReportInfo.fieldData,y),d=l.parseNumber(d),isNaN(d)&&console.log("Can't render chart value for field \x3d\x3e "+(b.fieldInfo?b.fieldInfo.name:"missing field"));else if(b=b.fieldInfo&&b.fieldInfo.statefulName&&b.fieldInfo.statefulName.charAt(0),d=d||p(c),d=
d[e%d.length],g===m.GAUGE&&"p"!==b&&c.gaugeRangeMax)a=c.gaugeRangeMin||0,d=.425123*(c.gaugeRangeMax-a)+a;else if(g===m.WAFFLE)"p"===b||"number"!==typeof c.waffleRangeMin&&"number"!==typeof c.waffleRangeMax?a&&(d="p"===b?90.85/a:d/a):(e=c.waffleRangeMin,c=c.waffleRangeMax,"number"===typeof e&&"number"!==typeof c?c=0===e?1E3:e*((1<a?a:2)+1):"number"!==typeof e&&"number"===typeof c&&(e=0),d=.9085*(c-e)/(a||1)+e);else if(d*=r[h%r.length]*(0===h?1:t[e%t.length]),!c.conditionalStyling){a=d;if("p"===b||
c.dataLabelsShowValuePercentSymbol||c.yAxis&&c.yAxis.showPercentSymbol||c.yAxis&&c.yAxis.showValuesAsWeightsInSeries)a=Number((a/24.5123).toFixed(c.dataLabelsDecimals||1));"i"===b&&(a=Number((a/7).toFixed(c.dataLabelsDecimals||1)));d=a}return d};f.getCaptionValue=function(a,b){return a.captionFieldInfo?b.dynamicReportInfo?k.getFieldDataValue(a.captionFieldInfo,b.dynamicReportInfo.fieldData):k.renderFieldInfoInTableCell(a.captionFieldInfo).formattedValue:""};f.allowNegativeValuesInPreview=function(a,
b){return m.supportsNegativeValues(a)&&!b.isStacked&&!b.renderColumnBarsInOppositeDirections};f.getChartData=function(a){function b(){g=Infinity;c=-Infinity;h.forEach(function(a){g=Math.min(g,a);c=Math.max(c,a)})}function e(a,b,e){var d=c-g,f=g;g=isFinite(a)?a:Math.min(0,g);c=isFinite(b)?b:c>=g?c:2*g;e&&(a=.1*(c-g),g+=a,c-=a);var k=(c-g)/d;h=h.map(function(a){return(a-f)*k+g})}var h=a.chartData,h=(h||p(a.visualProperties)).slice();h.length=Math.min(h.length,a.numPoints);var g,c;if(a.filterRangesStats)return b(),
e(a.filterRangesStats.min,a.filterRangesStats.max,!0),h;if(a.conditionalStats){b();var f=a.conditionalStats.min;a=a.conditionalStats.max;e(0===f?-10:0>f?1.2*f:.8*f,0===a?10:0>a?.8*a:1.2*a,!1)}return h};f.setPreviewChartData_dev=function(a){q=a};return f});