// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/waffle/_SeriesCalculator","../../ThemeCalculator ../../ChartTypes ../../ChartJsonUtil ../../../../supportClasses/conditionalStyling/ConditionalStyleUtil ../../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder ../utils/ChartDataUtil ../utils/TooltipInfoBuilder".split(" "),function(u,h,D,v,E,w,F){return{calcSeries:function(b){var x=b.seriesItems,f=h.WAFFLE,G=b.themeSettings,H=b.viewModel,d=b.visualProperties,I=b.currentFeatureIndex;
b=[];var y=x[0],z={name:"data",data:[]},k=[],l=0,A=0,m=1E6,n=-1E6,B,c=y.points;1===c.length&&(c=c.slice(),c.push(D.getWaffleOthersPoint()));if(h.isConditionalStylingSupported(f)&&d.conditionalStyling){var C=v.getStatistics(d.conditionalStyling);B=C&&w.getChartData({conditionalStats:C,numPoints:c.length})}var J=c.every(function(a){return!a.fieldInfo||E.isFieldInfoInPercentState(a.fieldInfo)}),p=0>d.waffleRangeMin;c.forEach(function(a,b){b<c.length-1?(a=w.getPointValue({point:a,index:b,seriesIndex:0,
maxValue:!1,chartType:f,visualProperties:d,viewModel:H,currentFeatureIndex:I,chartData:B,numPoints:c.length}),p=p||0>a):(a=k.reduce(function(a,c){return a+c},0),a=d.waffleRangeMax?Math.max(0,d.waffleRangeMax-a):J?Math.max(0,100-a):0);a=(k[b]=a)||0;l+=a;A+=Math.abs(a);m=Math.min(m,a);n=Math.max(n,a)});var K=l/c.length;c.forEach(function(a,b){var g=b===c.length-1,q=k[b],r=q||0,e;h.isConditionalStylingSupported(f)&&d.conditionalStyling&&(e=(e=v.getConditionalStyle(r,d.conditionalStyling))&&e.backgroundColor,
g&&!d.waffleConditionalStylingOthers&&(e=void 0));e=e||u.calcColorForPoint({point:a,seriesItem:y,pointIndex:b,isOthersPoint:g,seriesIndex:0,numSeries:x.length,chartType:f,themeSettings:G});var t=r;g||d.waffleRangeMin&&(t=Math.max(0,t-d.waffleRangeMin));z.data.push({originalValue:q,x:1,y:t,isUnavailableData:isNaN(q),valueProp:"y",unsortedIndex:b,name:a.label,point:a,fill:e,icon:u.calcIconForPoint(a,e,f),fieldInfo:a.fieldInfo||c[0].fieldInfo,seriesIndex:0,isOthersPoint:g,tooltip:F.getTooltipInfo({yValue:r,
pointLabel:a.label,seriesLabel:null,minInSeriesValue:m,maxInSeriesValue:n,sumInSeriesValue:l,absSumInSeriesValue:A,avgInSeriesValue:K,visualProperties:d,chartType:f,conditionalStyling:d.conditionalStyling,fieldInfo:a.fieldInfo||c[0].fieldInfo,decimals:a.value&&a.value.decimals,hasNegativeValues:p,fill:e}),stroke:{width:0}})});b.push(z);return b}}});