// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/infographics/comparison/jsonBuilder/_StatsCollector",["dojo/_base/lang","../../../comparison/ComparisonListUtil","esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/stdGeographies/StdGeographiesUtil"],function(t,u,v){var p={getStats:function(f,d,e,b,c){var g=[],m=[],k=[],h=0,l=0,w=1<d.length?"shortName":"name";d.forEach(function(a,c){var n=t.mixin({},a.data);f&&(g.push(n),n.StdGeographyName=b&&b[c][w],n.__thisAreaIndex=c);m=m.concat(a.comparisonLevels)});
d=p._comparisonLevelsToGroups(m);var a=d.groups,h=h+g.length;a.forEach(function(a){h+=a.features.length});c=p._collectRangesAndFilterAttributes(g,a,c);var q=g.filter(function(a){return!!a}).length,l=l+q;a.forEach(function(a){l+=a.features.length});var r={};a.forEach(function(a){a.cache={};a.features.forEach(function(b){a.cache[b.attributes.StdGeographyID]=b});var b=a.cache[e[a.levelId]]||a.features[0];k.push(b&&b.attributes);b&&(r[a.levelId]=a)});return{ranges:c,thisAreas:g,shownGeographiesInGroup:k,
groups:r,numThisAreas:q,numAreasTotal:h,numAreasShown:l,allGeographies:d.features.map(function(a){return a.attributes})}},_comparisonLevelsToGroups:function(f){var d=[],e=[];f.forEach(function(b){if(b.StdGeographyID){var c=b.StdGeographyID+";"+b.StdGeographyLevel+";"+b.StdGeographyName+";";d[c]||(d[c]=!0,b.StdGeographyName&&(c=v.getAreaName(b),c!==b.StdGeographyName&&(b.StdGeographyName=c)),e.push({attributes:b}))}else console.log("Error: Can't add a feature to a group.")});return{features:e,groups:u.getFeatureGroups(e)}},
_collectRangesAndFilterAttributes:function(f,d,e){function b(b){k.forEach(function(a){var c=b[a.fieldName];isNaN(c)||(a.min=Math.min(a.min,c),a.max=Math.max(a.max,c),a.dataArray.push(c))})}function c(b){return!k.some(function(a){var c=e[a.fieldName];a=b[a.fieldName];return c&&(a<c.min||a>c.max)})}var g;e&&(g={},e.forEach(function(b){g[b.fieldName]=b}),e=g);var m=f[0]||d[0]&&d[0].features[0]&&d[0].features[0].attributes,k=[],h;for(h in m)if("__thisAreaIndex"!==h){var l=m[h];"number"!==typeof l||isNaN(l)||
k.push({fieldName:h,min:Infinity,max:-Infinity,dataArray:[]})}f.forEach(function(d,a){b(d);e&&!c(d)&&(f[a]=void 0)});d.forEach(function(d){d.features=d.features.filter(function(a){b(a.attributes);return!e||c(a.attributes)})});return k},applyFieldsToRanges:function(f,d){var e={};f.forEach(function(b){e[b.name]=b});return d.filter(function(b){var c=e[b.fieldName];if(!c)return!1;b.alias=c.label;b.decimals=c.decimals;return!0})}};return p});