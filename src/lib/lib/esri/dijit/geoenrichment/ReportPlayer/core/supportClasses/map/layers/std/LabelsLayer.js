// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/std/LabelsLayer","dojo/_base/Color dojo/_base/declare dojo/_base/lang esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/symbols/TextSymbol esri/graphic esri/geometry/Polygon esri/geometry/Point esri/dijit/geoenrichment/utils/InvokeUtil".split(" "),function(v,e,w,x,y,n,z,A,t,B){function c(a){return C[a]||"#005500"}function g(a){return{fontSize:13,fontFamily:"Arial",isBold:!1,isItalic:!1,isUnderlined:!1,color:c(a)}}
function u(a){var f=(new n).setColor(new v(a.color));f.font.setSize(a.fontSize+"px");f.font.setFamily(a.fontFamily);f.font.setStyle(a.isItalic?"italic":"normal");f.font.setWeight(a.isBold?"bold":"normal");f.font.setDecoration(a.isUnderlined?"underline":"none");return f}var C={"US.States":"#000000","US.Counties":"#40B25F","US.ZIP5":"#B8482C","US.Tracts":"#C6C346","US.BlockGroups":"#717A32","US.CBSA":"#32A6A1","US.DMA":"#9F2D28","US.Places":"#66665E","US.CD":"#DD6D27","US.CSD":"#3C3534","CAN.PR":"#787365",
"CAN.FED":"#4DA10C","CAN.CD":"#AC7A17","CAN.CSD":"#3A5731","CAN.CMACA":"#83211A","CAN.CT":"#B1A618","CAN.FSA":"#504F49","CAN.DA":"#5F7C16"};e=e(x,{isLabelsLayer:!0,labelField:"name",_graphics:null,_sourceLayer:null,_handle:null,setLabelField:function(a){this.labelField=a},setSourceGraphicsLayer:function(a){this._handle&&this._handle.remove();if(this._sourceLayer=a)this._handle=this._sourceLayer.on("graphic-add, graphic-remove, graphics-clear",function(){this.createLabels(null)}.bind(this))},createLabels:function(a){this._graphics=
a;return B.invoke(this,"_doCreateLabels",100)},_doCreateLabels:function(){this.clear();this._collectLabels(this._graphics||this._sourceLayer.graphics).forEach(function(a){this.add(new z(a.point,a.symbol,a.g.attributes))},this);this.redraw()},_collectLabels:function(a){function f(a){var b=p.renderer.getSymbol(a),b=new n(b.toJson());b.setVerticalAlignment("baseline");b.setHorizontalAlignment("center");b.setText(a.attributes[p.labelField]||"");return b}function e(a){return!q.some(function(b){b=b.rect;
if(!(b.X2<a.X1||b.X1>a.X2||b.Y2<a.Y1||b.Y1>a.Y2))return!0})}var p=this,q=[];a.forEach(function(a){function b(a,b,h){var d=b.getExtent();b=p.getMap();if(h){h=new t(d.xmin,d.ymin,d.spatialReference);var c=new t(d.xmax,d.ymax,d.spatialReference);h=b.toScreen(h);var c=b.toScreen(c),g=Math.abs(c.y-h.y);if(Math.abs(c.x-h.x)<4*k||g<4*l)return}d=d.getCenter();b=b.toScreen(d);b={X1:b.x-k/2,Y1:b.y-l/2,X2:b.x+k/2,Y2:b.y+l/2};e(b)&&(m=m||f(a),q.push({symbol:m,point:d,rect:b,g:a}),n=!0)}var m,n,k,l;a.attributes.__hasCachedLabelDimensions?
(k=a.attributes.__w,l=a.attributes.__h):(m=f(a),k=m.getWidth(),l=m.getHeight(),a.attributes.__w=k,a.attributes.__h=l,a.attributes.__hasCachedLabelDimensions=!0);if(a.geometry.rings&&1<a.geometry.rings.length){for(var r=0;r<a.geometry.rings.length;r++){var c=a.geometry.rings[r];if(a.geometry.isClockwise(c)){var g=new A(a.geometry.spatialReference);g.addRing(c);b(a,g,!0)}}n||b(a,a.geometry,!1)}else b(a,a.geometry,!1)});return q},clearCache:function(a){a.forEach(function(a){a.attributes.__hasCachedLabelDimensions=
!1})},setVisualSettings:function(a){a=w.mixin(g(),a);this.setRenderer(new y(u(a)))},_setMap:function(){this.visibleAtMapScale=!0;return this.inherited(arguments)},_isMapAtVisibleScale:function(){return this.visibleAtMapScale},emitAvailabilityChanged:function(a){this.visibleAtMapScale=a;this.onScaleVisibilityChange()}});e.getLevelColor=c;e.getDefaultVisualSettings=g;e.labelPropertiesToSymbol=u;e.symbolToLabelProperties=function(a){return{color:a.color.toCss(!0),fontSize:a.font.size,fontFamily:a.font.family,
isItalic:"italic"===a.font.style,isBold:"bold"===a.font.weight,isUnderlined:"underline"===a.font.decoration}};return e});