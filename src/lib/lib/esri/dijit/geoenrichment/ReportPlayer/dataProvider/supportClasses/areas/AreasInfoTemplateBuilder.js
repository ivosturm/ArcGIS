// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/areas/AreasInfoTemplateBuilder","esri/dijit/geoenrichment/when esri/dijit/geoenrichment/promise/all esri/dijit/PopupTemplate ../attachments/AttributesUtil esri/dijit/geoenrichment/utils/DomUtil dojo/i18n!esri/nls/jsapi".split(" "),function(g,m,n,p,q,k){k=k.geoenrichment.dijit.ReportPlayer.AreasInfoTemplateBuilder;var l={buildInfoTemplates:function(b,c,a){var d=this,e={};c=c.map(function(a,c){return g(d._getAttributesAndNotesForAreaAt(b,
c),function(b){e[c]=b;d._buildAreaInfoTemplate(a,b.attributesText,b.notesText)})});return m(c).then(function(){a.groups&&a.groups.forEach(function(a){var b=e[a.indexes[0]];d._buildGroupInfoTemplate(a,b.attributesText,b.notesText)})})},buildInfoTemplateForFeature:function(b,c,a,d){var e=this;return g(this._getAttributesAndNotesForAreaAt(b,a),function(a){e._buildFeatureInfosInfoTemplate([{feature:c,title:d}],a.attributesText,a.notesText)})},_getAttributesAndNotesForAreaAt:function(b,c){b.supportsMultipleAreas&&
b.setCurrentAnalysisAreaIndex(c);return m([function(){return g(b.getAttributes(),function(a){return a&&a.length?l.buildAttributesTable(k.attributes,a.map(function(a){return{label:a.alias,value:p.formatAttributeValue(a,{unavailableDataValue:k.unavailableData})}})):null})}(),function(){return g(b.getNotes(),function(a){return a&&a.length?l.formatArrayOfTexts(k.notes,a.map(function(a){return a.text})):null})}()]).then(function(a){return{attributesText:a[0]||"",notesText:a[1]||""}})},_buildAreaInfoTemplate:function(b,
c,a){var d=[{feature:b.feature,title:b.name}];b.location&&d.push({feature:b.location,title:b.locationName||b.name});this._buildFeatureInfosInfoTemplate(d,c,a)},_buildGroupInfoTemplate:function(b,c,a){var d=[];b.location&&d.push({feature:b.location,title:b.locationName||b.name});this._buildFeatureInfosInfoTemplate(d,c,a)},_buildFeatureInfosInfoTemplate:function(b,c,a){b.forEach(function(b){c||a?b.feature.setInfoTemplate(new n({title:b.title,fieldInfos:[],description:c+a})):b.feature.setInfoTemplate(null)})},
formatArrayOfTexts:function(b,c){return"\x3cp\x3e"+b+"\x3c/p\x3e"+("\x3cp style\x3d'padding-left:10px'\x3e"+c.join("\x3cbr/\x3e\x3cbr/\x3e")+"\x3c/p\x3e")},buildAttributesTable:function(b,c,a){a=a||{};var d=a.padding?a.padding+"px":"0px 5px",e=null;if(a.maxHeight){var h=a.padding||0,g=q.getTextBox("Text").h,h=(2*h+g)*(c.length+(b?1:0));a.maxHeight<h&&(h=a.maxHeight/h,e=Math.floor(g*h)+"px",a.padding&&(d=Math.floor(a.padding*h*.5)+"px "+a.padding+"px"))}var f="";b&&(f+="\x3cp\x3e"+b+"\x3c/p\x3e");
var l="padding:"+d+";"+(e?"font-size:"+e+";":""),f=f+"\x3ctable\x3e";c.forEach(function(a){f+="\x3ctr style\x3d'text-align:left;'\x3e";var b=f+="\x3ctd style\x3d'"+l+"'\x3e"+a.label+"\x3c/td\x3e";a=a.value;a=null===a||void 0===a||"number"===typeof a&&isNaN(a)?k.unavailableData:a;f=b+("\x3ctd style\x3d'"+l+"'\x3e"+a+"\x3c/td\x3e");f+="\x3c/tr\x3e"});return f+="\x3c/table\x3e"}};return l});