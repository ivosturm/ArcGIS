// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/ge/_GEFilterSupport",["dojo/_base/declare","esri/tasks/FeatureSet","esri/dijit/geoenrichment/infographicUtils/formatVariable","esri/dijit/geoenrichment/utils/ObjectUtil"],function(e,f,g,h){return e(null,{_filterRanges:null,_alwaysAllowThisAreasWhenFiltering:!1,getData:function(a){this.data||(this.data=this._createFeatureSet());return a&&a.ignoreFilters?this.data:this._filterRanges&&this._filterRanges.length&&this.data?this._filterData(this.data):
this.data},_createFeatureSet:function(){},_filterData:function(a){var b=new f;b.fields=a.fields;b.fieldAliases=a.fieldAliases;b.features=a.features.filter(function(a){return this._alwaysAllowThisAreasWhenFiltering&&a.attributes.isThisArea?!0:!this._filterRanges.some(function(c){var b=a.attributes[c.fieldName];return b<c.min||b>c.max})},this);return b},_excludeMap:{StdGeographyName:1,StdGeographyID:1,StdGeographyLevel:1,isThisArea:1},getAttributeFields:function(){var a=this.getData({ignoreFilters:!0});
if(!a)return[];for(var a=a.fields,b=[],d=0;d<a.length;d++){var c=a[d];!this._excludeMap[c.name]&&this._filterAttributeField(c)&&b.push({name:c.name,label:c.alias,decimals:0<=c.decimals?c.decimals:void 0,type:c.type,formatFunction:function(a){return function(c){return-1===a.decimals?h.formatNumber(c):g(a,c)}}(c)})}return b},_filterAttributeField:function(a){return this.variables&&this.variables.length?"HouseholdsByIncome.*"===this.variables[0]?0===a.name.indexOf("HIN"):"HouseholdIncomeCurrentYear.*"===
this.variables[0]?0===a.name.indexOf("EHYHNI"):"Age.*"===this.variables[0]?0===a.name.indexOf("FEM")||0===a.name.indexOf("MAL")||0===a.name.indexOf("ECYP"):-1!==this.variables[0].indexOf("AVGHHSZ")?-1!==a.name.indexOf("AVGHHSZ"):"RaceAndEthnicity.*"===this.variables[0]?-1!==a.name.indexOf("_CY_"):!0:!0},getAllGeographyAttributes:function(a){a=this.getData(a);if(!a)return[];a=a.features;for(var b=[],d=0;d<a.length;d++){var c=a[d].attributes;c.isThisArea||b.push(c)}return b},setFilterRanges:function(a,
b){this._filterRanges=a;this._alwaysAllowThisAreasWhenFiltering=b&&b.ignoreThisAreas},collectFilterRangesStats:function(a){if(!this.getData())return null;a=a||{};var b=a.additionalAttributes||[],b=b.concat(a.excludeThisAreas?this.getAllGeographyAttributes({ignoreFilters:!0}):this.getData({ignoreFilters:!0}).features.map(function(a){return a.attributes})),d=[];this.getAttributeFields().forEach(function(a){if("esriFieldTypeString"!==a.type){var c={fieldName:a.name,alias:a.label,min:Infinity,max:-Infinity,
decimals:a.decimals,dataArray:[]};d.push(c);b.forEach(function(b){b=b[a.name];c.min=Math.min(c.min,b);c.max=Math.max(c.max,b);c.dataArray.push(b)})}});return{filterRanges:d,numAreasTotal:b.length}}})});