// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/printing/_PrintSettingsSupport","require dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/promise/all esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when esri/dijit/geoenrichment/utils/DelayUtil esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/DocumentOptions ../PlayerCommands ../PlayerViewModes ./HeaderFooterSettingsBuilder ./PageSizeUtil".split(" "),function(m,n,g,p,k,f,q,r,l,t,u,v){return n(null,{_checkPrintSettings:function(a){function d(e){e=
g.mixin({},a.exportSettings);delete e.pageSettings;return g.mixin({commandId:a.commandId,noAutoScale:!c._checkNeedAutoScale(),pageSettings:g.mixin({},c.getCurrentReportContainer().documentOptions,a.exportSettings&&a.exportSettings.pageSettings),addHeader:!1,addDataSource:!1,addFooter:!1,reportTitle:void 0,reportSubtitle:void 0,allowDataDrilling:!0,allowFallbackMaps:!0,canSplitPages:!1,splitPages:!1},e)}function b(){var b=new k;a.onShowWaiting(b.promise);f(c._getPrintDialogSettings(a.commandId),function(a){return c._loadDialogClass().then(function(b){b=
new b;b.onPrint=function(b){f(c._applyPrintSettings(g.mixin(d(a),b)),e.resolve,e.reject)};b.onCancel=function(){e.resolve("cancel")};b.show(a)}).always(b.resolve)})}var c=this,e=new k;a.showDialog?b():f(c._applyPrintSettings(d()),e.resolve,e.reject);return e.promise},_loadDialogClass:function(){var a=new k,d=this._player.printConfig.printDialogClass;"string"===typeof d?m([d],function(b){a.resolve(b)}):a.resolve(d);return a.promise},getPrintDialogSettings:function(){return this._getPrintDialogSettings()},
_getPrintDialogSettings:function(a){var d=this;return f(this._player.dataProvider.getCommands(),function(b){var c={canAutoScale:d._checkNeedAutoScale(),pageSettings:{pagesize:d.getCurrentReportContainer().documentOptions.pagesize,orientation:d.getCurrentReportContainer().documentOptions.orientation},reportTitle:d._player.getReportTitle(),reportSubtitle:d._player.printConfig.subtitle,supportedPageSizes:v.getSupportedPageSizes().map(function(a){return{label:a.label,id:a.value}}),canSplitPages:d._player.viewMode===
t.PANELS_IN_STACK_ALL};a&&(c.commandId=a);c.exportCommands=a?a===l.PRINT?null:b.filter(function(a){return a.id!==l.PRINT}):b;c.exportCommands&&(c.exportCommands=c.exportCommands.map(function(a){return{label:a.label,id:a.id}}));return c})},_checkNeedAutoScale:function(){return this.getAllReportContainers().some(function(a){return a.hasHiddenContent()})},_applyPrintSettings:function(a){function d(){return p(b.getAllReportContainers().map(function(a){return a.resizePanelsToShowContent()})).then(function(){return q.delay(500)})}
var b=this;this._commandId=a.commandId||this._commandId;this._allowDataDrilling=a.allowDataDrilling;this._allowFallbackMaps=a.allowFallbackMaps;this._splitPages=a.splitPages;this._needAutoScale=this._checkNeedAutoScale();var c=a.commandId===l.DYNAMIC_HTML||this._needAutoScale&&a.noAutoScale,e,h;c||(e=g.clone(this._player.getReportData().templateJson));h=this._player._showAllContainers();this._pageSettingsRollBackFunc=function(){h&&h.undo();h=null;if(!c)return b._player.getReportData().templateJson=
e,b._player.refresh()};return f(!c&&d(),function(){b._pageSettings=a.pageSettings;var c=r.getPageBox(a.pageSettings);b._pageFitParams={w:c.w,h:c.h,hAlign:"center",vAlign:"top"};return f(u.createHeaderFooterParams(b._player,b._viewModel,a),function(a){b._headerFooterParams=a})})}})});