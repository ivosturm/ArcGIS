// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/async/AsyncQueue","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dijit/Destroyable ../DelayUtil".split(" "),function(m,n,h,e,p,k){var g=m(p,{_lastPromise:null,_isFinished:!1,_isDestroyed:!1,_lastDfd:null,_lastResult:null,constructor:function(b){n.mixin(this,b)},add:function(b,c){c=c||{};var a=this;if(!this._isDestroyed){this._lastDfd||(this.onStarted(),this._lastDfd=new h);this._isFinished=!1;var f=function(){var l=
function(){if(!a._isDestroyed)try{return"function"===typeof b?b():b}catch(q){return(new h).reject(q)}},d=0<=c.delayBefore?function(){return k.delay(l,c.delayBefore)}:l;return(0<=c.delayAfter?function(){return e(d(),function(a){return k.delay(function(){return a},c.delayAfter)})}:d)()};!this._lastPromise||this._lastPromise.isFulfilled()?this._lastPromise=e(f()):this._lastPromise=e(this._lastPromise).then(f);var d=this._lastPromise;e(d,function(b){d!==a._lastPromise||a._isDestroyed||a._isFinished||
d&&!d.isFulfilled()||(a._isFinished=!0,a._lastDfd.resolve(b),a._lastResult=b,a._lastDfd=null,a.onFinished(b))},this._lastDfd.reject);return this.getPromise()}},getPromise:function(){return this._isDestroyed?null:this._lastDfd&&this._lastDfd.promise||this._lastResult},isFinished:function(){return this._isFinished},isDestroyed:function(){return this._isDestroyed},destroy:function(){this._isDestroyed=!0},onStarted:function(){},onFinished:function(b){}});g.executeFunctions=function(b,c,a){a=a||{};var f=
new g,d=[];b.forEach(function(a,b){f.add(function(){return e(a(),function(a){d.push(a);return a})},{delayBefore:0===b?void 0:c})});a.onQueueReady&&a.onQueueReady(f);return e(f.getPromise(),function(b){return a.collectResults?d:b})};g.processArrayInBatches=function(b,c){function a(){if(b.length){for(var d=[],e=0;e<c.batchSize&&b.length;e++)d.push(b.shift());c.processBatch?c.callback(d):d.forEach(c.callback);setTimeout(a,c.timeout||0)}else f.resolve()}b=b.slice();var f=new h;a();return f.promise};return g});