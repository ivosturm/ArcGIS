// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/NodeProcessor",["esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","./drawing/SVGDrawer","./Clipper","./VisualsCollector"],function(w,g,k,t,p){return{processNode:function(q,l){function u(b,c,q,e,n){function h(a){a&&(Array.isArray(a)?a.forEach(function(a){h(a)}):(m.push({text:a,stackIndex:++n}),d++))}var d=0;if("#comment"===b.nodeName)return d;var a=p.getNodeVisuals(b,e);if(!a)return d;a.style.isRelAbs&&(n=x+=1E5);a.parentVs=
e;var f;if("svg"===b.nodeName)return h(k.drawSVG(b,a,c)),d;if("IMG"===b.nodeName)return g(k.drawImage(b,a,c),function(a){h(a);return d});e=function(){var b=a.style;return b.getBorder().radius||"auto"===b.getBackground().size||b.getBackground().repeatX||b.getBackground().repeatY?t.addClipping(a,l.definitions):c};a.style.getBackground().image&&"none"!==a.style.getBackground().image&&(f=g(k.drawBackgroundImage(a,e()),function(a){h(a)}));f=g(f,function(){h(k.drawRect(a,c));h(k.drawBorder(a,c))});return g(f,
function(){var e;if(b.childNodes.length){var f=function(){function e(){"#text"===d.nodeName?(h(k.drawText(d,b,a,c)),f()):g(u(d,c,r,a,n),function(a){n+=a;f()})}var d=b.childNodes[p++];d?++v>(l.iterationsPerScript||500)?(v=0,setTimeout(e,30)):e():m.resolve()},m=new w;e=m.promise;var r;"hidden"===a.style.overflow&&(r=l.clipFunc&&l.clipFunc(b),c=(q||l.useClipping||r)&&t.addClipping(a,l.definitions,c)||c);var p=0;f()}return g(e,function(){return d})})}var v=0,m=[],x=0;return g(u(q,null,null,null,0),function(){m.sort(function(b,
c){return b.stackIndex-c.stackIndex});return m})}}});