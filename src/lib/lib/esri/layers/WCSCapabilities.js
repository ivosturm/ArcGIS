// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/WCSCapabilities",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Extent"],function(k,l,n,p,m){var h=function(a,b){if(null===a||null===b||null===a.tagName||void 0===a.tagName)return!1;a=a.tagName.toLowerCase();b=b.toLowerCase();return a===b||0<a.indexOf(":"+b)};k=k(null,{declaredClass:"esri.layers.WCSCapabilities",version:null,name:null,onlineResources:null,coverages:null,supportedFormats:null,supportedVersions:null,profiles:null,supportedInterpolations:null,
constructor:function(a){this._parse=l.hitch(this,this._parse);a&&l.mixin(this,this._parse(a))},_parse:function(a){var b=this._getElement(a,"Capabilities")||this._getElement(a,"WCS_Capabilities");if(null===b)throw"not a valid capabilities file -- cannot find Capabilities or WCS_Capabilities root element";this.version=b=b.getAttribute("version");switch(b){case "1.0.0":this._parse100(a);break;case "1.1.0":case "1.1.1":case "1.1.2":this._parse110(a);break;case "2.0.1":this._parse201(a);break;default:throw"unsupported WCS version "+
b;}},_getElements:function(a,b){if(!a)return null;if(!b)return a;var d=b;-1<b.indexOf("/")?(d=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";return b?this._getElement(a,d).getElementsByTagNameNS("*",b):a.getElementsByTagNameNS("*",d)},_getElement:function(a,b){if(!a)return null;if(!b)return a;var d=b;-1<b.indexOf("/")?(d=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";a=this._getElements(a,d);return 0<a.length?b?this._getElement(a[0],b):a[0]:null},_getElementValue:function(a,
b){return(a=this._getElement(a,b))?(a=a.textContent||a.text||a.nodeValue||a.innerText)?a.trim():null:null},_getElementValues:function(a,b){a=this._getElements(a,b);b=[];var d,c;for(c=0;c<a.length;c++)if(d=a[c].textContent||a[c].text||a[c].nodeValue||a[c].innerText)d=d.trim(),""!==d&&b.push(d);return b},_removeTrailingQuestionMark:function(a){return a?a.indexOf("?")===a.length-1?a.substring(0,a.length-1):a:null},_parse100:function(a){var b=this._getElement(a,"Service");this.name=this._getElementValue(b,
"name");this.supportedVersions=["1.0.0"];var b={},d=this._getElement(a,"Capability");b.getCapabilities=this._removeTrailingQuestionMark(this._getElement(d,"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"));b.describeCoverage=this._removeTrailingQuestionMark(this._getElement(d,"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"));b.getCoverage=this._removeTrailingQuestionMark(this._getElement(d,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"));this.onlineResources=
b;a=this._getElements(a,"CoverageOfferingBrief");for(var d=[],c,e,f,b=0;b<a.length;b++)c=a[b],e={},e.id=this._getElementValue(c,"name"),e.label=this._getElementValue(c,"label"),e.description=this._getElementValue(c,"description"),f=this._getElements(c,"pos"),c=this._getElementValue(f[0]).split(" "),f=this._getElementValue(f[1]).split(" "),e.lonLatEnvelope=new m({xmin:parseFloat(c[0]),ymin:parseFloat(c[1]),xmax:parseFloat(f[0]),ymax:parseFloat(f[1]),spatialReference:{wkid:4326}}),d.push(e);this.coverages=
d;return!0},_parse110:function(a){var b=l.hitch(this,function(a){var d,c,e,g;c={};for(e=0;e<a.childNodes.length;e++)d=a.childNodes[e],h(d,"title")?c.title=this._getElementValue(d):h(d,"abstract")?c["abstract"]=this._getElementValue(d):h(d,"identifier")?c.id=this._getElementValue(d):h(d,"WGS84BoundingBox")?(g=this._getElementValue(d,"LowerCorner").split(" "),d=this._getElementValue(d,"UpperCorner").split(" "),c.lonLatEnvelope=new m({xmin:parseFloat(g[0]),ymin:parseFloat(g[1]),xmax:parseFloat(d[0]),
ymax:parseFloat(d[1]),spatialReference:{wkid:4326}})):h(d,"CoverageSummary")&&(c.coverageSummaries=c.coverageSummaries||[],c.coverageSummaries.push(b(d)));return c}),d=function(a,b){var c;if(a.coverageSummaries)for(c=0;c<a.coverageSummaries.length;c++)a.coverageSummaries[c]["abstract"]=a.coverageSummaries[c]["abstract"]||a["abstract"],a.coverageSummaries[c].lonLatEnvelope=a.coverageSummaries[c].lonLatEnvelope||a.lonLatEnvelope,a.coverageSummaries[c].title=a.coverageSummaries[c].title||a.title,d(a.coverageSummaries[c],
b);void 0!==a.id&&b.push(a)};this.name=this._getElementValue(a,"ServiceIdentification/Title");this.supportedVersions=this._getElementValues(a,"ServiceIdentification/ServiceTypeVersion");var c={},e=this._getElement(a,"OperationsMetadata");c.getCapabilities=this._removeTrailingQuestionMark(this._getElement(e.querySelector("Operation[name\x3dGetCapabilities]"),"Get").getAttribute("xlink:href"));c.describeCoverage=this._removeTrailingQuestionMark(this._getElement(e.querySelector("Operation[name\x3dDescribeCoverage]"),
"Get").getAttribute("xlink:href"));c.getCoverage=this._removeTrailingQuestionMark(this._getElement(e.querySelector("Operation[name\x3dGetCoverage]"),"Get").getAttribute("xlink:href"));this.onlineResources=c;var c=this._getElement(a,"Contents"),e=[],f;for(a=0;a<c.childNodes.length;a++)f=c.childNodes[a],h(f,"coveragesummary")&&d(b(f),e);this.coverages=e;e=[];c=this._getElements(c,"SupportedFormat");for(a=0;a<c.length;a++)e.push(this._getElementValue(c[a]));this.supportedFormats=e;return!0},_parse201:function(a){var b;
b=this._getElement(a,"ServiceIdentification");this.name=this._getElementValue(b,"Title");this.supportedVersions=this._getElementValues(b,"ServiceTypeVersion");var d=this._getElements(b,"Profile"),c=[];for(b=0;b<d.length;b++)c.push(this._getElementValue(d[b]));this.profiles=c;b={};d=this._getElement(a,"OperationsMetadata");b.getCapabilities=this._removeTrailingQuestionMark(this._getElement(d.querySelector("Operation[name\x3dGetCapabilities]"),"Get").getAttribute("xlink:href"));b.describeCoverage=this._removeTrailingQuestionMark(this._getElement(d.querySelector("Operation[name\x3dDescribeCoverage]"),
"Get").getAttribute("xlink:href"));b.getCoverage=this._removeTrailingQuestionMark(this._getElement(d.querySelector("Operation[name\x3dGetCoverage]"),"Get").getAttribute("xlink:href"));this.onlineResources=b;var d=this._getElements(a,"Contents/CoverageSummary"),c=[],e,f,g;for(b=0;b<d.length;b++){e=d[b];f={};f.id=this._getElementValue(e,"CoverageId");if(g=this._getElement(e,"WGS84BoundingBox"))e=this._getElementValue(g,"LowerCorner").split(" "),g=this._getElementValue(g,"UpperCorner").split(" "),f.lonLatEnvelope=
new m({xmin:parseFloat(e[0]),ymin:parseFloat(e[1]),xmax:parseFloat(g[0]),ymax:parseFloat(g[1]),spatialReference:{wkid:4326}});c.push(f)}this.coverages=c;a=this._getElement(a,"ServiceMetadata");d=this._getElements(a,"formatSupported");c=[];for(b=0;b<d.length;b++)c.push(this._getElementValue(d[b]));this.supportedFormats=c;a=this._getElements(a,"interpolationSupported");d=[];for(b=0;b<a.length;b++)d.push(this._getElementValue(a[b]));this.supportedInterpolations=d.map(function(a){var b=null;-1<a.toLowerCase().indexOf("nearest")?
b=0:-1<a.toLowerCase().indexOf("linear")?b=1:-1<a.toLowerCase().indexOf("cubic")&&(b=2);return b}).filter(function(a){return null!==a});return!0}});n("extend-esri")&&l.setObject("layers.WCSCapabilities",k,p);return k});