// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(m,h,a,b){var d=m.some;return function(g){var e,c;h.isArray(g)?c=g:g&&"object"===typeof g&&(e=g);var f,k=[];if(e){c=[];for(var p in e)Object.hasOwnProperty.call(e,p)&&(k.push(p),c.push(e[p]));f={}}else c&&(f=[]);if(!c||!c.length)return(new a).resolve(f);var l=new a;l.promise.always(function(){f=k=null});var r=c.length;d(c,function(a,c){e||k.push(c);b(a,function(a){l.isFulfilled()||
(f[k[c]]=a,0===--r&&l.resolve(f))},l.reject);return l.isFulfilled()});return l.promise}})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,h,a,b){m=m([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(a){if(a){if(!a.width||Math.floor(a.width)!==a.width)throw"PixelBlock: incorrect width";if(!a.height||Math.floor(a.height)!==
a.height)throw"PixelBlock: incorrect height";if(!a.pixels)throw"PixelBlock: pixel data not present";this.width=a.width;this.height=a.height;this.pixels=a.pixels;this.pixelType=a.pixelType||null;this.statistics=a.statistics;this.mask=a.mask||null;this.maskIsAlpha=a.maskIsAlpha||!1;a=a.validPixelCount;null==a&&(a=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=a}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):
this.statistics.length},addData:function(a){if(!a.pixels||!a.statistics)throw"Pixel data or statistics are not present";if(a.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(a.statistics);this.pixels.push(a.pixels)},getAsRGBA:function(){var a=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)},
getAsRGBAFloat:function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a},clone:function(a){a=a||this;var b=new this.constructor;b.width=a.width;b.height=a.height;b.pixelType=a.pixelType;b.maskIsAlpha=a.maskIsAlpha;a.mask&&(b.mask=new Uint8Array(a.mask));var e,c,f;if(a.pixels)for(b.pixels=[],f=(c=a.pixels.length)&&a.pixels[0].slice,e=0;e<c;e++)b.pixels[e]=f?a.pixels[e].slice(0,a.pixels[e].length):new a.pixels[e].constructor(a.pixels[e]);if(a.statistics)for(b.statistics=
[],c=a.statistics.length,e=0;e<c;e++)b.statistics[e]=h.clone(a.statistics[e]);a=a.validPixelCount;null==a&&(a=b.mask?this._getValidPixelCount(b.mask):b.width*b.height);return b},clamp:function(a){if("F64"!==a&&"F32"!==a){var b;switch(a){case "U8":b=[0,255];break;case "U16":b=[0,65535];break;case "U32":b=[0,4294967295];break;case "S8":b=[-128,127];break;case "S16":b=[-32768,32767];break;case "S32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var e=b[0];b=b[1];var c=this.pixels,f=
this.width*this.height,k=c.length,d,l,r,q,n,t=[];for(q=0;q<k;q++){r=this._createEmptyBand(a,f);d=c[q];for(n=0;n<f;n++)l=d[n],r[n]=l>b?b:l<e?e:l;t.push(r)}this.pixels=t;this.pixelType=a}},calculateStatistics:function(){var a,b=[],e,c=this.mask;for(a=0;a<this.pixels.length;a++)e=this.pixels[a],b.push(this._calculateBandStatistics(e,c));this.statistics=b},_getValidPixelCount:function(a){var b,e=0;for(b=0;b<a.length;b++)a[b]&&e++;return e},_createEmptyBand:function(a,b){switch(a){case "U8":a=new Uint8Array(b);
break;case "U16":a=new Uint16Array(b);break;case "U32":a=new Uint32Array(b);break;case "S8":a=new Int8Array(b);break;case "S16":a=new Int16Array(b);break;case "S32":a=new Int32Array(b);break;case "U32":a=new Uint32Array(b);break;case "F32":a=new Float32Array(b);break;case "F64":a=new Float64Array(b);break;default:a=new Float32Array(b)}return a},_fillFrom8Bit:function(a){var b=this.pixels,e=this.mask;if(!a||!b||!b.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var c,f,k;c=f=k=b[0];3<=b.length&&(f=b[1],k=b[2]);var b=new Uint32Array(a),d=this.width*this.height;if(c.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(e&&e.length===d)if(this.maskIsAlpha)for(a=0;a<d;a++)e[a]&&(b[a]=e[a]<<24|k[a]<<16|f[a]<<8|c[a]);else for(a=0;a<d;a++)e[a]&&(b[a]=-16777216|k[a]<<16|f[a]<<8|c[a]);else for(a=0;a<d;a++)b[a]=-16777216|k[a]<<16|f[a]<<8|c[a]},_fillFromNon8Bit:function(a){var b=this.pixels,e=this.mask,c=this.statistics;if(!a||
!b||!b.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var f=1,k=0,f=1;c&&0<c.length?(k=c.map(function(a){return a.minValue}).reduce(function(a,c){return Math.min(a,c)}),f=c.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,c){return Math.max(a,c)}),f=255/f):(f=255,"S8"===this.pixelType?(k=-128,f=127):"U16"===this.pixelType?f=65535:"S16"===this.pixelType?(k=-32768,f=32767):"U32"===this.pixelType?f=4294967295:"S32"===this.pixelType?(k=-2147483648,
f=2147483647):"F32"===this.pixelType?(k=-3.4*1E39,f=3.4*1E39):"F64"===this.pixelType&&(k=-Number.MAX_VALUE,f=Number.MAX_VALUE),f=255/(f-k));a=new Uint32Array(a);var c=this.width*this.height,d,l,r;d=b[0];if(d.length!==c)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=b.length)if(l=b[1],r=b[2],e&&e.length===c)for(b=0;b<c;b++)e[b]&&(a[b]=-16777216|(r[b]-k)*f<<16|(l[b]-k)*f<<8|(d[b]-k)*f);else for(b=0;b<c;b++)a[b]=-16777216|(r[b]-k)*f<<16|(l[b]-k)*f<<8|(d[b]-k)*f;else if(e&&
e.length===c)for(b=0;b<c;b++)l=(d[b]-k)*f,e[b]&&(a[b]=-16777216|l<<16|l<<8|l);else for(b=0;b<c;b++)l=(d[b]-k)*f,a[b]=-16777216|l<<16|l<<8|l},_fillFrom32Bit:function(a){var b=this.pixels,e=this.mask;if(!a||!b||!b.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var c,f,k;c=f=k=b[0];3<=b.length&&(f=b[1],k=b[2]);var d=this.width*this.height;if(c.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(e&&e.length===d)for(b=
0;b<d;b++)a[l++]=c[b],a[l++]=f[b],a[l++]=k[b],a[l++]=e[b]&1;else for(b=0;b<d;b++)a[l++]=c[b],a[l++]=f[b],a[l++]=k[b],a[l++]=1},_calculateBandStatistics:function(a,b){var e=Infinity,c=-Infinity,f=a.length,k,d=0;if(b)for(k=0;k<f;k++)b[k]&&(d=a[k],e=d<e?d:e,c=d>c?d:c);else for(k=0;k<f;k++)d=a[k],e=d<e?d:e,c=d>c?d:c;return{minValue:e,maxValue:c}}});a("extend-esri")&&h.setObject("layers.PixelBlock",m,b);return m})},"esri/kernel":function(){define(["dojo/_base/kernel","dojo/_base/config","dojo/has"],function(m,
h,a){var b=function(){return this}(),d=b.location,g=d.pathname,e=d.protocol,d={version:"3.32",_appBaseUrl:e+"//"+d.host+g.substring(0,g.lastIndexOf(g.split("/")[g.split("/").length-1]))};h.noGlobals||(b.esri=d);m.isAsync||a.add("extend-esri",1);(d.dijit=d.dijit||{})._arcgisUrl=("http:"===e||"https:"===e?e:"http:")+"//www.arcgis.com/sharing/rest";return d})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),
function(m,h,a,b,d,g,e,c,f,k,p){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var a=new ArrayBuffer(4),c=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===c[0]}(),decode:function(a,c){if(void 0===c||null===c)throw"missing decode options";var f,b;c.format&&(f=c.format.toUpperCase());"BSQ"!==f&&"BIP"!==f&&(f=this._getFormat(a));b=c.decodeFunc;if(void 0===
b||null===b)b=this._getFormatDecoderDfd(f);return b(a,c)},_getFormatDecoderDfd:function(c){var f=null;switch(c){case "LERC":f=this._decodeLerc;break;case "LERC2":f=this._decodeLerc2;break;case "JPEG":f=this._decodeJpeg;break;case "PNG":f=this._decodePng;break;case "BSQ":f=this._decodeBsq;break;case "BIP":f=this._decodeBip;break;case "TIFF":f=this._decodeTiff;break;default:f=function(a,c){throw"The raster format is not supported";}}f=a.hitch(this,f);return function(a,c){var e=new b;c.isPoint&&c.width&&
(c.width++,c.height++);a=f(a,c);c.isPoint&&c.width&&(this._interpolatePointGrid(a),c.width--,c.height--);e.resolve(a);return e}.bind(this)},_getFormat:function(a){a=new Uint8Array(a,0,10);var c="";if(255===a[0]&&216===a[1])c="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])c="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])c="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])c="LERC2";
else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))c="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])c="TIFF";return c},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,f){if(!c)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(f);a=(new c).decode(a);
if(!this._verifyResult(a,f))throw"The decoded image dimensions are incorrect.";f=new d({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});f.calculateStatistics();return f},_decodePng:function(a,c){if(!f)throw"The png decoder module is not loaded.";this._validateDecodeParams(c);a=new Uint8Array(a);var b=new f(a);a=new Uint8Array(c.width*c.height*4);b.copyToImageData(a,b.decodePixels());for(var e=b=0,k,e=new Uint8Array(c.width*c.height),b=0;b<c.width*c.height;b++)e[b]=
a[4*b+3];for(var l=new d({width:c.width,height:c.height,pixels:[],pixelType:"U8",mask:e,statistics:[]}),b=0;3>b;b++){k=new Uint8Array(c.width*c.height);for(e=0;e<c.width*c.height;e++)k[e]=a[4*e+b];l.addData({pixels:k})}l.calculateStatistics();return l},_decodeBsq:function(a,c){if(!k)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(c);var f=c.noDataValue;c.pixelType=this._getpixelTypeAndNoData(c.pixelType);a=k.decodeBSQ(a,{bandCount:c.planes,width:c.width,height:c.height,pixelType:c.pixelType,
noDataValue:f});c=new d({width:c.width,height:c.height,pixels:a.pixels,pixelType:c.pixelType,mask:a.maskData,statistics:null});c.calculateStatistics();return c},_decodeBip:function(a,c){this._validateDecodeParams(c);var f=c.noDataValue;c.pixelType=this._getpixelTypeAndNoData(c.pixelType);a=k.decodeBIP(a,{bandCount:c.planes,width:c.width,height:c.height,pixelType:c.pixelType,noDataValue:f});c=new d({width:c.width,height:c.height,pixels:a.pixels,pixelType:c.pixelType,mask:a.maskData,statistics:null});
c.calculateStatistics();return c},_decodeTiff:function(a,c){this._validateDecodeParams(c);c.pixelType=this._getpixelTypeAndNoData(c.pixelType);a=p.decode(a);a=new d({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType,mask:a.maskData,statistics:null});a.calculateStatistics();return a},_decodeLerc:function(a,c){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(c);var f=c.noDataValue;c.pixelType=this._getpixelTypeAndNoData(c.pixelType);
for(var b=0,e,k=0,l,p=a.byteLength-10;k<p;){var r=g.decode(a,{inputOffset:k,encodedMaskData:e,returnMask:0===b?!0:!1,returnEncodedMask:0===b?!0:!1,returnFileInfo:!0,pixelType:c.pixelType,noDataValue:f}),k=r.fileInfo.eofOffset;0===b&&(e=r.encodedMaskData,l=new d({width:c.width,height:c.height,pixels:[],pixelType:c.pixelType,mask:r.maskData,statistics:[]}));b++;if(!this._verifyResult(r,c))throw"The decoded image dimensions are incorrect";l.addData({pixels:r.pixelData,statistics:{minValue:r.minValue,
maxValue:r.maxValue,noDataValue:r.noDataValue}})}return l},_decodeLerc2:function(a,c){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(c);c.pixelType=this._getpixelTypeAndNoData(c.pixelType);for(var f=0,b,k,l,p=0,g,r=a.byteLength-10,h=[],A;p<r;){k=e.decode(a,{inputOffset:p,maskData:b,returnFileInfo:!0});p=k.fileInfo.eofOffset;0===f&&(l=k.fileInfo.numValidPixel,b=k.maskData,g=new d({width:c.width,height:c.height,pixels:[],dimCount:k.dimCount||
1,pixelType:k.fileInfo.pixelType,mask:k.maskData,statistics:[]}));k.fileInfo.mask&&0<k.fileInfo.mask.numBytes&&h.push(k.maskData);f++;if(!this._verifyResult(k,c))throw"The decoded image dimensions are incorrect";g.addData({pixels:k.pixelData,statistics:{minValue:k.minValue,maxValue:k.maxValue,noDataValue:k.noDataValue,dimStats:k.dimStats}})}if(1<h.length){c=g.width*g.height;g.bandMasks=h;b=new Uint8Array(c);b.set(h[0]);for(l=1;l<h.length;l++)for(A=h[l],a=0;a<c;a++)b[a]&=A[a];for(a=l=0;a<c;a++)l+=
A[a];g.mask=b}g.validPixelCount=l;return g},_interpolatePointGrid:function(a,c){var f=a.pixels;if(f&&0!==f.length){var b=f.length,e=a.width,k=a.mask,d=e-1,l=a.height-1,p=[],g,r,h,m,z,C;if(0===(null==c?1:c)){for(c=0;c<b;c++){h=f[c];m=new h.constructor(d*l);for(g=0;g<l;g++)for(C=g*e,r=0;r<d;r++)m[g*d+r]=h[C+r];p.push(m)}if(k)for(z=new Uint8Array(d*l),g=0;g<l;g++)for(C=g*e,r=0;r<d;r++)z[g*d+r]=k[C+r]}else{for(c=0;c<b;c++){h=f[c];m=new h.constructor(d*l);for(g=0;g<l;g++)for(C=g*e,r=0;r<d;r++)m[g*d+r]=
(h[C+r]+h[C+r+1]+h[C+e+r]+h[C+e+r+1])/4;p.push(m)}if(k)for(z=new Uint8Array(d*l),g=0;g<l;g++)for(C=g*e,r=0;r<d;r++)z[g*d+r]=Math.min.apply(null,[k[C+r],k[C+r+1],k[C+e+r],k[C+e+r+1]])}a.width=d;a.height=l;a.mask=z;a.pixels=p;return a}},_getpixelTypeAndNoData:function(a){return"U1"===a||"U2"===a||"U4"===a||"U8"===a?"U8":a},_verifyResult:function(a,c){return a.height!==c.height||a.width!==c.width?!1:!0}}})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var m={defaultNoDataValue:-3.4027999387901484E38,
decode:function(a,b){var d;b=b||{};var g=b.inputOffset||0,e=b.encodedMaskData||null===b.encodedMaskData,c={},f=new Uint8Array(a,g,10);c.fileIdentifierString=String.fromCharCode.apply(null,f);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;g+=10;f=new DataView(a,g,24);c.fileVersion=f.getInt32(0,!0);c.imageType=f.getInt32(4,!0);c.height=f.getUint32(8,!0);c.width=f.getUint32(12,!0);c.maxZError=f.getFloat64(16,!0);g+=24;if(!e)if(f=new DataView(a,
g,16),c.mask={},c.mask.numBlocksY=f.getUint32(0,!0),c.mask.numBlocksX=f.getUint32(4,!0),c.mask.numBytes=f.getUint32(8,!0),c.mask.maxValue=f.getFloat32(12,!0),g+=16,0<c.mask.numBytes){var e=new Uint8Array(Math.ceil(c.width*c.height/8)),f=new DataView(a,g,c.mask.numBytes),k=f.getInt16(0,!0),p=2,l=0;do{if(0<k)for(;k--;)e[l++]=f.getUint8(p++);else for(var r=f.getUint8(p++),k=-k;k--;)e[l++]=r;k=f.getInt16(p,!0);p+=2}while(p<c.mask.numBytes);if(-32768!==k||l<e.length)throw"Unexpected end of mask RLE encoding";
c.mask.bitset=e;g+=c.mask.numBytes}else 0===(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(e=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=e);f=new DataView(a,g,16);c.pixels={};c.pixels.numBlocksY=f.getUint32(0,!0);c.pixels.numBlocksX=f.getUint32(4,!0);c.pixels.numBytes=f.getUint32(8,!0);c.pixels.maxValue=f.getFloat32(12,!0);g+=16;e=c.pixels.numBlocksX;f=c.pixels.numBlocksY;e+=0<c.width%e?1:0;k=f+(0<c.height%f?1:0);c.pixels.blocks=Array(e*k);for(l=p=0;l<k;l++)for(r=0;r<e;r++){var q=
0,f=new DataView(a,g,Math.min(10,a.byteLength-g)),n={};c.pixels.blocks[p++]=n;var t=f.getUint8(0);q++;n.encoding=t&63;if(3<n.encoding)throw"Invalid block encoding ("+n.encoding+")";if(2===n.encoding)g++;else{if(0!==t&&2!==t){t>>=6;n.offsetType=t;if(2===t)n.offset=f.getInt8(1),q++;else if(1===t)n.offset=f.getInt16(1,!0),q+=2;else if(0===t)n.offset=f.getFloat32(1,!0),q+=4;else throw"Invalid block offset type";if(1===n.encoding)if(t=f.getUint8(q),q++,n.bitsPerPixel=t&63,t>>=6,n.numValidPixelsType=t,
2===t)n.numValidPixels=f.getUint8(q),q++;else if(1===t)n.numValidPixels=f.getUint16(q,!0),q+=2;else if(0===t)n.numValidPixels=f.getUint32(q,!0),q+=4;else throw"Invalid valid pixel count type";}g+=q;if(3!=n.encoding)if(0===n.encoding){t=(c.pixels.numBytes-1)/4;if(t!==Math.floor(t))throw"uncompressed block has invalid length";f=new ArrayBuffer(4*t);q=new Uint8Array(f);q.set(new Uint8Array(a,g,4*t));f=new Float32Array(f);n.rawData=f;g+=4*t}else 1===n.encoding&&(t=Math.ceil(n.numValidPixels*n.bitsPerPixel/
8),f=new ArrayBuffer(4*Math.ceil(t/4)),q=new Uint8Array(f),q.set(new Uint8Array(a,g,t)),n.stuffedData=new Uint32Array(f),g+=t)}}c.eofOffset=g;a=null!=b.noDataValue?b.noDataValue:m.defaultNoDataValue;var e=b.encodedMaskData,t=b.returnMask,k=0,p=c.pixels.numBlocksX,l=c.pixels.numBlocksY,r=Math.floor(c.width/p),n=Math.floor(c.height/l),q=2*c.maxZError,g=Number.MAX_VALUE,B,e=e||(c.mask?c.mask.bitset:null),u,f=new (b.pixelType||Float32Array)(c.width*c.height);t&&e&&(u=new Uint8Array(c.width*c.height));
for(var t=new Float32Array(r*n),v,x,w=0;w<=l;w++){var A=w!==l?n:c.height%l;if(0!==A)for(var D=0;D<=p;D++){var y=D!==p?r:c.width%p;if(0!==y){var z=w*c.width*n+D*r,C=c.width-y,E=c.pixels.blocks[k],F,G;if(2>E.encoding){if(0===E.encoding)F=E.rawData;else{F=E.stuffedData;G=E.bitsPerPixel;B=E.numValidPixels;v=E.offset;x=q;var H=t,N=c.pixels.maxValue,J=(1<<G)-1,P=0,I=void 0,L=0,W=void 0,M=void 0,U=Math.ceil((N-v)/x);F[F.length-1]<<=8*(4*F.length-Math.ceil(G*B/8));for(I=0;I<B;I++)0===L&&(M=F[P++],L=32),L>=
G?(W=M>>>L-G&J,L-=G):(L=G-L,W=(M&J)<<L&J,M=F[P++],L=32-L,W+=M>>>L),H[I]=W<U?v+W*x:N;F=t}G=0}else d=2===E.encoding?0:E.offset;var O;if(e)for(x=0;x<A;x++){z&7&&(O=e[z>>3],O<<=z&7);for(v=0;v<y;v++)z&7||(O=e[z>>3]),O&128?(u&&(u[z]=1),B=2>E.encoding?F[G++]:d,g=g>B?B:g,f[z++]=B):(u&&(u[z]=0),f[z++]=a),O<<=1;z+=C}else if(2>E.encoding)for(x=0;x<A;x++){for(v=0;v<y;v++)B=F[G++],g=g>B?B:g,f[z++]=B;z+=C}else for(g=g>d?d:g,x=0;x<A;x++){for(v=0;v<y;v++)f[z++]=d;z+=C}if(1===E.encoding&&G!==E.numValidPixels)throw"Block and Mask do not match";
k++}}}d=u;u={width:c.width,height:c.height,pixelData:f,minValue:g,maxValue:c.pixels.maxValue,noDataValue:a};d&&(u.maskData=d);b.returnEncodedMask&&c.mask&&(u.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(b.returnFileInfo&&(u.fileInfo=h(c),b.computeUsedBitDepths)){b=u.fileInfo;d=c.pixels.numBlocksX*c.pixels.numBlocksY;O={};for(F=0;F<d;F++)G=c.pixels.blocks[F],0===G.encoding?O.float32=!0:1===G.encoding?O[G.bitsPerPixel]=!0:O[0]=!0;c=Object.keys(O);b.bitDepths=c}return u}},h=function(a){return{fileIdentifierString:a.fileIdentifierString,
fileVersion:a.fileVersion,imageType:a.imageType,height:a.height,width:a.width,maxZError:a.maxZError,eofOffset:a.eofOffset,mask:a.mask?{numBlocksX:a.mask.numBlocksX,numBlocksY:a.mask.numBlocksY,numBytes:a.mask.numBytes,maxValue:a.mask.maxValue}:null,pixels:{numBlocksX:a.pixels.numBlocksX,numBlocksY:a.pixels.numBlocksY,numBytes:a.pixels.numBytes,maxValue:a.pixels.maxValue,noDataValue:this.noDataValue}}};return m})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var m={unstuff:function(a,
d,g,e,c,f,k,p){var b=(1<<g)-1,r=0,q,n=0,t,h;a[a.length-1]<<=8*(4*a.length-Math.ceil(g*e/8));if(c)for(q=0;q<e;q++)0===n&&(h=a[r++],n=32),n>=g?(t=h>>>n-g&b,n-=g):(n=g-n,t=(h&b)<<n&b,h=a[r++],n=32-n,t+=h>>>n),d[q]=c[t];else for(c=Math.ceil((p-f)/k),q=0;q<e;q++)0===n&&(h=a[r++],n=32),n>=g?(t=h>>>n-g&b,n-=g):(n=g-n,t=(h&b)<<n&b,h=a[r++],n=32-n,t+=h>>>n),d[q]=t<c?f+t*k:p},unstuffLUT:function(a,d,g,e,c,f){var b=(1<<d)-1,p=0,l=0,r=0,q=r=0,n,t=[];a[a.length-1]<<=8*(4*a.length-Math.ceil(d*g/8));for(var h=Math.ceil((f-
e)/c),l=0;l<g;l++)0===r&&(n=a[p++],r=32),r>=d?(q=n>>>r-d&b,r-=d):(r=d-r,q=(n&b)<<r&b,n=a[p++],r=32-r,q+=n>>>r),t[l]=q<h?e+q*c:f;t.unshift(e);return t},unstuff2:function(a,d,g,e,c,f,k,p){var b=(1<<g)-1,r=0,q,n=0,t=0,h,u,v;if(c)for(q=0;q<e;q++)0===n&&(u=a[r++],n=32,t=0),n>=g?(h=u>>>t&b,n-=g,t+=g):(v=g-n,h=u>>>t&b,u=a[r++],n=32-v,h|=(u&(1<<v)-1)<<g-v,t=v),d[q]=c[h];else for(c=Math.ceil((p-f)/k),q=0;q<e;q++)0===n&&(u=a[r++],n=32,t=0),n>=g?(h=u>>>t&b,n-=g,t+=g):(v=g-n,h=u>>>t&b,u=a[r++],n=32-v,h|=(u&(1<<
v)-1)<<g-v,t=v),d[q]=h<c?f+h*k:p;return d},unstuffLUT2:function(a,d,g,e,c,f){for(var b=(1<<d)-1,p=0,l=0,r=0,q=0,n=0,t=0,h,u=[],v=Math.ceil((f-e)/c),l=0;l<g;l++)0===q&&(h=a[p++],q=32,t=0),q>=d?(n=h>>>t&b,q-=d,t+=d):(r=d-q,n=h>>>t&b,h=a[p++],q=32-r,n|=(h&(1<<r)-1)<<d-r,t=r),u[l]=n<v?e+n*c:f;u.unshift(e);return u},originalUnstuff:function(a,d,g,e){var c=(1<<g)-1,f=0,b,p=0,l,r;a[a.length-1]<<=8*(4*a.length-Math.ceil(g*e/8));for(b=0;b<e;b++)0===p&&(r=a[f++],p=32),p>=g?(l=r>>>p-g&c,p-=g):(p=g-p,l=(r&c)<<
p&c,r=a[f++],p=32-p,l+=r>>>p),d[b]=l;return d},originalUnstuff2:function(a,d,g,e){var c=(1<<g)-1,f=0,b,p=0,l=0,r,q,n;for(b=0;b<e;b++)0===p&&(q=a[f++],p=32,l=0),p>=g?(r=q>>>l&c,p-=g,l+=g):(n=g-p,r=q>>>l&c,q=a[f++],p=32-n,r|=(q&(1<<n)-1)<<g-n,l=n),d[b]=r;return d}},h={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(a){for(var b=65535,g=65535,e=a.length,c=Math.floor(e/2),f=0;c;){var k=359<=c?359:c,c=c-k;do b+=a[f++]<<8,g+=b+=a[f++];while(--k);b=(b&65535)+(b>>>16);g=(g&65535)+(g>>>16)}e&1&&
(g+=b+=a[f]<<8);return((g&65535)+(g>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(a,d){var b=d.ptr,e=new Uint8Array(a,b,6),c={};c.fileIdentifierString=String.fromCharCode.apply(null,e);if(0!==c.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+c.fileIdentifierString;var b=b+6,e=new DataView(a,b,8),f=e.getInt32(0,!0);c.fileVersion=f;b+=4;3<=f&&(c.checksum=e.getUint32(4,!0),b+=4);e=new DataView(a,b,12);c.height=e.getUint32(0,!0);c.width=
e.getUint32(4,!0);b+=8;4<=f?(c.numDims=e.getUint32(8,!0),b+=4):c.numDims=1;e=new DataView(a,b,40);c.numValidPixel=e.getUint32(0,!0);c.microBlockSize=e.getInt32(4,!0);c.blobSize=e.getInt32(8,!0);c.imageType=e.getInt32(12,!0);c.maxZError=e.getFloat64(16,!0);c.zMin=e.getFloat64(24,!0);c.zMax=e.getFloat64(32,!0);b+=40;d.headerInfo=c;d.ptr=b;if(3<=f&&(a=this.computeChecksumFletcher32(new Uint8Array(a,b-(4<=f?52:48),c.blobSize-14)),a!==c.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(a,
d){var b=d.headerInfo,e=this.getDataTypeArray(b.imageType),c=b.numDims*this.getDataTypeSize(b.imageType),f=this.readSubArray(a,d.ptr,e,c);a=this.readSubArray(a,d.ptr+c,e,c);d.ptr+=2*c;c=!0;for(d=0;d<b.numDims;d++)if(f[d]!==a[d]){c=!1;break}b.minValues=f;b.maxValues=a;return c},readSubArray:function(a,d,g,e){if(g===Uint8Array)a=new Uint8Array(a,d,e);else{var c=new ArrayBuffer(e);(new Uint8Array(c)).set(new Uint8Array(a,d,e));a=new g(c)}return a},readMask:function(a,d){var b=d.ptr,e=d.headerInfo,c=
e.width*e.height,f=e.numValidPixel,k=new DataView(a,b,4),e={};e.numBytes=k.getUint32(0,!0);b+=4;if((0===f||c===f)&&0!==e.numBytes)throw"invalid mask";if(0===f)f=new Uint8Array(Math.ceil(c/8)),e.bitset=f,k=new Uint8Array(c),d.pixels.resultMask=k,b+=e.numBytes;else if(0<e.numBytes){f=new Uint8Array(Math.ceil(c/8));k=new DataView(a,b,e.numBytes);a=k.getInt16(0,!0);var p=2,l=0,r=0;do{if(0<a)for(;a--;)f[l++]=k.getUint8(p++);else for(r=k.getUint8(p++),a=-a;a--;)f[l++]=r;a=k.getInt16(p,!0);p+=2}while(p<
e.numBytes);if(-32768!==a||l<f.length)throw"Unexpected end of mask RLE encoding";k=new Uint8Array(c);for(p=p=a=0;p<c;p++)p&7?(a=f[p>>3],a<<=p&7):a=f[p>>3],a&128&&(k[p]=1);d.pixels.resultMask=k;e.bitset=f;b+=e.numBytes}d.ptr=b;d.mask=e;return!0},readDataOneSweep:function(a,d,g){var b=d.ptr,c=d.headerInfo,f=c.numDims,k=c.width*c.height,c=c.numValidPixel*h.getDataTypeSize(c.imageType)*f,p=d.pixels.resultMask;if(g===Uint8Array)a=new Uint8Array(a,b,c);else{var l=new ArrayBuffer(c);(new Uint8Array(l)).set(new Uint8Array(a,
b,c));a=new g(l)}if(a.length===k*f)d.pixels.resultPixels=a;else{d.pixels.resultPixels=new g(k*f);var r=l=g=0,q=0;if(1<f)for(r=0;r<f;r++)for(q=r*k,l=0;l<k;l++)p[l]&&(d.pixels.resultPixels[q+l]=a[g++]);else for(l=0;l<k;l++)p[l]&&(d.pixels.resultPixels[l]=a[g++])}d.ptr=b+c;return!0},readHuffmanTree:function(b,d){var g=this.HUFFMAN_LUT_BITS_MAX,e=new DataView(b,d.ptr,16);d.ptr+=16;if(2>e.getInt32(0,!0))throw"unsupported Huffman version";var c=e.getInt32(4,!0),f=e.getInt32(8,!0),e=e.getInt32(12,!0);if(f>=
e)return!1;var k=new Uint32Array(e-f);h.decodeBits(b,d,k);var p=[],l,r,q;for(l=f;l<e;l++)r=l-(l<c?0:c),p[r]={first:k[l-f],second:null};l=b.byteLength-d.ptr;k=new ArrayBuffer(4*Math.ceil(l/4));(new Uint8Array(k)).set(new Uint8Array(b,d.ptr,l));b=new Uint32Array(k);d=0;var n,k=0;n=b[0];for(l=f;l<e;l++)r=l-(l<c?0:c),q=p[r].first,0<q&&(p[r].second=n<<d>>>32-q,32-d>=q?(d+=q,32===d&&(d=0,k++,n=b[k])):(d+=q-32,k++,n=b[k],p[r].second|=n>>>32-d));var t=n=0,B=new a;for(l=0;l<p.length;l++)void 0!==p[l]&&(n=
Math.max(n,p[l].first));var t=n>=g?g:n,g=[],u,v;for(l=f;l<e;l++)if(r=l-(l<c?0:c),q=p[r].first,0<q)if(f=[q,r],q<=t)for(r=p[r].second<<t-q,u=1<<t-q,q=0;q<u;q++)g[r|q]=f;else for(r=p[r].second,u=B,--q;0<=q;q--)(v=r>>>q&1)?(u.right||(u.right=new a),u=u.right):(u.left||(u.left=new a),u=u.left),0!==q||u.val||(u.val=f[1]);return{decodeLut:g,numBitsLUTQick:t,numBitsLUT:n,tree:B,stuffedData:b,srcPtr:k,bitPos:d}},readHuffman:function(a,d,g){var b=d.headerInfo,c=b.numDims,f=d.headerInfo.height,k=d.headerInfo.width,
p=k*f,l=this.readHuffmanTree(a,d);a=l.decodeLut;var r=l.tree,q=l.stuffedData,n=l.srcPtr,t=l.bitPos,h=l.numBitsLUTQick,l=l.numBitsLUT,u=0===d.headerInfo.imageType?128:0,v,x,w=d.pixels.resultMask,A,m,y,z,C,E,F=0;0<t&&(n++,t=0);var G=q[n],H=1===d.encodeMode,N=new g(p*c),J=N,P;for(P=0;P<b.numDims;P++){1<c&&(J=new g(N.buffer,p*P,p),F=0);if(d.headerInfo.numValidPixel===k*f)for(y=C=0;y<f;y++)for(z=0;z<k;z++,C++){x=0;v=A=G<<t>>>32-h;32-t<h&&(v=A|=q[n+1]>>>64-t-h);if(a[v])x=a[v][1],t+=a[v][0];else for(v=A=
G<<t>>>32-l,32-t<l&&(v=A|=q[n+1]>>>64-t-l),v=r,E=0;E<l;E++)if(v=(m=A>>>l-E-1&1)?v.right:v.left,!v.left&&!v.right){x=v.val;t=t+E+1;break}32<=t&&(t-=32,n++,G=q[n]);x-=u;H?(x=0<z?x+F:0<y?x+J[C-k]:x+F,x&=255,F=J[C]=x):J[C]=x}else for(y=C=0;y<f;y++)for(z=0;z<k;z++,C++)if(w[C]){x=0;v=A=G<<t>>>32-h;32-t<h&&(v=A|=q[n+1]>>>64-t-h);if(a[v])x=a[v][1],t+=a[v][0];else for(v=A=G<<t>>>32-l,32-t<l&&(v=A|=q[n+1]>>>64-t-l),v=r,E=0;E<l;E++)if(v=(m=A>>>l-E-1&1)?v.right:v.left,!v.left&&!v.right){x=v.val;t=t+E+1;break}32<=
t&&(t-=32,n++,G=q[n]);x-=u;H?(x=0<z&&w[C-1]?x+F:0<y&&w[C-k]?x+J[C-k]:x+F,x&=255,F=J[C]=x):J[C]=x}d.ptr=d.ptr+4*(n+1)+(0<t?4:0)}d.pixels.resultPixels=N},decodeBits:function(a,d,g,e,c){var f=d.headerInfo,b=f.fileVersion,p=0,l=new DataView(a,d.ptr,5<=a.byteLength-d.ptr?5:a.byteLength-d.ptr),r=l.getUint8(0);p++;var q=r>>6,n=0===q?4:3-q,t=0<(r&32)?!0:!1,q=r&31,r=0;if(1===n)r=l.getUint8(p),p++;else if(2===n)r=l.getUint16(p,!0),p+=2;else if(4===n)r=l.getUint32(p,!0),p+=4;else throw"Invalid valid pixel count type";
var n=2*f.maxZError,h,u;c=1<f.numDims?f.maxValues[c]:f.zMax;if(t){d.counter.lut++;t=l.getUint8(p);p++;f=Math.ceil((t-1)*q/8);h=Math.ceil(f/4);h=new ArrayBuffer(4*h);u=new Uint8Array(h);d.ptr+=p;u.set(new Uint8Array(a,d.ptr,f));p=new Uint32Array(h);d.ptr+=f;for(l=0;t-1>>>l;)l++;f=Math.ceil(r*l/8);h=Math.ceil(f/4);h=new ArrayBuffer(4*h);u=new Uint8Array(h);u.set(new Uint8Array(a,d.ptr,f));a=new Uint32Array(h);d.ptr+=f;d=3<=b?m.unstuffLUT2(p,q,t-1,e,n,c):m.unstuffLUT(p,q,t-1,e,n,c);3<=b?m.unstuff2(a,
g,l,r,d):m.unstuff(a,g,l,r,d)}else d.counter.bitstuffer++,l=q,d.ptr+=p,0<l&&(f=Math.ceil(r*l/8),h=Math.ceil(f/4),h=new ArrayBuffer(4*h),u=new Uint8Array(h),u.set(new Uint8Array(a,d.ptr,f)),a=new Uint32Array(h),d.ptr+=f,3<=b?null==e?m.originalUnstuff2(a,g,l,r):m.unstuff2(a,g,l,r,!1,e,n,c):null==e?m.originalUnstuff(a,g,l,r):m.unstuff(a,g,l,r,!1,e,n,c))},readTiles:function(a,d,g){var b=d.headerInfo,c=b.width,f=b.height,k=b.microBlockSize,p=b.imageType,l=h.getDataTypeSize(p),r=Math.ceil(c/k),q=Math.ceil(f/
k);d.pixels.numBlocksY=q;d.pixels.numBlocksX=r;for(var n=d.pixels.ptr=0,t=0,B=0,u=0,v=0,x=0,w=0,A=0,m=0,y=0,z=0,C=0,E=0,w=E=w=0,F,G=new g(k*k),H=f%k||k,N=c%k||k,J=b.numDims,P,I=d.pixels.resultMask,L=d.pixels.resultPixels,W=5<=b.fileVersion?14:15,M=b.zMax,B=0;B<q;B++)for(v=B!==q-1?k:H,u=0;u<r;u++)for(x=u!==r-1?k:N,z=B*c*k+u*k,C=c-x,P=0;P<J;P++){1<J?(E=L,z=B*c*k+u*k,L=new g(d.pixels.resultPixels.buffer,c*f*P*l,c*f),M=b.maxValues[P]):E=null;w=a.byteLength-d.ptr;n=new DataView(a,d.ptr,Math.min(10,w));
t={};w=0;A=n.getUint8(0);w++;F=5<=b.fileVersion?A&4:0;m=A>>6&255;y=A>>2&W;if(y!==(u*k>>3&W))throw"integrity issue";if(F&&0===P)throw"integrity issue";A&=3;if(3<A)throw d.ptr+=w,"Invalid block encoding ("+A+")";if(2===A){if(F)if(I)for(n=0;n<v;n++)for(t=0;t<x;t++)I[z]&&(L[z]=E[z]),z++;else for(n=0;n<v;n++)for(t=0;t<x;t++)L[z]=E[z],z++;d.counter.constant++;d.ptr+=w}else if(0===A){if(F)throw"integrity issue";d.counter.uncompressed++;d.ptr+=w;E=v*x*l;w=a.byteLength-d.ptr;E=E<w?E:w;w=new ArrayBuffer(0===
E%l?E:E+l-E%l);F=new Uint8Array(w);F.set(new Uint8Array(a,d.ptr,E));w=new g(w);E=0;if(I)for(n=0;n<v;n++){for(t=0;t<x;t++)I[z]&&(L[z]=w[E++]),z++;z+=C}else for(n=0;n<v;n++){for(t=0;t<x;t++)L[z++]=w[E++];z+=C}d.ptr+=E*l}else if(m=h.getDataTypeUsed(F&&6>p?5:p,m),y=h.getOnePixel(t,w,m,n),w+=h.getDataTypeSize(m),3===A)if(d.ptr+=w,d.counter.constantoffset++,I)for(n=0;n<v;n++){for(t=0;t<x;t++)I[z]&&(L[z]=F?Math.min(M,E[z]+y):y),z++;z+=C}else for(n=0;n<v;n++){for(t=0;t<x;t++)L[z]=F?Math.min(M,E[z]+y):y,z++;
z+=C}else if(d.ptr+=w,h.decodeBits(a,d,G,y,P),w=0,F)if(I)for(n=0;n<v;n++){for(t=0;t<x;t++)I[z]&&(L[z]=G[w++]+E[z]),z++;z+=C}else for(n=0;n<v;n++){for(t=0;t<x;t++)L[z]=G[w++]+E[z],z++;z+=C}else if(I)for(n=0;n<v;n++){for(t=0;t<x;t++)I[z]&&(L[z]=G[w++]),z++;z+=C}else for(n=0;n<v;n++){for(t=0;t<x;t++)L[z++]=G[w++];z+=C}}},formatFileInfo:function(a){return{fileIdentifierString:a.headerInfo.fileIdentifierString,fileVersion:a.headerInfo.fileVersion,imageType:a.headerInfo.imageType,height:a.headerInfo.height,
width:a.headerInfo.width,numValidPixel:a.headerInfo.numValidPixel,microBlockSize:a.headerInfo.microBlockSize,blobSize:a.headerInfo.blobSize,maxZError:a.headerInfo.maxZError,pixelType:h.getPixelType(a.headerInfo.imageType),eofOffset:a.eofOffset,mask:a.mask?{numBytes:a.mask.numBytes}:null,pixels:{numBlocksX:a.pixels.numBlocksX,numBlocksY:a.pixels.numBlocksY,maxValue:a.headerInfo.zMax,minValue:a.headerInfo.zMin,noDataValue:a.noDataValue}}},constructConstantSurface:function(a){var b=a.headerInfo.zMax,
g=a.headerInfo.numDims,e=a.headerInfo.height*a.headerInfo.width,c=0,f=0,k=0,p=a.pixels.resultMask,l=a.pixels.resultPixels;if(p)if(1<g)for(c=0;c<g;c++)for(k=c*e,b=a.headerInfo.maxValues[c],f=0;f<e;f++)p[f]&&(l[k+f]=b);else for(f=0;f<e;f++)p[f]&&(l[f]=b);else if(1<g)for(c=0;c<g;c++)for(k=c*e,b=a.headerInfo.maxValues[c],f=0;f<e;f++)l[k+f]=b;else for(f=0;f<e;f++)l[f]=b},getDataTypeArray:function(a){switch(a){case 0:a=Int8Array;break;case 1:a=Uint8Array;break;case 2:a=Int16Array;break;case 3:a=Uint16Array;
break;case 4:a=Int32Array;break;case 5:a=Uint32Array;break;case 6:a=Float32Array;break;case 7:a=Float64Array;break;default:a=Float32Array}return a},getPixelType:function(a){switch(a){case 0:a="S8";break;case 1:a="U8";break;case 2:a="S16";break;case 3:a="U16";break;case 4:a="S32";break;case 5:a="U32";break;case 6:a="F32";break;case 7:a="F64";break;default:a="F32"}return a},isValidPixelValue:function(a,d){if(null==d)return!1;switch(a){case 0:a=-128<=d&&127>=d;break;case 1:a=0<=d&&255>=d;break;case 2:a=
-32768<=d&&32767>=d;break;case 3:a=0<=d&&65536>=d;break;case 4:a=-2147483648<=d&&2147483647>=d;break;case 5:a=0<=d&&4294967296>=d;break;case 6:a=-3.4027999387901484E38<=d&&3.4027999387901484E38>=d;break;case 7:a=4.9E-324<=d&&1.7976931348623157E308>=d;break;default:a=!1}return a},getDataTypeSize:function(a){var b=0;switch(a){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=a}return b},getDataTypeUsed:function(a,d){var b=a;switch(a){case 2:case 4:b=
a-d;break;case 3:case 5:b=a-2*d;break;case 6:b=0===d?a:1===d?2:1;break;case 7:b=0===d?a:a-2*d+1;break;default:b=a}return b},getOnePixel:function(a,d,g,e){a=0;switch(g){case 0:a=e.getInt8(d);break;case 1:a=e.getUint8(d);break;case 2:a=e.getInt16(d,!0);break;case 3:a=e.getUint16(d,!0);break;case 4:a=e.getInt32(d,!0);break;case 5:a=e.getUInt32(d,!0);break;case 6:a=e.getFloat32(d,!0);break;case 7:a=e.getFloat64(d,!0);break;default:throw"the decoder does not understand this pixel type";}return a}},a=function(a,
d,g){this.val=a;this.left=d;this.right=g};return{decode:function(a,d){d=d||{};var b=d.noDataValue,e=0,c={};c.ptr=d.inputOffset||0;c.pixels={};if(h.readHeaderInfo(a,c)){var e=c.headerInfo,f=e.fileVersion,k=h.getDataTypeArray(e.imageType);if(5<f)throw"unsupported lerc version 2."+f;h.readMask(a,c);e.numValidPixel===e.width*e.height||c.pixels.resultMask||(c.pixels.resultMask=d.maskData);var p=e.width*e.height;c.pixels.resultPixels=new k(p*e.numDims);c.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,
constant:0,constantoffset:0};if(0!==e.numValidPixel)if(e.zMax===e.zMin)h.constructConstantSurface(c);else if(4<=f&&h.checkMinMaxRanges(a,c))h.constructConstantSurface(c);else{var l=new DataView(a,c.ptr,2),r=l.getUint8(0);c.ptr++;if(r)h.readDataOneSweep(a,c,k);else if(1<f&&1>=e.imageType&&1E-5>Math.abs(e.maxZError-.5)){l=l.getUint8(1);c.ptr++;c.encodeMode=l;if(2<l||4>f&&1<l)throw"Invalid Huffman flag "+l;l?h.readHuffman(a,c,k):h.readTiles(a,c,k)}else h.readTiles(a,c,k)}c.eofOffset=c.ptr;d.inputOffset?
(a=c.headerInfo.blobSize+d.inputOffset-c.ptr,1<=Math.abs(a)&&(c.eofOffset=d.inputOffset+c.headerInfo.blobSize)):(a=c.headerInfo.blobSize-c.ptr,1<=Math.abs(a)&&(c.eofOffset=c.headerInfo.blobSize));a={width:e.width,height:e.height,pixelData:c.pixels.resultPixels,minValue:e.zMin,maxValue:e.zMax,validPixelCount:e.numValidPixel,dimCount:e.numDims,dimStats:{minValues:e.minValues,maxValues:e.maxValues},maskData:c.pixels.resultMask};if(c.pixels.resultMask&&h.isValidPixelValue(e.imageType,b)){f=c.pixels.resultMask;
for(e=0;e<p;e++)f[e]||(a.pixelData[e]=b);a.noDataValue=b}c.noDataValue=b;d.returnFileInfo&&(a.fileInfo=h.formatFileInfo(c));return a}},getBandCount:function(a){for(var b=0,g=0,e={ptr:0,pixels:{}};g<a.byteLength-58;)h.readHeaderInfo(a,e),g+=e.headerInfo.blobSize,b++,e.ptr=g;return b}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(m,h,a){return m(null,{constructor:function(){},decode:function(b){var d=new Uint8Array(b);b=new a;b.parse(d);var g=
b.numComponents,e=b.getData(b.width,b.height,!0),c,f=b.width*b.height,k=b.eof,p=0,l=0,r=0;if(k<d.length-1)for(l=(new h(d.subarray(k))).getBytes(),c=new Uint8Array(f),p=d=0;p<l.length;p++)for(r=7;0<=r;r--)c[d++]=l[p]>>r&1;d=[];if(1===g)d=[e,e,e];else{for(p=0;3>p;p++)g=new Uint8Array(f),d.push(g);for(l=r=0;l<f;l++)for(p=0;3>p;p++)d[p][l]=e[r++]}return{width:b.width,height:b.height,pixels:d,mask:c}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var m=function(){function h(){this.bufferLength=
this.pos=0;this.eof=!1;this.buffer=null}h.prototype={ensureBuffer:function(a){var b=this.buffer,d=b?b.byteLength:0;if(a<d)return b;for(var g=512;g<a;)g<<=1;a=new Uint8Array(g);for(g=0;g<d;++g)a[g]=b[g];return this.buffer=a},getByte:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(a){var b=this.pos;if(a){this.ensureBuffer(b+a);for(a=b+a;!this.eof&&this.bufferLength<a;)this.readBlock();var d=this.bufferLength;
a>d&&(a=d)}else{for(;!this.eof;)this.readBlock();a=this.bufferLength}this.pos=a;return this.buffer.subarray(b,a)},lookChar:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(a,b,d){for(var g=a+b;this.bufferLength<=g&&!this.eof;)this.readBlock();
return new Stream(this.buffer,a,b,d)},skip:function(a){a||(a=1);this.pos+=a},reset:function(){this.pos=0}};return h}();return function(){function h(a){throw Error(a);}function a(a){var c=0,f=a[c++],b=a[c++];-1!=f&&-1!=b||h("Invalid header in flate stream");8!=(f&15)&&h("Unknown compression method in flate stream");0!=((f<<8)+b)%31&&h("Bad FCHECK in flate stream");b&32&&h("FDICT bit set in flate stream");this.bytes=a;this.bytesPos=c;this.codeBuf=this.codeSize=0;m.call(this)}if(!self||!self.Uint32Array)return null;
var b=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),g=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),e=[new Uint32Array([459008,524368,
524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,
524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,
524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,
524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,
524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,
524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,
524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,
524335,590015,524303,524431,524367,590079]),9],c=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];a.prototype=Object.create(m.prototype);a.prototype.getBits=function(a){for(var c=this.codeSize,f=this.codeBuf,b=this.bytes,e=this.bytesPos,d;c<a;)"undefined"==typeof(d=b[e++])&&h("Bad encoding in flate stream"),f|=d<<
c,c+=8;this.codeBuf=f>>a;this.codeSize=c-=a;this.bytesPos=e;return f&(1<<a)-1};a.prototype.getCode=function(a){var c=a[0],f=a[1];a=this.codeSize;for(var b=this.codeBuf,e=this.bytes,d=this.bytesPos;a<f;){var g;"undefined"==typeof(g=e[d++])&&h("Bad encoding in flate stream");b|=g<<a;a+=8}f=c[b&(1<<f)-1];c=f>>16;f&=65535;(0==a||a<c||0==c)&&h("Bad encoding in flate stream");this.codeBuf=b>>c;this.codeSize=a-c;this.bytesPos=d;return f};a.prototype.generateHuffmanTable=function(a){for(var c=a.length,f=
0,b=0;b<c;++b)a[b]>f&&(f=a[b]);for(var e=1<<f,d=new Uint32Array(e),g=1,t=0,h=2;g<=f;++g,t<<=1,h<<=1)for(var u=0;u<c;++u)if(a[u]==g){for(var v=0,x=t,b=0;b<g;++b)v=v<<1|x&1,x>>=1;for(b=v;b<e;b+=h)d[b]=g<<16|u;++t}return[d,f]};a.prototype.readBlock=function(){function a(a,c,f,b,e){for(a=a.getBits(f)+b;0<a--;)c[t++]=e}var k=this.getBits(3);k&1&&(this.eof=!0);k>>=1;if(0==k){var p=this.bytes,l=this.bytesPos,r;"undefined"==typeof(r=p[l++])&&h("Bad block header in flate stream");var q=r;"undefined"==typeof(r=
p[l++])&&h("Bad block header in flate stream");q|=r<<8;"undefined"==typeof(r=p[l++])&&h("Bad block header in flate stream");k=r;"undefined"==typeof(r=p[l++])&&h("Bad block header in flate stream");(k|r<<8)!=(~q&65535)&&h("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;r=this.bufferLength;k=this.ensureBuffer(r+q);this.bufferLength=q=r+q;for(var n=r;n<q;++n){if("undefined"==typeof(r=p[l++])){this.eof=!0;break}k[n]=r}this.bytesPos=l}else{if(1==k)l=e,r=c;else if(2==k){k=
this.getBits(5)+257;r=this.getBits(5)+1;for(var p=this.getBits(4)+4,l=Array(b.length),t=0;t<p;)l[b[t++]]=this.getBits(3);l=this.generateHuffmanTable(l);t=p=0;r=k+r;for(q=Array(r);t<r;)n=this.getCode(l),16==n?a(this,q,2,3,p):17==n?a(this,q,3,3,p=0):18==n?a(this,q,7,11,p=0):q[t++]=p=n;l=this.generateHuffmanTable(q.slice(0,k));r=this.generateHuffmanTable(q.slice(k,r))}else h("Unknown block type in flate stream");q=(k=this.buffer)?k.length:0;for(n=this.bufferLength;;){var B=this.getCode(l);if(256>B)n+
1>=q&&(k=this.ensureBuffer(n+1),q=k.length),k[n++]=B;else{if(256==B){this.bufferLength=n;break}var B=B-257,B=d[B],u=B>>16;0<u&&(u=this.getBits(u));p=(B&65535)+u;B=this.getCode(r);B=g[B];u=B>>16;0<u&&(u=this.getBits(u));B=(B&65535)+u;n+p>=q&&(k=this.ensureBuffer(n+p),q=k.length);for(u=0;u<p;++u,++n)k[n]=k[n-B]}}}};return a}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var m=function(){function h(a){this.message="JPEG error: "+a}h.prototype=Error();h.prototype.name="JpegError";
return h.constructor=h}();return function(){function h(){this.decodeTransform=null;this.colorTransform=-1}function a(a,f){for(var c=0,b=[],e,d,g=16;0<g&&!a[g-1];)g--;b.push({children:[],index:0});var n=b[0],t;for(e=0;e<g;e++){for(d=0;d<a[e];d++){n=b.pop();for(n.children[n.index]=f[c];0<n.index;)n=b.pop();n.index++;for(b.push(n);b.length<=e;)b.push(t={children:[],index:0}),n.children[n.index]=t.children,n=t;c++}e+1<g&&(b.push(t={children:[],index:0}),n.children[n.index]=t.children,n=t)}return b[0].children}
function b(a,f,b,d,l,r,h,n,t){function c(){if(0<G)return G--,F>>G&1;F=a[f++];if(255===F){var c=a[f++];if(c)throw new m("unexpected marker "+(F<<8|c).toString(16));}G=7;return F>>>7}function k(a){for(;;){a=a[c()];if("number"===typeof a)return a;if("object"!==typeof a)throw new m("invalid huffman sequence");}}function p(a){for(var f=0;0<a;)f=f<<1|c(),a--;return f}function q(a){if(1===a)return 1===c()?1:-1;var f=p(a);return f>=1<<a-1?f:f+(-1<<a)+1}function w(a,c){var f=k(a.huffmanTableDC),f=0===f?0:
q(f);a.blockData[c]=a.pred+=f;for(f=1;64>f;){var b=k(a.huffmanTableAC),d=b&15,b=b>>4;if(0===d){if(15>b)break;f+=16}else f+=b,a.blockData[c+e[f]]=q(d),f++}}function A(a,c){var f=k(a.huffmanTableDC),f=0===f?0:q(f)<<t;a.blockData[c]=a.pred+=f}function D(a,f){a.blockData[f]|=c()<<t}function y(a,c){if(0<H)H--;else for(var f=r;f<=h;){var b=k(a.huffmanTableAC),d=b&15,b=b>>4;if(0===d){if(15>b){H=p(b)+(1<<b)-1;break}f+=16}else f+=b,a.blockData[c+e[f]]=q(d)*(1<<t),f++}}function z(a,f){for(var b=r,d=0,l;b<=
h;){l=e[b];switch(N){case 0:d=k(a.huffmanTableAC);l=d&15;d>>=4;if(0===l)15>d?(H=p(d)+(1<<d),N=4):(d=16,N=1);else{if(1!==l)throw new m("invalid ACn encoding");J=q(l);N=d?2:3}continue;case 1:case 2:a.blockData[f+l]?a.blockData[f+l]+=c()<<t:(d--,0===d&&(N=2===N?3:0));break;case 3:a.blockData[f+l]?a.blockData[f+l]+=c()<<t:(a.blockData[f+l]=J<<t,N=0);break;case 4:a.blockData[f+l]&&(a.blockData[f+l]+=c()<<t)}b++}4===N&&(H--,0===H&&(N=0))}var C=b.mcusPerLine,E=f,F=0,G=0,H=0,N=0,J,P=d.length,I,L,W,M,U;n=
b.progressive?0===r?0===n?A:D:0===n?y:z:w;var O=0;b=1===P?d[0].blocksPerLine*d[0].blocksPerColumn:C*b.mcusPerColumn;for(var ba,za;O<b;){var da=l?Math.min(b-O,l):b;for(L=0;L<P;L++)d[L].pred=0;H=0;if(1===P)for(I=d[0],U=0;U<da;U++)n(I,64*((I.blocksPerLine+1)*(O/I.blocksPerLine|0)+O%I.blocksPerLine)),O++;else for(U=0;U<da;U++){for(L=0;L<P;L++)for(I=d[L],ba=I.h,za=I.v,W=0;W<za;W++)for(M=0;M<ba;M++)n(I,64*((I.blocksPerLine+1)*((O/C|0)*I.v+W)+(O%C*I.h+M)));O++}G=0;(I=g(a,f))&&I.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+
I.invalid),f=I.offset);I=I&&I.marker;if(!I||65280>=I)throw new m("marker was not found");if(65488<=I&&65495>=I)f+=2;else break}(I=g(a,f))&&I.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+I.invalid),f=I.offset);return f-E}function d(a,f){a=f.blocksPerLine;for(var c=f.blocksPerColumn,b=new Int16Array(64),e=0;e<c;e++)for(var d=0;d<a;d++){var g=64*((f.blocksPerLine+1)*e+d),n=b,t=f.quantizationTable,h=f.blockData,u=void 0,v=void 0,x=void 0,w=void 0,A=void 0,D=void 0,y=void 0,
z=void 0,C=void 0,E=z=void 0,F=y=v=D=void 0,G=void 0,C=void 0;if(!t)throw new m("missing required Quantization Table.");for(var H=0;64>H;H+=8)C=h[g+H],z=h[g+H+1],E=h[g+H+2],D=h[g+H+3],v=h[g+H+4],y=h[g+H+5],F=h[g+H+6],G=h[g+H+7],C*=t[H],0===(z|E|D|v|y|F|G)?(C=5793*C+512>>10,n[H]=C,n[H+1]=C,n[H+2]=C,n[H+3]=C,n[H+4]=C,n[H+5]=C,n[H+6]=C,n[H+7]=C):(z*=t[H+1],E*=t[H+2],D*=t[H+3],v*=t[H+4],y*=t[H+5],F*=t[H+6],G*=t[H+7],u=5793*C+128>>8,v=5793*v+128>>8,x=E,w=F,A=2896*(z-G)+128>>8,z=2896*(z+G)+128>>8,D<<=4,
y<<=4,u=u+v+1>>1,v=u-v,C=3784*x+1567*w+128>>8,x=1567*x-3784*w+128>>8,w=C,A=A+y+1>>1,y=A-y,z=z+D+1>>1,D=z-D,u=u+w+1>>1,w=u-w,v=v+x+1>>1,x=v-x,C=2276*A+3406*z+2048>>12,A=3406*A-2276*z+2048>>12,z=C,C=799*D+4017*y+2048>>12,D=4017*D-799*y+2048>>12,y=C,n[H]=u+z,n[H+7]=u-z,n[H+1]=v+y,n[H+6]=v-y,n[H+2]=x+D,n[H+5]=x-D,n[H+3]=w+A,n[H+4]=w-A);for(t=0;8>t;++t)C=n[t],z=n[t+8],E=n[t+16],D=n[t+24],v=n[t+32],y=n[t+40],F=n[t+48],G=n[t+56],0===(z|E|D|v|y|F|G)?(C=5793*C+8192>>14,C=-2040>C?0:2024<=C?255:C+2056>>4,h[g+
t]=C,h[g+t+8]=C,h[g+t+16]=C,h[g+t+24]=C,h[g+t+32]=C,h[g+t+40]=C,h[g+t+48]=C,h[g+t+56]=C):(u=5793*C+2048>>12,v=5793*v+2048>>12,x=E,w=F,A=2896*(z-G)+2048>>12,z=2896*(z+G)+2048>>12,u=(u+v+1>>1)+4112,v=u-v,C=3784*x+1567*w+2048>>12,x=1567*x-3784*w+2048>>12,w=C,A=A+y+1>>1,y=A-y,z=z+D+1>>1,D=z-D,u=u+w+1>>1,w=u-w,v=v+x+1>>1,x=v-x,C=2276*A+3406*z+2048>>12,A=3406*A-2276*z+2048>>12,z=C,C=799*D+4017*y+2048>>12,D=4017*D-799*y+2048>>12,y=C,C=u+z,G=u-z,z=v+y,F=v-y,E=x+D,y=x-D,D=w+A,v=w-A,C=16>C?0:4080<=C?255:C>>
4,z=16>z?0:4080<=z?255:z>>4,E=16>E?0:4080<=E?255:E>>4,D=16>D?0:4080<=D?255:D>>4,v=16>v?0:4080<=v?255:v>>4,y=16>y?0:4080<=y?255:y>>4,F=16>F?0:4080<=F?255:F>>4,G=16>G?0:4080<=G?255:G>>4,h[g+t]=C,h[g+t+8]=z,h[g+t+16]=E,h[g+t+24]=D,h[g+t+32]=v,h[g+t+40]=y,h[g+t+48]=F,h[g+t+56]=G)}return f.blockData}function g(a,f,b){var c=a.length-1;b=b<f?b:f;if(f>=c)return null;var e=a[f]<<8|a[f+1];if(65472<=e&&65534>=e)return{invalid:null,marker:e,offset:f};for(f=a[b]<<8|a[b+1];!(65472<=f&&65534>=f);){if(++b>=c)return null;
f=a[b]<<8|a[b+1]}return{invalid:e.toString(16),marker:f,offset:b}}if(!self||!self.Uint8ClampedArray)return null;var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);h.prototype={parse:function(c){function f(){var a=c[l]<<8|c[l+1];l+=2;return a}function k(){var a=f(),a=l+a-2,b=g(c,a,l);b&&b.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+
b.invalid),a=b.offset);a=c.subarray(l,a);l+=a.length;return a}function p(a){for(var c=Math.ceil(a.samplesPerLine/8/a.maxH),f=Math.ceil(a.scanLines/8/a.maxV),b=0;b<a.components.length;b++){E=a.components[b];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*E.h/a.maxH),k=Math.ceil(Math.ceil(a.scanLines/8)*E.v/a.maxV);E.blockData=new Int16Array(64*f*E.v*(c*E.h+1));E.blocksPerLine=e;E.blocksPerColumn=k}a.mcusPerLine=c;a.mcusPerColumn=f}var l=0,h=null,q=null,n,t,B=[],u=[],v=[],x=f();if(65496!==x)throw new m("SOI not found");
for(x=f();65497!==x;){var w,A;switch(x){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:w=k();65504===x&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(h={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])});65518===x&&65===w[0]&&100===
w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&(q={version:w[5]<<8|w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var x=f()+l-2,D;l<x;){var y=c[l++],z=new Uint16Array(64);if(0===y>>4)for(w=0;64>w;w++)D=e[w],z[D]=c[l++];else if(1===y>>4)for(w=0;64>w;w++)D=e[w],z[D]=f();else throw new m("DQT - invalid table spec");B[y&15]=z}break;case 65472:case 65473:case 65474:if(n)throw new m("Only single frame JPEGs supported");f();n={};n.extended=65473===x;n.progressive=65474===
x;n.precision=c[l++];n.scanLines=f();n.samplesPerLine=f();n.components=[];n.componentIds={};w=c[l++];for(x=z=y=0;x<w;x++){D=c[l];A=c[l+1]>>4;var C=c[l+1]&15;y<A&&(y=A);z<C&&(z=C);A=n.components.push({h:A,v:C,quantizationId:c[l+2],quantizationTable:null});n.componentIds[D]=A-1;l+=3}n.maxH=y;n.maxV=z;p(n);break;case 65476:D=f();for(x=2;x<D;){y=c[l++];z=new Uint8Array(16);for(w=A=0;16>w;w++,l++)A+=z[w]=c[l];C=new Uint8Array(A);for(w=0;w<A;w++,l++)C[w]=c[l];x+=17+A;(0===y>>4?v:u)[y&15]=a(z,C)}break;case 65501:f();
t=f();break;case 65498:f();D=c[l++];w=[];for(var E,x=0;x<D;x++)y=n.componentIds[c[l++]],E=n.components[y],y=c[l++],E.huffmanTableDC=v[y>>4],E.huffmanTableAC=u[y&15],w.push(E);x=c[l++];D=c[l++];y=c[l++];x=b(c,l,n,w,t,x,D,y>>4,y&15);l+=x;break;case 65535:255!==c[l]&&l--;break;default:if(255===c[l-3]&&192<=c[l-2]&&254>=c[l-2])l-=3;else throw new m("unknown marker "+x.toString(16));}x=f()}this.width=n.samplesPerLine;this.height=n.scanLines;this.jfif=h;this.eof=l;this.adobe=q;this.components=[];for(x=
0;x<n.components.length;x++){E=n.components[x];if(h=B[E.quantizationId])E.quantizationTable=h;this.components.push({output:d(n,E),scaleX:E.h/n.maxH,scaleY:E.v/n.maxV,blocksPerLine:E.blocksPerLine,blocksPerColumn:E.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(a,f){var c=this.width/a,b=this.height/f,e,d,g,h,t,B,u=0,v,x=this.components.length,w=a*f*x,A=new Uint8ClampedArray(w),m=new Uint32Array(a);for(B=0;B<x;B++){e=this.components[B];d=e.scaleX*c;g=e.scaleY*
b;u=B;v=e.output;h=e.blocksPerLine+1<<3;for(t=0;t<a;t++)e=0|t*d,m[t]=(e&4294967288)<<3|e&7;for(d=0;d<f;d++)for(e=0|d*g,e=h*(e&4294967288)|(e&7)<<3,t=0;t<a;t++)A[u]=v[e+m[t]],u+=x}if(f=this.decodeTransform)for(B=0;B<w;)for(a=e=0;e<x;e++,B++,a+=2)A[B]=(A[B]*f[a]>>8)+f[a+1];return A},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,b,e,d=0,g=a.length;d<
g;d+=3)c=a[d],b=a[d+1],e=a[d+2],a[d]=c-179.456+1.402*e,a[d+1]=c+135.459-.344*b-.714*e,a[d+2]=c-226.816+1.772*b;return a},_convertYcckToRgb:function(a){for(var c,b,e,d,g=0,h=0,n=a.length;h<n;h+=4)c=a[h],b=a[h+1],e=a[h+2],d=a[h+3],a[g++]=-122.67195406894+b*(-6.60635669420364E-5*b+4.37130475926232E-4*e-5.4080610064599E-5*c+4.8449797120281E-4*d-.154362151871126)+e*(-9.57964378445773E-4*e+8.17076911346625E-4*c-.00477271405408747*d+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*d+.48357088451265)+
d*(-3.36197177618394E-4*d+.484791561490776),a[g++]=107.268039397724+b*(2.19927104525741E-5*b-6.40992018297945E-4*e+6.59397001245577E-4*c+4.26105652938837E-4*d-.176491792462875)+e*(-7.78269941513683E-4*e+.00130872261408275*c+7.70482631801132E-4*d-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*d+.25802910206845)+d*(-3.18913117588328E-4*d-.213742400323665),a[g++]=-20.810012546947+b*(-5.70115196973677E-4*b-2.63409051004589E-5*e+.0020741088115012*c-.00288260236853442*d+.814272968359295)+
e*(-1.53496057440975E-5*e-1.32689043961446E-4*c+5.60833691242812E-4*d-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*d+.116935020465145)+d*(-3.43531996510555E-4*d+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,b,e,d=0,g=a.length;d<g;d+=4)c=a[d],b=a[d+1],e=a[d+2],a[d]=434.456-c-1.402*e,a[d+1]=119.541-c+.344*b+.714*e,a[d+2]=481.816-c-1.772*b;return a},_convertCmykToRgb:function(a){for(var c,b,e,d,g=0,h=1/255,n=0,t=a.length;n<t;n+=4)c=a[n]*h,b=a[n+1]*h,e=a[n+2]*h,d=
a[n+3]*h,a[g++]=255+c*(-4.387332384609988*c+54.48615194189176*b+18.82290502165302*e+212.25662451639585*d-285.2331026137004)+b*(1.7149763477362134*b-5.6096736904047315*e-17.873870861415444*d-5.497006427196366)+e*(-2.5217340131683033*e-21.248923337353073*d+17.5119270841813)-d*(21.86122147463605*d+189.48180835922747),a[g++]=255+c*(8.841041422036149*c+60.118027045597366*b+6.871425592049007*e+31.159100130055922*d-79.2970844816548)+b*(-15.310361306967817*b+17.575251261109482*e+131.35250912493976*d-190.9453302588951)+
e*(4.444339102852739*e+9.8632861493405*d-24.86741582555878)-d*(20.737325471181034*d+187.80453709719578),a[g++]=255+c*(.8842522430003296*c+8.078677503112928*b+30.89978309703729*e-.23883238689178934*d-14.183576799673286)+b*(10.49593273432072*b+63.02378494754052*e+50.606957656360734*d-112.23884253719248)+e*(.03296041114873217*e+115.60384449646641*d-193.58209356861505)-d*(22.33816807309886*d+180.12613974708367);return a},getData:function(a,f,b){if(4<this.numComponents)throw new m("Unsupported color mode");
a=this._getLinearizedBlockData(a,f);if(1===this.numComponents&&b){b=a.length;f=new Uint8ClampedArray(3*b);for(var c=0,e=0;e<b;e++){var d=a[e];f[c++]=d;f[c++]=d;f[c++]=d}return f}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===this.numComponents){if(this._isColorConversionNeeded())return b?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(b)return this._convertCmykToRgb(a)}return a}};return h}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],
function(m){return function(){function h(a){var b,g,e,c;this.data=a;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(e=null;;){b=this.readUInt32();c=a=void 0;c=[];for(a=0;4>a;++a)c.push(String.fromCharCode(this.data[this.pos++]));a=c.join("");switch(a){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=
this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":e&&this.animation.frames.push(e);this.pos+=4;e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};a=this.readUInt16();b=this.readUInt16()||100;e.delay=1E3*a/b;e.disposeOp=this.data[this.pos++];e.blendOp=this.data[this.pos++];
e.data=[];break;case "IDAT":case "fdAT":"fdAT"===a&&(this.pos+=4,b-=4);a=(null!=e?e.data:void 0)||this.imgData;for(c=0;0<=b?c<b:c>b;0<=b?++c:--c)a.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;
case "tEXt":c=this.read(b);b=c.indexOf(0);a=String.fromCharCode.apply(String,c.slice(0,b));this.text[a]=String.fromCharCode.apply(String,c.slice(b+1));break;case "IEND":e&&this.animation.frames.push(e);a:{switch(this.colorType){case 0:case 3:case 4:e=1;break a;case 2:case 6:e=3;break a}e=void 0}this.colors=e;this.hasAlphaChannel=4===(g=this.colorType)||6===g;g=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*g;a:{switch(this.colors){case 1:g="DeviceGray";break a;case 3:g="DeviceRGB";
break a}g=void 0}this.colorSpace=g;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}var a;h.load=function(a,d,g){var b;"function"===typeof d&&(g=d);b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="arraybuffer";b.onload=function(){var a;a=new Uint8Array(b.response||b.mozResponseArrayBuffer);a=new h(a);"function"===typeof(null!=d?d.getContext:void 0)&&a.render(d);return"function"===typeof g?
g(a):void 0};return b.send(null)};h.prototype.read=function(a){var b,g;g=[];for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)g.push(this.data[this.pos++]);return g};h.prototype.readUInt32=function(){var a,d,g,e;a=this.data[this.pos++]<<24;d=this.data[this.pos++]<<16;g=this.data[this.pos++]<<8;e=this.data[this.pos++];return a|d|g|e};h.prototype.readUInt16=function(){var a,d;a=this.data[this.pos++]<<8;d=this.data[this.pos++];return a|d};h.prototype.decodePixels=function(a){var b,g,e,c,f,k,p,l,h,q,n,t,B,u,v;null==
a&&(a=this.imgData);if(0===a.length)return new Uint8Array(0);a=new m(a);a=a.getBytes();l=this.pixelBitlength/8;t=l*this.width;h=new Uint8Array(t*this.height);k=a.length;for(g=q=n=0;q<k;){switch(a[q++]){case 0:for(c=b=0;b<t;c=b+=1)h[g++]=a[q++];break;case 1:for(c=B=0;B<t;c=B+=1)b=a[q++],f=c<l?0:h[g-l],h[g++]=(b+f)%256;break;case 2:for(c=f=0;f<t;c=f+=1)b=a[q++],e=(c-c%l)/l,B=n&&h[(n-1)*t+e*l+c%l],h[g++]=(B+b)%256;break;case 3:for(c=v=0;v<t;c=v+=1)b=a[q++],e=(c-c%l)/l,f=c<l?0:h[g-l],B=n&&h[(n-1)*t+e*
l+c%l],h[g++]=(b+Math.floor((f+B)/2))%256;break;case 4:for(c=v=0;v<t;c=v+=1)b=a[q++],e=(c-c%l)/l,f=c<l?0:h[g-l],0===n?B=u=0:(B=h[(n-1)*t+e*l+c%l],u=e&&h[(n-1)*t+(e-1)*l+c%l]),p=f+B-u,c=Math.abs(p-f),e=Math.abs(p-B),p=Math.abs(p-u),f=c<=e&&c<=p?f:e<=p?B:u,h[g++]=(b+f)%256;break;default:throw Error("Invalid filter algorithm: "+a[q-1]);}n++}return h};h.prototype.decodePalette=function(){var a,d,g,e,c,f,k,p,l;g=this.palette;f=this.transparency.indexed||[];c=new Uint8Array((f.length||0)+g.length);d=k=
a=e=0;for(p=g.length;k<p;d=k+=3)c[e++]=g[d],c[e++]=g[d+1],c[e++]=g[d+2],c[e++]=null!=(l=f[a++])?l:255;return c};h.prototype.copyToImageData=function(a,d){var b,e,c,f,k,p,l;e=this.colors;l=null;b=this.hasAlphaChannel;this.palette.length&&(l=null!=(c=this._decodedPalette)?c:this._decodedPalette=this.decodePalette(),e=4,b=!0);a=a.data||a;p=a.length;f=l||d;c=k=0;if(1===e)for(;c<p;)e=l?4*d[c/4]:k,k=f[e++],a[c++]=k,a[c++]=k,a[c++]=k,a[c++]=b?f[e++]:this.transparency.grayscale&&this.transparency.grayscale===
k?0:255,k=e;else for(;c<p;)e=l?4*d[c/4]:k,a[c++]=f[e++],a[c++]=f[e++],a[c++]=f[e++],a[c++]=b?f[e++]:this.transparency.rgb&&this.transparency.rgb[1]===f[e-3]&&this.transparency.rgb[3]===f[e-2]&&this.transparency.rgb[5]===f[e-1]?0:255,k=e};h.prototype.decode=function(){var a;a=new Uint8Array(this.width*this.height*4);this.copyToImageData(a,this.decodePixels());return a};a=function(a){(void 0).clearRect(0,0,a.width,a.height);(void 0).putImageData(a,0,0);a=new Image;a.src=(void 0).toDataURL();return a};
h.prototype.decodeFrames=function(b){var d,g,e,c,f,k,p;if(this.animation){k=this.animation.frames;p=[];d=c=0;for(f=k.length;c<f;d=++c)d=k[d],g=b.createImageData(d.width,d.height),e=this.decodePixels(new Uint8Array(d.data)),this.copyToImageData(g,e),d.imageData=g,p.push(d.image=a(g));return p}};h.prototype.renderFrame=function(a,d){var b,e;e=this.animation.frames;b=e[d];e=e[d-1];0===d&&a.clearRect(0,0,this.width,this.height);1===(null!=e?e.disposeOp:void 0)?a.clearRect(e.xOffset,e.yOffset,e.width,
e.height):2===(null!=e?e.disposeOp:void 0)&&a.putImageData(e.imageData,e.xOffset,e.yOffset);0===b.blendOp&&a.clearRect(b.xOffset,b.yOffset,b.width,b.height);return a.drawImage(b.image,b.xOffset,b.yOffset)};h.prototype.animate=function(a){var b,g,e,c,f,k,p=this;g=0;k=this.animation;c=k.numFrames;e=k.frames;f=k.numPlays;return(b=function(){var k,d;k=g++%c;d=e[k];p.renderFrame(a,k);if(1<c&&g/c<f)return p.animation._timeout=setTimeout(b,d.delay)})()};h.prototype.stopAnimation=function(){var a;return clearTimeout(null!=
(a=this.animation)?a._timeout:void 0)};h.prototype.render=function(a){var b;a._png&&a._png.stopAnimation();a._png=this;a.width=this.width;a.height=this.height;a=a.getContext("2d");if(this.animation)return this.decodeFrames(a),this.animate(a);b=a.createImageData(this.width,this.height);this.copyToImageData(b,this.decodePixels());return a.putImageData(b,0,0)};return h}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(m,h){var a=h.pixelType,b=h.bandCount,
d=[],g=h.width*h.height,e=this.getBandCount(m,h),b=b||e,c=m.byteLength-m.byteLength%(g*this._getPixelLength(a)),f=new a(m,0,g*e),k,p,l,r;for(k=0;k<b;k++){r=new a(g);for(p=0;p<g;p++)r[p]=f[p*e+k];d.push(r)}c<m.byteLength-1&&(l=this._decodeMask(m.slice(c),h));return{pixels:d,maskData:l}},decodeBSQ:function(m,h){var a=h.pixelType,b=h.bandCount;if(void 0===b||null===b)b=this.getBandCount(m,h);for(var d=[],g=h.width*h.height,e=g*b,c=m.byteLength-m.byteLength%(g*this._getPixelLength(a)),a=new a(m,0,e),
f,e=0;e<b;e++)d.push(a.subarray(e*g,(e+1)*g));c<m.byteLength-1&&(f=this._decodeMask(m.slice(c),h));return{pixels:d,maskData:f}},getBandCount:function(m,h){return Math.floor(m.byteLength/(h.width*h.height*this._getPixelLength(h.pixelType)))},_getPixelLength:function(m){var h=1;switch(m){case Uint8Array:case Int8Array:case Uint8ClampedArray:h=1;break;case Uint16Array:case Int16Array:h=2;break;case Uint32Array:case Int32Array:case Float32Array:h=4;break;case Float64Array:h=8}return h},_decodeMask:function(m,
h){var a=h.width*h.height;if(8*m.byteLength<a)return null;m=new Uint8Array(m,0,Math.ceil(a/8));h=new Uint8Array(h.width*h.height);for(var b=0,d=0,g=0,e=0,g=0;g<m.length-1;g++)for(d=m[g],e=7;0<=e;e--)h[b++]=d>>e&1;for(e=7;b<a-1;)d=m[m.length-1],h[b++]=d>>e&1,e--;return h}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(m,h){var a=function(){var a=new ArrayBuffer(4),c=new Uint8Array(a),a=new Uint32Array(a);c[0]=1;c[1]=2;c[2]=3;c[3]=4;return 67305985===a[0]},
b=function(){var a=[];a[254]="NEWSUBFILETYPE";a[255]="SUBFILETYPE";a[256]="IMAGEWIDTH";a[257]="IMAGELENGTH";a[258]="BITSPERSAMPLE";a[259]="COMPRESSION";a[262]="PHOTOMETRICINTERPRETATION";a[263]="THRESHHOLDING";a[264]="CELLWIDTH";a[265]="CELLLENGTH";a[266]="FILLORDER";a[269]="DOCUMENTNAME";a[270]="IMAGEDESCRIPTION";a[271]="MAKE";a[272]="MODEL";a[273]="STRIPOFFSETS";a[274]="ORIENTATION";a[277]="SAMPLESPERPIXEL";a[278]="ROWSPERSTRIP";a[279]="STRIPBYTECOUNTS";a[280]="MINSAMPLEVALUE";a[281]="MAXSAMPLEVALUE";
a[282]="XRESOLUTION";a[283]="YRESOLUTION";a[284]="PLANARCONFIGURATION";a[285]="PAGENAME";a[286]="XPOSITION";a[287]="YPOSITION";a[288]="FREEOFFSETS";a[289]="FREEBYTECOUNTS";a[290]="GRAYRESPONSEUNIT";a[291]="GRAYRESPONSECURVE";a[292]="T4OPTIONS";a[293]="T6OPTIONS";a[296]="RESOLUTIONUNIT";a[297]="PAGENUMBER";a[300]="COLORRESPONSEUNIT";a[301]="TRANSFERFUNCTION";a[305]="SOFTWARE";a[306]="DATETIME";a[315]="ARTIST";a[316]="HOSTCOMPUTER";a[317]="PREDICTOR";a[318]="WHITEPOINT";a[319]="PRIMARYCHROMATICITIES";
a[320]="COLORMAP";a[321]="HALFTONEHINTS";a[322]="TILEWIDTH";a[323]="TILELENGTH";a[324]="TILEOFFSETS";a[325]="TILEBYTECOUNTS";a[326]="BADFAXLINES";a[327]="CLEANFAXDATA";a[328]="CONSECUTIVEBADFAXLINES";a[330]="SUBIFD";a[332]="INKSET";a[333]="INKNAMES";a[334]="NUMBEROFINKS";a[336]="DOTRANGE";a[337]="TARGETPRINTER";a[338]="EXTRASAMPLES";a[339]="SAMPLEFORMAT";a[340]="SMINSAMPLEVALUE";a[341]="SMAXSAMPLEVALUE";a[342]="TRANSFERRANGE";a[347]="JPEGTABLES";a[512]="JPEGPROC";a[513]="JPEGIFOFFSET";a[514]="JPEGIFBYTECOUNT";
a[515]="JPEGRESTARTINTERVAL";a[517]="JPEGLOSSLESSPREDICTORS";a[518]="JPEGPOINTTRANSFORM";a[519]="JPEGQTABLES";a[520]="JPEGDCTABLES";a[521]="JPEGACTABLES";a[529]="YCBCRCOEFFICIENTS";a[530]="YCBCRSUBSAMPLING";a[531]="YCBCRPOSITIONING";a[532]="REFERENCEBLACKWHITE";a[33550]="GEOPIXELSCALE";a[33922]="GEOTIEPOINTS";a[33432]="COPYRIGHT";a[42112]="GDAL_METADATA";a[42113]="GDAL_NODATA";a[50844]="RPCCOEFFICIENT";a[34735]="GEOKEYDIRECTORY";a[34736]="GEODOUBLEPARAMS";a[34737]="GEOASCIIPARAMS";return a}(),d=[0,
1,1,2,4,8,1,1,2,4,8,4,8],g=function(a,c){var f="UNKNOWN";3===a?f="F32":1===a?8>=c?f="U8":16>=c?f="U16":32>=c&&(f="U32"):2===a&&(8>=c?f="S8":16>=c?f="S16":32>=c&&(f="S32"));return f};return{decode:function(e){var c,f=new DataView(e,0,8),k=f.getUint16(0,!1),p;if(18761===k)p=!0;else if(19789===k)p=!1;else throw"unexpected endianess byte";if(42!==f.getUint16(2,p))throw"unexpected tiff identifier";var l=f.getUint32(4,p);c=p;var r,q,n,t,B,u,v,x,w,A,D;r=l;for(var y=[];r;){q=(new DataView(e,r,2)).getUint16(0,
c);n=r+2;r=(new DataView(e,n+12*q,4)).getUint32(0,c);A={};for(t=0;t<q;t++)if(B=new DataView(e,n,12),u=B.getUint16(0,c),v=B.getUint16(2,c),x=B.getUint32(4,c),w=B.getUint32(8,c),n+=12,!(7===v||12<v)){var z=D={fieldTag:u,fieldType:v,fieldValueCount:x,fieldValueOffset:w},C=e,E=c,F=[],G=D.fieldType,H=D.fieldValueCount,N=D.fieldValueOffset,J=N,P=d[G],I=8*P,L=H*P,W=H*d[G]*8,M=void 0,U=void 0;if(32>=W)if(E||(N>>>=32-W),1===H)F=[N];else for(U=0;U<H;U++)F.push(N<<I*U>>>32-I);else for(J=N;J<N+L;J+=P){switch(G){case 1:M=
(new DataView(C,J,1)).getUint8(0);break;case 2:M=(new DataView(C,J,1)).getUint8(0);break;case 3:M=(new DataView(C,J,2)).getUint16(0,E);break;case 4:M=(new DataView(C,J,4)).getUint32(0,E);break;case 5:M=(new DataView(C,J,4)).getUint32(0,E)/(new DataView(C,J+4,4)).getUint32(0,E);break;case 6:M=(new DataView(C,J,1)).getInt8(0);break;case 8:M=(new DataView(C,J,2)).getInt16(0,E);break;case 9:M=(new DataView(C,J,4)).getInt32(0,E);break;case 10:M=(new DataView(C,J,4)).getInt32(0,E)/(new DataView(C,J+4,4)).getInt32(0,
E);break;case 11:M=(new DataView(C,J,4)).getFloat32(0,E);break;case 12:M=(new DataView(C,J,8)).getFloat64(0,E);break;case 7:M=null;break;default:M=null}F.push(M)}if(2===G){for(var O="",ba=F,F=[],U=0;U<ba.length;U++)0===ba[U]&&""!==O?(F.push(O),O=""):O+=String.fromCharCode(ba[U]);""===O&&0!==F.length||F.push(O)}z.fieldValues=F;var za=A,da=b[u];void 0===da&&(da="unknown"+u);za[da]={type:v,values:D.fieldValues}}y.push(A)}if(0===y.length)throw"no valid image file directory";var ca,V,K=y[0],pa=void 0===
K.GDAL_NODATA||null===K.GDAL_NODATA?null:parseFloat(K.GDAL_NODATA.values[0]);if(K.TILEOFFSETS){var cb,ia,ma,kb=a()===c,qa=K.TILEOFFSETS?K.TILEOFFSETS.values:void 0;if(void 0===qa)V=void 0;else{var ra=K.TILEBYTECOUNTS.values,sa=K.TILEWIDTH.values[0],Aa=K.TILELENGTH.values[0],Ba=K.IMAGEWIDTH.values[0],Ua=K.IMAGELENGTH.values[0],na=Ba*Ua,ea=K.BITSPERSAMPLE.values[0],X=K.SAMPLESPERPIXEL.values[0],Ca=K.SAMPLEFORMAT?K.SAMPLEFORMAT.values[0]:1,Ka=g(Ca,ea);if(1!==(K.PLANARCONFIGURATION?K.PLANARCONFIGURATION.values[0]:
1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var ha=K.COMPRESSION?K.COMPRESSION.values[0]:1;if(1!==ha&&6!==ha&&8!==ha&&32946!==ha)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";if(3<Ca)V=void 0;else{3===Ca?(ia=new Float32Array(na*X),ma=Float32Array):1===Ca?8>=ea?(ia=new Uint8Array(na*X),ma=Uint8Array):16>=ea?(ia=new Uint16Array(na*X),ma=Uint16Array):32>=ea&&(ia=
new Uint32Array(na*X),ma=Uint32Array):2===Ca&&(8>=ea?(ia=new Int8Array(na*X),ma=Int8Array):16>=ea?(ia=new Int16Array(na*X),ma=Int16Array):32>=ea&&(ia=new Int32Array(na*X),ma=Int32Array));var R,Da,Y,Ea,Va,Wa,Xa,Ya,La,Ma,db,eb,ja,S,ta,Za,Na,$a,fb=Math.ceil(Ba/sa);if(0===ea%8)for(R=0;R<qa.length;R++){Wa=Math.floor(R/fb)*Aa;Xa=R%fb*sa;Ya=(Wa*Ba+Xa)*X;if("U8"===Ka||"S8"===Ka||kb)if(8===ha||32946===ha)S=new Uint8Array(e,qa[R],ra[R]),Na=new h(S),$a=Na.getBytes(),ja=new ArrayBuffer($a.length),S=new Uint8Array(ja),
S.set($a),S.length!==sa*Aa*X*ea/8&&console.log("tile byte counts is different than expected");else if(6===ha){S=new Uint8Array(e,qa[R],ra[R]);var Oa=new m;Oa.parse(S);var gb=Oa.getData(Oa.width,Oa.height);ja=new ArrayBuffer(gb.length);S=new Uint8Array(ja);S.set(gb)}else 1===ha&&(ra[R]!==sa*Aa*X*ea/8&&console.log("tile byte counts is different than expected"),ja=e.slice(qa[R],qa[R]+ra[R]));else switch(8===ha||32946===ha?(S=new Uint8Array(e,qa[R],ra[R]),Na=new h(S),S=Na.getBytes(),ja=new ArrayBuffer(S.length),
ta=new Uint8Array(ja),S.length!==sa*Aa*X*ea/8&&console.log("tile byte counts is different than expected")):1===ha&&(ra[R]!==sa*Aa*X*ea/8&&console.log("tile byte counts is different than expected"),ja=new ArrayBuffer(ra[R]),S=new Uint8Array(e,qa[R],ra[R]),ta=new Uint8Array(ja)),Ka){case "U16":case "S16":for(Y=0;Y<S.length;Y+=2)ta[Y]=S[Y+1],ta[Y+1]=S[Y];break;case "U32":case "S32":case "F32":for(Y=0;Y<S.length;Y+=4)ta[Y]=S[Y+3],ta[Y+1]=S[Y+2],ta[Y+2]=S[Y+1],ta[Y+3]=S[Y]}cb=new ma(ja);Ma=0;La=Ya;eb=
Math.min(sa,Ba-Xa);db=Math.min(Aa,Ua-Wa);for(Ea=0;Ea<db;Ea++)for(La=Ya+Ea*Ba*X,Ma=Ea*sa*X,Va=0;Va<eb*X;Va++,La++,Ma++)ia[La]=cb[Ma]}var Pa={width:Ba,height:Ua,pixelType:Ka};if(1===X)Pa.pixels=[ia];else for(Pa.pixels=[],R=0;R<X;R++){Za=new ma(na);for(Da=0;Da<na;Da++)Za[Da]=ia[Da*X+R];Pa.pixels.push(Za)}V=Pa}}}else if(K.STRIPOFFSETS){var hb,ka,oa,lb=a()===c,ua=K.STRIPOFFSETS?K.STRIPOFFSETS.values:void 0;if(void 0===ua)V=void 0;else{var va=K.STRIPBYTECOUNTS.values,Fa=K.ROWSPERSTRIP.values,wa=K.IMAGEWIDTH.values[0],
Ga=K.IMAGELENGTH.values[0],xa=wa*Ga,fa=K.BITSPERSAMPLE.values[0],aa=K.SAMPLESPERPIXEL.values[0],Ha=K.SAMPLEFORMAT?K.SAMPLEFORMAT.values[0]:1,Qa=g(Ha,fa);if(1!==(K.PLANARCONFIGURATION?K.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var ga=K.COMPRESSION?K.COMPRESSION.values[0]:1;if(1!==ga&&6!==ga&&8!==ga&&32946!==ga)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";
if(3<Ha)V=void 0;else{3===Ha?(ka=new Float32Array(xa*aa),oa=Float32Array):1===Ha?8>=fa?(ka=new Uint8Array(xa*aa),oa=Uint8Array):16>=fa?(ka=new Uint16Array(xa*aa),oa=Uint16Array):32>=fa&&(ka=new Uint32Array(xa*aa),oa=Uint32Array):2===Ha&&(8>=fa?(ka=new Int8Array(xa*aa),oa=Int8Array):16>=fa?(ka=new Int16Array(xa*aa),oa=Int16Array):32>=fa&&(ka=new Int32Array(wa*Ga*aa),oa=Int32Array));var Q,Ia,Z,ib,la,T,ya,ab,Ra,bb,Ja=Fa;if(0===fa%8)for(Q=0;Q<ua.length;Q++){ib=Q*Fa*wa*aa;Ja=(Q+1)*Fa>Ga?Ga-Q*Fa:Fa;if("U8"===
Qa||"S8"===Qa||lb)if(8===ga||32946===ga)T=new Uint8Array(e,ua[Q],va[Q]),Ra=new h(T),bb=Ra.getBytes(),la=new ArrayBuffer(bb.length),T=new Uint8Array(la),T.set(bb),T.length!==Ja*wa*aa*fa/8&&console.log("strip byte counts is different than expected");else if(6===ga){T=new Uint8Array(e,ua[Q],va[Q]);var Sa=new m;Sa.parse(T);var jb=Sa.getData(Sa.width,Sa.height);la=new ArrayBuffer(jb.length);T=new Uint8Array(la);T.set(jb)}else 1===ga&&(va[Q]!==Ja*wa*aa*fa/8&&console.log("strip byte counts is different than expected"),
la=e.slice(ua[Q],ua[Q]+va[Q]));else switch(6===ga||8===ga||32946===ga?(T=new Uint8Array(e,ua[Q],va[Q]),Ra=new h(T),T=Ra.getBytes(),la=new ArrayBuffer(T.length),ya=new Uint8Array(la),T.length!==Ja*wa*aa*fa/8&&console.log("strip byte counts is different than expected")):1===ga&&(va[Q]!==Ja*wa*aa*fa/8&&console.log("strip byte counts is different than expected"),la=new ArrayBuffer(va[Q]),T=new Uint8Array(e,ua[Q],va[Q]),ya=new Uint8Array(la)),Qa){case "U16":case "S16":for(Z=0;Z<T.length;Z+=2)ya[Z]=T[Z+
1],ya[Z+1]=T[Z];break;case "U32":case "S32":case "F32":for(Z=0;Z<T.length;Z+=4)ya[Z]=T[Z+3],ya[Z+1]=T[Z+2],ya[Z+2]=T[Z+1],ya[Z+3]=T[Z]}hb=new oa(la);ka.set(hb,ib)}var Ta={width:wa,height:Ga,pixelType:Qa};if(1===aa)Ta.pixels=[ka];else for(Ta.pixels=[],Q=0;Q<aa;Q++){ab=new oa(xa);for(Ia=0;Ia<xa;Ia++)ab[Ia]=ka[Ia*aa+Q];Ta.pixels.push(ab)}V=Ta}}}if(null!==pa){V.maskData=new Uint8Array(V.width*V.height);if(1E24<Math.abs(pa))for(ca=0;ca<V.width*V.height;ca++)V.maskData[ca]=1E-6>Math.abs((V.pixels[0][ca]-
pa)/pa)?0:1;else for(ca=0;ca<V.width*V.height;ca++)V.maskData[ca]=V.pixels[0][ca]===pa?0:1;V.noDataValue=pa}return V}}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(m,h,a){return{create:function(a,d){if(a){var b=Object.keys(a);if(a.read&&!d)return a;a.read&&d&&(a=a.toJson());-1<b.indexOf("name")&&b.indexOf(!1)?(a=h.mixin({},a),d=this._parseV2(a,d)):(a="esri.layers.RasterFunction"===a.declaredClass?
a.toJson():h.mixin({},a),d=this._parseV1(a,d));d.branchCount=d.updateBranchStructure();return d}},_parseV1:function(b,d){var g=b.rasterFunction,e=b.rasterFunctionArguments,c=b.renderTexture||b.rasterFunctionArguments.renderTexture||!1,f,k,p,l,r,q,n;(l=e.raster||e.Raster)&&l.rasterFunction&&(f=this._parseV1(l,d));(l=e.raster2||e.Raster2)&&l.rasterFunction&&(k=this._parseV1(l,d));(l=e.rasters||e.Rasters)&&0<l.length&&(p=l.map(h.hitch(this,function(a){return a&&a.rasterFunction?this._parseV1(a,d):a})));
(l=e.dem||e.DEM)&&(l.functionName||l.rasterFunction)&&(r=this._parseV1(l,d));(l=e.fillRaster||e.FillRaster)&&(l.functionName||l.rasterFunction)&&(q=this._parseV1(l,d));l=a.functions[g];if(!l)return console.error("Function is not currently supported: "+g),null;g=new l(e);g.variableName&&(l=e[g.variableName])&&(l.functionName||l.rasterFunction)&&(n=this._parseV1(l,d));b.outputPixelType&&(g.pixelType=b.outputPixelType);"$$"===f?g.functionArguments.raster=d&&d.raster:null!=f?g.functionArguments.raster=
f:g.functionArguments.raster||(g.functionArguments.raster=d&&d.raster);null!=k&&(g.functionArguments.raster2=k);null!=p&&(g.functionArguments.rasters=p.map(function(a){"$$"===a&&(a=d&&d.raster);return a}));null!=r&&(g.functionArguments.dem=r);null!=q&&(g.functionArguments.fillRaster=q);null!=n&&(g.functionArguments[g.variableName]=n);g.renderTexture=c;return g},_parseV2:function(a,d){if(!a)return null;a=h.clone(a);this._bindV2Args(a,d);var b={};this._convertTov1(a,b);return this._parseV1(b,d)},_bindV2Args:function(a,
d){(a||d)&&Object.keys(a).forEach(function(b){a[b]["function"]&&a[b].arguments?this._bindV2Args(a[b].arguments,d):null!=d[a[b].name]&&(a[b].value=d[a[b].name])}.bind(this))},_convertV2Types:function(a){if(!a)return null;"ArgumentArray"===a.type?a.elements&&"RasterStatistics"===a.elements[0].type&&(a=a.elements):a instanceof Array&&0===a.length&&(a=null);return a},_convertTov1:function(a,d){if((a||d)&&a["function"]){var b=a["function"],e=a.arguments;d.rasterFunction=b.type.replace("Function","");d.outputPixelType=
"UNKNOWN"===b.pixelType?"Unknown":b.pixelType;d.rasterFunctionArguments={};var c;Object.keys(e).forEach(function(a){e[a]["function"]&&e[a].arguments?(d.rasterFunctionArguments[a]={},this._convertTov1(e[a],d.rasterFunctionArguments[a])):(c=e[a].value,d.rasterFunctionArguments[a]="object"!==typeof c||c.functionArguments?c:this._convertV2Types(c))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(m,h,a,b,d,g,e,c,f,k,p,l,r,q,n,t,B){return function(){function h(a){a.prototype.supportWebGL&&(x[a.prototype.functionName]=a);a.prototype.support2D&&(v[a.prototype.functionName]=a);w[a.prototype.functionName]=a}var v={},x={},w={};h(a);h(b);h(d);h(g);h(e);h(c);h(f);h(k);h(p);h(l);h(r);h(q);h(n);h(t);h(B);return{cpu:v,gpu:x,functions:w,register:h,getFunction:function(a){return w[a]},support:function(a,c){return!!("gpu"===c?x:"cpu"===c?v:w)[a]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(m,h,a,b,d,g,e,c){return m([a,e],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({raster:null},a)},bind:function(){var a=this.getSourceRasterInfo();if(!a.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histogram:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=c.aspect(a.raster);this._addPerformanceMetric(this._performance.elapsed());return a},readGL:function(a){this._performance.start();this._initializeProgram({fragment:g.aspect,fragmentName:"Aspect"});a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),f=this.gl;f.bindTexture(f.TEXTURE_2D,a.texture);var b=f.drawingBufferWidth,
f=f.drawingBufferHeight,e=a.extent;this._setUniforms({u_resolution:[1/b,1/f],u_cellSize:[(e.xmax-e.xmin)/b,(e.ymax-e.ymin)/f]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),function(m,h,a,b,d,g){return m(null,{functionName:null,functionArguments:null,
pixelType:"Unknown",rasterInfo:null,constructor:function(a){a&&(this.pixelType=a.outputPixelType||a.OutputPixelType||this.pixelType,this.renderTexture=a.renderTexture,this._initFunction())},mixinIgnoreCase:function(a,c){var f=Object.keys(a),b=Object.keys(c),e,d,g=f.length,h;for(e=0;e<b.length;e++)if(h=c[b[e]],null!=h)for(d=0;d<g;d++)if(f[d].toLowerCase()===b[e].toLowerCase()){a[f[d]]=h;break}return a},bind:function(a){},setProcessingContext:function(a){if(!a)throw"cannot bind to layer without options";
this.useWebGL=!!a.useWebGL;this._tileMode=!!a.tileMode;this._glSetting=a.glSetting;this._rawRasterInfo=a.rawRasterInfo;this._xformSetting=a.xformSetting||this._xformSetting;this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var c=this.functionArguments.raster,f=this.functionArguments.raster2,b=this.functionArguments.dem,e=this.functionArguments.fillRaster,d=this.functionArguments.rasters;c&&c.functionArguments&&c.setProcessingContext(a);
f&&f.functionArguments&&f.setProcessingContext(a);b&&b.functionArguments&&b.setProcessingContext(a);e&&e.functionArguments&&e.setProcessingContext(a);if(d)for(c=0;c<d.length;c++)d[c]&&d[c].functionArguments&&d[c].setProcessingContext(a);this.bind()},updateBranchStructure:function(){var a=0,c=this.functionArguments;c.raster&&c.raster.read&&c.raster.functionArguments&&(a+=c.raster.updateBranchStructure());c.raster2&&c.raster2.read&&c.raster2.functionArguments&&(a+=c.raster2.updateBranchStructure(),
c.raster2.isBranch=!0,c.raster&&c.raster.read&&(c.raster.isBranch=!0));c.rasters&&(a=c.rasters.length,c.rasters.forEach(function(a){a.read&&a.functionArguments&&(a.isBranch=!0)}));c.dem&&c.dem.read&&c.dem.functionArguments&&(a+=c.dem.updateBranchStructure());return 1===a?0:a},read:function(a){a=this.processRasterArgument(a);return this.useWebGL?this.readGL(a):this.read2D(a)},hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var a,c={};if(this.functionArguments.raster2)c.functionArguments.raster=
this._bindRaster(this.functionArguments.raster),c.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._bindRaster(this.functionArguments.rasters[a]);else c.raster=this._bindRaster(this.functionArguments.raster);return this.sourceRasterInfo=c},processRasterArgument:function(a){var c=this.bind();if(!0!==c)throw c;var f={};if(this.functionArguments.raster2)f.raster=
this._readRaster(this.functionArguments.raster,a),f.raster2=this._readRaster(this.functionArguments.raster2,a);else if(this.functionArguments.rasters)for(f.rasters=[],c=0;c<this.functionArguments.rasters.length;c++)f.rasters[c]=this._readRaster(this.functionArguments.rasters[c],a);else f.raster=this._readRaster(this.functionArguments.raster,a);return f},toJson:function(){var a=this.functionArguments,c=a.raster,f=a.raster2,a=a.rasters,c=c?c.toJson?c.toJson():c:null,f=f?f.toJson?f.toJson():f:null,b;
a&&0<a.length&&(b=a.map(function(a){return a.toJson?a.toJson():a}));a=h.mixin({},this.functionArguments);a.raster=c;a.raster2=f;a.rasters=b;a=this._fixRasterFunctionJson(a);return{rasterFunction:this.functionName,rasterFunctionArguments:a,outputPixelType:this.pixelType}},_initFunction:function(a){},_getIntegerRange:function(a){var c;switch(a){case "U8":c=[0,255];break;case "U16":c=[0,65535];break;case "U32":c=[0,4294967295];break;case "S8":c=[-128,127];break;case "S16":c=[-32768,32767];break;case "S32":c=
[-2147483648,2147483647]}return c},_calculatePixelType:function(a,c){return a&&"unknown"!==a.toLowerCase()?a:c},_clonePixelData:function(a){if(null==a)return a;var c={};a.extent&&(c.extent=new d(a.extent.xmin,a.extent.ymin,a.extent.xmax,a.extent.ymax,a.extent.spatialReference));a=a.pixelBlock;if(null==a)return c;c.pixelBlock=a.clone?a.clone():g.prototype.clone(a);return c},_readRaster:function(a,c){var f;null==a||"$$"===a?f=this._clonePixelData(c.src[Object.keys(c.src)[0]]):a&&a.rasterInfo&&!a.functionArguments?
f=this._clonePixelData(c.src[a._rasterId]):isNaN(a)?a.read&&(f=a.functionArguments?a.read(c):this._clonePixelData(c)):(f=c.src?c.src[Object.keys(c.src)[0]]:c,c=f.pixelBlock,c=new Float32Array(c.width*c.height),c.fill(parseFloat(a)),f=this._clonePixelData(f),f.pixelBlock.pixels=[c],f.isConstant=!0);return f},_bindRaster:function(a){var c;a&&"$$"!==a?isNaN(a)?a.rasterInfo?c=a.rasterInfo:a.bind&&a.bind()&&(c=a.rasterInfo):c={}:c=this._rawRasterInfo;c&&(c=c.clone?c.clone():new b(c),c.bandCount=c.bandCount||
3);return c},_getOutputBand:function(a,c){switch(a){case "U8":a=new Uint8Array(c);break;case "U16":a=new Uint16Array(c);break;case "U32":a=new Uint32Array(c);break;case "S8":a=new Int8Array(c);break;case "S16":a=new Int16Array(c);break;case "S32":a=new Int32Array(c);break;case "U32":a=new Uint32Array(c);break;case "F32":a=new Float32Array(c);break;case "F64":a=new Float64Array(c);break;default:a=new Float32Array(c)}return a},_clampBand:function(a,c,f){if(("F64"===c||"F32"===c)&&!f)return a;var b,
e,d=this._getIntegerRange(c),g=a.length;if(d)for(f=d[1],d=d[0],c=this._getOutputBand(c,g),b=0;b<g;b++)e=a[b],c[b]=e>f?f:e<d?d:e;else c=a;return c},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},_addPerformanceMetric:function(b){a.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(b),
50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(a){for(var c in a)a.hasOwnProperty(c)&&(null==a[c]?delete a[c]:a[c]instanceof Object&&!a[c].sourceType&&this._fixRasterFunctionJson(a[c],!0));return a}})})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(m,h,a,b,d){return m(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",
bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(g){h.mixin(this,g);this.extent=this.extent?this.extent.toJson?this.extent:new a(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?
this.spatialReference:new b(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new d(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?h.clone(this.colormap):null,
attributeTable:this.attributeTable?h.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?h.clone(this.multiDimensionalInfo):null,statistics:this.statistics?h.clone(this.statistics):null,histograms:this.histograms?h.clone(this.histograms):null,catalogInfo:this.catalogInfo?h.clone(this.catalogInfo):null,keyProperties:this.keyProperties?h.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&
this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?h.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/geometry/Extent":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./webMercatorUtils ./mathUtils ../srUtils".split(" "),
function(m,h,a,b,d,g,e,c,f,k,p,l){function r(){}var q={type:"extent",xmin:0,ymin:0,xmax:0,ymax:0},n=m(c,{declaredClass:"esri.geometry.Extent",type:"extent",xmin:0,ymin:0,xmax:0,ymax:0,constructor:function(a,c,f,b,e){g.isObject(a)?(g.mixin(this,a),this.spatialReference&&(this.spatialReference=l.createSpatialReference(this.spatialReference))):this.update(a,c,f,b,e);this.verifySR()},getWidth:function(){return Math.abs(this.xmax-this.xmin)},getHeight:function(){return Math.abs(this.ymax-this.ymin)},getCenter:function(){return new f((this.xmin+
this.xmax)/2,(this.ymin+this.ymax)/2,this.spatialReference)},getTopLeft:function(){return new f(this.xmin,this.ymax,this.spatialReference)},getTopRight:function(){return new f(this.xmax,this.ymax,this.spatialReference)},getBottomLeft:function(){return new f(this.xmin,this.ymin,this.spatialReference)},getBottomRight:function(){return new f(this.xmax,this.ymin,this.spatialReference)},centerAt:function(a){var c=this.getCenter(),f=a.x-c.x;a=a.y-c.y;return new n(this.xmin+f,this.ymin+a,this.xmax+f,this.ymax+
a,this.spatialReference)},update:function(a,c,f,b,e){this.xmin=a;this.ymin=c;this.xmax=f;this.ymax=b;this.spatialReference=e;this.clearCache();return this},offset:function(a,c){return new n(this.xmin+a,this.ymin+c,this.xmax+a,this.ymax+c,this.spatialReference)},expand:function(a){var c=(1-a)/2;a=this.getWidth()*c;c*=this.getHeight();return new n(this.xmin+a,this.ymin+c,this.xmax-a,this.ymax-c,this.spatialReference)},intersects:function(a){if(!a)return!1;var c=a.type,f=this.spatialReference,b=a.spatialReference;
f&&b&&!f.equals(b)&&f._canProject(b)&&(a=f.isWebMercator()?k.geographicToWebMercator(a):k.webMercatorToGeographic(a,!0));switch(c){case "point":return this.contains(a);case "multipoint":return this._intersectsMultipoint(a);case "extent":return this._intersectsExtent(a);case "polygon":return this._intersectsPolygon(a);case "polyline":return this._intersectsPolyline(a)}},normalize:function(){var c=this._normalize(!1,!0);a.isArray(c)||(c=[c]);return c},shiftCentralMeridian:function(){return this._normalize(!0)},
bisect:function(){var a=this.spatialReference,c=a&&a._getInfo(),f=[],b=0;if(c&&this._isOutOfBounds(c)){var d=this,b=d.xmin,k=d.ymin,g=d.ymax,l=c.valid[0],p=c.valid[1];d.getWidth()>2*p&&(d=d.getCenter(),d=new n(d.x-p,k,d.x+p,g,new e(a.toJson())));var b=d.xmin-b,h=this._normalizeX(d.xmin,c),c=this._normalizeX(d.xmax,c);h.frameId===c.frameId?f.push(new n(h.x,k,c.x,g,new e(a.toJson()))):f.push(new n(h.x,k,p,g,new e(a.toJson())),new n(l,k,c.x,g,new e(a.toJson())))}else f.push(this.getExtent());return{extents:f,
marginLeft:b}},_intersectsMultipoint:function(a){var c=a.points.length,f;for(f=0;f<c;f++)if(this.contains(a.getPoint(f)))return!0;return!1},_intersectsExtent:function(a){var c,f,b,d,e=!1;this.xmin<=a.xmin?(c=a.xmin,this.xmax<c?e=!0:b=Math.min(this.xmax,a.xmax)-c):(c=this.xmin,a.xmax<c?e=!0:b=Math.min(this.xmax,a.xmax)-c);this.ymin<=a.ymin?(f=a.ymin,this.ymax<f?e=!0:d=Math.min(this.ymax,a.ymax)-f):(f=this.ymin,a.ymax<f?e=!0:d=Math.min(this.ymax,a.ymax)-f);return e?null:new n(c,f,c+b,f+d,this.spatialReference)},
_intersectsPolygon:function(a){var c=[this.xmin,this.ymax],b=[this.xmax,this.ymax],e=[this.xmin,this.ymin],d=[this.xmax,this.ymin],k=[c,b,e,d],c=[[e,c],[c,b],[b,d],[d,e]],e=a.rings,d=e.length,g,l=new f(0,0,this.spatialReference);g=k.length;for(b=0;b<g;b++)if(l.update(k[b][0],k[b][1]),a.contains(l))return!0;l.setSpatialReference(a.spatialReference);for(var p,h,b=0;b<d;b++)if(k=e[b],g=k.length){p=k[0];l.update(p[0],p[1]);if(this.contains(l))return!0;for(a=1;a<g;a++){h=k[a];l.update(h[0],h[1]);if(this.contains(l)||
this._intersectsLine([p,h],c))return!0;p=h}}return!1},_intersectsPolyline:function(a){var c=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],b,e=a.paths,d=e.length,k,g,l,p,h=new f(0,0,a.spatialReference);for(a=0;a<d;a++)if(k=e[a],g=k.length){l=k[0];h.update(l[0],l[1]);if(this.contains(h))return!0;for(b=1;b<g;b++){p=k[b];h.update(p[0],p[1]);if(this.contains(h)||this._intersectsLine([l,
p],c))return!0;l=p}}return!1},_intersectsLine:function(a,c){var f=p._getLineIntersection2,b,e=c.length;for(b=0;b<e;b++)if(f(a,c[b]))return!0;return!1},contains:function(a){if(!a)return!1;var c=a.type;if("point"===c){var b=this.spatialReference,e=a.spatialReference,c=a.x;a=a.y;b&&e&&!b.equals(e)&&b._canProject(e)&&(a=b.isWebMercator()?f.lngLatToXY(c,a):f.xyToLngLat(c,a,!0),c=a[0],a=a[1]);return c>=this.xmin&&c<=this.xmax&&a>=this.ymin&&a<=this.ymax}return"extent"===c?this._containsExtent(a):!1},_containsExtent:function(a){var c=
a.xmin,b=a.ymin,e=a.xmax,d=a.ymax,k=a.spatialReference;a=new f(c,b,k);c=new f(c,d,k);d=new f(e,d,k);b=new f(e,b,k);return this.contains(a)&&this.contains(c)&&this.contains(d)&&this.contains(b)?!0:!1},union:function(a){return new n(Math.min(this.xmin,a.xmin),Math.min(this.ymin,a.ymin),Math.max(this.xmax,a.xmax),Math.max(this.ymax,a.ymax),this.spatialReference)},getExtent:function(){var a=this.spatialReference;return new n(this.xmin,this.ymin,this.xmax,this.ymax,a&&new e(a.toJson()))},_shiftCM:function(a){var c=
this.getCacheValue("_shifted");if(!c){var c=new n(this.toJson()),f=c.spatialReference;if(a=a||f._getInfo()){var b=this._getCM(a);if(b){var d=f._isWebMercator()?k.webMercatorToGeographic(b):b;c.xmin-=b.x;c.xmax-=b.x;f._isWebMercator()||(d.x=this._normalizeX(d.x,a).x);c.setSpatialReference(new e(g.substitute({Central_Meridian:d.x},4326===f.wkid?a.altTemplate:a.wkTemplate)))}}this.setCacheValue("_shifted",c)}return c},_getCM:function(a){var c;this._isOutOfBounds(a)&&(c=this.getCenter());return c},_isOutOfBounds:function(a){var c=
a.valid[0];a=a.valid[1];var f=this.xmin,b=this.xmax;return!(f>=c&&f<=a&&b>=c&&b<=a)},_normalize:function(a,c,f){var b=new n(this.toJson()),e=b.spatialReference;if(e&&(f=f||e._getInfo())){var d=h.map(this._getParts(f),function(a){return a.extent});return 2<d.length?a?this._shiftCM(f):b.update(f.valid[0],b.ymin,f.valid[1],b.ymax,e):2===d.length?a?this._shiftCM(f):c?d:{rings:h.map(d,function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]}),spatialReference:e}:
d[0]||b}return b},_getParts:function(a){var c=this.getCacheValue("_parts");if(!c){var c=[],f=this.xmin,b=this.xmax,e=this.ymin,d=this.ymax,k=this.spatialReference,g=this.getWidth(),l=f,p=b,h=0,r=0,q,t;a=a||k._getInfo();q=a.valid[0];t=a.valid[1];r=this._normalizeX(f,a);f=r.x;h=r.frameId;r=this._normalizeX(b,a);b=r.x;r=r.frameId;a=f===b&&0<g;if(g>2*t){g=new n(l<p?f:b,e,t,d,k);f=new n(q,e,l<p?b:f,d,k);t=new n(0,e,t,d,k);e=new n(q,e,0,d,k);k=[];q=[];g.contains(t)&&k.push(h);g.contains(e)&&q.push(h);f.contains(t)&&
k.push(r);f.contains(e)&&q.push(r);for(d=h+1;d<r;d++)k.push(d),q.push(d);c.push({extent:g,frameIds:[h]},{extent:f,frameIds:[r]},{extent:t,frameIds:k},{extent:e,frameIds:q})}else f>b||a?c.push({extent:new n(f,e,t,d,k),frameIds:[h]},{extent:new n(q,e,b,d,k),frameIds:[r]}):c.push({extent:new n(f,e,b,d,k),frameIds:[h]});this.setCacheValue("_parts",c)}return c},_normalizeX:function(a,c){var f=0,b=c.valid[0],e=c.valid[1];c=2*e;a>e?(f=Math.ceil(Math.abs(a-e)/c),a-=f*c):a<b&&(f=Math.ceil(Math.abs(a-b)/c),
a+=f*c,f=-f);return{x:a,frameId:f}},toJson:function(){var a={xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax},c=this.spatialReference;c&&(a.spatialReference=c.toJson());return a}});r.prototype=n.prototype;n.simpleConstructor=r;n.defaultProps=q;b("extend-esri")&&(a.setObject("geometry.Extent",n,d),d.geometry.defaultExtent=q);return n})},"esri/lang":function(){define("dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/_base/lang dojo/date dojo/has dojo/number dojo/date/locale ./kernel".split(" "),
function(m,h,a,b,d,g,e,c,f){function k(a,c,f,b){(c=c&&c[a])?c={formatType:c.formatType,options:c}:b&&-1!==m.indexOf(b.properties||"",a)?c={formatType:b.formatter||"DateString",options:null}:f&&-1!==m.indexOf(f.properties||"",a)&&(c={formatType:f.formatter||"NumberFormat",options:null});return c}function p(c,f,e){return[b.isString(c)?c.split(""):c,f||a.global,b.isString(e)?new Function("item","index","array",e):e]}function l(a){return void 0!==a&&null!==a}function r(a){return l(a)?a:""}function q(a,
f,k,g){var p=k.match(/([^\(]+)(\([^\)]+\))?/i);k=b.trim(p[1]);var n=p[2]?b.trim(p[2]):null,p=f[a];g=g||(n?h.fromJson(n.replace(/^\(/,"({").replace(/\)$/,"})")):{});n=g.utcOffset;if(-1===m.indexOf(t,k))k=b.getObject(k),b.isFunction(k)&&(p=k(p,a,f,g));else if("number"===typeof p||"string"===typeof p&&p&&!isNaN(Number(p)))switch(p=Number(p),k){case "NumberFormat":return e.format(p,g);case "DateString":a=new Date(p);if(g.local||g.systemLocale)return g.systemLocale?a.toLocaleDateString()+(g.hideTime?"":
" "+a.toLocaleTimeString()):a.toDateString()+(g.hideTime?"":" "+a.toTimeString());a=a.toUTCString();g.hideTime&&(a=a.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,""));return a;case "DateFormat":return a=new Date(p),l(n)&&(a=d.add(a,"minute",a.getTimezoneOffset()-n)),c.format(a,g)}return r(p)}function n(a,c){var f;if(c)for(f in a)a.hasOwnProperty(f)&&(void 0===a[f]?delete a[f]:a[f]instanceof Object&&n(a[f],!0));else for(f in a)a.hasOwnProperty(f)&&void 0===a[f]&&delete a[f];return a}var t=["NumberFormat",
"DateString","DateFormat"],B=/<\/?[^>]+>/g,u={valueOf:function(a,c){for(var f in a)if(a[f]==c)return f;return null},stripTags:function(a){if(a){var c=typeof a;if("string"===c)a=a.replace(B,"");else if("object"===c)for(var f in a)(c=a[f])&&"string"===typeof c&&(c=c.replace(B,"")),a[f]=c}return a},substitute:function(a,c,f){var e,d,g,p;l(f)&&(b.isObject(f)?(e=f.first,d=f.dateFormat,g=f.numberFormat,p=f.format):e=f);if(c&&"${*}"!==c)return b.replace(c,b.hitch({obj:a},function(a,c){var f=c.split(":");
return 1<f.length?(c=f[0],f.shift(),(a=p&&p[f[0]])?f=a.formatType:(f=f.join(":"),a=null),q(c,this.obj,f,a)):(a=k(c,p,g,d))?q(c,this.obj,a.formatType,a.options):r(this.obj[c])}),/\$\{([^\}]+)\}/g);c=[];for(var h in a)if(f=(f=k(h,p,g,d))?q(h,a,f.formatType,f.options):a[h],c.push(h+" \x3d "+r(f)+"\x3cbr/\x3e"),e)break;return c.join("")},filter:function(a,c,f){c=p(a,f,c);f={};var b;a=c[0];for(b in a)c[2].call(c[b],a[b],b,a)&&(f[b]=a[b]);return f},startsWith:function(a,c,f){f=f||0;return a.indexOf(c,f)===
f},endsWith:function(a,c,f){if("number"!==typeof f||!isFinite(f)||Math.floor(f)!==f||f>a.length)f=a.length;f-=c.length;a=a.indexOf(c,f);return-1!==a&&a===f},isDefined:l,fixJson:n,isObject:function(a){return a&&"object"===typeof a},isString:function(a){return"string"===typeof a},mixin:function(a,c){for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);return a},clone2DArray:function(a){if(a=a?a.slice(0):null){var c,f=a.length;for(c=0;c<f;c++)a[c]=a[c]?a[c].slice(0):null}return a},clone3DArray:function(a){if(a=
a?a.slice(0):null){var c,f=a.length;for(c=0;c<f;c++){a[c]=a[c]?a[c].slice(0):null;var b=a[c];if(b){var e,d=b.length;for(e=0;e<d;e++)b[e]=b[e]?b[e].slice(0):null}}}return a}};g("extend-esri")&&(b.mixin(f,u),f._isDefined=l,f._getParts=p,f._sanitize=n);return u})},"dojo/date":function(){define(["./has","./_base/lang"],function(m,h){var a={getDaysInMonth:function(b){var d=b.getMonth();return 1==d&&a.isLeapYear(b)?29:[31,28,31,30,31,30,31,31,30,31,30,31][d]},isLeapYear:function(a){a=a.getFullYear();return!(a%
400)||!(a%4)&&!!(a%100)},getTimezoneName:function(a){var b=a.toString(),g="",e=b.indexOf("(");if(-1<e)g=b.substring(++e,b.indexOf(")"));else if(e=/([A-Z\/]+) \d{4}$/,b=b.match(e))g=b[1];else if(b=a.toLocaleString(),e=/ ([A-Z\/]+)$/,b=b.match(e))g=b[1];return"AM"==g||"PM"==g?"":g},compare:function(a,d,g){a=new Date(+a);d=new Date(+(d||new Date));"date"==g?(a.setHours(0,0,0,0),d.setHours(0,0,0,0)):"time"==g&&(a.setFullYear(0,0,0),d.setFullYear(0,0,0));return a>d?1:a<d?-1:0},add:function(a,d,g){var b=
new Date(+a),c=!1,f="Date";switch(d){case "day":break;case "weekday":var k;(d=g%5)?k=parseInt(g/5):(d=0<g?5:-5,k=0<g?(g-5)/5:(g+5)/5);var p=a.getDay(),l=0;6==p&&0<g?l=1:0==p&&0>g&&(l=-1);p+=d;if(0==p||6==p)l=0<g?2:-2;g=7*k+d+l;break;case "year":f="FullYear";c=!0;break;case "week":g*=7;break;case "quarter":g*=3;case "month":c=!0;f="Month";break;default:f="UTC"+d.charAt(0).toUpperCase()+d.substring(1)+"s"}if(f)b["set"+f](b["get"+f]()+g);c&&b.getDate()<a.getDate()&&b.setDate(0);return b},difference:function(b,
d,g){d=d||new Date;g=g||"day";var e=d.getFullYear()-b.getFullYear(),c=1;switch(g){case "quarter":b=b.getMonth();d=d.getMonth();c=Math.floor(d/3)+1+4*e-(Math.floor(b/3)+1);break;case "weekday":e=Math.round(a.difference(b,d,"day"));g=parseInt(a.difference(b,d,"week"));if(0==e%7)e=5*g;else{var c=0,f=b.getDay(),k=d.getDay();g=parseInt(e/7);d=e%7;b=new Date(b);b.setDate(b.getDate()+7*g);b=b.getDay();if(0<e)switch(!0){case 6==f:c=-1;break;case 0==f:c=0;break;case 6==k:c=-1;break;case 0==k:c=-2;break;case 5<
b+d:c=-2}else if(0>e)switch(!0){case 6==f:c=0;break;case 0==f:c=1;break;case 6==k:c=2;break;case 0==k:c=1;break;case 0>b+d:c=2}e=e+c-2*g}c=e;break;case "year":c=e;break;case "month":c=d.getMonth()-b.getMonth()+12*e;break;case "week":c=parseInt(a.difference(b,d,"day")/7);break;case "day":c/=24;case "hour":c/=60;case "minute":c/=60;case "second":c/=1E3;case "millisecond":c*=d.getTime()-b.getTime()}return Math.round(c)}};h.mixin(h.getObject("dojo.date",!0),a);return a})},"dojo/number":function(){define(["./_base/lang",
"./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(m,h,a,b,d){var g={};m.setObject("dojo.number",g);g.format=function(a,f){f=m.mixin({},f||{});var c=h.normalizeLocale(f.locale),c=h.getLocalization("dojo.cldr","number",c);f.customs=c;c=f.pattern||c[(f.type||"decimal")+"Format"];return isNaN(a)||Infinity==Math.abs(a)?null:g._applyPattern(a,c,f)};g._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;g._applyPattern=function(a,f,b){b=b||{};var c=b.customs.group,e=b.customs.decimal;f=f.split(";");
var d=f[0];f=f[0>a?1:0]||"-"+d;if(-1!=f.indexOf("%"))a*=100;else if(-1!=f.indexOf("\u2030"))a*=1E3;else if(-1!=f.indexOf("\u00a4"))c=b.customs.currencyGroup||c,e=b.customs.currencyDecimal||e,f=f.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/,function(a,c,f,e){return(a=b[["symbol","currency","displayName"][f.length-1]]||b.currency||"")?c+a+e:""});else if(-1!=f.indexOf("E"))throw Error("exponential notation not supported");var k=g._numberPatternRE,d=d.match(k);if(!d)throw Error("unable to find a number expression in pattern: "+
f);!1===b.fractional&&(b.places=0);return f.replace(k,g._formatAbsolute(a,d[0],{decimal:e,group:c,places:b.places,round:b.round}))};g.round=function(a,f,b){b=10/(b||10);return(b*+a).toFixed(f)/b};if(0==(.9).toFixed()){var e=g.round;g.round=function(a,f,b){var c=Math.pow(10,-f||0),d=Math.abs(a);if(!a||d>=c)c=0;else if(d/=c,.5>d||.95<=d)c=0;return e(a,f,b)+(0<a?c:-c)}}g._formatAbsolute=function(a,f,e){e=e||{};!0===e.places&&(e.places=0);Infinity===e.places&&(e.places=6);f=f.split(".");var c="string"==
typeof e.places&&e.places.indexOf(","),d=e.places;c?d=e.places.substring(c+1):0<=d||(d=(f[1]||[]).length);0>e.round||(a=g.round(a,d,e.round));a=String(Math.abs(a)).split(".");var k=a[1]||"";f[1]||e.places?(c&&(e.places=e.places.substring(0,c)),c=void 0!==e.places?e.places:f[1]&&f[1].lastIndexOf("0")+1,c>k.length&&(a[1]=b.pad(k,c,"0",!0)),d<k.length&&(a[1]=k.substr(0,d))):a[1]&&a.pop();d=f[0].replace(",","");c=d.indexOf("0");-1!=c&&(c=d.length-c,c>a[0].length&&(a[0]=b.pad(a[0],c)),-1==d.indexOf("#")&&
(a[0]=a[0].substr(a[0].length-c)));var d=f[0].lastIndexOf(","),h,n;-1!=d&&(h=f[0].length-d-1,f=f[0].substr(0,d),d=f.lastIndexOf(","),-1!=d&&(n=f.length-d-1));f=[];for(d=a[0];d;)c=d.length-h,f.push(0<c?d.substr(c):d),d=0<c?d.slice(0,c):"",n&&(h=n,n=void 0);a[0]=f.reverse().join(e.group||",");return a.join(e.decimal||".")};g.regexp=function(a){return g._parseInfo(a).regexp};g._parseInfo=function(a){a=a||{};var c=h.normalizeLocale(a.locale),c=h.getLocalization("dojo.cldr","number",c),b=a.pattern||c[(a.type||
"decimal")+"Format"],e=c.group,l=c.decimal,r=1;if(-1!=b.indexOf("%"))r/=100;else if(-1!=b.indexOf("\u2030"))r/=1E3;else{var q=-1!=b.indexOf("\u00a4");q&&(e=c.currencyGroup||e,l=c.currencyDecimal||l)}c=b.split(";");1==c.length&&c.push("-"+c[0]);c=d.buildGroupRE(c,function(c){c="(?:"+d.escapeString(c,".")+")";return c.replace(g._numberPatternRE,function(c){var f={signed:!1,separator:a.strict?e:[e,""],fractional:a.fractional,decimal:l,exponent:!1};c=c.split(".");var b=a.places;1==c.length&&1!=r&&(c[1]=
"###");1==c.length||0===b?f.fractional=!1:(void 0===b&&(b=a.pattern?c[1].lastIndexOf("0")+1:Infinity),b&&void 0==a.fractional&&(f.fractional=!0),!a.places&&b<c[1].length&&(b+=","+c[1].length),f.places=b);c=c[0].split(",");1<c.length&&(f.groupSize=c.pop().length,1<c.length&&(f.groupSize2=c.pop().length));return"("+g._realNumberRegexp(f)+")"})},!0);q&&(c=c.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(c,f,b,e){c=d.escapeString(a[["symbol","currency","displayName"][b.length-1]]||a.currency||
"");if(!c)return"";f=f?"[\\s\\xa0]":"";e=e?"[\\s\\xa0]":"";return a.strict?f+c+e:(f&&(f+="*"),e&&(e+="*"),"(?:"+f+c+e+")?")}));return{regexp:c.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:e,decimal:l,factor:r}};g.parse=function(a,f){f=g._parseInfo(f);a=(new RegExp("^"+f.regexp+"$")).exec(a);if(!a)return NaN;var c=a[1];if(!a[1]){if(!a[2])return NaN;c=a[2];f.factor*=-1}c=c.replace(new RegExp("["+f.group+"\\s\\xa0]","g"),"").replace(f.decimal,".");return c*f.factor};g._realNumberRegexp=function(a){a=a||{};
"places"in a||(a.places=Infinity);"string"!=typeof a.decimal&&(a.decimal=".");"fractional"in a&&!/^0/.test(a.places)||(a.fractional=[!0,!1]);"exponent"in a||(a.exponent=[!0,!1]);"eSigned"in a||(a.eSigned=[!0,!1]);var c=g._integerRegexp(a),b=d.buildGroupRE(a.fractional,function(c){var f="";c&&0!==a.places&&(f="\\"+a.decimal,f=Infinity==a.places?"(?:"+f+"\\d+)?":f+("\\d{"+a.places+"}"));return f},!0),e=d.buildGroupRE(a.exponent,function(c){return c?"([eE]"+g._integerRegexp({signed:a.eSigned})+")":""}),
c=c+b;b&&(c="(?:(?:"+c+")|(?:"+b+"))");return c+e};g._integerRegexp=function(a){a=a||{};"signed"in a||(a.signed=[!0,!1]);"separator"in a?"groupSize"in a||(a.groupSize=3):a.separator="";var c=d.buildGroupRE(a.signed,function(a){return a?"[-+]":""},!0),b=d.buildGroupRE(a.separator,function(c){if(!c)return"(?:\\d+)";c=d.escapeString(c);" "==c?c="\\s":"\u00a0"==c&&(c="\\s\\xa0");var f=a.groupSize,b=a.groupSize2;return b?(c="(?:0|[1-9]\\d{0,"+(b-1)+"}(?:["+c+"]\\d{"+b+"})*["+c+"]\\d{"+f+"})",0<f-b?"(?:"+
c+"|(?:0|[1-9]\\d{0,"+(f-1)+"}))":c):"(?:0|[1-9]\\d{0,"+(f-1)+"}(?:["+c+"]\\d{"+f+"})*)"},!0);return c+b};return g})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(m,h){var a=/[&<>'"\/]/g,b={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"},d={};h.setObject("dojo.string",d);d.escape=function(d){return d?d.replace(a,function(a){return b[a]}):""};d.rep=function(a,b){if(0>=b||!a)return"";for(var c=[];;){b&1&&c.push(a);if(!(b>>=
1))break;a+=a}return c.join("")};d.pad=function(a,b,c,f){c||(c="0");a=String(a);b=d.rep(c,Math.ceil((b-a.length)/c.length));return f?a+b:b+a};d.substitute=function(a,b,c,f){f=f||m.global;c=c?h.hitch(f,c):function(a){return a};return a.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,function(a,e,d){if(""==e)return"$";a=h.getObject(e,!1,b);d&&(a=h.getObject(d,!1,f).call(f,a,e));d=c(a,e);if("undefined"===typeof d)throw Error('string.substitute could not find key "'+e+'" in template');return d.toString()})};
d.trim=String.prototype.trim?h.trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;0<=b;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a};return d})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(m,h){var a={};h.setObject("dojo.regexp",a);a.escapeString=function(a,d){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(a){return d&&-1!=d.indexOf(a)?a:"\\"+a})};a.buildGroupRE=function(b,d,g){if(!(b instanceof Array))return d(b);for(var e=
[],c=0;c<b.length;c++)e.push(d(b[c]));return a.group(e.join("|"),g)};a.group=function(a,d){return"("+(d?"?:":"")+a+")"};return a})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(m,h,a,b,d,g,e,c,f){function k(a,c,f,d){return d.replace(/([a-z])\1*/ig,function(k){var g,l,p=k.charAt(0);k=k.length;var h=["abbr","wide","narrow"];switch(p){case "G":g=c[4>k?"eraAbbr":"eraNames"][0>
a.getFullYear()?0:1];break;case "y":g=a.getFullYear();switch(k){case 1:break;case 2:if(!f.fullYear){g=String(g);g=g.substr(g.length-2);break}default:l=!0}break;case "Q":case "q":g=Math.ceil((a.getMonth()+1)/3);l=!0;break;case "M":case "L":g=a.getMonth();3>k?(g+=1,l=!0):(p=["months","L"==p?"standAlone":"format",h[k-3]].join("-"),g=c[p][g]);break;case "w":g=r._getWeekOfYear(a,0);l=!0;break;case "d":g=a.getDate();l=!0;break;case "D":g=r._getDayOfYear(a);l=!0;break;case "e":case "c":if(g=a.getDay(),2>
k){g=(g-b.getFirstDayOfWeek(f.locale)+8)%7;break}case "E":g=a.getDay();3>k?(g+=1,l=!0):(p=["days","c"==p?"standAlone":"format",h[k-3]].join("-"),g=c[p][g]);break;case "a":p=12>a.getHours()?"am":"pm";g=f[p]||c["dayPeriods-format-wide-"+p];break;case "h":case "H":case "K":case "k":l=a.getHours();switch(p){case "h":g=l%12||12;break;case "H":g=l;break;case "K":g=l%12;break;case "k":g=l||24}l=!0;break;case "m":g=a.getMinutes();l=!0;break;case "s":g=a.getSeconds();l=!0;break;case "S":g=Math.round(a.getMilliseconds()*
Math.pow(10,k-3));l=!0;break;case "v":case "z":if(g=r._getZone(a,!0,f))break;k=4;case "Z":p=r._getZone(a,!1,f);p=[0>=p?"+":"-",e.pad(Math.floor(Math.abs(p)/60),2),e.pad(Math.abs(p)%60,2)];4==k&&(p.splice(0,0,"GMT"),p.splice(3,0,":"));g=p.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+d);}l&&(g=e.pad(g,k));return g})}function p(a,c,f,b){var e=function(a){return a};c=c||e;f=f||e;b=b||e;var d=a.match(/(''|[^'])+/g),k="'"==a.charAt(0);h.forEach(d,function(a,b){a?
(d[b]=(k?f:c)(a.replace(/''/g,"'")),k=!k):d[b]=""});return b(d.join(""))}function l(a,c,f,b){b=g.escapeString(b);f.strict||(b=b.replace(" a"," ?a"));return b.replace(/([a-z])\1*/ig,function(b){var d;d=b.charAt(0);var e=b.length,k="",g="";f.strict?(1<e&&(k="0{"+(e-1)+"}"),2<e&&(g="0{"+(e-2)+"}")):(k="0?",g="0{0,2}");switch(d){case "y":d="\\d{2,4}";break;case "M":case "L":2<e?(d=c["months-"+("L"==d?"standAlone":"format")+"-"+q[e-3]].slice(0).join("|"),f.strict||(d=d.replace(/\./g,""),d="(?:"+d+")\\.?")):
d="1[0-2]|"+k+"[1-9]";break;case "D":d="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+k+"[1-9][0-9]|"+g+"[1-9]";break;case "d":d="3[01]|[12]\\d|"+k+"[1-9]";break;case "w":d="[1-4][0-9]|5[0-3]|"+k+"[1-9]";break;case "E":case "e":case "c":d=".+?";break;case "h":d="1[0-2]|"+k+"[1-9]";break;case "k":d="1[01]|"+k+"\\d";break;case "H":d="1\\d|2[0-3]|"+k+"\\d";break;case "K":d="1\\d|2[0-4]|"+k+"[1-9]";break;case "m":case "s":d="[0-5]\\d";break;case "S":d="\\d{"+e+"}";break;case "a":e=f.am||c["dayPeriods-format-wide-am"];
k=f.pm||c["dayPeriods-format-wide-pm"];d=e+"|"+k;f.strict||(e!=e.toLowerCase()&&(d+="|"+e.toLowerCase()),k!=k.toLowerCase()&&(d+="|"+k.toLowerCase()),-1!=d.indexOf(".")&&(d+="|"+d.replace(/\./g,"")));d=d.replace(/\./g,"\\.");break;default:d=".*"}a&&a.push(b);return"("+d+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var r={};m.setObject(f.id.replace(/\//g,"."),r);r._getZone=function(c,f,b){return f?a.getTimezoneName(c):c.getTimezoneOffset()};r.format=function(a,c){c=c||{};var f=d.normalizeLocale(c.locale),
b=c.formatLength||"short",f=r._getGregorianBundle(f),e=[];a=m.hitch(this,k,a,f,c);if("year"==c.selector)return p(f["dateFormatItem-yyyy"]||"yyyy",a);var g;"date"!=c.selector&&(g=c.timePattern||f["timeFormat-"+b])&&e.push(p(g,a));"time"!=c.selector&&(g=c.datePattern||f["dateFormat-"+b])&&e.push(p(g,a));return 1==e.length?e[0]:f["dateTimeFormat-"+b].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,c){return e[c]})};r.regexp=function(a){return r._parseInfo(a).regexp};r._parseInfo=function(a){a=a||{};
var c=d.normalizeLocale(a.locale),c=r._getGregorianBundle(c),f=a.formatLength||"short",b=a.datePattern||c["dateFormat-"+f],e=a.timePattern||c["timeFormat-"+f],f="date"==a.selector?b:"time"==a.selector?e:c["dateTimeFormat-"+f].replace(/\{(\d+)\}/g,function(a,c){return[e,b][c]}),k=[];return{regexp:p(f,m.hitch(this,l,k,c,a)),tokens:k,bundle:c}};r.parse=function(c,f){var b=/[\u200E\u200F\u202A\u202E]/g,d=r._parseInfo(f),e=d.tokens,k=d.bundle;c=(new RegExp("^"+d.regexp.replace(b,"")+"$",d.strict?"":"i")).exec(c&&
c.replace(b,""));if(!c)return null;var g=["abbr","wide","narrow"],l=[1970,0,1,0,0,0,0],p="";c=h.every(c,function(a,c){if(!c)return!0;var b=e[c-1];c=b.length;b=b.charAt(0);switch(b){case "y":if(2!=c&&f.strict)l[0]=a;else if(100>a)a=Number(a),b=""+(new Date).getFullYear(),c=100*b.substring(0,2),b=Math.min(Number(b.substring(2,4))+20,99),l[0]=a<b?c+a:c-100+a;else{if(f.strict)return!1;l[0]=a}break;case "M":case "L":if(2<c){if(c=k["months-"+("L"==b?"standAlone":"format")+"-"+g[c-3]].concat(),f.strict||
(a=a.replace(".","").toLowerCase(),c=h.map(c,function(a){return a.replace(".","").toLowerCase()})),a=h.indexOf(c,a),-1==a)return!1}else a--;l[1]=a;break;case "E":case "e":case "c":c=k["days-"+("c"==b?"standAlone":"format")+"-"+g[c-3]].concat();f.strict||(a=a.toLowerCase(),c=h.map(c,function(a){return a.toLowerCase()}));a=h.indexOf(c,a);if(-1==a)return!1;break;case "D":l[1]=0;case "d":l[2]=a;break;case "a":c=f.am||k["dayPeriods-format-wide-am"];b=f.pm||k["dayPeriods-format-wide-pm"];if(!f.strict){var d=
/\./g;a=a.replace(d,"").toLowerCase();c=c.replace(d,"").toLowerCase();b=b.replace(d,"").toLowerCase()}if(f.strict&&a!=c&&a!=b)return!1;p=a==b?"p":a==c?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":if(23<a)return!1;l[3]=a;break;case "m":l[4]=a;break;case "s":l[5]=a;break;case "S":l[6]=a}return!0});b=+l[3];"p"===p&&12>b?l[3]=b+12:"a"===p&&12==b&&(l[3]=0);b=new Date(l[0],l[1],l[2],l[3],l[4],l[5],l[6]);f.strict&&b.setFullYear(l[0]);var n=e.join(""),d=-1!=n.indexOf("d"),n=-1!=n.indexOf("M");
if(!c||n&&b.getMonth()>l[1]||d&&b.getDate()>l[2])return null;if(n&&b.getMonth()<l[1]||d&&b.getDate()<l[2])b=a.add(b,"hour",1);return b};var q=["abbr","wide","narrow"],n=[],t={};r.addCustomFormats=function(a,c){n.push({pkg:a,name:c});t={}};r._getGregorianBundle=function(a){if(t[a])return t[a];var c={};h.forEach(n,function(f){f=d.getLocalization(f.pkg,f.name,a);c=m.mixin(c,f)},this);return t[a]=c};r.addCustomFormats(f.id.replace(/\/date\/locale$/,".cldr"),"gregorian");r.getNames=function(a,c,f,b){var d;
b=r._getGregorianBundle(b);a=[a,f,c];"standAlone"==f&&(f=a.join("-"),d=b[f],1==d[0]&&(d=void 0));a[1]="format";return(d||b[a.join("-")]).concat()};r.isWeekend=function(a,c){c=b.getWeekend(c);a=(a||new Date).getDay();c.end<c.start&&(c.end+=7,a<c.start&&(a+=7));return a>=c.start&&a<=c.end};r._getDayOfYear=function(c){return a.difference(new Date(c.getFullYear(),0,1,c.getHours()),c)+1};r._getWeekOfYear=function(a,c){1==arguments.length&&(c=0);var f=(new Date(a.getFullYear(),0,1)).getDay(),b=(f-c+7)%
7,b=Math.floor((r._getDayOfYear(a)+b-1)/7);f==c&&b++;return b};return r})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(m,h){var a={};m.setObject("dojo.cldr.supplemental",a);a.getFirstDayOfWeek=function(b){b={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,
mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[a._region(b)];return void 0===b?1:b};a._region=function(a){a=h.normalizeLocale(a);a=a.split("-");var b=a[1];b?4==b.length&&(b=a[2]):b={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",
dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",
lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",
tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",
chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",
kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",
mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",
swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[a[0]];return b};a.getWeekend=function(b){var d=a._region(b);b={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,
tn:5}[d];d={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[d];void 0===b&&(b=6);void 0===d&&(d=0);return{start:b,end:d}};return a})},"esri/SpatialReference":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/has","./kernel","./lang"],function(m,h,a,b,d){function g(){}var e=[-2.0037508342788905E7,2.0037508342788905E7],c=[-2.0037508342787E7,2.0037508342787E7];m=m(null,{declaredClass:"esri.SpatialReference",constructor:function(a){a&&(d.isObject(a)?
d.mixin(this,a):d.isString(a)?this.wkt=a:this.wkid=a)},wkid:null,wkt:null,_info:{102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',
valid:e,origin:c,dx:1E-5},102100:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:e,origin:c,
dx:1E-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:e,origin:c,dx:1E-5},3857:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',
valid:e,origin:c,dx:1E-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",${Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],UNIT["Degrees",111319.491]]',
valid:[-180,180],origin:[-180,180],dx:1E-5}},_isWebMercator:function(){return-1!==h.indexOf([102113,102100,3857,3785],this.wkid)},_isWrappable:function(){return-1!==h.indexOf([102113,102100,3857,3785,4326],this.wkid)},_getInfo:function(){return this.wkid?this._info[this.wkid]:null},_canProject:function(a){var c=!1;a&&(c=this.isWebMercator()&&4326===a.wkid||a.isWebMercator()&&4326===this.wkid);return c},isWebMercator:function(){return this._isWebMercator()},equals:function(a){var c=!1;a&&(this===a&&
(c=!0),this.wkid||a.wkid?c=this.wkid===a.wkid||this.isWebMercator()&&a.isWebMercator()||this.wkid===a.latestWkid||a.wkid===this.latestWkid:this.wkt&&a.wkt&&(c=this.wkt.toUpperCase()===a.wkt.toUpperCase()));return c},toJson:function(){var a=null;null!=this.wkid?a={wkid:this.wkid}:null!=this.wkt&&(a={wkt:this.wkt});a&&null!=this.latestWkid&&(a.latestWkid=this.latestWkid);return a}});g.prototype=m.prototype;m.simpleConstructor=g;a("extend-esri")&&(b.SpatialReference=m);return m})},"esri/geometry/Geometry":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../SpatialReference"],function(m,h,a,b,d){m=m(null,{declaredClass:"esri.geometry.Geometry",spatialReference:null,type:null,cache:void 0,setSpatialReference:function(a){this.spatialReference=a;return this},verifySR:function(){this.spatialReference||this.setSpatialReference(new d(4326))},getExtent:function(){return null},clearCache:function(){this.cache=void 0},getCacheValue:function(a){return this.cache&&this.cache[a]},setCacheValue:function(a,b){this.cache||
(this.cache={});this.cache[a]=b}});a("extend-esri")&&h.setObject("geometry.Geometry",m,b);return m})},"esri/geometry/Point":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ../srUtils".split(" "),function(m,h,a,b,d,g,e,c){function f(a,c){89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999);c*=.017453292519943;return[111319.49079327169*a,3189068.5*Math.log((1+Math.sin(c))/(1-Math.sin(c)))]}function k(a,c,f){a=a/6378137*57.29577951308232;return f?
[a,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*c/6378137)))]:[a-360*Math.floor((a+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*c/6378137)))]}function p(){}function l(){}function r(a){var c=a._json;a._unquantizeFn?(c=a._unquantizeFn({x:c.x,y:c.y}),a._xVal=c.x,a._yVal=c.y,a._unquantizeFn=null):(a._xVal=c.x,a._yVal=c.y);a._json=null}g={type:"point",x:0,y:0};m=m(e,{declaredClass:"esri.geometry.Point",type:"point",x:0,y:0,constructor:function(a,f,b){h.isArray(a)?
(this.x=a[0],this.y=a[1],this.spatialReference=f):d.isObject(a)?(d.mixin(this,a),null!=this.latitude&&(this.y=this.latitude),null!=this.longitude&&(this.x=this.longitude),this.spatialReference&&(this.spatialReference=c.createSpatialReference(this.spatialReference))):(this.x=a,this.y=f,this.spatialReference=b);this.verifySR()},offset:function(a,c){return new this.constructor(this.x+a,this.y+c,this.spatialReference)},setX:function(a){this.x=a;this.clearCache();return this},setY:function(a){this.y=a;
this.clearCache();return this},setLongitude:function(a){var c=this.spatialReference;c&&(c._isWebMercator()?this.setX(f(a,this.y)[0]):4326===c.wkid&&this.setX(a));return this},setLatitude:function(a){var c=this.spatialReference;c&&(c._isWebMercator()?this.setY(f(this.x,a)[1]):4326===c.wkid&&this.setY(a));return this},getLongitude:function(){var a=this.spatialReference,c;a&&(a._isWebMercator()?c=k(this.x,this.y)[0]:4326===a.wkid&&(c=this.x));return c},getLatitude:function(){var a=this.spatialReference,
c;a&&(a._isWebMercator()?c=k(this.x,this.y)[1]:4326===a.wkid&&(c=this.y));return c},update:function(a,c){this.x=a;this.y=c;this.clearCache();return this},normalize:function(){var a=this.x,c=this.spatialReference;if(c){var f=c._getInfo();f&&(a=this._normalizeX(a,f))}return new this.constructor(a,this.y,c)},_normalizeX:function(a,c){var f=c.valid[0],b=c.valid[1];c=2*b;a>b?(f=Math.ceil(Math.abs(a-b)/c),a-=f*c):a<f&&(f=Math.ceil(Math.abs(a-f)/c),a+=f*c);return a},toJson:function(){var a={x:this.x,y:this.y},
c=this.spatialReference;c&&(a.spatialReference=c.toJson());return a}});p.prototype=m.prototype;l.prototype=new p;Object.defineProperty(l.prototype,"x",{get:function(){this._json&&r(this);return this._xVal},set:function(a){this._xVal=a}});Object.defineProperty(l.prototype,"y",{get:function(){this._json&&r(this);return this._yVal},set:function(a){this._yVal=a}});l.prototype.setupLazyUnquantization=function(a,c){this._unquantizeFn=a;this._json=c};m.simpleConstructor=p;m.accessorConstructor=l;m.lngLatToXY=
f;m.xyToLngLat=k;m.defaultProps=g;m.metersPerDegree=6378137*Math.PI/180;a("extend-esri")&&(h.setObject("geometry.Point",m,b),b.geometry.defaultPoint=g);return m})},"esri/srUtils":function(){define(["./SpatialReference","./ImageSpatialReference","./kernel","./sniff","dojo/_base/lang"],function(m,h,a,b,d){function g(a){var c=!1;a&&(a.ics||a.icsid)&&(c=!0);return c}var e={isICS:g,createSpatialReference:function(a){var c=null;a&&(c=g(a)?new h(a):new m(a));return c}};b("extend-esri")&&d.mixin(a,e);return e})},
"esri/ImageSpatialReference":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./lang ./SpatialReference".split(" "),function(m,h,a,b,d,g){m=m(g,{declaredClass:"esri.ImageSpatialReference",constructor:function(a){a&&h.isObject(a)&&h.mixin(this,a)},icsid:null,icsns:null,ics:null,_isWebMercator:function(){return!1},_isWrappable:function(){return!1},equals:function(a){var c=!1;if(a)if(this.icsid&&a.icsid){if(c=this.icsid===a.icsid,this.icsns||a.icsns)c=c&&this.icsns===a.icsns}else this.ics&&
a.ics&&(c=this.ics===a.ics);return c},toJson:function(a){var c=null,f=d.isDefined;a=f(a)?a:!0;f(this.icsid)?(c={icsid:this.icsid},f(this.icsns)&&(c.icsns=this.icsns)):f(this.ics)&&(c={ics:this.ics});f(this.url)&&f(c)&&a&&(c.url=this.url);return c}});a("extend-esri")&&(b.ImageSpatialReference=m);return m})},"esri/sniff":function(){define(["dojo/_base/sniff","dojo/global","./kernel"],function(m,h,a){var b=m("ff"),d=m("ie"),g=void 0===d&&7<=m("trident"),e=m("edge"),c=m("webkit"),f=m("opera"),k=m("chrome"),
p=m("safari"),l=navigator.userAgent,r;(r=l.match(/(iPhone|iPad|CPU)\s+OS\s+(\d+\_\d+)/i))&&m.add("esri-iphone",parseFloat(r[2].replace("_",".")));(r=l.match(/Android\s+(\d+(\.\d+)*)/i))&&m.add("esri-android",parseFloat(r[1]));(r=l.match(/Fennec\/(\d+\.\d+)/i))&&m.add("esri-fennec",parseFloat(r[1]));0<=l.indexOf("BlackBerry")&&0<=l.indexOf("WebKit")&&m.add("esri-blackberry",1);m.add("esri-touch",m("esri-iphone")||m("esri-android")||m("esri-blackberry")||6<=m("esri-fennec")||(b||c)&&(document.createTouch||
"ontouchstart"in h||h.TouchEvent&&0<navigator.maxTouchPoints)?!0:!1);(r=l.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i))&&m.add("esri-mobile",!!r);m.add("esri-pointer",!b&&(navigator.pointerEnabled||navigator.msPointerEnabled||!!h.PointerEvent));a._getDOMAccessor=function(a){var e="";b?e="Moz":c?e="Webkit":d?e="ms":f&&(e="O");return e+a.charAt(0).toUpperCase()+a.substr(1)};m.add("esri-phonegap",!!h.cordova);m.add("esri-cors",m("esri-phonegap")||h.XMLHttpRequest&&"withCredentials"in
new XMLHttpRequest);m.add("esri-file-upload",h.FormData&&h.FileList?!0:!1);m.add("esri-script-sandbox",function(){return"MessageChannel"in h&&"HTMLIFrameElement"in h&&"sandbox"in HTMLIFrameElement.prototype});m.add("esri-secure-context",function(){if("isSecureContext"in h)return h.isSecureContext;if(h.location&&h.location.origin)return 0===h.location.origin.indexOf("https:")});m.add("esri-wasm","WebAssembly"in h);m.add("esri-workers",h.Worker?!0:!1);m.add("esri-featurelayer-webgl",!1);if(l=m("esri-featurelayer-webgl")){var q=
m("esri-mobile");r=q?1:2;q=q?1:3;"object"===typeof l?(l.maxDrillLevel=null==l.maxDrillLevel?r:l.maxDrillLevel,l.maxRecordCountFactor=null==l.maxRecordCountFactor?q:l.maxRecordCountFactor,l.enablePBFQuery=null==l.enablePBFQuery?!0:l.enablePBFQuery):m.add("esri-featurelayer-webgl",{maxDrillLevel:r,maxRecordCountFactor:q,enablePBFQuery:!0},null,!0)}m.add("esri-featurelayer-webgl-labeling",!1);m.add("esri-pbf",!d||10<=d);m.add("esri-featurelayer-pbf",!0);m.add("esri-transforms",g||e||9<=d||3.5<=b||4<=
k||3.1<=p||10.5<=f||3.2<=m("esri-iphone")||2.1<=m("esri-android"));m.add("esri-transitions",g||e||10<=d||4<=b||4<=k||3.1<=p||10.5<=f||3.2<=m("esri-iphone")||2.1<=m("esri-android"));m.add("esri-transforms3d",g||e||10<=b||12<=k||4<=p||3.2<=m("esri-iphone")||3<=m("esri-android"));m.add("esri-url-encodes-apostrophe",function(){if(!h.document)return!1;var a=h.document.createElement("a");a.href="?'";return-1<a.href.indexOf("?%27")});3>m("esri-android")&&(m.add("esri-transforms",!1,!1,!0),m.add("esri-transitions",
!1,!1,!0),m.add("esri-transforms3d",!1,!1,!0));m.add("esri-will-change",m("esri-transforms")&&(52<=k||11.1<=p));a._css=function(a){var e=m("esri-transforms3d");void 0!==a&&null!==a?e=a:e&&(k||p&&!m("esri-iphone"))&&(e=!1);var g=e?"translate3d(":"translate(",l=e?k?",-1px)":",0px)":")",h=e?"scale3d(":"scale(",n=e?",1)":")",r=e?"rotate3d(0,0,1,":"rotate(",q=e?"matrix3d(":"matrix(",D=e?",0,0,":",",y=e?",0,0,0,0,1,0,":",",z=e?",0,1)":")";return{names:{transition:c&&"-webkit-transition"||b&&"MozTransition"||
f&&"OTransition"||d&&"msTransition"||"transition",transform:c&&"-webkit-transform"||b&&"MozTransform"||f&&"OTransform"||d&&"msTransform"||"transform",transformName:c&&"-webkit-transform"||b&&"-moz-transform"||f&&"-o-transform"||d&&"-ms-transform"||"transform",origin:c&&"-webkit-transform-origin"||b&&"MozTransformOrigin"||f&&"OTransformOrigin"||d&&"msTransformOrigin"||"transformOrigin",endEvent:c&&"webkitTransitionEnd"||b&&"transitionend"||f&&"oTransitionEnd"||d&&"MSTransitionEnd"||"transitionend"},
translate:function(a,c){return g+a+"px,"+c+"px"+l},scale:function(a){return h+a+","+a+n},rotate:function(a){return r+a+"deg)"},matrix:function(a){return q+a.xx+","+a.xy+D+a.yx+","+a.yy+y+a.dx.toFixed(10)+(b&&59>=b?"px,":",")+a.dy.toFixed(10)+(b&&59>=b?"px":"")+z},getScaleFromMatrix:function(a){if(!a)return 1;a=a.toLowerCase();var c=-1<a.indexOf("matrix3d")?"matrix3d(":"matrix(";return Number(a.substring(c.length,a.indexOf(",")))}}};m("extend-esri")&&(a.isiPhone=m("esri-iphone"),a.isAndroid=m("esri-android"),
a.isFennec=m("esri-fennec"),a.isBlackBerry=m("esri-blackberry"),a.isTouchEnabled=m("esri-touch"),a.isPointerEnabled=m("esri-pointer"),a._hasCors=m("esri-cors"),a._hasFileUpload=m("esri-file-upload"),a._hasTransforms=m("esri-transforms"),a._hasTransitions=m("esri-transitions"),a._has3DTransforms=m("esri-transforms3d"));return m})},"esri/geometry/webMercatorUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/has ../kernel ../SpatialReference ./Point".split(" "),function(m,h,a,b,d,g){function e(a,
c,f,b){if("point"===a.type){var e=c(a.x,a.y,b);return new a.constructor(e[0],e[1],new d(f))}if("extent"===a.type){var e=c(a.xmin,a.ymin,b),k=c(a.xmax,a.ymax,b);return new a.constructor(e[0],e[1],k[0],k[1],new d(f))}if("polyline"===a.type||"polygon"===a.type){var e="polyline"===a.type,g=[],l;m.forEach(e?a.paths:a.rings,function(a){g.push(l=[]);m.forEach(a,function(a){l.push(c(a[0],a[1],b))})});return e?new a.constructor({paths:g,spatialReference:new d(f)}):new a.constructor({rings:g,spatialReference:new d(f)})}if("multipoint"===
a.type){var p=[];m.forEach(a.points,function(a){p.push(c(a[0],a[1],b))});return new a.constructor({points:p,spatialReference:new d(f)})}}function c(a,c){a=a&&(null!=a.wkid?a:a.spatialReference);c=c&&(null!=c.wkid?c:c.spatialReference);return a&&c?c.equals(a)?!0:c._canProject(a):!1}var f={canProject:c,project:function(a,f){var b=a&&a.spatialReference;f=f&&(null!=f.wkid?f:f.spatialReference);b&&f?b.equals(f)?a=new a.constructor(a.toJson()):c(b,f)?f.isWebMercator()?a=e(a,g.lngLatToXY,{wkid:102100}):
4326===f.wkid&&(a=e(a,g.xyToLngLat,{wkid:4326})):a=null:a=null;return a},lngLatToXY:g.lngLatToXY,xyToLngLat:g.xyToLngLat,metersPerDegree:g.metersPerDegree,geographicToWebMercator:function(a){return e(a,g.lngLatToXY,{wkid:102100})},webMercatorToGeographic:function(a,c){return e(a,g.xyToLngLat,{wkid:4326},c)}};a("extend-esri")&&h.mixin(h.getObject("geometry",!0,b),f);return f})},"esri/geometry/mathUtils":function(){define(["dojo/_base/lang","dojo/has","../kernel","./Point"],function(m,h,a,b){function d(a,
c,d){return a instanceof b?new b(a.x+d*(c.x-a.x),a.y+d*(c.y-a.y)):[a[0]+d*(c[0]-a[0]),a[1]+d*(c[1]-a[1])]}function g(a,c){return 1E-8>Math.abs(a-c)}function e(a,c,b,d){var f,e=g(a[0],c[0])?1E10:(a[1]-c[1])/(a[0]-c[0]),k=g(b[0],d[0])?1E10:(b[1]-d[1])/(b[0]-d[0]),l=a[1]-e*a[0],p=b[1]-k*b[0];if(g(e,k)){if(g(l,p)){if(g(a[0],c[0]))if(Math.min(a[1],c[1])<Math.max(b[1],d[1])||Math.max(a[1],c[1])>Math.min(b[1],d[1]))a=(a[1]+c[1]+b[1]+d[1]-Math.min(a[1],c[1],b[1],d[1])-Math.max(a[1],c[1],b[1],d[1]))/2,f=(a-
l)/e;else return null;else if(Math.min(a[0],c[0])<Math.max(b[0],d[0])||Math.max(a[0],c[0])>Math.min(b[0],d[0]))f=(a[0]+c[0]+b[0]+d[0]-Math.min(a[0],c[0],b[0],d[0])-Math.max(a[0],c[0],b[0],d[0]))/2,a=e*f+l;else return null;return[f,a]}return null}g(e,1E10)?(f=a[0],a=k*f+p):g(k,1E10)?(f=b[0],a=e*f+l):(f=-(l-p)/(e-k),a=a[1]===c[1]?a[1]:b[1]===d[1]?b[1]:e*f+l);return[f,a]}var c={getLength:function(a,c){var f=c.x-a.x;a=c.y-a.y;return Math.sqrt(f*f+a*a)},_getLength:function(a,c){var f=c[0]-a[0];a=c[1]-
a[1];return Math.sqrt(f*f+a*a)},getPointOnLine:d,getMidpoint:function(a,c){return d(a,c,.5)},_equals:g,_getLineIntersection:e,getLineIntersection:function(a,c,d,g,h){(a=e([a.x,a.y],[c.x,c.y],[d.x,d.y],[g.x,g.y]))&&(a=new b(a[0],a[1],h));return a},_getLineIntersection2:function(a,c){var b=a[0],f=a[1],d=c[0],e=c[1];c=b[0];b=b[1];a=f[0];var f=f[1],k=d[0],g=d[1],d=e[0]-k,k=c-k,h=a-c,e=e[1]-g,g=b-g,m=f-b,v=e*h-d*m;if(0===v)return!1;d=(d*g-e*k)/v;k=(h*g-m*k)/v;return 0<=d&&1>=d&&0<=k&&1>=k?[c+d*(a-c),b+
d*(f-b)]:!1},_pointLineDistance:function(a,c){var b=c[0],f=c[1];c=b[0];var d=b[1],b=a[0];a=a[1];var e=f[0]-c,k=f[1]-d,g=b-c,h=a-d,f=Math.sqrt,m=Math.pow,v=f(m(e,2)+m(k,2)),g=(g*e+h*k)/(v*v),d=d+g*k;return f(m(b-(c+g*e),2)+m(a-d,2))}};h("extend-esri")&&m.mixin(m.getObject("geometry",!0,a),c);return c})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),
function(m,h,a,b,d,g,e){return m([e],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,b){if(a||b){var c=b&&b.refTileInfo;a?this.virtual=!1:(this.virtual=!0,h.mixin(this,{rows:b.rows||this.rows,cols:b.cols||this.cols,compressionQuality:b.compressionQuality||95,lercError:b.compressionTolerance||.01,spatialReference:b.spatialReference,origin:b.origin}),
this.width=this.cols,this.height=this.rows,this.origin||(c?this.origin=c.origin:b.spatialReference.isWebMercator()||b.extent&&360<=Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(b.spatialReference.wkid)||360>Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:b.extent.xmin,y:b.extent.ymax}))}},toJson:function(){var a=e.prototype.toJson.apply(this);a.tileType=this.tileType;
a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/TileInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../SpatialReference ../geometry/Point ./LOD".split(" "),function(m,h,a,b,d,g,e,c,f){m=m(null,{declaredClass:"esri.layers.TileInfo",constructor:function(b){h.mixin(this,b);this.width=this.cols;this.height=this.rows;this._levelToLOD={};b=this.spatialReference;
var d=this.origin;b&&(b=this.spatialReference=new e(b.toJson?b.toJson():b));d&&(this.origin=new c(d.toJson?d.toJson():d),!d.spatialReference&&b&&this.origin.setSpatialReference(new e(b.toJson())));this.lods=a.map(this.lods,function(a){return new f(a)});a.forEach(this.lods,function(a){this._levelToLOD[a.level]=a},this);b=!1;var d=this.spatialReference,k=this.origin;if(d&&k){var g=d._getInfo();g&&(b=d._isWrappable()&&Math.abs(g.origin[0]-k.x)<=g.dx)}this.isWrappable=b;this._initializeUpsampleLevels()},
toJson:function(){return g.fixJson({rows:this.rows,cols:this.cols,dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin&&this.origin.toJson(),spatialReference:this.spatialReference&&this.spatialReference.toJson(),lods:this.lods&&a.map(this.lods,function(a){return a.toJson()})})},lodAt:function(a){return this._levelToLOD&&this._levelToLOD[a]||null},updateTileInfo:function(a){var c=this.lodAt(a.level),b=c.resolution*this.width,c=c.resolution*this.height;a.id=
a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=[0,0,0,0]);a.extent[0]=this.origin.x+a.col*b;a.extent[1]=this.origin.y-(a.row+1)*c;a.extent[2]=a.extent[0]+b;a.extent[3]=a.extent[1]+c},upsampleTile:function(a){var c=this._upsampleLevels[a.level];if(!c||-1===c.parentLevel)return!1;a.level=c.parentLevel;a.row=Math.floor(a.row/c.factor+.001);a.col=Math.floor(a.col/c.factor+.001);this.updateTileInfo(a);return!0},_initializeUpsampleLevels:function(){var a=this.lods;this._upsampleLevels=[];for(var c=null,
b=0;b<a.length;b++){var f=a[b];this._upsampleLevels[f.level]={parentLevel:c?c.level:-1,factor:c?c.resolution/f.resolution:0};c=f}}});b("extend-esri")&&h.setObject("layers.TileInfo",m,d);return m})},"esri/layers/LOD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(m,h,a,b,d){m=m(null,{declaredClass:"esri.layers.LOD",constructor:function(a){h.mixin(this,a)},toJson:function(){return d.fixJson({level:this.level,levelValue:this.levelValue,resolution:this.resolution,
scale:this.scale})}});a("extend-esri")&&h.setObject("layers.LOD",m,b);return m})},"esri/WKIDUnitConversion":function(){define(["dojo/has","./kernel"],function(m,h){var a,b={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.116756,5E4,15E4],units:"Meter Foot Foot_US Foot_Clarke Yard_Clarke Link_Clarke Yard_Sears Foot_Sears Chain_Sears Chain_Benoit_1895_B Yard_Indian Yard_Indian_1937 Foot_Gold_Coast Chain_Sears_1922_Truncated 50_Kilometers 150_Kilometers".split(" "),
2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,
3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,
3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,
3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,
5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,
6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,
6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,
6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,
6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,
7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,
7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,
8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,
8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,
8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,
24600:0,25E3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,
32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,
103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,
103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,
103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,
103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(a=2E3;2045>=a;a++)b[a]=0;for(a=2056;2065>=a;a++)b[a]=0;for(a=2067;2135>=a;a++)b[a]=0;for(a=2137;2154>=a;a++)b[a]=0;for(a=2161;2170>=a;a++)b[a]=0;for(a=2172;2193>=a;a++)b[a]=
0;for(a=2195;2198>=a;a++)b[a]=0;for(a=2200;2203>=a;a++)b[a]=0;for(a=2205;2217>=a;a++)b[a]=0;for(a=2222;2224>=a;a++)b[a]=1;for(a=2225;2250>=a;a++)b[a]=2;for(a=2251;2253>=a;a++)b[a]=1;for(a=2257;2264>=a;a++)b[a]=2;for(a=2274;2279>=a;a++)b[a]=2;for(a=2280;2282>=a;a++)b[a]=1;for(a=2283;2289>=a;a++)b[a]=2;for(a=2290;2292>=a;a++)b[a]=0;for(a=2308;2313>=a;a++)b[a]=0;for(a=2315;2491>=a;a++)b[a]=0;for(a=2494;2866>=a;a++)b[a]=0;for(a=2867;2869>=a;a++)b[a]=1;for(a=2870;2888>=a;a++)b[a]=2;for(a=2891;2895>=a;a++)b[a]=
2;for(a=2896;2898>=a;a++)b[a]=1;for(a=2902;2908>=a;a++)b[a]=2;for(a=2915;2920>=a;a++)b[a]=2;for(a=2921;2923>=a;a++)b[a]=1;for(a=2924;2930>=a;a++)b[a]=2;for(a=2931;2962>=a;a++)b[a]=0;for(a=2964;2968>=a;a++)b[a]=2;for(a=2969;2973>=a;a++)b[a]=0;for(a=2975;2991>=a;a++)b[a]=0;for(a=2995;3051>=a;a++)b[a]=0;for(a=3054;3079>=a;a++)b[a]=0;for(a=3081;3088>=a;a++)b[a]=0;for(a=3092;3101>=a;a++)b[a]=0;for(a=3106;3138>=a;a++)b[a]=0;for(a=3146;3151>=a;a++)b[a]=0;for(a=3153;3166>=a;a++)b[a]=0;for(a=3168;3172>=a;a++)b[a]=
0;for(a=3174;3203>=a;a++)b[a]=0;for(a=3294;3358>=a;a++)b[a]=0;for(a=3367;3403>=a;a++)b[a]=0;for(a=3408;3416>=a;a++)b[a]=0;for(a=3417;3438>=a;a++)b[a]=2;for(a=3441;3446>=a;a++)b[a]=2;for(a=3447;3450>=a;a++)b[a]=0;for(a=3451;3459>=a;a++)b[a]=2;for(a=3460;3478>=a;a++)b[a]=0;for(a=3554;3559>=a;a++)b[a]=0;for(a=3560;3570>=a;a++)b[a]=2;for(a=3571;3581>=a;a++)b[a]=0;for(a=3594;3597>=a;a++)b[a]=0;for(a=3601;3604>=a;a++)b[a]=0;for(a=3637;3639>=a;a++)b[a]=0;for(a=3665;3667>=a;a++)b[a]=0;for(a=3693;3695>=a;a++)b[a]=
0;for(a=3701;3727>=a;a++)b[a]=0;for(a=3728;3739>=a;a++)b[a]=2;for(a=3740;3751>=a;a++)b[a]=0;for(a=3753;3760>=a;a++)b[a]=2;for(a=3761;3773>=a;a++)b[a]=0;for(a=3775;3777>=a;a++)b[a]=0;for(a=3779;3781>=a;a++)b[a]=0;for(a=3783;3785>=a;a++)b[a]=0;for(a=3788;3791>=a;a++)b[a]=0;for(a=3797;3802>=a;a++)b[a]=0;for(a=3814;3816>=a;a++)b[a]=0;for(a=3825;3829>=a;a++)b[a]=0;for(a=3832;3841>=a;a++)b[a]=0;for(a=3844;3852>=a;a++)b[a]=0;for(a=3873;3885>=a;a++)b[a]=0;for(a=3890;3893>=a;a++)b[a]=0;for(a=3907;3912>=a;a++)b[a]=
0;for(a=3942;3950>=a;a++)b[a]=0;for(a=3968;3970>=a;a++)b[a]=0;for(a=3973;3976>=a;a++)b[a]=0;for(a=3986;3989>=a;a++)b[a]=0;for(a=3994;3997>=a;a++)b[a]=0;for(a=4048;4051>=a;a++)b[a]=0;for(a=4056;4063>=a;a++)b[a]=0;for(a=4093;4096>=a;a++)b[a]=0;for(a=4390;4398>=a;a++)b[a]=0;for(a=4399;4413>=a;a++)b[a]=2;for(a=4418;4433>=a;a++)b[a]=2;for(a=4455;4457>=a;a++)b[a]=2;for(a=4484;4489>=a;a++)b[a]=0;for(a=4491;4554>=a;a++)b[a]=0;for(a=4568;4589>=a;a++)b[a]=0;for(a=4652;4656>=a;a++)b[a]=0;for(a=4766;4800>=a;a++)b[a]=
0;for(a=5014;5016>=a;a++)b[a]=0;for(a=5069;5072>=a;a++)b[a]=0;for(a=5105;5130>=a;a++)b[a]=0;for(a=5173;5188>=a;a++)b[a]=0;for(a=5253;5259>=a;a++)b[a]=0;for(a=5269;5275>=a;a++)b[a]=0;for(a=5292;5311>=a;a++)b[a]=0;for(a=5329;5331>=a;a++)b[a]=0;for(a=5343;5349>=a;a++)b[a]=0;for(a=5355;5357>=a;a++)b[a]=0;for(a=5387;5389>=a;a++)b[a]=0;for(a=5459;5463>=a;a++)b[a]=0;for(a=5479;5482>=a;a++)b[a]=0;for(a=5518;5520>=a;a++)b[a]=0;for(a=5530;5539>=a;a++)b[a]=0;for(a=5550;5552>=a;a++)b[a]=0;for(a=5562;5583>=a;a++)b[a]=
0;for(a=5623;5625>=a;a++)b[a]=2;for(a=5631;5639>=a;a++)b[a]=0;for(a=5649;5653>=a;a++)b[a]=0;for(a=5663;5680>=a;a++)b[a]=0;for(a=5682;5685>=a;a++)b[a]=0;for(a=5875;5877>=a;a++)b[a]=0;for(a=5896;5899>=a;a++)b[a]=0;for(a=5921;5940>=a;a++)b[a]=0;for(a=6050;6125>=a;a++)b[a]=0;for(a=6244;6275>=a;a++)b[a]=0;for(a=6328;6348>=a;a++)b[a]=0;for(a=6350;6356>=a;a++)b[a]=0;for(a=6366;6372>=a;a++)b[a]=0;for(a=6381;6387>=a;a++)b[a]=0;for(a=6393;6404>=a;a++)b[a]=0;for(a=6480;6483>=a;a++)b[a]=0;for(a=6511;6514>=a;a++)b[a]=
0;for(a=6579;6581>=a;a++)b[a]=0;for(a=6619;6624>=a;a++)b[a]=0;for(a=6625;6627>=a;a++)b[a]=2;for(a=6628;6632>=a;a++)b[a]=0;for(a=6634;6637>=a;a++)b[a]=0;for(a=6669;6692>=a;a++)b[a]=0;for(a=6707;6709>=a;a++)b[a]=0;for(a=6720;6723>=a;a++)b[a]=0;for(a=6732;6738>=a;a++)b[a]=0;for(a=6931;6933>=a;a++)b[a]=0;for(a=6956;6959>=a;a++)b[a]=0;for(a=7005;7007>=a;a++)b[a]=0;for(a=7057;7070>=a;a++)b[a]=2;for(a=7074;7082>=a;a++)b[a]=0;for(a=7109;7118>=a;a++)b[a]=0;for(a=7119;7127>=a;a++)b[a]=1;for(a=7374;7376>=a;a++)b[a]=
0;for(a=7528;7586>=a;a++)b[a]=0;for(a=7587;7645>=a;a++)b[a]=2;for(a=7692;7696>=a;a++)b[a]=0;for(a=7755;7787>=a;a++)b[a]=0;for(a=7791;7795>=a;a++)b[a]=0;for(a=7799;7801>=a;a++)b[a]=0;for(a=7803;7805>=a;a++)b[a]=0;for(a=7825;7831>=a;a++)b[a]=0;for(a=7845;7859>=a;a++)b[a]=0;for(a=8013;8032>=a;a++)b[a]=0;for(a=8065;8068>=a;a++)b[a]=1;for(a=8518;8529>=a;a++)b[a]=2;for(a=8533;8536>=a;a++)b[a]=2;for(a=8538;8540>=a;a++)b[a]=2;for(a=8677;8679>=a;a++)b[a]=0;for(a=8836;8840>=a;a++)b[a]=0;for(a=8857;8859>=a;a++)b[a]=
0;for(a=8908;8910>=a;a++)b[a]=0;for(a=9154;9159>=a;a++)b[a]=0;for(a=9205;9218>=a;a++)b[a]=0;for(a=20002;20032>=a;a++)b[a]=0;for(a=20062;20092>=a;a++)b[a]=0;for(a=20135;20138>=a;a++)b[a]=0;for(a=20248;20258>=a;a++)b[a]=0;for(a=20348;20358>=a;a++)b[a]=0;for(a=20436;20440>=a;a++)b[a]=0;for(a=20822;20824>=a;a++)b[a]=0;for(a=20934;20936>=a;a++)b[a]=0;for(a=21035;21037>=a;a++)b[a]=0;for(a=21095;21097>=a;a++)b[a]=0;for(a=21148;21150>=a;a++)b[a]=0;for(a=21413;21423>=a;a++)b[a]=0;for(a=21473;21483>=a;a++)b[a]=
0;for(a=21780;21782>=a;a++)b[a]=0;for(a=21891;21894>=a;a++)b[a]=0;for(a=21896;21899>=a;a++)b[a]=0;for(a=22171;22177>=a;a++)b[a]=0;for(a=22181;22187>=a;a++)b[a]=0;for(a=22191;22197>=a;a++)b[a]=0;for(a=22234;22236>=a;a++)b[a]=0;for(a=22521;22525>=a;a++)b[a]=0;for(a=22991;22994>=a;a++)b[a]=0;for(a=23028;23038>=a;a++)b[a]=0;for(a=23830;23853>=a;a++)b[a]=0;for(a=23866;23872>=a;a++)b[a]=0;for(a=23877;23884>=a;a++)b[a]=0;for(a=23886;23894>=a;a++)b[a]=0;for(a=23946;23948>=a;a++)b[a]=0;for(a=24311;24313>=
a;a++)b[a]=0;for(a=24342;24347>=a;a++)b[a]=0;for(a=24370;24374>=a;a++)b[a]=10;for(a=24375;24381>=a;a++)b[a]=0;for(a=24718;24721>=a;a++)b[a]=0;for(a=24817;24821>=a;a++)b[a]=0;for(a=24877;24882>=a;a++)b[a]=0;for(a=24891;24893>=a;a++)b[a]=0;for(a=25391;25395>=a;a++)b[a]=0;for(a=25828;25838>=a;a++)b[a]=0;for(a=26191;26195>=a;a++)b[a]=0;for(a=26391;26393>=a;a++)b[a]=0;for(a=26701;26722>=a;a++)b[a]=0;for(a=26729;26799>=a;a++)b[a]=2;for(a=26801;26803>=a;a++)b[a]=2;for(a=26811;26813>=a;a++)b[a]=2;for(a=26847;26870>=
a;a++)b[a]=2;for(a=26891;26899>=a;a++)b[a]=0;for(a=26901;26923>=a;a++)b[a]=0;for(a=26929;26946>=a;a++)b[a]=0;for(a=26948;26998>=a;a++)b[a]=0;for(a=27037;27040>=a;a++)b[a]=0;for(a=27205;27232>=a;a++)b[a]=0;for(a=27258;27260>=a;a++)b[a]=0;for(a=27391;27398>=a;a++)b[a]=0;for(a=27561;27564>=a;a++)b[a]=0;for(a=27571;27574>=a;a++)b[a]=0;for(a=27581;27584>=a;a++)b[a]=0;for(a=27591;27594>=a;a++)b[a]=0;for(a=28191;28193>=a;a++)b[a]=0;for(a=28348;28358>=a;a++)b[a]=0;for(a=28402;28432>=a;a++)b[a]=0;for(a=28462;28492>=
a;a++)b[a]=0;for(a=29118;29122>=a;a++)b[a]=0;for(a=29168;29172>=a;a++)b[a]=0;for(a=29177;29185>=a;a++)b[a]=0;for(a=29187;29195>=a;a++)b[a]=0;for(a=29900;29903>=a;a++)b[a]=0;for(a=30161;30179>=a;a++)b[a]=0;for(a=30491;30494>=a;a++)b[a]=0;for(a=30729;30732>=a;a++)b[a]=0;for(a=31251;31259>=a;a++)b[a]=0;for(a=31265;31268>=a;a++)b[a]=0;for(a=31275;31279>=a;a++)b[a]=0;for(a=31281;31297>=a;a++)b[a]=0;for(a=31461;31469>=a;a++)b[a]=0;for(a=31491;31495>=a;a++)b[a]=0;for(a=31917;31922>=a;a++)b[a]=0;for(a=31965;32E3>=
a;a++)b[a]=0;for(a=32001;32003>=a;a++)b[a]=2;for(a=32005;32031>=a;a++)b[a]=2;for(a=32033;32060>=a;a++)b[a]=2;for(a=32064;32067>=a;a++)b[a]=2;for(a=32074;32077>=a;a++)b[a]=2;for(a=32081;32086>=a;a++)b[a]=0;for(a=32107;32130>=a;a++)b[a]=0;for(a=32133;32158>=a;a++)b[a]=0;for(a=32164;32167>=a;a++)b[a]=2;for(a=32180;32199>=a;a++)b[a]=0;for(a=32201;32260>=a;a++)b[a]=0;for(a=32301;32360>=a;a++)b[a]=0;for(a=32601;32662>=a;a++)b[a]=0;for(a=32664;32667>=a;a++)b[a]=2;for(a=32701;32761>=a;a++)b[a]=0;for(a=53001;53004>=
a;a++)b[a]=0;for(a=53008;53019>=a;a++)b[a]=0;for(a=53021;53032>=a;a++)b[a]=0;for(a=53034;53037>=a;a++)b[a]=0;for(a=53042;53046>=a;a++)b[a]=0;for(a=53074;53080>=a;a++)b[a]=0;for(a=54001;54004>=a;a++)b[a]=0;for(a=54008;54019>=a;a++)b[a]=0;for(a=54021;54032>=a;a++)b[a]=0;for(a=54034;54037>=a;a++)b[a]=0;for(a=54042;54046>=a;a++)b[a]=0;for(a=54048;54053>=a;a++)b[a]=0;for(a=54074;54080>=a;a++)b[a]=0;for(a=54098;54101>=a;a++)b[a]=0;for(a=102001;102040>=a;a++)b[a]=0;for(a=102042;102063>=a;a++)b[a]=0;for(a=
102065;102067>=a;a++)b[a]=0;for(a=102070;102117>=a;a++)b[a]=0;for(a=102122;102216>=a;a++)b[a]=0;for(a=102221;102377>=a;a++)b[a]=0;for(a=102382;102388>=a;a++)b[a]=0;for(a=102389;102398>=a;a++)b[a]=2;for(a=102399;102444>=a;a++)b[a]=0;for(a=102445;102447>=a;a++)b[a]=2;for(a=102448;102458>=a;a++)b[a]=0;for(a=102459;102468>=a;a++)b[a]=2;for(a=102469;102499>=a;a++)b[a]=0;for(a=102500;102519>=a;a++)b[a]=1;for(a=102520;102524>=a;a++)b[a]=0;for(a=102525;102529>=a;a++)b[a]=2;for(a=102530;102588>=a;a++)b[a]=
0;for(a=102590;102598>=a;a++)b[a]=0;for(a=102601;102603>=a;a++)b[a]=0;for(a=102605;102628>=a;a++)b[a]=0;for(a=102629;102646>=a;a++)b[a]=2;for(a=102648;102700>=a;a++)b[a]=2;for(a=102701;102703>=a;a++)b[a]=0;for(a=102707;102730>=a;a++)b[a]=2;for(a=102733;102758>=a;a++)b[a]=2;for(a=102767;102900>=a;a++)b[a]=0;for(a=102965;102969>=a;a++)b[a]=0;for(a=102971;102973>=a;a++)b[a]=0;for(a=102975;102989>=a;a++)b[a]=0;for(a=102990;102992>=a;a++)b[a]=1;for(a=102997;103002>=a;a++)b[a]=0;for(a=103003;103008>=a;a++)b[a]=
2;for(a=103009;103011>=a;a++)b[a]=0;for(a=103012;103014>=a;a++)b[a]=2;for(a=103019;103021>=a;a++)b[a]=0;for(a=103022;103024>=a;a++)b[a]=2;for(a=103029;103031>=a;a++)b[a]=0;for(a=103032;103034>=a;a++)b[a]=2;for(a=103065;103068>=a;a++)b[a]=0;for(a=103074;103076>=a;a++)b[a]=0;for(a=103077;103079>=a;a++)b[a]=1;for(a=103080;103082>=a;a++)b[a]=0;for(a=103083;103085>=a;a++)b[a]=2;for(a=103090;103093>=a;a++)b[a]=0;for(a=103097;103099>=a;a++)b[a]=0;for(a=103100;103102>=a;a++)b[a]=2;for(a=103107;103109>=a;a++)b[a]=
0;for(a=103110;103112>=a;a++)b[a]=2;for(a=103113;103116>=a;a++)b[a]=0;for(a=103117;103120>=a;a++)b[a]=2;for(a=103153;103157>=a;a++)b[a]=0;for(a=103158;103162>=a;a++)b[a]=2;for(a=103163;103165>=a;a++)b[a]=0;for(a=103166;103168>=a;a++)b[a]=1;for(a=103169;103171>=a;a++)b[a]=2;for(a=103186;103188>=a;a++)b[a]=0;for(a=103189;103191>=a;a++)b[a]=2;for(a=103192;103195>=a;a++)b[a]=0;for(a=103196;103199>=a;a++)b[a]=2;for(a=103200;103224>=a;a++)b[a]=0;for(a=103225;103227>=a;a++)b[a]=1;for(a=103232;103237>=a;a++)b[a]=
0;for(a=103238;103243>=a;a++)b[a]=2;for(a=103244;103246>=a;a++)b[a]=0;for(a=103247;103249>=a;a++)b[a]=2;for(a=103254;103256>=a;a++)b[a]=0;for(a=103257;103259>=a;a++)b[a]=2;for(a=103264;103266>=a;a++)b[a]=0;for(a=103267;103269>=a;a++)b[a]=2;for(a=103300;103375>=a;a++)b[a]=0;for(a=103381;103383>=a;a++)b[a]=0;for(a=103384;103386>=a;a++)b[a]=1;for(a=103387;103389>=a;a++)b[a]=0;for(a=103390;103392>=a;a++)b[a]=2;for(a=103397;103399>=a;a++)b[a]=0;for(a=103400;103471>=a;a++)b[a]=2;for(a=103476;103478>=a;a++)b[a]=
0;for(a=103479;103481>=a;a++)b[a]=2;for(a=103486;103488>=a;a++)b[a]=0;for(a=103489;103491>=a;a++)b[a]=2;for(a=103492;103495>=a;a++)b[a]=0;for(a=103496;103499>=a;a++)b[a]=2;for(a=103528;103543>=a;a++)b[a]=0;for(a=103544;103548>=a;a++)b[a]=2;for(a=103549;103551>=a;a++)b[a]=0;for(a=103552;103554>=a;a++)b[a]=1;for(a=103555;103557>=a;a++)b[a]=2;for(a=103558;103560>=a;a++)b[a]=0;for(a=103571;103573>=a;a++)b[a]=0;for(a=103574;103576>=a;a++)b[a]=2;for(a=103577;103580>=a;a++)b[a]=0;for(a=103581;103583>=a;a++)b[a]=
2;for(a=103595;103597>=a;a++)b[a]=0;for(a=103600;103694>=a;a++)b[a]=0;for(a=103696;103698>=a;a++)b[a]=0;for(a=103700;103793>=a;a++)b[a]=2;for(a=103794;103871>=a;a++)b[a]=0;for(a=103900;103971>=a;a++)b[a]=2;m("extend-esri")&&(h.WKIDUnitConversion=b);return b})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaderScripts"],function(m,h,a){m={shaderType:"fragment",getShader:function(a,d){var b;b=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(b,
d);a.compileShader(b);a.getShaderParameter(b,a.COMPILE_STATUS)||(b=null);return b}};h.mixin(m,a);return m})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(m,h,a,b,d,g,e){return m(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:1}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var b;b=this._glSetting;this.isBranch?(b.branchIndex=(b.branchIndex+1)%b.branchCount,b=b.branches[b.branchIndex]):(b.pingpongIndex=(b.pingpongIndex+1)%b.pingpong.length,b=b.pingpong[b.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,b.frameBuffer);a.activeTexture(a.TEXTURE0);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return b},_initializeProgram:function(a){if(this.gl)try{var c=
this.gl;c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);if(!this.rasterProgram){var e=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?d.mesh:d.basic,p=d.getShader(c,a.vertex||e),l=b.getShader(c,a.fragment);this.rasterProgram=this._loadProgram(p,l);this._uniforms=this._uniforms||{};this._uniforms.rasterProgram=g.getUniforms(c,this.rasterProgram)}c.useProgram(this.rasterProgram);var h=c.getAttribLocation(this.rasterProgram,"a_texCoord"),q=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,
q);var n=g.createMesh(this._xformSetting.meshSize||1);c.bufferData(c.ARRAY_BUFFER,n,c.STATIC_DRAW);c.enableVertexAttribArray(h);c.vertexAttribPointer(h,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo={fragment:a.fragmentName}}catch(t){console.error("webgl exception: "+t.message)}else console.error("WebGL is required.")},_setUniform:function(a,b,d){null!=
b&&(d&&!this._uniforms[d]&&(this._uniforms[d]=g.getUniforms(this.gl,this[d])),d=d?this._uniforms[d]:this._uniforms.rasterProgram,(a=d[a]||d[a+"[0]"])&&g.setUniform(this.gl,a,b))},_setUniforms:function(a,b){var c=Object.keys(a),f,d=c.length;for(f=0;f<d;f++)this._setUniform(c[f],a[c[f]],b);this.rawInput?this._setUniform("u_flipY",!0,b):this._setUniform("u_flipY",!1,b);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,c=this._xformSetting.scale):(a=[0,0],c=[1,1]),this._setUniform("u_xformOffset",
a,b),this._setUniform("u_xformScale",c,b),this._xformSetting.requireProjection&&(this.rawInput?(this._setUniform("u_projection",!0,b),this._setUniform("u_meshSize",[this._xformSetting.meshSize-1,this._xformSetting.meshSize-1],b),this._setUniform("u_xformGrid",this._xformSetting.xformGrid,b)):this._setUniform("u_projection",!1,b))):(a=[0,0],c=[1,1],this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",c,b))},_setupTextureData:function(a,b){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var c=b&&b.notOriginal,f=b&&b.bandIDs;b&&b.reCreate?b=!1:(b=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(b=f?this._originalBandIDs.join("")===f.join(""):!1);0<this._glSetting.branchCount&&(b=!1);if(b&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};b=this._createTexture();c||(this.originalTexture=b,this._originalBandIDs=f);var c=this.gl,d=a.pixelBlock,e=0;f&&0<f.length&&d&&(e=Math.max.apply(null,
f),d.pixels.length>e&&f&&(d.pixels=f.map(function(a){return d.pixels[a]}),d.statistics&&(d.statistics=f.map(function(a){return d.statistics[a]}))));f=d.width;e=d.height;c.getExtension("OES_texture_float");var g=d.getAsRGBAFloat();c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f,e,0,c.RGBA,c.FLOAT,g);return{extent:a.extent,texture:b}},_setupPingPongTextures:function(){var a=this._glSetting;if(!a||!a.pingpong){a.pingpong=[];var b=g.createBufferTexture(this.gl,!1);a.pingpong.push(b);b=g.createBufferTexture(this.gl,
!1);a.pingpong.push(b);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var b=0,d,e=a.branchCount;if(0<e){for(b=0;b<e;b++)d=g.createBufferTexture(this.gl,!1),a.branches.push(d);a.branchIndex=e-1}}},_setupXformTexture:function(a){var c=this._createTexture(!0),b=this.gl;a=a||new Float32Array(1600);b.getExtension("OES_texture_float");b.texImage2D(b.TEXTURE_2D,0,b.RGBA,20,20,0,b.RGBA,b.FLOAT,a);return c},_createTexture:function(a){return g.createTexture(this.gl,
a)},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);a=this._xformSetting.meshSize||1;c.drawArrays(c.TRIANGLES,0,a*a*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var b=a.getAttribLocation(this.meshProgram,
"a_texCoord"),d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);var d=this._xformSetting.meshSize||1,e=g.createMesh(d,!0);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.enableVertexAttribArray(b);a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,d*d*10)}},_setupMeshProgram:function(){var a=d.getShader(this.gl,d.mesh),f=b.getShader(this.gl,b.constant);return this._loadProgram(a,
f)},_loadProgram:function(a,b){return g.loadProgram(this.gl,a,b)},_getShaderScript:function(a,b){b=document.getElementById(b);if(!b)return null;a="";for(b=b.firstChild;b;)3==b.nodeType&&(a+=b.textContent),b=b.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(m,h,a){m={shaderType:"vertex",getShader:function(a,d){var b;b=a.createShader(a.VERTEX_SHADER);a.shaderSource(b,d);a.compileShader(b);
a.getShaderParameter(b,a.COMPILE_STATUS)||(b=null);return b}};h.mixin(m,a);return m})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",
histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_projection;\nuniform vec2 u_xformGrid[400];\nuniform vec2 u_meshSize;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nint getOffsetIndex(vec2 indexPos){\nint i \x3d int(indexPos.s*(u_meshSize.s+1.0)+indexPos.y+0.001);\nint maxIndex \x3d int((u_meshSize.s+1.0) * (u_meshSize.t+1.0) -1.0);\nreturn i\x3emaxIndex ? maxIndex:i;\n}\nvoid main() {\nif (u_projection) {\nvec2 index_ul \x3d floor(a_texCoord*u_meshSize);\nvec2 index_ur \x3d floor(a_texCoord*u_meshSize) + vec2(0.0, 1.0);\nvec2 index_ll \x3d floor(a_texCoord*u_meshSize) + vec2(1.0, 0.0);\nvec2 index_lr \x3d floor(a_texCoord*u_meshSize) + vec2(1.0, 1.0);\nvec2 weight \x3d fract(a_texCoord*u_meshSize);\nvec2 offset_ul \x3d u_xformGrid[getOffsetIndex(index_ul)];\nvec2 offset_ur \x3d u_xformGrid[getOffsetIndex(index_ur)];\nvec2 offset_ll \x3d u_xformGrid[getOffsetIndex(index_ll)];\nvec2 offset_lr \x3d u_xformGrid[getOffsetIndex(index_lr)];\nv_texCoord \x3d (offset_ul * (1.0 - weight) + offset_ur * vec2(1.0-weight.s,weight.t) + offset_ll * vec2(weight.s,1.0- weight.t) + offset_lr * weight)/2.0;\n}\nelse {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var m={getUniforms:function(h,a){var b=h.getProgramParameter(a,h.ACTIVE_UNIFORMS),d,g,e={};for(d=0;d<b;d++)(g=h.getActiveUniform(a,d))&&(e[g.name]={location:h.getUniformLocation(a,g.name),info:g});return e},setUniform:function(h,a,b){var d=a.info,g=a.location,e=d.type;if(null==b)console.log("uniform "+a.info.name+" has null or undefined value");else switch(e){case h.FLOAT:1<d.size?0===b.length?console.log("uniform "+a.info.name+
" has length 0"):h.uniform1fv(g,b):h.uniform1f(g,b);break;case h.FLOAT_VEC2:if(0===b.length){console.log("uniform "+a.info.name+" has length 0");break}h.uniform2fv(g,b);break;case h.FLOAT_VEC3:if(0===b.length){console.log("uniform "+a.info.name+" has length 0");break}h.uniform3fv(g,b);break;case h.FLOAT_VEC4:if(0===b.length){console.log("uniform "+a.info.name+" has length 0");break}h.uniform4fv(g,b);break;case h.INT:case h.BOOL:1<d.size?0===b.length?console.log("uniform "+a.info.name+" has length 0"):
h.uniform1iv(g,b):h.uniform1i(g,b);break;case h.INT_VEC2:case h.BOOL_VEC2:if(0===b.length){console.log("uniform "+a.info.name+" has length 0");break}h.uniform2iv(g,b);break;case h.INT_VEC3:case h.BOOL_VEC3:if(0===b.length){console.log("uniform "+a.info.name+" has length 0");break}h.uniform3iv(g,b);break;case h.INT_VEC4:case h.BOOL_VEC4:0===b.length?console.log("uniform "+a.info.name+" has length 0"):h.uniform4iv(g,b)}},createTexture:function(h,a){var b=h.createTexture();h.bindTexture(h.TEXTURE_2D,
b);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a?h.LINEAR:h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,a?h.LINEAR:h.NEAREST);return b},createBufferTexture:function(h,a,b){a=m.createTexture(h,a);h.getExtension("OES_texture_float");b=b||[h.drawingBufferWidth,h.drawingBufferHeight];h.texImage2D(h.TEXTURE_2D,0,h.RGBA,b[0],b[1],0,h.RGBA,h.FLOAT,null);b=h.createFramebuffer();
h.bindFramebuffer(h.FRAMEBUFFER,b);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0);return{texture:a,frameBuffer:b}},getShader:function(h,a,b){b=b?h.createShader(h.VERTEX_SHADER):h.createShader(h.FRAGMENT_SHADER);h.shaderSource(b,a);h.compileShader(b);h.getShaderParameter(b,h.COMPILE_STATUS)||(console.log(h.getShaderInfoLog(b)),b=null);return b},loadProgram:function(h,a,b){var d=h.createProgram();h.attachShader(d,a);h.attachShader(d,b);h.linkProgram(d);h.getProgramParameter(d,
h.LINK_STATUS)||(console.warn("failed to load webgl program: "+h.getProgramInfoLog(d)),h.deleteProgram(d),d=null);return d},createMesh:function(h,a){if(!h||1===h)return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var b;b=h&&a?new Float32Array(h*h*20):new Float32Array(h*h*12);var d=.9998/h,g,e,c,f,k=0;for(g=0;g<h;g++)for(e=0;e<h;e++)c=1E-4+d*g,f=1E-4+d*e,h&&!a?(b[k++]=c,b[k++]=f,b[k++]=c+d,b[k++]=f,b[k++]=c,b[k++]=f+d,b[k++]=c,b[k++]=f+d,b[k++]=c+d,b[k++]=f,b[k++]=c+d,b[k++]=f+d):(b[k++]=c,b[k++]=
f,b[k++]=c,b[k++]=f+d,b[k++]=c,b[k++]=f+d,b[k++]=c+d,b[k++]=f+d,b[k++]=c+d,b[k++]=f+d,b[k++]=c+d,b[k++]=f,b[k++]=c,b[k++]=f,b[k++]=c+d,b[k++]=f,b[k++]=c,b[k++]=f+d,b[k++]=c+d,b[k++]=f);return b}};return m})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var m={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,
-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,
4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(h){switch(h){case 0:return m.LineDetectionHorizontal;
case 1:return m.LineDetectionVertical;case 2:return m.LineDetectionLeftDiagonal;case 3:return m.LineDetectionRightDiagonal;case 4:return m.GradientNorth;case 5:return m.GradientWest;case 6:return m.GradientEast;case 7:return m.GradientSouth;case 8:return m.GradientNorthEast;case 9:return m.GradientNorthWest;case 10:return m.SmoothArithmeticMean;case 11:return m.Smoothing3x3;case 12:return m.Smoothing5x5;case 13:return m.Sharpening3x3;case 14:return m.Sharpening5x5;case 15:return m.Laplacian3x3;case 16:return m.Laplacian5x5;
case 17:return m.SobelHorizontal;case 18:return m.SobelVertical;case 19:return m.Sharpen;case 20:return m.Sharpen2;case 21:return m.PointSpread;default:return m.Default}}};return m})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(m){return{hillshade:function(h,a){if(null!==h&&null!==h.pixelBlock&&null!==h.pixelBlock.pixels){var b=this._clonePixelBlock(h.pixelBlock),d=a.altitude,g=a.azimuth,e=a.zFactor,c=a.psPower,f=a.psFactor,k=a.hillshadeType,p=a.slopeType,
l=a.isGCS;1===k&&(e*=2);a=b.width;var r=b.height,q=b.pixels[0],n=b.mask,t=new Uint8Array(a*r);n&&t.set(n);var m=new Uint8Array(a*r),u=(h.extent.xmax-h.extent.xmin)/a,v=(h.extent.ymax-h.extent.ymin)/r,x=e/(8*u),w=e/(8*v);.001<e&&l&&(x/=111E3,w/=111E3);3===p&&(l?(x=111E3*u,w=111E3*v,x=(e+Math.pow(x,c)*f)/(8*x),w=(e+Math.pow(w,c)*f)/(8*w)):(x=(e+Math.pow(u,c)*f)/(8*u),w=(e+Math.pow(v,c)*f)/(8*v)));var l=(90-d)*Math.PI/180,d=Math.cos(l),A=(360-g+90)*Math.PI/180,g=Math.sin(l)*Math.cos(A),l=Math.sin(l)*
Math.sin(A),D,y,z,C,E,F,G,H,e=[],c=[],f=[],N,u=[315,270,225,360,180,0];y=[60,60,60,60,60,90];var p=[3,5,3,2,1,4],J=p.reduce(function(a,c){return a+c}),v=p.map(function(a){return a/J});if(1===k)for(N=u.length,p=0;p<N;p++)d=y[p],g=u[p],l=(90-d)*Math.PI/180,d=Math.cos(l),A=(360-g+90)*Math.PI/180,g=Math.sin(l)*Math.cos(A),l=Math.sin(l)*Math.sin(A),e.push(d),c.push(g),f.push(l);F=0;for(p=1;p<r-1;p++)for(y=p*a,u=1;u<a-1;u++)if(n&&!n[y+u])m[y+u]=0;else{A=0;if(n&&(A=n[y-a+u-1]+n[y-a+u]+n[y-a+u+1]+n[y+u-1]+
n[y+u+1]+n[y+a+u-1]+n[y+a+u]+n[y+a+u+1],7>A)){m[y+u]=0;t[y+u]=0;continue}7===A?(D=n[y-a+u-1]?q[y-a+u-1]:q[y+u],z=n[y-a+u]?q[y-a+u]:q[y+u],C=n[y-a+u+1]?q[y-a+u+1]:q[y+u],A=n[y+u-1]?q[y+u-1]:q[y+u],E=n[y+u+1]?q[y+u+1]:q[y+u],F=n[y+a+u-1]?q[y+a+u-1]:q[y+u],G=n[y+a+u]?q[y+a+u]:q[y+u],H=n[y+a+u+1]?q[y+a+u+1]:q[y+u]):(D=q[y-a+u-1],z=q[y-a+u],C=q[y-a+u+1],A=q[y+u-1],E=q[y+u+1],F=q[y+a+u-1],G=q[y+a+u],H=q[y+a+u+1]);A=(C+E+E+H-(D+A+A+F))*x;z=(F+G+G+H-(D+z+z+C))*w;C=Math.sqrt(1+A*A+z*z);F=0;if(0===k)G=l*z-
g*A,G=255*(d+G)/C,0>G&&(G=0),F=G;else if(1===k)for(D=0;D<N;D++)G=f[D]*z-c[D]*A,G=255*(e[D]+G)/C,0>G&&(G=0),F+=G*v[D];m[y+u]=F}for(p=0;p<r;p++)m[p*a]=m[p*a+1],m[(p+1)*a-1]=m[(p+1)*a-2];for(p=1;p<a-1;p++)m[p]=m[p+a],m[p+(r-1)*a]=m[p+(r-2)*a];b.pixelType="U8";b.pixels=[m];b.statistics=[{minValue:0,maxValue:255}];n&&(b.mask=t);return{extent:h.extent,pixelBlock:b}}},slope:function(h,a){if(null!==h&&null!==h.pixelBlock&&null!==h.pixelBlock.pixels){var b=this._clonePixelBlock(h.pixelBlock),d=a.zFactor,g=
a.psPower,e=a.psFactor,c=a.slopeType,f=a.isGCS;a=b.width;var k=b.height,p=b.pixels[0],l=b.mask,r=new Uint8Array(a*k);l&&r.set(l);var q=new Float32Array(a*k),n=(h.extent.xmax-h.extent.xmin)/a,t=(h.extent.ymax-h.extent.ymin)/k,m=d/(8*n),u=d/(8*t);1E-4>Math.abs(d-1)&&f&&(m/=111E3,u/=111E3);3===c&&(f?(m=111E3*n,u=111E3*t,m=(d+Math.pow(m,g)*e)/(8*m),u=(d+Math.pow(u,g)*e)/(8*u)):(m=(d+Math.pow(n,g)*e)/(8*n),u=(d+Math.pow(t,g)*e)/(8*t)));for(var v,x,w,A,D,d=1;d<k-1;d++)for(e=d*a,g=1;g<a-1;g++)if(l&&!l[e+
g])q[e+g]=0;else{t=0;if(l&&(t=l[e-a+g-1]+l[e-a+g]+l[e-a+g+1]+l[e+g-1]+l[e+g+1]+l[e+a+g-1]+l[e+a+g]+l[e+a+g+1],7>t)){q[e+g]=0;r[e+g]=0;continue}7===t?(t=l[e-a+g-1]?p[e-a+g-1]:p[e+g],f=l[e-a+g]?p[e-a+g]:p[e+g],n=l[e-a+g+1]?p[e-a+g+1]:p[e+g],v=l[e+g-1]?p[e+g-1]:p[e+g],x=l[e+g+1]?p[e+g+1]:p[e+g],w=l[e+a+g-1]?p[e+a+g-1]:p[e+g],A=l[e+a+g]?p[e+a+g]:p[e+g],D=l[e+a+g+1]?p[e+a+g+1]:p[e+g]):(t=p[e-a+g-1],f=p[e-a+g],n=p[e-a+g+1],v=p[e+g-1],x=p[e+g+1],w=p[e+a+g-1],A=p[e+a+g],D=p[e+a+g+1]);v=(n+x+x+D-(t+v+v+w))*
m;t=(w+A+A+D-(t+f+f+n))*u;t=Math.sqrt(v*v+t*t);q[e+g]=1===c||3===c?57.2957795*Math.atan(t):100*t}for(d=0;d<k;d++)q[d*a]=q[d*a+1],q[(d+1)*a-1]=q[(d+1)*a-2];for(d=1;d<a-1;d++)q[d]=q[d+a],q[d+(k-1)*a]=q[d+(k-2)*a];b.pixelType="F32";b.pixels=[q];b.statistics=[{minValue:0,maxValue:255}];l&&(b.mask=r);return{extent:h.extent,pixelBlock:b}}},aspect:function(h){if(null!==h&&null!==h.pixelBlock&&null!==h.pixelBlock.pixels){var a=this._clonePixelBlock(h.pixelBlock),b=a.width,d=a.height,g=a.pixels[0],e=a.mask,
c=new Uint8Array(b*d);e&&c.set(e);var f=new Float32Array(b*d),k=1/((h.extent.xmax-h.extent.xmin)/b),p=1/((h.extent.ymax-h.extent.ymin)/d),l,r,q,n,t,m,u,v,x,w,A;for(l=1;l<d-1;l++)for(q=l*b,r=1;r<b-1;r++)if(e&&!e[q+r])f[q+r]=0;else{n=0;if(e&&(n=e[q-b+r-1]+e[q-b+r]+e[q-b+r+1]+e[q+r-1]+e[q+r+1]+e[q+b+r-1]+e[q+b+r]+e[q+b+r+1],7>n)){f[q+r]=0;c[q+r]=0;continue}7===n?(n=e[q-b+r-1]?g[q-b+r-1]:g[q+r],t=e[q-b+r]?g[q-b+r]:g[q+r],m=e[q-b+r+1]?g[q-b+r+1]:g[q+r],u=e[q+r-1]?g[q+r-1]:g[q+r],v=e[q+r+1]?g[q+r+1]:g[q+
r],x=e[q+b+r-1]?g[q+b+r-1]:g[q+r],w=e[q+b+r]?g[q+b+r]:g[q+r],A=e[q+b+r+1]?g[q+b+r+1]:g[q+r]):(n=g[q-b+r-1],t=g[q-b+r],m=g[q-b+r+1],u=g[q+r-1],v=g[q+r+1],x=g[q+b+r-1],w=g[q+b+r],A=g[q+b+r+1]);u=(m+v+v+A-(n+u+u+x))*k;n=(x+w+w+A-(n+t+t+m))*p;0===u&&0===n?n=-1:(n=90-57.29578*Math.atan2(n,-u),0>n&&(n+=360),360===n?n=0:360<n&&(n%=360));f[q+r]=n}for(l=0;l<d;l++)f[l*b]=f[l*b+1],f[(l+1)*b-1]=f[(l+1)*b-2];for(l=1;l<b-1;l++)f[l]=f[l+b],f[l+(d-1)*b]=f[l+(d-2)*b];a.pixelType="F32";a.pixels=[f];a.statistics={minValue:0,
maxValue:360};e&&(a.mask=c);return{extent:h.extent,pixelBlock:a}}},_clonePixelBlock:function(h){return h.clone?h.clone():m.clone(h)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(m,h,a,b,d,g,e){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=e.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:d.bandArithmetic,fragmentName:"bandArithmetic"});
var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(a){return parseInt(a,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var b=this.gl,e=this.bindFrameBuffer();b.bindTexture(b.TEXTURE_2D,a.texture);var b=this.functionArguments.method,
g=2<c.length?c.slice(2):null;this._alterBand?this._setUniforms({u_method:b,u_bandId_nir:0,u_bandId_red:1,u_constants:g}):this._setUniforms({u_method:b,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:g});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],function(m){return{calculate:function(h,a){if(h&&h.pixels&&h.pixels.length){var b=a&&a.bandIndexes;
a=a&&a.method;var d=b.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});h=this._clonePixelBlock(h);var g=h.pixels,e=h.mask;switch(a){case 1:g=this._calculateNDVI(e,g[d[0]-1],g[d[1]-1]);break;case 2:g=this._calculateSAVI(e,g[d[0]-1],g[d[1]-1],d[2]);break;case 3:g=this._calculateTSAVI(e,g[d[0]-1],g[d[1]-1],d[2],d[3],d[4]);break;case 4:g=this._calculateMSAVI(e,g[d[0]-1],g[d[1]-1]);break;case 5:g=this._calculateGEMI(e,g[d[0]-1],g[d[1]-1]);break;case 6:g=this._calculatePVI(e,
g[d[0]-1],g[d[1]-1],d[2],d[3]);break;case 7:g=this._calculateGVITM(e,g[d[0]-1],g[d[1]-1],g[d[2]-1],g[d[3]-1],g[d[4]-1],g[d[5]-1]);break;case 8:g=this._calculateSultan(e,g[d[0]-1],g[d[1]-1],g[d[2]-1],g[d[3]-1],g[d[4]-1],g[d[5]-1]);break;case 9:g=this._calculateVARI(e,g[d[0]-1],g[d[1]-1],g[d[2]-1]);break;case 0:g=this._calculateUserDefined(e,g,b)}h.pixels=g;h.pixelType="F32";h.calculateStatistics();return h}},_clonePixelBlock:function(h){return h.clone?h.clone():m.clone(h)},_parseUserDefined:function(h,
a){h=h.replace(" ","");0===h.indexOf("-")&&(h="0"+h);0===h.indexOf("+")&&(h=h.slice(1,h.length));h=h.split("");var b=[],d=[],g="+-*/()".split(""),e,c="",f;for(e=0;e<h.length;e++)f=h[e],g.some(function(a){return a===f})?(""!==c&&d.push(parseFloat(c)),b.push(f),c=""):"b"===f.toLowerCase()?(e++,c=f.concat(h[e]),d.push(a[parseInt(c[1],10)-1]),c=""):(c=c.concat(f),e===h.length-1&&d.push(parseFloat(c)));return{ops:b,nums:d}},_op:function(h,a,b,d){if(b.constructor===Number&&d.constructor===Number)return b+
d;var g,e,c;if(b.constructor===Number)for(g=d.length,e=b,b=new Float32Array(g),c=0;c<g;c++)b[c]=e;else if(g=b.length,d.constructor===Number)for(e=d,d=new Float32Array(g),c=0;c<g;c++)d[c]=e;e=new Float32Array(g);if(null==h)if("+"===a)for(c=0;c<g;c++)e[c]=b[c]+d[c];else if("-"===a)for(c=0;c<g;c++)e[c]=b[c]-d[c];else if("*"===a)for(c=0;c<g;c++)e[c]=b[c]*d[c];else{if("/"===a)for(c=0;c<g;c++)e[c]=b[c]/d[c]}else if("+"===a)for(c=0;c<g;c++)h[c]&&(e[c]=b[c]+d[c]);else if("-"===a)for(c=0;c<g;c++)h[c]&&(e[c]=
b[c]-d[c]);else if("*"===a)for(c=0;c<g;c++)h[c]&&(e[c]=b[c]*d[c]);else if("/"===a)for(c=0;c<g;c++)h[c]&&(e[c]=b[c]/d[c]);return e},_shrinkOp:function(h,a){h.splice(a,1);var b=a=0,d=0;do{for(a=d=b=0;a<h.length;a++)if("("===h[a])b=a;else if(")"===h[a]){d=a;break}d===b+1&&h.splice(b,2)}while(d===b+1);return h},_getPriorityOpIndex:function(h,a){if(1===h.length)return{opIndex:0,numIndex:0};var b=a=0,d=0,g=-1,e=0,c;for(a=0;a<h.length;a++)if("("===h[a])b=a;else if(")"===h[a]){d=a;break}c=0===d?h:h.slice(b+
1,d);for(a=0;a<c.length;a++)if("*"===c[a]||"/"===c[a]){g=a;break}if(!(-1<g))for(a=0;a<c.length;a++)if("+"===c[a]||"-"===c[a]){g=a;break}0<d&&(g+=b+1);for(a=0;a<g;a++)"("===h[a]&&e++;return{opIndex:g,numIndex:g-e}},_calculateUserDefined:function(h,a,b){a=this._parseUserDefined(b,a);b=a.ops;for(var d=a.nums,g,e,c;0<b.length&&(a=this._getPriorityOpIndex(b,d),g=b[a.opIndex],e=d[a.numIndex],c=d[a.numIndex+1],g=this._op(h,g,e,c),1!==b.length);)b=this._shrinkOp(b,a.opIndex),d.splice(a.numIndex,2,g);return[g]},
_calculateNDVI:function(h,a,b){var d=b.length,g=new Float32Array(d),e,c,f;if(null==h)for(e=0;e<d;e++)c=b[e],f=a[e],g[e]=(f-c)/(f+c);else for(e=0;e<d;e++)h[e]&&(c=b[e],f=a[e],g[e]=(f-c)/(f+c));return[g]},_calculateSAVI:function(h,a,b,d){var g=b.length,e=new Float32Array(g),c,f,k;if(null==h)for(c=0;c<g;c++)f=b[c],k=a[c],e[c]=(k-f)/(k+f+d)*(1+d);else for(c=0;c<g;c++)h[c]&&(f=b[c],k=a[c],e[c]=(k-f)/(k+f+d)*(1+d));return[e]},_calculateTSAVI:function(h,a,b,d,g,e){var c=b.length,f=new Float32Array(c),k,
p,l=-g*d+e*(1+d*d);if(null==h)for(e=0;e<c;e++)k=b[e],p=a[e],f[e]=d*(p-d*k-g)/(g*p+k+l);else for(e=0;e<c;e++)h[e]&&(k=b[e],p=a[e],f[e]=d*(p-d*k-g)/(g*p+k+l));return[f]},_calculateMSAVI:function(h,a,b){var d=b.length,g=new Float32Array(d),e,c,f;if(null==h)for(e=0;e<d;e++)c=b[e],f=a[e],g[e]=.5*(2*(f+1)-Math.sqrt(Math.pow(2*f+1,2)-8*(f-c)));else for(e=0;e<d;e++)h[e]&&(g[e]=.5*(2*(f+1)-Math.sqrt(Math.pow(2*f+1,2)-8*(f-c))));return[g]},_calculateGEMI:function(h,a,b){var d=b.length,g=new Float32Array(d),
e,c,f;if(null==h)for(e=0;e<d;e++)c=b[e],f=a[e],f=(2*(f*f-c*c)+1.5*f+.5*c)/(f+c+.5),g[e]=f*(1-.25*f)-(c-.125)/(1-c);else for(e=0;e<d;e++)h[e]&&(c=b[e],f=a[e],f=(2*(f*f-c*c)+1.5*f+.5*c)/(f+c+.5),g[e]=f*(1-.25*f)-(c-.125)/(1-c));return[g]},_calculatePVI:function(h,a,b,d,g){var e=b.length,c=new Float32Array(e),f,k,p,l=Math.sqrt(1+d*d);if(null==h)for(f=0;f<e;f++)k=b[f],p=a[f],c[f]=(p-d*k-g)/l;else for(f=0;f<e;f++)h[f]&&(k=b[f],p=a[f],c[f]=(p-d*k-g)/l);return[c]},_calculateGVITM:function(h,a,b,d,g,e,c){var f=
a.length,k=new Float32Array(f),p;if(null==h)for(p=0;p<f;p++)k[p]=-.2848*a[p]-.2435*b[p]-.5436*d[p]+.7243*g[p]+.084*e[p]-1.18*c[p];else for(p=0;p<f;p++)h[p]&&(k[p]=-.2848*a[p]-.2435*b[p]-.5436*d[p]+.7243*g[p]+.084*e[p]-1.18*c[p]);return[k]},_calculateSultan:function(h,a,b,d,g,e,c){b=a.length;var f=new Float32Array(b),k=new Float32Array(b),p=new Float32Array(b),l;if(null==h)for(l=0;l<b;l++)f[l]=e[l]/c[l]*100,k[l]=e[l]/a[l]*100,p[l]=d[l]/g[l]*(e[l]/g[l])*100;else for(l=0;l<b;l++)h[l]&&(f[l]=e[l]/c[l]*
100,k[l]=e[l]/a[l]*100,p[l]=d[l]/g[l]*(e[l]/g[l])*100);return[f,k,p]},_calculateVARI:function(h,a,b,d){var g=redBand.length,e=new Float32Array(g),c,f,k,p;if(null==h)for(c=0;c<g;c++)f=a[c],k=b[c],p=d[c],e[c]=(k-f)/(k+f-p);else for(c=0;c<g;c++)if(h[c])for(c=0;c<g;c++)f=a[c],k=b[c],p=d[c],e[c]=(k-f)/(k+f-p);return[e]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(m,h,a,b,d,g,e){return m([b,g],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;var c,b,d,e,g,h,n;if(a){if(a.features||a[0].attributes){a=a.features||a;c=Object.keys(a[0].attributes);d=c.filter(function(a){return"alpha"===
a.toLowerCase()})[0];b=c.filter(function(a){return"value"===a.toLowerCase()})[0];e=c.filter(function(a){return"red"===a.toLowerCase()})[0];g=c.filter(function(a){return"green"===a.toLowerCase()})[0];h=c.filter(function(a){return"blue"===a.toLowerCase()})[0];if(!(b&&e&&g&&h))throw"invalid colormap";a=a.map(function(a){return d?[a.attributes[b],a.attributes[e],a.attributes[g],a.attributes[h],a.attributes[d]]:[a.attributes[b],a.attributes[e],a.attributes[g],a.attributes[h]]});n=1.1>Math.max.apply(null,
a.map(function(a){return a[1]}));c=d&&1.1>Math.max.apply(null,a.map(function(a){return a[4]}));if(n)for(n=0;n<a.length;n++)a[n][1]=Math.round(255*a[n][1]),a[n][2]=Math.round(255*a[n][2]),a[n][3]=Math.round(255*a[n][3]),c&&(a[n][4]=Math.round(255*a[n][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=h.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histogram:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=e.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,b){for(var c=0,f=a.length-1,d=0,e=0;c<f;)if(d=Math.floor((c+f)/2),e=a[d],e[0]<b)c=d;else if(e[0]>b)f=d;else return e.slice(1);return null},_sortClr:function(a,b){var c,f,d=[];for(c=0;c<a.length;c++)d.push(a[c]);for(c=0;c<d.length-1;c++)for(f=d[c],a=c+1;a<d.length;a++)f[0]>d[a][0]&&(f=d[a],d[a]=d[c],
d[c]=f);if(b)for(c=0;c<d.length/2;c++)f=d[c],d[d.length-1-c]=d[c],d[c]=f;return d},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(a){return{fromColor:a.toColor,toColor:a.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var c=e.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
c&&c.alphaSpecified;this._indexedColormap=c&&c.indexedColormap;this._indexedColormapOffset=c&&c.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?a.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):a.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?a.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
a.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=a.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var b=0;0>a[0][0]&&(b=a[0][0]);var d=[],e=5===a[0].length,g;for(g=0;g<a.length;g++)d[a[g][0]-b]=e?a[g].slice(1):a[g].slice(1).concat([255]);return d},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:d.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,b=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var e=this._clrTexture,g=this.gl,h=this.bindFrameBuffer(),q=g.getUniformLocation(this.rasterProgram,"u_image"),n=g.getUniformLocation(this.rasterProgram,"u_image1");g.uniform1i(q,0);g.uniform1i(n,1);a=this._setupTextureData(a);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,a.texture);g.activeTexture(g.TEXTURE1);
g.bindTexture(g.TEXTURE_2D,e);this._setUniforms({u_indexedColormapOffset:b,u_indexedColormapMaxIndex:c.length/4-1});this._drawGL();return{extent:a.extent,texture:h.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),b=this.gl,d=a.length/4,e=new Float32Array(a.length),g,h=this.renderTexture?255:1;for(g=0;g<a.length;g++)e[g]=a[g]/h;b.getExtension("OES_texture_float");b.texImage2D(b.TEXTURE_2D,0,b.RGBA,d,1,0,b.RGBA,b.FLOAT,e);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../renderers/colorUtils"],function(m,h,a){return{createAlgorithmicColorRamp:function(b,d){if(!b)return null;var g=b.fromColor,e=b.toColor;if(!g||!e)return null;void 0===g.r&&3<=g.length&&(g={r:g[0],g:g[1],b:g[2]});void 0===e.r&&3<=e.length&&(e={r:e[0],g:e[1],b:e[2]});var c=b.size||256;b=b.algorithm||"cie-lab";var f;if(-1<b.toLowerCase().indexOf("hsv")){f=a.toHSV(g);var e=a.toHSV(e),c=c||256,k=0===f.s,h=0===e.s,g=f.h;b=e.h;k&&!h?g=f.h=b:h&&!k&&(b=e.h=g);k=Math.abs(b-g);180>k?b=(b-
g)/(c-1):(k=360-k,b=g>b?k/(c-1):-k/(c-1));var k=(e.s-f.s)/(c-1),h=(e.v-f.v)/(c-1),l=f.s;f=f.v;var r,q,n=new Uint8Array(4*c);for(r=0;r<c-1;r++)q=a.toRGB({h:g,s:l,v:f}),n[4*r]=q.r,n[4*r+1]=q.g,n[4*r+2]=q.b,n[4*r+3]=255,g+=b,l+=k,f+=h,360<g?g-=360:0>g&&(g+=360);q=a.toRGB(e);n[4*(c-1)]=q.r;n[4*(c-1)+1]=q.g;n[4*(c-1)+2]=q.b;n[4*(c-1)+3]=255;f=n}else if(-1<b.toLowerCase().indexOf("lch")){l=a.toLCH(g);e=a.toLCH(e);c=c||256;f=(e.l-l.l)/(c-1);g=(e.c-l.c)/(c-1);b=(e.h-l.h)/(c-1);k=l.l;h=l.c;l=l.h;n=new Uint8Array(4*
c);for(r=0;r<c-1;r++)q=a.toRGB({l:k,c:h,h:l}),n[4*r]=q.r,n[4*r+1]=q.g,n[4*r+2]=q.b,n[4*r+3]=255,k+=f,h+=g,l+=b;q=a.toRGB(e);n[4*(c-1)]=q.r;n[4*(c-1)+1]=q.g;n[4*(c-1)+2]=q.b;n[4*(c-1)+3]=255;f=n}else if(-1<b.toLowerCase().indexOf("lab")){l=a.toLAB(g);e=a.toLAB(e);c=c||256;f=(e.l-l.l)/(c-1);g=(e.a-l.a)/(c-1);b=(e.b-l.b)/(c-1);k=l.l;h=l.a;l=l.b;n=new Uint8Array(4*c);for(r=0;r<c-1;r++)q=a.toRGB({l:k,a:h,b:l}),n[4*r]=q.r,n[4*r+1]=q.g,n[4*r+2]=q.b,n[4*r+3]=255,k+=f,h+=g,l+=b;q=a.toRGB(e);n[4*(c-1)]=q.r;
n[4*(c-1)+1]=q.g;n[4*(c-1)+2]=q.b;n[4*(c-1)+3]=255;f=n}if(d&&!1===d.flattened)for(d=f,f=[],e=0;e<f/4;e++)f[e]=d.slice(4*e,4*e+4);return f},createMultiPartColorRamp:function(a,d){if(!a)return null;d=d&&h.clone(d)||{flattened:!0};var b=a.colorRamps;if(!b||0===b.length)return null;var e=a.size||256;a=Math.max(Math.floor(e/b.length),3);var c=Math.max(a,e-(b.length-1)*a),f=!1!==d.flattened;d.flattened=!0;for(var e=(b.length-1)*a+c,k,p=new Uint8Array(4*e),e=0;e<b.length;e++)k={fromColor:b[e].fromColor,
toColor:b[e].toColor,size:e===b.length-1?c:a},p instanceof Array?p.concat(this.createAlgorithmicColorRamp(k,d)):p.set(this.createAlgorithmicColorRamp(k,d),a*e*4);if(!f)for(d=p,p=[],e=0;e<p/4;e++)p[e]=d.slice(4*e,4*e+4);return p},createRandomColorRamp:function(a){a=a||{};var b=a.size||256,g=!1===a.flattened,e;e=g?new Uint8Array(4*b):[];for(a=0;a<b;a++)g?(e[4*a]=Math.round(255*Math.random()),e[4*a+1]=Math.round(255*Math.random()),e[4*a+2]=Math.round(255*Math.random()),e[4*a+3]=255):e[a]=[Math.round(255*
Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return e}}})},"esri/renderers/colorUtils":function(){define(["dojo/_base/Color","dojo/_base/array"],function(m,h){var a={COEF_RGB2XYZ:[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],COEF_XYZ2RGB:[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],matrixProduct:function(a,b){var d=[],c,f;if(a[0].length!==b.length)throw"dimensions do not match";var g=a.length,h=a[0].length,l=0;for(c=0;c<g;c++){for(f=
l=0;f<h;f++)l+=a[c][f]*b[f];d.push(l)}return d},rgb2xyz:function(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=this.matrixProduct(this.COEF_RGB2XYZ,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}},xyz2rgb:function(a){a=this.matrixProduct(this.COEF_XYZ2RGB,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*
a[2])}},xyz2lab:function(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}},lab2xyz:function(a){var b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}},lab2lch:function(a){var b=a.l,d=a.a,c=a.b;a=Math.sqrt(d*d+c*c);d=Math.atan2(c,d);d=0<
d?d:d+2*Math.PI;return{l:b,c:a,h:d}},lch2lab:function(a){var b=a.c,d=a.h;return{l:a.l,a:b*Math.cos(d),b:b*Math.sin(d)}},rgb2lab:function(a){return this.xyz2lab(this.rgb2xyz(a))},lab2rgb:function(a){return this.xyz2rgb(this.lab2xyz(a))},rgb2lch:function(a){return this.lab2lch(this.xyz2lab(this.rgb2xyz(a)))},lch2rgb:function(a){return this.xyz2rgb(this.lab2xyz(this.lch2lab(a)))}},b={rgb2hsv:function(a){var b=a.r,d=a.g;a=a.b;var c=Math.max(b,d,a),f=c-Math.min(b,d,a),k;0===f?k=0:c===b?k=(d-a)/f%6:c===
d?k=(a-b)/f+2:c===a&&(k=(b-d)/f+4);0>k&&(k+=6);return{h:60*k,s:100*(0===f?0:f/c),v:100/255*c}},hsv2rgb:function(a){var b=(a.h+360)%360/60,d=a.v/100*255;a=a.s/100*d;var c=a*(1-Math.abs(b%2-1));switch(Math.floor(b)){case 0:b={r:a,g:c,b:0};break;case 1:b={r:c,g:a,b:0};break;case 2:b={r:0,g:a,b:c};break;case 3:b={r:0,g:c,b:a};break;case 4:b={r:c,g:0,b:a};break;case 5:case 6:b={r:a,g:0,b:c};break;default:b={r:0,g:0,b:0}}b.r=Math.round(b.r+d-a);b.g=Math.round(b.g+d-a);b.b=Math.round(b.b+d-a);return b}};
return{toRGB:function(d){var g;void 0!==d.r&&void 0!==d.g&&void 0!==d.b?g=d:void 0!==d.l&&void 0!==d.c&&void 0!==d.h?g=a.lch2rgb(d):void 0!==d.l&&void 0!==d.a&&void 0!==d.b?g=a.lab2rgb(d):void 0!==d.x&&void 0!==d.y&&void 0!==d.z?g=a.xyz2rgb(d):void 0!==d.h&&void 0!==d.s&&void 0!==d.v&&(g=b.hsv2rgb(d));return g},toHSV:function(a){if(void 0!==a.h&&void 0!==a.s&&void 0!==a.v)return a;a=this.toRGB(a);return b.rgb2hsv(a)},toLAB:function(b){return void 0!==b.l&&void 0!==b.a&&void 0!==b.b?b:a.rgb2lab(this.toRGB(b))},
toLCH:function(b){return void 0!==b.l&&void 0!==b.c&&void 0!==b.h?b:a.rgb2lch(this.toRGB(b))},toXYZ:function(b){return void 0!==b.x&&void 0!==b.y&&void 0!==b.z?b:a.rgb2xyz(this.toRGB(b))},getDojoColor:function(a){if(a){if(Array.isArray(a))return m.fromArray(a);if(void 0!==a.r&&void 0!==a.g&&void 0!==a.b)return a}},correctRGBLimits:function(a){var b=[a.r,a.g,a.b];h.forEach(b,function(a,c){0>b[c]?b[c]=0:255<b[c]&&(b[c]=255);b[c]=Math.floor(b[c])});return{r:b[0],g:b[1],b:b[2],a:1}}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(m){return{mask:function(h,a){if(h&&h.pixels&&h.pixels.length){h=this._clonePixelBlock(h);var b=a.includedRanges,d=a.noDataInterpretation;a=a.noDataValues;if(null===b&&null===a)return h;var g=h.pixels,e=h.mask,c=h.width*h.height,f=g.length,k;if(null!==a&&a.length!==f)throw"expect "+f+" elements in noDataValues";if(null!==b&&b.length!==2*f)throw"expect "+2*f+" elements in IncludeRanges";var p,l,r,q,n;if(null==e){e=new Uint8Array(c);for(k=0;k<c;k++)e[k]=1;h.mask=e}if(0===d)for(d=0;d<f;d++)if(r=
g[d],p=null===b?null:b[2*d],l=null===b?null:b[2*d+1],q=null===a?null:parseFloat(a[d]),null===p||null===l)for(k=0;k<c;k++)e[k]&&(n=r[k],n===q&&(e[k]=0));else if(null===q)for(k=0;k<c;k++)e[k]&&(n=r[k],n<p||n>l)&&(e[k]=0);else for(k=0;k<c;k++)e[k]&&(n=r[k],n<p||n>l||n===q)&&(e[k]=0);else{var t=new Uint8Array(c);for(k=0;k<c;k++)t[k]=e[k];for(d=0;d<f;d++)if(r=g[d],p=null===b?null:b[2*d],l=null===b?null:b[2*d+1],q=null===a?null:parseFloat(a[d]),null===p||null===l)for(k=0;k<c;k++)t[k]&&(n=r[k],n!==q&&(t=
0));else if(null===q)for(k=0;k<c;k++)t[k]&&(n=r[k],n<=p&&n<=l&&(t=0));else for(k=0;k<c;k++)t[k]&&(n=r[k],n<=p&&n<=l&&n!==q&&(t=0));for(k=0;k<c;k++)e[k]&&t[k]&&(e[k]=0)}return h}},calculateStatisticsHistograms:function(h,a){h=this._clonePixelBlock(h);a=h.pixelType;var b=h.pixels,d=h.mask,g=b.length,e,c,f,k,p=[],l,r,q,n,t;for(f=0;f<g;f++){l={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};r=l.counts;n=b[f];if("U8"===a)if(d)for(k=0;k<h.width*h.height;k++)d[k]&&r[n[k]]++;else for(k=0;k<h.width*
h.height;k++)r[n[k]]++;else{e=h.statistics[f].minValue;c=h.statistics[f].maxValue;l.min=e;l.max=c;c=(c-e)/256;q=new Uint32Array(257);if(d)for(k=0;k<h.width*h.height;k++)d[k]&&q[Math.floor((n[k]-e)/c)]++;else for(k=0;k<h.width*h.height;k++)q[Math.floor((n[k]-e)/c)]++;for(k=0;255>k;k++)r[k]=q[k];r[255]=q[255]+q[256]}p.push(l);e=h.statistics[f].minValue;c=h.statistics[f].maxValue;for(k=q=t=n=0;k<l.size;k++)n+=r[k],t+=k*r[k];t/=n;for(k=0;k<l.size;k++)q+=r[k]*Math.pow(k-t,2);r=Math.sqrt(q/(n-1));k=(t+
.5)*(l.max-l.min)/l.size+l.min;l=r*(l.max-l.min)/l.size;h.statistics[f]={min:e,minValue:e,max:c,maxValue:c,mean:k,stddev:l}}h.histograms=p;return h},buildIndexedColormap:function(h,a){if(!h)return null;var b=0;0>h[0][0]&&(b=h[0][0]);var d=Math.max(256,h[h.length-1][0]-b);if(65536<d)return null;var g=new Uint8Array(4*d),e=[],c=0,f=5===h[0].length;if(a)for(e=h[c],a=e[0]-b;a<d;a++)g[4*a]=e[1],g[4*a+1]=e[2],g[4*a+2]=e[3],g[4*a+3]=f?e[4]:255,a===e[0]-b&&(e=c===h.length-1?e:h[++c]);else for(a=0;a<h.length;a++)e=
h[a],c=4*(e[0]-b),g[c]=e[1],g[c+1]=e[2],g[c+2]=e[3],g[c+3]=f?e[4]:255;return{indexedColormap:g,offset:b,alphaSpecified:f}},colorize:function(h,a){if(null!==h&&null!==h.pixels){h=this._clonePixelBlock(h);var b=h.pixels,d=h.width*h.height,g=h.mask,e=a.indexedColormap,c=a.indexedColormapOffset,f=e&&e.length-1,k=a.indexed2DColormap;a=a.alphaSpecified;if(3<=b.length)throw"colormap only works on single band image";var p=b[0],l=new Uint8Array(p.length),r=new Uint8Array(p.length),q=new Uint8Array(p.length),
n=0;if(e)if(g)for(b=0;b<d;b++)g[b]&&(n=4*(p[b]-c),n<c||n>f?g[b]=0:(l[b]=e[n],r[b]=e[n+1],q[b]=e[n+2],g[b]=e[n+3]));else{g=new Uint8Array(d);for(b=0;b<d;b++)n=4*(p[b]-c),n<c||n>f?g[b]=0:(l[b]=e[n],r[b]=e[n+1],q[b]=e[n+2],g[b]=e[n+3]);h.mask=g}else if(g)for(b=0;b<d;b++)g[b]&&(e=k[p[b]],l[b]=e[0],r[b]=e[1],q[b]=e[2],g[b]=e[3]);else{g=new Uint8Array(d);for(b=0;b<d;b++)e=k[p[b]],l[b]=e[0],r[b]=e[1],q[b]=e[2],g[b]=e[3];h.mask=g}h.pixels=[l,r,q];h.statistics=null;h.pixelType="U8";h.maskIsAlpha=a;return h}},
convolute:function(h,a){h=this._clonePixelBlock(h);var b=h.pixels,d=h.width,g=h.height,e=d*g,c=b.length,f,k,p,l,r,q,n=[],t=[],m=a.normalizedKernel,u=a.kernelRows,v=a.kernelCols,x;for(a=0;a<c;a++){p=b[a];l=new Float32Array(e);l.set(p);for(r=1;r<g-1;r++)for(x=r*d,q=1;q<d-1;q++){for(f=t=0;f<u;f++)for(k=0;k<v;k++)t+=p[x+q+(f-1)*d+k-1]*m[f*v+k];l[x+q]=t}n.push(l)}h.pixels=n;return h},contrastBrightnessStretch:function(h,a){if(null!==h&&null!==h.pixels){h=this._clonePixelBlock(h);var b=h.pixels,d=h.mask,
g=h.width*h.height,e=b.length,c;c=a&&a.contrastOffset;a=a&&a.brightnessOffset;if("U8"!==h.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var f=this._createContrastBrightnessLUT(c,a);if(null==d)for(c=0;c<g;c++)for(a=0;a<e;a++)b[a][c]=f[b[a][c]];else for(c=0;c<g;c++)if(d[c])for(a=0;a<e;a++)b[a][c]=f[b[a][c]];h.pixelType="U8";return h}},isNull:function(h,a){if(null!==h&&null!==h.pixels){h=this._clonePixelBlock(h);a=h.mask;var b=h.pixels[0],d=b.length,
g;if(a){for(g=0;g<d;g++)b[g]=a[g]?0:1;h.mask=null}else if(b.fill)b.fill(0);else for(g=0;g<d;g++)b[g]=0;return h}},setNull:function(h){if(null!==a&&null!==a.pixels){var a=this._clonePixelBlock(h);h=a.mask;var b=a.pixels[0],d=b.length,g;h=h||new Uint8Array(d);for(g=0;g<d;g++)h[g]=b[g]?0:1;a.mask=h;return a}},local:function(h,a){if(!a)return h[0];var b=a.rasterCountNeeded;a=a.functor;var d=this._clonePixelBlock(h[0]);if(null!==d&&null!==d.pixels){var g=d.width*d.height,e;h=(e=h[1])&&e.pixels[0];var c=
e&&e.mask,f=d.mask,k=d.pixels[0];if(2===b)if(!f&&c)f=c;else if(f&&c)for(e=0;e<g;e++)f[e]=f[e]&&c[e]?1:0;d.mask=f;if(1===b)if(null==f)for(e=0;e<g;e++)k[e]=a(k[e]);else for(e=0;e<g;e++)f[e]&&(k[e]=a(k[e]));else if(2===b)if(null==f)for(e=0;e<g;e++)k[e]=a(k[e],h[e]);else for(e=0;e<g;e++)f[e]&&(k[e]=a(k[e],h[e]));d.mask=f;d.calculateStatistics();return d}},_clonePixelBlock:function(h){return h.clone?h.clone():m.clone(h)},_createContrastBrightnessLUT:function(h,a){if(this._contrastCache&&this._contrastCache.contrastOffset===
h&&this._contrastCache.brightnessOffset===a)return this._contrastCache.lut;var b=Math.min(Math.max(h,-100),100),d=Math.min(Math.max(a,-100),100),g,e,c=new Uint8Array(256);for(g=0;256>g;g++)0<b&&100>b?e=(200*g-25500+510*d)/(2*(100-b))+128:0>=b&&-100<b?e=(200*g-25500+510*d)*(100+b)/2E4+128:100===b?(e=200*g-25500+256*(100-b)+510*d,e=0<e?255:0):-100===b&&(e=128),c[g]=255<e?255:0>e?0:e;this._contrastCache={contrastOffset:h,brightnessOffset:a,lut:c};return c}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(m,h,a,b,d,g){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.rasters)return Error("The rasters input to composite band function is invalid.");var c=[],b=[],d=a.rasters.length,e;if(a.rasters[0].statistics)for(e=0;e<d;e++)c.push(a.rasters[e].statistics[0]);if(a.rasters[0].histograms)for(e=
0;e<d;e++)b.push(a.rasters[e].histograms[0]);this.rasterInfo=h.mixin(a.rasters[0],{bandCount:d,pixelType:this._calculatePixelType(this.pixelType,a.rasters[0].pixelType),statistics:c,histograms:b});return!0},read2D:function(a){a=a.rasters;if(null!=a&&0!==a.length){for(var c=this._clonePixelData(a[0]),b=c.pixelBlock,d=[],e=[],g=0;g<a.length;g++)d.push(a[g].pixelBlock.pixels[0]),e.push(a[g].pixelBlock.statistics[0]);b.pixels=d;b.stackedStatistics=e;b.planes=a.length;var h,g,e=b.width*b.height;for(g=
0;g<a.length;g++)if(b=a[g].pixelBlock.mask,h&&b)for(d=0;d<e;d++)h[d]&=b[d];else h=h||b;c.maks=h;return c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:d.compositeBand,fragmentName:"CompositeBand"});var c=a.rasters;if(null!=c&&0!==c.length){var c=c.length,b=this.gl,e,g,h,r=this.bindFrameBuffer();for(e=0;e<c;e++)g=this._setupTextureData(a.rasters[e],{notOriginal:0<e}),h=0<e?e.toString():"",h=b.getUniformLocation(this.rasterProgram,"u_image"+h),b.uniform1i(h,e),b.activeTexture(b.TEXTURE0+
e),b.bindTexture(b.TEXTURE_2D,g.texture);this._setUniforms({u_rasterCount:c});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:g.extent,texture:r.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(m,h,a,b,d,g,e){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",
renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=e.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(h.hitch(this,function(a){return this._clampBand(a,
c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:d.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);var c=this.gl,b=this.bindFrameBuffer();c.bindTexture(c.TEXTURE_2D,a.texture);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(m,h,a,b,d,g,e,c){return m([a,e],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",
functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=this._analyzeKernel(),f=c.convolute(a.pixelBlock,{normalizedKernel:b.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(f.pixelType=this.pixelType);f.pixels=f.pixels.map(h.hitch(this,
function(a){return this._clampBand(a,f.pixelType)}));return{extent:a.extent,pixelBlock:f}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:g.convolution,fragmentName:"Convolution"});var c=this.gl;a=this._setupTextureData(a.raster);var b=this.bindFrameBuffer();c.bindTexture(c.TEXTURE_2D,a.texture);var f=this.functionArguments.kernel;this._setUniforms({u_resolution:[1/c.drawingBufferWidth,1/c.drawingBufferHeight],u_kernel:f,u_kernelSize:f.length});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,texture:b.texture}},_analyzeKernel:function(){var a=this.functionArguments.kernel,c=a.reduce(function(a,c){return a+c});0!==c&&1!==c&&(a=a.map(function(a){return a/c}));var b,d=[];for(b=0;b<a.length;b++)d.some(function(c){return c===a[b]})||d.push(a[b]);return{normalizedKernel:a,distinctValues:d}},_analyzeKernelPattern:function(){var a=this.functionArguments.rows,c=this.functionArguments.columns,b=this.functionArguments.kernel,d=[],e,g;for(e=0;e<a;e++)d.push({weights:b.slice(e*
c,(e+1)*c)});var h,t,m;for(e=1;e<a;e++)for(t=d[e].weights,b=0;b<e;b++)if(h=d[b].weights){m=t[0]/h[0];for(g=1;g<c;g++)t[g]/h[g]!==m&&(m=null);null!==m&&(d[e]={row:b,factor:m})}return d}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(m,h,a,b,d,g){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to extract band function is invalid.");var c=[],b=a.raster.statistics,d=[],e=a.raster.histograms,g=this.functionArguments.bandIDs.length||a.raster.bandCount;this.functionArguments.bandIDs.forEach(h.hitch(this,function(a){if(a>=g-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+
a);a=g-1}if(0>a)return Error("missing band "+a);void 0!==b&&null!==b&&0<b.length&&c.push(b[a]);void 0!==e&&null!==e&&0<e.length&&d.push(e[a])}));this.rasterInfo=h.mixin(a.raster,{bandCount:g,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:c,histograms:d});return!0},read2D:function(a){a=this._clonePixelData(a.raster);if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){this._performance.start();var c=a.pixelBlock,b=c.statistics,d=c.pixels,e=d.length;if(null==
this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return a;var g=[],h=[];this.functionArguments.bandIDs.forEach(function(a){if(a>=e-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+a;a=e-1}if(0>a)throw"missing band "+a;g.push(d[a]);void 0!==b&&null!==b&&0<b.length&&h.push(b[a])});c.pixels=g;c.statistics=h;c.planes=this.functionArguments.bandIDs.length;return a}},readGL:function(a){this._performance.start();if(null==
this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:d.extractBand,fragmentName:"ExtractBand"});var c=this.functionArguments.bandIDs;1===c.length&&(c=[c[0],c[0],c[0]]);this._bandIDs=c;this._alterBand=!(0===this.functionArguments.bandIDs.length||0===c[0]&&1===c[1]&&2===c[2]);var b=!!(this._alterBand&&a.raster&&a.raster.texture);a=this._setupTextureData(a.raster,
{bandIDs:c});var e=this.gl,g=this.bindFrameBuffer();e.bindTexture(e.TEXTURE_2D,a.texture);b?this._setUniforms({u_bandIDs:c,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:c,u_alterBand:!1});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(m,h,a,b,d,g,e,c){return m([a,e],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},a);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var c=this._weights.reduce(function(a,c){return a+
c});this._weights=this._weights.map(function(a){return a/c})},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to hillshade function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histogram:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();
a=a.raster;a=c.hillshade(a,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:a.extent.spatialReference.wkid&&null==b[a.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());return a},readGL:function(a){this._performance.start();
this._initializeProgram({fragment:g.hillshade,fragmentName:"Hillshade"});a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),f=this.gl;f.bindTexture(f.TEXTURE_2D,a.texture);var d=f.drawingBufferWidth,f=f.drawingBufferHeight,e=a.extent,h=(e.xmax-e.xmin)/d,n=(e.ymax-e.ymin)/f,t=this.functionArguments.altitude,m=this.functionArguments.azimuth,u=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(u*=2);var v=u/(8*h),x=u/(8*n);.001<u&&e.spatialReference.wkid&&null==b[e.spatialReference.wkid]&&
(v/=111E3,x/=111E3);var w=this.functionArguments.psPower,A=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((v=e.spatialReference.wkid&&null==b[e.spatialReference.wkid])?(v=111E3*h,x=111E3*n,v=(u+Math.pow(v,w)*A)/(8*v),x=(u+Math.pow(x,w)*A)/(8*x)):(v=(u+Math.pow(h,w)*A)/(8*h),x=(u+Math.pow(n,w)*A)/(8*n)));var D=(90-t)*Math.PI/180,t=Math.cos(D),y=(360-m+90)*Math.PI/180,m=Math.sin(D)*Math.cos(y),D=Math.sin(D)*Math.sin(y),w=Array(6),A=Array(6),e=Array(6),z,C=this._weights,E;if(1===
this.functionArguments.hillshadeType)for(z=this._azimuths.length,E=0;E<z;E++)t=this._altitudes[E],m=this._azimuths[E],D=(90-t)*Math.PI/180,t=Math.cos(D),y=(360-m+90)*Math.PI/180,m=Math.sin(D)*Math.cos(y),D=Math.sin(D)*Math.sin(y),w[E]=t,A[E]=m,e[E]=D;else w[0]=t,A[0]=m,e[0]=D;w=w.map(function(a){return parseFloat(a)});A=A.map(function(a){return parseFloat(a)});e=e.map(function(a){return parseFloat(a)});this._setUniforms({u_cellSize:[h,n],u_zfactor:u,u_xFactor:v,u_yFactor:x,u_sinZcosA:m,u_sinZsinA:D,
u_cosZ:t,u_sinZcosAs:A,u_sinZsinAs:e,u_cosZs:w,u_weights:C,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:[1/d,1/f],u_scaled:!this.renderTexture});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(m,h,
a,b,d,g,e){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(a){return a.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");
a=a.raster||a.rasters.filter(function(a){return!!a.extent})[0];this.rasterInfo=h.mixin(a,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[],c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(a){return a.pixelBlock});var b=this.functionArguments.operation;if(null===b)return c[0];
this._performance.start();var d=this._getOperations(),g=d.operators[b-1],d=d.functors[b-1];if(!this.functionArguments.rasters){if(1!==g)throw"no sufficient rasters, require "+g;}else if(999!==g&&this.functionArguments.rasters.length!==g)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+g;var r;r=31===b?e.isNull(a[0]):50===b?e.setNull(a[0]):e.local(a,{rasterCountNeeded:g,functor:d});"Unknown"!==this.pixelType&&(r.pixelType=this.pixelType,r.pixels=r.pixels.map(h.hitch(this,
function(a){return this._clampBand(a,r.pixelType)})));r.statistics||r.calculateStatistics();return{extent:c[0].extent,pixelBlock:r}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,b=this._getWebGLOperations(),e=b.operators[c-1],g=d.local,b="result\x3d"+b.functors[c-1]+";";31!==c&&50!==c&&(b+="result \x3d vec4(result.rgb, a.a);");var g=g.replace("vec4 replaceme"+e+";",b),b=this.gl.getParameter(this.gl.VERSION),h="";if(-1<b.toLowerCase().indexOf("webgl 1.0")||-1<
b.toLowerCase().indexOf("webgl 0."))h=this._getPolyfill(c);g=g.replace("vec4 polyfill;",h);1<e&&(g=g.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",e.toString())));this._initializeProgram({fragment:g,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){for(var c=c.length,e=this.gl,q,b=this.bindFrameBuffer(),g=0;g<c;g++)q=0<g?g.toString():"",q=e.getUniformLocation(this.rasterProgram,"u_image"+q),e.uniform1i(q,g),e.activeTexture(e.TEXTURE0+g),q=this._setupTextureData(a.rasters[g],
{reCreate:!0}),e.bindTexture(e.TEXTURE_2D,q.texture);this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:q.extent,texture:b.texture}}},_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,b){return a+b},function(a,b){return a-b},function(a,b){return a*
b},function(a){return Math.sqrt(a)},function(a,b){return Math.pow(a,b)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},function(a){return Math.abs(a)},function(a,b){return a&b},function(a,b){return a<<b},function(a){return~a},function(a,b){return a|b},function(a,b){return a>>b},function(a,b){return a^b},function(a,b){return a&&b},function(a){return!a},function(a,b){return a||b},function(a,b){return a!=b},function(a){return Math.cos(a)},
function(a,b){return Math.cosh(a)},function(a,b){return a/b},function(a,b){return a==b},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,a)},function(a,b){return a>b?1:0},function(a,b){return a>=b?1:0},function(a,b){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,b){return a<b?1:0},function(a,b){return a<=b?1:0},function(a){return Math.log(a)},function(a,b){return Math.log10(a)},function(a,b){return Math.log2(a)},999,999,
999,999,999,999,function(a,b){return a%b},function(a){return-a},function(a,b){return a!=b?1:0},999,function(a,b){return Math.floor(a)},function(a,b){return Math.ceil(a)},function(a,b){return b?0:a},function(a,b){return Math.sin(a)},function(a,b){return Math.sinh(a)},function(a,b){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,b){return Math.atan2(a,b)},function(a,b){return a/b},
function(a,b){return Math.floor(a/b)},999,999,999,999,999,999,999,999,999,999,function(a,b,d){return a?b:d}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",
tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c="";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,
2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)","(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)",
"(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(m,h,a,b,d,g,e){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,
a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});return!0},read2D:function(a){this._performance.start();a=a.raster;var c=e.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();
this._initializeProgram({fragment:d.mask,fragmentName:"Mask"});a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),b=this.gl;b.bindTexture(b.TEXTURE_2D,a.texture);var b=this.functionArguments.includedRanges,e=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(a){return parseFloat(a,10)}):null;this._setUniforms({u_includedRanges:b,u_includedRanges_specified:b?!0:!1,u_noDataValues:e,u_noDataValues_specified:e?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,
u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(m,h,a,b,d,g,e){return m([a,g],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=h.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,
max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=e.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),b,d,g,h,q;if(this.functionArguments.scaled){b=c.pixels[0];g=c.mask;h=b.length;d=new Uint8Array(h);if(null==g)for(q=0;q<h;q++)d[q]=100*b[q]+100&255;else for(q=
0;q<h;q++)g[q]&&(d[q]=100*b[q]+100&255);c.pixels[0]=d;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:d.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,b=this.functionArguments.infraredBandID,e=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(b,c)?!0:!1;a=this._setupTextureData(a.raster,
{bandIDs:this._alterBand?{bandIDs:[b,c,b]}:null});var g=this.gl,h=this.bindFrameBuffer();g.bindTexture(g.TEXTURE_2D,a.texture);this._alterBand?this._setUniforms({u_bandId_nir:0,u_bandId_red:1,u_scaled:e}):this._setUniforms({u_bandId_nir:b,u_bandId_red:c,u_scaled:e});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(m,h,a,b,d,g,e,c){return m([a,e],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,
"F32"),statistics:1===this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histogram:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;a=c.slope(a,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:a.extent.spatialReference.wkid&&null==b[a.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return a},readGL:function(a){this._performance.start();this._initializeProgram({fragment:g.slope,fragmentName:"Slope"});a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),b=this.gl;b.bindTexture(b.TEXTURE_2D,a.texture);var f=b.drawingBufferWidth,b=b.drawingBufferHeight,d=a.extent;this._setUniforms({u_resolution:[1/f,1/b],u_cellSize:[(d.xmax-d.xmin)/f,(d.ymax-d.ymin)/b],u_zfactor:this.functionArguments.zFactor});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(m,h,a,b,d,g,e){return m([a,e],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,
numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?
255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");this.rasterInfo=h.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=
a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(a){return a&&null!=a.min?[a.min,a.max,a.mean,a.stddev]:a}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments;if(!(a&&a.pixelBlock&&a.pixelBlock.pixels))this._statistics=c.statistics,this._histograms=c.histograms,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics);else if(0!==c.stretchType){var b=
a.pixelBlock,d=b.pixels.length,e=6===c.stretchType&&(c.dra||!c.histograms)||3===c.stretchType&&c.dra;e&&(b.statistics||b.calculateStatistics(),this._calculateStatisticsHistograms(a));if(c.dra)if(b.statistics||b.calculateStatistics(),e)this._statistics=b.statistics,this._histograms=b.histograms;else for(c=b.statistics,this._statistics=[],a=0;a<d;a++)this._statistics[a]=[c[a].minValue,c[a].maxValue,0,0];else this._statistics=c.statistics,this._histograms=c.histograms;this._statistics=this._convertStats(this._statistics);
this._gammaCorrection=this._getGammaCorrection()}},_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var b=[],d;for(d=0;d<a.length;d++)b[d]=1<a[d]?2<a[d]?6.5+Math.pow(a[d]-2,2.5):6.5+100*Math.pow(2-a[d],4):1;return b}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,b=c.pixels,c=c.width*c.height,d=b.length,e,g;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);
var h=this.LUT,n=this.LUTOffset,t,m;for(e=0;e<d;e++)for(m=h[e],g=0;g<c;g++)t=b[e][g],b[e][g]=m[t-n];a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){var c=this.functionArguments;a=a.pixelBlock;var b=a.pixelType,d=a.pixels,e=a.mask,g=d.length,q,n,t,m,u=function(a){c.min=-.5;c.max=255.5;this.size=256;h.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},v=[],x,w,A,D,y,z;for(t=0;t<g;t++){x=new u;w=x.counts;D=d[t];if("U8"===b)if(e)for(m=0;m<a.width*a.height;m++)e[m]&&
w[D[m]]++;else for(m=0;m<a.width*a.height;m++)w[D[m]]++;else{q=a.statistics[t].minValue;n=a.statistics[t].maxValue;x.min=q;x.max=n;n=(n-q)/256;A=new Uint32Array(257);if(e)for(m=0;m<a.width*a.height;m++)e[m]&&A[Math.floor((D[m]-q)/n)]++;else for(m=0;m<a.width*a.height;m++)A[Math.floor((D[m]-q)/n)]++;for(m=0;255>m;m++)w[m]=A[m];w[255]=A[255]+A[256]}v.push(x);D=[];q=a.statistics[t].minValue;n=a.statistics[t].maxValue;for(m=z=y=A=0;m<x.size;m++)A+=w[m],y+=m*w[m];y/=A;for(m=0;m<x.size;m++)z+=w[m]*Math.pow(m-
y,2);w=Math.sqrt(z/(A-1));m=(y+.5)*(x.max-x.min)/x.size+x.min;x=w*(x.max-x.min)/x.size;D.push(q);D.push(n);D.push(m);D.push(x);a.statistics[t]={min:q,minValue:q,max:n,maxValue:n,mean:m,stddev:x}}a.histograms=v},_getCutOffPoints:function(a){var c=this.functionArguments,b=999;a&&a.pixelBlock?b=a.pixelBlock.pixels.length:a&&a.texture&&(b=3);a=Math.min(b,this._statistics.length);var d=[],e=[],g,h,n,t,m,u;switch(c.stretchType){case 5:for(m=0;m<a;m++)d[m]=this._statistics[m][0],e[m]=this._statistics[m][1];
break;case 3:for(m=0;m<a;m++)d[m]=this._statistics[m][2]-c.numberOfStandardDeviations*this._statistics[m][3],e[m]=this._statistics[m][2]+c.numberOfStandardDeviations*this._statistics[m][3],d[m]<this._statistics[m][0]&&(d[m]=this._statistics[m][0]),e[m]>this._statistics[m][1]&&(e[m]=this._statistics[m][1]);break;case 6:for(m=0;m<a;m++){b=this._histograms[m];n=new Uint32Array(b.size);h=b.counts;g=0;t=-.5===b.min&&1===(b.max-b.min)/h?.5:0;for(u=0;u<b.size;u++)g+=h[u],n[u]=g;h=c.minPercent*g/100;for(u=
0;u<b.size;u++)if(n[u]>h){d[m]=b.min+(b.max-b.min)/b.size*(u+t);break}h=(1-c.maxPercent/100)*g;for(u=b.size-2;0<=u;u--)if(n[u]<h){e[m]=b.min+(b.max-b.min)/b.size*(u+2-t);break}}break;default:for(m=0;m<b;m++)d[m]=0,e[m]=255}return{minCutOff:d,maxCutOff:e}},_createLUT:function(a){var c=this.functionArguments,b=a.pixelBlock,d=b.pixelType;if("U8"===d||"U16"===d||"S8"===d||"S16"===d){if(this._LUTSignature&&(d=this._computeLutSignature(),d.length===this._LUTSignature.length&&!d.some(function(a,b){return a!==
this._LUTSignature[b]}.bind(this))))return;var d=b.pixels.length,e=[],g=[],h,n,m=c.max,B=c.min,u=c.gamma,v=m-B,x=this._getCutOffPoints(a);a=x.minCutOff;var x=x.maxCutOff,w=0,A=256,D;"S8"===b.pixelType?w=-127:"S16"===b.pixelType&&(w=-32767);if("U16"===b.pixelType||"S16"===b.pixelType)A=65536;for(b=0;b<d;b++)e[b]=x[b]-a[b];var y=this._gammaCorrection;if(c.useGamma)for(var z,b=0;b<d;b++){D=[];for(c=0;c<A;c++)h=c+w,z=(h-a[b])/e[b],n=1,1<u[b]&&(n-=Math.pow(1/v,z*y[b])),h<x[b]&&h>a[b]?D[c]=Math.floor(n*
v*Math.pow(z,1/u[b]))+B:h>x[b]?D[c]=m:h<a[b]&&(D[c]=B);g[b]=D}else for(b=0;b<d;b++){D=[];for(c=0;c<A;c++)h=c+w,D[c]=h<a[b]?B:h>x[b]?m:Math.floor((h-a[b])/e[b]*v)+B;g[b]=D}this.LUT=g;this.LUTOffset=w;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,b=[],d,e;b.push(a.stretchType);b.push(a.min);b.push(a.max);b.push(a.numberOfStandardDeviations);if(this._statistics)for(d=0;d<this._statistics.length;d++)for(e=0;e<this._statistics[d].length;e++)b.push(this._statistics[d][e]);
b.push(a.dra?1:0);b.push(a.minPercent);b.push(a.maxPercent);if(a.gamma)for(d=0;d<this._statistics.length;d++)b.push(a.gamma[d]);b.push(a.useGamma?1:0);return b},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=this.functionArguments,c=a.pixelBlock,d=c.pixels,e=c.mask,c=c.width*c.height,g=d.length,h=[],n=[],m,B,u,v,x=b.max,w=b.min,A=b.gamma,D=x-w;m=this._getCutOffPoints(a);var y=m.minCutOff,z=m.maxCutOff;for(m=0;m<g;m++)h[m]=z[m]-y[m];if(b.useGamma&&null!==
A&&A.length>=g)for(m=0;m<g;m++)n[m]=1<A[m]?2<A[m]?6.5+Math.pow(A[m]-2,2.5):6.5+100*Math.pow(2-A[m],4):1;if(b.useGamma)if(void 0!==e&&null!==e)for(b=0;b<c;b++){if(e[b])for(m=0;m<g;m++)B=d[m][b],v=(B-y[m])/h[m],u=1,1<A[m]&&(u-=Math.pow(1/D,v*n[m])),B<z[m]&&B>y[m]?d[m][b]=Math.floor(u*D*Math.pow(v,1/A[m]))+w:B>z[m]?d[m][b]=x:B<y[m]&&(d[m][b]=w)}else for(b=0;b<c;b++)for(m=0;m<g;m++)B=d[m][b],v=(B-y[m])/h[m],u=1,1<A[m]&&(u-=Math.pow(1/D,v*n[m])),B<z[m]&&B>y[m]?d[m][b]=Math.floor(u*D*Math.pow(v,1/A[m]))+
w:B>z[m]?d[m][b]=x:B<y[m]&&(d[m][b]=w);else if(void 0!==e&&null!==e)for(b=0;b<c;b++){if(e[b])for(m=0;m<g;m++)B=d[m][b],B<z[m]&&B>y[m]?d[m][b]=Math.floor((B-y[m])/h[m]*D)+w:B>z[m]?d[m][b]=x:B<y[m]&&(d[m][b]=w)}else for(b=0;b<c;b++)for(m=0;m<g;m++)B=d[m][b],B<z[m]&&B>y[m]?d[m][b]=Math.floor((B-y[m])/h[m]*D)+w:B>z[m]?d[m][b]=x:B<y[m]&&(d[m][b]=w);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var b=this._statistics.length,c,d=[],e;for(c=0;c<b;c++)e=this._statistics[c][2],"U8"!==
a&&(e=255*(e-this._statistics[c][0])/(this._statistics[c][1]-this._statistics[c][0])),d.push(this._computeGammaValue(e));return d},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var b=0;0<a&&150!=a&&255>a&&(b=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));b=Math.log((a+b)/255);if(0!==b&&(a=Math.log(a/255)/b,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,d,e,
h,m=this.sourceRasterInfo.raster.bandCount,q=a.pixelBlock,n=this.gl,t=n.drawingBufferWidth,B=n.drawingBufferHeight;if(!q&&this.functionArguments.dra){var u=new Float32Array(t*B*4);e=new Uint8Array(t*B);h=new Float32Array(t*B);var v=new Float32Array(t*B),x=new Float32Array(t*B);n.checkFramebufferStatus(n.FRAMEBUFFER)==n.FRAMEBUFFER_COMPLETE&&n.readPixels(0,0,t,B,n.RGBA,n.FLOAT,u);for(d=0;d<t*B;d++)h[d]=u[4*d],v[d]=u[4*d+1],x[d]=u[4*d+2],e[d]=u[4*d+3];a.pixelBlock=new b({width:t,height:B,pixels:[h,
v,x],mask:e});a.pixelBlock.calculateStatistics()}!q&&this.functionArguments.dra&&this._useGPUStats?(e=new Float32Array(m),h=new Float32Array(m)):(this._updateStatistisHistograms(a),d=this._getCutOffPoints(a),e=new Float32Array(m),h=new Float32Array(m),e.set(d.minCutOff.slice(0,m)),h.set(d.maxCutOff.slice(0,m)));this._initializeProgram({fragment:g.stretch,fragmentName:"Stretch"});u=this._setupTextureData(a);this.renderTexture=!1;d=n.getUniformLocation(this.rasterProgram,"u_image");n.uniform1i(d,0);
n.activeTexture(n.TEXTURE0);var w,A;this._performance.start();!q&&this.functionArguments.dra&&this._useGPUStats&&(this._setUniforms({u_sourceDim:[t,B],u_bandCount:m}),1===m?w=this._readMinMax(u,2):(w=this._readMinMax(u,0),A=this._readMinMax(u,1)),6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)&&(d=this._readHistogram(w,A,a),e=d.minCutOff||e,h=d.minCutOff||h);v=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(m);for(d=
0;d<m;d++)a[d]=v/(h[d]-e[d]);this._initializeProgram({fragment:g.stretch,fragmentName:"Stretch"});n.blendFunc(n.SRC_ALPHA,n.ZERO);v=new Float32Array(3);x=new Float32Array(3);for(d=0;3>d;d++)v[d]=this.functionArguments.min,x[d]=this.functionArguments.max;this._setUniforms({u_sourceDim:[t,B],u_bandCount:m,u_minOutput:v,u_maxOutput:x,u_minCutOff:e,u_maxCutOff:h,u_factor:a,u_state:100,u_useGamma:this.functionArguments.useGamma,u_gamma:this.functionArguments.gamma,u_scaled:!c,u_gammaCorrection:this._gammaCorrection,
u_minMaxTexture:!q&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;n.viewport(0,0,t,B);n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,u.texture);!q&&this.functionArguments.dra&&this._useGPUStats&&(c=n.getUniformLocation(this.rasterProgram,"u_image1"),n.uniform1i(c,1),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,w.texture),1<m&&(m=n.getUniformLocation(this.rasterProgram,"u_image2"),n.uniform1i(m,2),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,
A.texture)));n=this.bindFrameBuffer();this._drawGL();return{extent:u.extent,texture:n.texture}},_readMinMax:function(a,b){var c=this.gl,d=a.width||c.drawingBufferWidth,e=a.height||c.drawingBufferHeight;this._setUniforms({u_state:b});this.renderTexture=!1;var f,g,h=a.texture;for(c.activeTexture(c.TEXTURE0);1<d||1<e;)f=this._createTexture(),b=Math.max(Math.ceil(d/2),1),g=Math.max(Math.ceil(e/2),1),c.getExtension("OES_texture_float"),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,b,g,0,c.RGBA,c.FLOAT,null),a=c.createFramebuffer(),
c.bindFramebuffer(c.FRAMEBUFFER,a),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,f,0),c.viewport(0,0,b,g),c.bindTexture(c.TEXTURE_2D,h),this._setUniforms({u_sourceDim:[d,e]}),d=b,e=g,this._drawGL(!0),h=f;a=new Float32Array(d*e*4);c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE&&c.readPixels(0,0,d,e,c.RGBA,c.FLOAT,a);return{texture:f,minmax:a}},_readHistogram:function(a,b,e){if(a)try{var c=this.gl,f=c.drawingBufferWidth,h=c.drawingBufferHeight,k,n,m,B,u,v,x;
if(a.texture instanceof WebGLTexture)x=!0,B=[1,0,0,1],b?(u=a.minmax,v=b.minmax):(u=[a.minmax[0]],v=[a.minmax[1]]);else for(v=b,u=a,B=new Float32Array(v.length),k=0;k<v.length;k++)B[k]=256/(v[k]-u[k]);var w=new Float32Array(f*h);for(m=0;m<w.length;m++)w[m]=m;if(!this.histogramProgram){var A=d.getShader(c,d.histogram),D=g.getShader(c,g.constant);this.histogramProgram=this._loadProgram(A,D)}c.blendFunc(c.ONE,c.ONE);c.enable(c.BLEND);c.useProgram(this.histogramProgram);var y=c.getAttribLocation(this.histogramProgram,
"a_pixelIndex"),z=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,z);c.bufferData(c.ARRAY_BUFFER,w,c.STATIC_DRAW);c.enableVertexAttribArray(y);c.vertexAttribPointer(y,1,c.FLOAT,!1,0,0);var C=this._setupHistTexture(e),E=this._createTexture();c.getExtension("OES_texture_float");c.texImage2D(c.TEXTURE_2D,0,c.RGBA,257,1,0,c.RGBA,c.FLOAT,null);var F=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,F);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,E,0);c.viewport(0,0,257,1);var G=
c.getUniformLocation(this.histogramProgram,"u_image");c.uniform1i(G,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,C);var H=c.getUniformLocation(this.histogramProgram,"u_sourceDim");c.uniform2f(H,f,h);var N=c.getUniformLocation(this.histogramProgram,"u_bandCount");c.uniform1i(N,3);var J=c.getUniformLocation(this.histogramProgram,"u_halfPixel");c.uniform2f(J,.5/f,.5/h);var P=c.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(x){c.uniform1i(P,1);var I=c.getUniformLocation(this.histogramProgram,
"u_image1");c.uniform1i(I,1);c.activeTexture(c.TEXTURE1);c.bindTexture(c.TEXTURE_2D,a.texture);if(b){var L=c.getUniformLocation(this.histogramProgram,"u_image2");c.uniform1i(L,2);c.activeTexture(c.TEXTURE2);c.bindTexture(c.TEXTURE_2D,b.texture)}}else{var W=c.getUniformLocation(this.histogramProgram,"u_mins");c.uniform4f(W,u[0],u[0],u[0],u[0]);c.uniform1i(P,0)}var M=c.getUniformLocation(this.histogramProgram,"u_color"),U=c.getUniformLocation(this.histogramProgram,"u_factors"),O=c.getUniformLocation(this.histogramProgram,
"u_size");c.uniform1f(O,256);a=[];b=[];var ba;c.uniform4fv(M,[1,0,0,1]);c.uniform4fv(U,[B[0],0,0,1]);c.drawArrays(c.POINTS,0,w.length);var za=this.sourceRasterInfo.raster.bandCount;1<za&&(c.uniform4fv(M,[0,1,0,1]),c.uniform4fv(U,[0,B[0],0,1]),c.drawArrays(c.POINTS,0,w.length),c.uniform4fv(M,[0,0,1,1]),c.uniform4fv(U,[0,0,B[0],1]),c.drawArrays(c.POINTS,0,w.length));if(c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE){ba=new Float32Array(1028);c.readPixels(0,0,257,1,c.RGBA,c.FLOAT,ba);
var da,c=0,ca=-.5===u[0]&&1===(v[0]-u[0])/256?.5:0;for(k=0;k<za;k++){da=new Float32Array(257);var V=new Float32Array(257);for(m=c=0;256>m;m++)c+=ba[4*m+k],da[m]=c,V[m]=ba[4*m+k];V[256]=ba[1024+k];da[256]=c+ba[1024+k];var K=this.functionArguments.minPercent*c/100;if(v){for(n=0;256>n;n++)if(da[n]>K){a[k]=u[0]+(v[0]-u[0])/256*(n+ca);break}K=(1-this.functionArguments.maxPercent/100)*c;for(n=254;0<=n;n--)if(da[n]<K){b[k]=u[0]+(v[0]-u[0])/256*(n+2-ca);break}}}}return{histogram:ba,minCutOff:a,maxCutOff:b}}catch(pa){console.debug("webgl filter exception: "+
pa.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var b=this.originalHistTexture=this._createTexture(),c=this.gl;a=a.pixelBlock;var d=a.width,e=a.height;c.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();c.texImage2D(c.TEXTURE_2D,0,c.RGBA,d,e,0,c.RGBA,c.FLOAT,this.rgbaFloatData);return b}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],
function(m,h,a,b,d){return m([b,d],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments={raster:null}},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=h.mixin(a.raster,{});return!0},read2D:function(a){return a.raster},readGL:function(b){this._initializeProgram({fragment:a.identity,fragmentName:"identity"});
b=this._setupTextureData(b.raster);var d=this.bindFrameBuffer(),c=this.gl;c.bindTexture(c.TEXTURE_2D,b.texture);this._drawGL();return{extent:b.extent,texture:d.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(m,h,a,b,d){return m([b,d],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingType:0,resamplingOrigin:null,
resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(a){},readGL:function(b){this._performance.start();this._initializeProgram({fragment:a.mask,fragmentName:"Mask"});var d=this._setupTextureData(b.raster),c=this.bindFrameBuffer(),f=this.gl;f.bindTexture(f.TEXTURE_2D,d.texture);var g,h=f.drawingBufferWidth,f=f.drawingBufferHeight;g=b.raster;void 0!==g.pixelBlock?(d=d||this._setupTextureData(g),b=g.pixelBlock.width,g=g.pixelBlock.height):(d=d||g,b=
h,g=f);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[b/h,g/f],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.resamplingType,u_resolution:[1/h,1/f]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:d.extent,texture:c.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer".split(" "),
function(m,h,a,b,d,g,e){var c=function(){function a(a){c[a.prototype.rendererName]=a}var c={};a(b);a(g);a(e);a(d);return c}();return{wellKnownRenderers:c,isSupported:function(a){if(!a)return!1;var b=!0;c[a.rendererName]||(b=!1);return b},create:function(a){if(!a)return null;var b;a.rendererName?(b=a.rendererName,a=a.rendererArguments):(b=["uniqueValue","rasterStretch","rgb","colormap"].indexOf(a.type),b=["UniqueValue","Stretch","RGB","Colormap"][b],"rasterStretch"===a.type&&a.bandIndex&&1<a.bandIndex.length&&
(b="RGB"));return new c[b](a)},createDefaultRenderer:function(a){if(a&&a.raster){var c=a.raster.rasterInfo,f=a.raster.dataType;if(c){var h=a.raster.rasterFunction,m=["Stretch","Colormap","ContrastAndBrightness"];if(h&&"U8"===c.pixelType&&-1<m.indexOf(h.functionName))h.renderTexture=!0;else if("Processed"!==f||!(a.useWebGL&&h&&h.renderTexture||!a.useWebGL&&"U8"===c.pixelType)){var h=c.bandCount,q=c.colormap,n=c.vat,m=c.histograms,t;m&&0===m.length&&(m=null);var B=c.statistics&&c.statistics.map(function(a){return[a.min,
a.max,a.mean,a.stddev]}),u=c.keyProperties&&(c.keyProperties.bandProperties||c.keyProperties.BandProperties);if(1===h&&q&&0<q.length)t=new b({colormap:q||n});else if(1===h&&n&&n.features&&0<n.features.length)t=new d({});else{q=0;n=!1;f||!a.raster||!a.raster.tileInfo||void 0!==a.raster.tileInfo.tileType&&"Map"!==a.raster.tileInfo.tileType?"U8"===c.pixelType&&"Processed"===f?(q=5,B=B||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],n=!1):"U8"===c.pixelType||"Elevation"===f?(q=5,n=B?!1:!0):"Scientific"===f?(q=
5,n=B?!1:!0,t=this._getDefaultScientificColorRamp()):m&&0<m.length?(q=6,n=!1):B?(q=5,n=!1):(q=6,n=!0):(B=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],q=5,n=!1);B||(q=5,n=!0);var v,x,w,A;if(3<=h&&u&&!(a.bandIds||a.raster&&a.raster.imageServiceParams&&a.raster.imageServiceParams.bandIds)){for(a=0;a<u.length;a++)u[a].BandName&&"red"===u[a].BandName.toLowerCase()&&(x=a),u[a].BandName&&"green"===u[a].BandName.toLowerCase()&&(w=a),u[a].BandName&&"blue"===u[a].BandName.toLowerCase()&&(A=a);void 0!==x&&void 0!==
w&&void 0!==A&&(v=[x,w,A])}v={stretchType:q,min:0,max:255,dra:n,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:B,histograms:m,numberOfStandardDeviations:2.5,bandIndex:v};1===h?(t&&(v.colorRamp=t,v.invert=!0),t=new e(v)):t=new g(v)}return t}}}},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(m,h,a,b){return m([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(a){this._function=new b(a);this._function.outputPixelType="U8"},draw2D:function(a){this._updateColormapParameters();a=this._clonePixelData(a);return a=this._function._colorize(a)},drawGL:function(a){this._updateColormapParameters();this._function._colorizeGL(a)},toJson:function(){var a=
this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:a}},_updateColormapParameters:function(){var a=this._function.functionArguments;a.colormap=this.colormap;a.colormapName=this.colormapName;a.colorRamp=this.colorRamp;a.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(m,h,a,b){return m(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",
raster:null,constructor:function(a){a=a||{};this.raster=a.raster||a.Raster||this.raster;this.draw=h.hitch(this,this.draw);this.bind=h.hitch(this,this.bind);a=h.clone(a);Object.keys(a).forEach(function(b){null==a[b]&&delete a[b]});h.mixin(this,a)},bind:function(a){if(!a)throw"failed to bind without options";var b=a;a.layer&&(a=a.layer,b={id:a.id,rawRasterInfo:a.raster.rasterInfo,glSetting:a._glSetting,xformSetting:a.tileManager&&a.tileManager.xformSetting,useWebGL:a.useWebGL,resampling:a.tileMode&&
a.tileManager&&a.tileManager.xformSetting.requireProjection&&!a._hasTilingEffects&&"Thematic"!==a.raster.dataType?1:0,tileMode:a.tileMode});this._rawRasterInfo=b.rawRasterInfo;this.useWebGL=b.useWebGL;this._function&&this._function.setProcessingContext(h.mixin({useProcessedData:!0},b));this._processingContext=b},hasTilingEffects:function(){},draw:function(a){return this.useWebGL?this.drawGL(a):this.draw2D(a)},toJson:function(){},_clonePixelData:function(d){if(null==d)return d;var g={};d.extent&&(g.extent=
new a(d.extent.xmin,d.extent.ymin,d.extent.xmax,d.extent.ymax,d.extent.spatialReference));d=d.processedPixelBlock||d.pixelBlock;if(null==d)return g;g.pixelBlock=d.clone?d.clone():b.prototype.clone(d);return g}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(m,h,a,b,d){return m([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",
rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(a){a&&a.colormap&&(this.colormap=a.colormap,this._function=new b(a),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(a){this.inherited(arguments);if(!this._function){var e=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!e)throw"uv renderer requires data source to have raster attribute table";var c=this.attributeField||this.field1||this.field,f=this.infos||this.uniqueValueInfos;
this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var g,h=e.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];h&&(g=h.name);c||((c=e.fields.filter(function(a){return-1<["classname","category"].indexOf(a.name.toLowerCase())})[0])||(c=e.fields.filter(function(a){return"esriFieldTypeString"===a.type})[0]),this.alias=(this.field=c=c&&c.name||g)&&c.alias||g);var l=[],m,q,n,t,B,u;if(!f){f=[];n=e.fields.filter(function(a){return"alpha"===a.name.toLowerCase()})[0];
t=e.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0];B=e.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0];u=e.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];for(h=0;h<e.features.length;h++)q=e.features[h].attributes,(m=f.some(function(a){a.value===q[c]}))||(n&&t&&B&&u?f.push({value:q[c],alias:q[c],color:[q[t.name],q[B.name],q[u.name],q[n.name]]}):t&&B&&u?f.push({value:q[c],alias:q[c],color:[q[t.name],q[B.name],q[u.name]]}):f.push({value:q[c],
alias:q[c]}));if(!(t&&B&&u))for(m=d.createRandomColorRamp({size:f.length}),h=0;h<f.length;h++)f[h].color=m[h];this.uniqueValueInfos=f}if(f)f.forEach(function(a){l=l.concat(e.features.filter(function(b){return a.value==b.attributes[c]}).map(function(b){return[b.attributes[g]].concat(a.color||a.symbol&&a.symbol.color)}))}),this.defaultColor&&e.features.filter(function(a){l.some(function(b){return b[0]===a.attributes[g]})||l.push([a.attributes[g]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";
this._function=new b({colormap:l});this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(a){a=this._clonePixelData(a);return a=this._function._colorize(a)},drawGL:function(a){this._function._colorizeGL(a)},toJson:function(a){var b={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};a&&(b.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:b}}})})},
"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),function(m,h,a,b,d,g){return m([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,
computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(a){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);a=h.mixin({},a,{stretchType:this.stretchType});this._function=new b(a);this._function.outputPixelType="U8";this._function.renderTexture=!1;this.bandIndex=a.bandIndex||a.BandIndex;this._cbFunction=new d(a);this._cbFunction.functionArguments.raster=this._function;
this._cbFunction.renderTexture=!0},hasTilingEffects:function(){return this._function.hasTilingEffects()},draw2D:function(a){this._updateStretchParameters();a=this._clonePixelData(a);if("U8"===a.pixelBlock.pixelType&&!this.contrastOffset&&!this.brightnessOffset)return a;this._function._stretch(a);var b=a.pixelBlock,d=this.bandIndex,e=Math.max.apply(null,d);b&&b.pixels.length>e&&d&&(b.pixels=d.map(function(a){return b.pixels[a]}),b.statistics&&(b.statistics=d.map(function(a){return b.statistics[a]})));
if(this.contrastOffset||this.brightnessOffset)a.pixelBlock=g.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateStretchParameters();a.pixelBlock&&(a=this._clonePixelData(a));var b=a.pixelBlock,d=this.bandIndex,e=Math.max.apply(null,d),g=this.statistics,h=this.histograms,m,q;b&&b.pixels.length>e&&d&&(b.pixels=d.map(function(a){return b.pixels[a]}),b.statistics&&(b.statistics=d.map(function(a){return b.statistics[a]})),
g&&g.length>d.length&&(m=d.map(function(a){return g[a]})),h&&h.length>d.length&&(q=d.map(function(a){return h[a]})));this._function.functionArguments.statistics=m||g;this._function.functionArguments.histograms=q||h;this.contrastOffset||this.brightnessOffset?(this._function.renderTexture=!1,this._cbFunction.renderTexture=!0,a=this._function._stretchGL(a),this._cbFunction._cbGL(a)):(this._function.renderTexture=!0,this._function._stretchGL(a))},toJson:function(){var a=this._function.toJson().rasterFunctionArguments;
a.bandIndex=this.bandIndex;a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},_updateStretchParameters:function(){var a=this._function.functionArguments;a.stretchType=this.stretchType;a.min=this.min;a.max=this.max;a.numberOfStandardDeviations=this.numberOfStandardDeviations;a.statistics=this.statistics;a.histograms=this.histograms;a.dra=this.dra;a.minPercent=this.minPercent;a.maxPercent=this.maxPercent;a.useGamma=
this.useGamma;a.gamma=this.gamma;a.computeGamma=this.computeGamma}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(m,h,a,b,d,g,e){return m([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:0,colorRamp:null,
invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(a){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);a=h.mixin({},a,{stretchType:this.stretchType});Object.keys(a).forEach(function(b){null==a[b]&&delete a[b]});
this._function=new d(a);this._stretchFunction=new b(a);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new g(a);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(a){this._updateStretchParameters();a=this._clonePixelData(a);if("U8"===a.pixelBlock.pixelType&&
!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return a;this._stretchFunction._stretch(a);var b=a.pixelBlock,c=this.bandIndex;b&&1<b.pixels.length&&b.pixels.length>c&&(b.pixels=[b.pixels[c]],b.statistics&&(b.statistics=[b.statistics[c]]));this.colorRamp&&(a=this._clrFunction._colorize(a));if(this.contrastOffset||this.brightnessOffset)a.pixelBlock=e.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateStretchParameters();
var b=a.pixelBlock,c=this.bandIndex,d=this.statistics,e=this.histograms,g,h;b&&1<b.pixels.length&&b.pixels.length>c&&(b.pixels=[b.pixels[c]],b.statistics&&(b.statistics=[b.statistics[c]]),d&&0<d.length&&(g=[d[c]]),e&&0<e.length&&(h=[e[c]]));this._stretchFunction.functionArguments.statistics=g||d;this._stretchFunction.functionArguments.histograms=h||e;b=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=
!0,a=this._stretchFunction._stretchGL(a),b&&(a=this._clrFunction._colorizeGL(a)),this._function._cbGL(a)):b?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,a=this._stretchFunction._stretchGL(a),this._clrFunction._colorizeGL(a)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(a))},toJson:function(){var a=this._stretchFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;
a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},_updateStretchParameters:function(){var a=this._stretchFunction.functionArguments;a.stretchType=this.stretchType;a.min=this.min;a.max=this.max;a.numberOfStandardDeviations=this.numberOfStandardDeviations;a.statistics=this.statistics;a.histograms=this.histograms;a.dra=this.dra;a.minPercent=this.minPercent;a.maxPercent=this.maxPercent;a.useGamma=this.useGamma;a.gamma=this.gamma;a.computeGamma=this.computeGamma}})})},
"*now":function(m){m(['dojo/i18n!*preload*esri/layers/rasterLib/tile/nls/RasterWorker*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("esri/layers/rasterLib/tile/RasterWorker","require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../rasterFormats/rasterCodec ../function/rasterFunctionHelper ../renderer/rasterRendererHelper ../raster/RasterInfo".split(" "),function(m,h,a,b,d,g,e,c,f,k){return function(){function a(a){this.processingSettings={}}a.prototype.setLayer=function(a){var c=new b,d=a.layerId;this.processingSettings[d]=this.processingSettings[d]||{};a.raster&&(this.processingSettings[d].raster=
a.raster,a.raster.rasterInfo&&(this.processingSettings[d].raster.rasterInfo=new k(a.raster.rasterInfo)));this.processingSettings[d].bandCount=a.bandCount;this.processingSettings[d].useWebGL=!1;c.resolve();return c.promise};a.prototype.setRasterFunction=function(a){var d=new b,e=a.layerId;a=a.data;this.processingSettings[e]=this.processingSettings[e]||{};a?(a=c.create(a),this.processingSettings[e].rasterFunction=a,this.processingSettings[e].rasterFunction.setProcessingContext(this.processingSettings[e])):
this.processingSettings[e].rasterFunction=null;d.resolve();return d.promise};a.prototype.setRasterRenderer=function(a){var c=new b,d=a.layerId;a=a.data;this.processingSettings[d]=this.processingSettings[d]||{};a?(this.processingSettings[d].rasterRenderer=f.create(a),this.processingSettings[d].rasterRenderer.bind({layer:this.processingSettings[d]})):this.processingSettings[d].rasterRenderer=null;c.resolve();return c.promise};a.prototype.processTileData=function(a){return this.decode(a).then(function(a){this.process(a).then(function(a){this.render(a)}.bind(this))}.bind(this))};
a.prototype.decode=function(a){return e.decode(a.encodedData,a.decodeParams)};a.prototype.process=function(a){var c=new b,d=this.processingSettings[a.layerId].rasterFunction,e;d&&a&&(e=d.read(a));c.resolve(e||a);return c.promise};a.prototype.render=function(a){var c=new b,d=this.processingSettings[a.layerId].rasterRenderer,e;d&&a&&(e=d.draw(a));c.resolve(e||a);return c.promise};return a}()});