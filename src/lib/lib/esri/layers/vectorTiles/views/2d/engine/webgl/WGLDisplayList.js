// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/WGLDisplayList","require exports ../../../../core/tsSupport/generatorHelper ../../../../core/Logger ./enums ./MaterialInfo ./Utils ./util/serializationUtils".split(" "),function(q,z,v,w,g,r,x,e){var y=w.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");q=function(){function c(){this.symbolLevels=[]}Object.defineProperty(c.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});
c.prototype.addToList=function(a){var d=this;Array.isArray(a)?a.forEach(function(a){d._addToList(a)}):this._addToList(a)};c.prototype.removeFromList=function(a){var d=this;Array.isArray(a)||(a=[a]);a.forEach(function(a){d._removeFromList(a)})};c.prototype.ofType=function(a){var d,b,c,n,f,h,p,g,e,l,m;return v(this,function(k){switch(k.label){case 0:d=0,b=this.symbolLevels,k.label=1;case 1:if(!(d<b.length))return[3,8];c=b[d];n=0;f=c.zLevels;k.label=2;case 2:if(!(n<f.length))return[3,7];h=f[n];p=h.geometryDPInfo;
g=this._getDPInfoType(a);if(!p[g])return[3,6];e=0;l=p[g];k.label=3;case 3:if(!(e<l.length))return[3,6];m=l[e];return[4,m];case 4:k.sent(),k.label=5;case 5:return e++,[3,3];case 6:return n++,[3,2];case 7:return d++,[3,1];case 8:return[2]}})};c.prototype._addToList=function(a){var d=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=0<d.length?d[d.length-1]:null;null!==b&&x.isSameMaterialInfo(b.materialInfo,a.materialInfo)&&b.indexFrom+b.indexCount===a.indexFrom?b.indexCount+=a.indexCount:
(b=new l,b.indexFrom=a.indexFrom,b.indexCount=a.indexCount,b.materialInfo=a.materialInfo,b.geometryType=a.geometryType,d.push(b))};c.prototype._removeFromList=function(a){for(var d=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=d.length,c=void 0,g=0;g<b;++g){var f=d[g];a.indexFrom+a.indexCount>f.indexFrom&&a.indexFrom<f.indexFrom+f.indexCount&&(c=g)}if(void 0!==c)if(f=d[c],a.indexFrom===f.indexFrom)f.indexCount-=a.indexCount,f.indexFrom+=a.indexCount;else if(a.indexFrom+a.indexCount===
f.indexFrom+f.indexCount)f.indexCount-=a.indexCount;else{var b=f.indexFrom,g=a.indexFrom-f.indexFrom,h=a.indexCount;a=f.indexFrom+f.indexCount-(a.indexFrom+a.indexCount);f.indexCount=g;var e=new l;e.geometryType=f.geometryType;e.materialInfo=new r.default;e.materialInfo.copy(f.materialInfo);e.indexFrom=b+g+h;e.indexCount=a;d.splice(c+1,0,e)}};c.prototype._getDisplayList=function(a,d,c){for(var b,e=this.symbolLevels.length,f=0;f<e;f++)if(this.symbolLevels[f].symbolLevel===a){b=this.symbolLevels[f];
break}b||(b=new t,b.symbolLevel=a,this.symbolLevels.push(b));var h;a=b.zLevels.length;for(e=0;e<a;e++)if(b.zLevels[e].zLevel===d){h=b.zLevels[e];break}h||(h=new u,h.geometryDPInfo=new m,h.zLevel=d,b.zLevels.push(h));var l;switch(c){case g.WGLGeometryType.FILL:h.geometryDPInfo.fill||(h.geometryDPInfo.fill=[]);l=h.geometryDPInfo.fill;break;case g.WGLGeometryType.LINE:h.geometryDPInfo.line||(h.geometryDPInfo.line=[]);l=h.geometryDPInfo.line;break;case g.WGLGeometryType.MARKER:h.geometryDPInfo.marker||
(h.geometryDPInfo.marker=[]);l=h.geometryDPInfo.marker;break;case g.WGLGeometryType.TEXT:h.geometryDPInfo.text||(h.geometryDPInfo.text=[]);l=h.geometryDPInfo.text;break;case g.WGLGeometryType.LABEL:h.geometryDPInfo.label||(h.geometryDPInfo.label=[]);l=h.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+c+"'.")}return l};c.prototype.serialize=function(a){e.serializeList(a,this.symbolLevels);return a};c.deserialize=function(a){var d=new c;d.symbolLevels=
e.deserializeList(a,t);return d};c.prototype._getDPInfoType=function(a){switch(a){case g.WGLGeometryType.FILL:return"fill";case g.WGLGeometryType.LINE:return"line";case g.WGLGeometryType.MARKER:return"marker";case g.WGLGeometryType.TEXT:return"text";case g.WGLGeometryType.LABEL:return"label";default:y.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return c}();var l=function(){function c(){this.materialInfo=null;this.indexCount=this.indexFrom=0}c.prototype.serialize=function(a){this.materialInfo.serialize(a);
a.writeInt32(this.indexFrom);a.writeInt32(this.indexCount);return a};c.deserialize=function(a,d){var b=new c;b.geometryType=d.geometryType;b.materialInfo=r.default.deserialize(a);b.indexFrom=a.readInt32();b.indexCount=a.readInt32();return b};return c}(),m=function(){function c(){this.label=this.text=this.marker=this.line=this.fill=null}c.prototype.serialize=function(a){e.serializeList(a,this.fill);e.serializeList(a,this.line);e.serializeList(a,this.marker);e.serializeList(a,this.text);e.serializeList(a,
this.label);return a};c.deserialize=function(a){var d=new c,b={geometryType:g.WGLGeometryType.FILL},k=e.deserializeList(a,l,b);k.length&&(d.fill=k);b.geometryType=g.WGLGeometryType.LINE;k=e.deserializeList(a,l,b);k.length&&(d.line=k);b.geometryType=g.WGLGeometryType.MARKER;k=e.deserializeList(a,l,b);k.length&&(d.marker=k);b.geometryType=g.WGLGeometryType.TEXT;k=e.deserializeList(a,l,b);k.length&&(d.text=k);b.geometryType=g.WGLGeometryType.LABEL;a=e.deserializeList(a,l,b);a.length&&(d.label=a);return d};
return c}(),u=function(){function c(){this.geometryDPInfo=new m}c.prototype.serialize=function(a){a.writeInt32(this.zLevel);this.geometryDPInfo.serialize(a);return a};c.deserialize=function(a){var d=new c;d.zLevel=a.readInt32();d.geometryDPInfo=m.deserialize(a);return d};return c}(),t=function(){function c(){this.zLevels=[]}c.prototype.serialize=function(a){a.writeInt32(this.symbolLevel);e.serializeList(a,this.zLevels);return a};c.deserialize=function(a){var d=new c;d.symbolLevel=a.readInt32();d.zLevels=
e.deserializeList(a,u);return d};return c}();return q});