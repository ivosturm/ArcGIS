// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/tasks/datareviewer/_DRSBaseTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/has ../../request ../../urlUtils ../../kernel ../Task ./ReviewerSession".split(" "),function(l,h,p,m,u,n,q,v,w,r){l=l(w,{declaredClass:"esri.tasks.datareviewer.DRSBaseTask",_url:null,_queryParams:null,_reviewerMapServerUrl:null,constructor:function(a){"/"==a[a.length-1]&&(a=a.slice(0,-1));a=q.urlToObject(a);this._url=a.path;this._queryParams=a.query;a=this._url.toLowerCase().lastIndexOf("/exts/");
0<a&&(this._reviewerMapServerUrl=this._url.substring(0,a));this._successHandler=h.hitch(this,this._successHandler);this._errorHandler=h.hitch(this,this._errorHandler);this._appendQueryParams=h.hitch(this,this._appendQueryParams);this.onError=h.hitch(this,this.onError)},_appendQueryParams:function(a){if(this._queryParams)for(var b in this._queryParams)a=q.urlToObject(a).query?a+("\x26"+b+"\x3d"+this._queryParams[b]):a+("?"+b+"\x3d"+this._queryParams[b]);return a},_successHandler:function(a,b,g){b&&
this[b].apply(this,[a]);g&&g.resolve(a)},_errorHandler:function(a,b){null===a&&(a=Error("Unexpected response received from server"),a.code=500);this.onError(a);b&&b.reject(a)},getReviewerMapServerUrl:function(){var a=null;if(a=this._reviewerMapServerUrl){if(this._queryParams)for(var b in this._queryParams)a=q.urlToObject(a).query?a+("\x26"+b+"\x3d"+this._queryParams[b]):a+("?"+b+"\x3d"+this._queryParams[b]);return a}return null},getLifecycleStatusStrings:function(){var a=this._successHandler,b=this._errorHandler,
g=this._appendQueryParams,f=this._url+"/Utilities/getLifecycleStatusStrings",f=g(f),c=new m;n({callbackParamName:"callback",url:f,content:{f:"json"}}).then(h.hitch(this,function(d,e){if(void 0!==d.error)e=Error(),e.message=d.error.message,e.code=d.error.code,b(e,c);else try{var t=d.lifecycleStatusString;if(void 0===t)b(null,c);else{var f=[];p.forEach(t,function(a,b){f[a.descriptionCode]=a.descriptionString});a({lifecycleStatusStrings:f},"onGetLifecycleStatusStringsComplete",c)}}catch(k){b(k,c)}}),
function(a,e){b(a,c)});return c},createReviewerSession:function(a,b){var g=this._successHandler,f=this._errorHandler,c=this._appendQueryParams,d=this._url+"/Utilities/createReviewerSession",d=c(d),e=new m;n({callbackParamName:"callback",url:d,content:{sessionName:a,sessionProperties:b.toJsonSessionOptions(),f:"json"}}).then(h.hitch(this,function(a,b){if(void 0!==a.error)b=Error(),b.message=a.error.message,b.code=a.error.code,f(b,e);else try{if(void 0===a.sessionAttributes)f(null,e);else{var d=a.sessionAttributes,
c=new r(d.sessionId,d.sessionName,d.userName,d.versionName);g({reviewerSession:c},"onCreateReviewerSessionComplete",e)}}catch(x){f(x,e)}}),function(a,b){f(a,e)});return e},getReviewerSessions:function(){var a=this._successHandler,b=this._errorHandler,g=this._appendQueryParams,f=this._url+"/Utilities/getReviewerSessions",f=g(f),c=new m;n({callbackParamName:"callback",url:f,content:{f:"json"}}).then(h.hitch(this,function(d,e){if(void 0!==d.error)e=Error(),e.message=d.error.message,e.code=d.error.code,
b(e,c);else try{var f=d.sessionAttributes;if(void 0===f)b(null,c);else{var g=[];p.forEach(f,function(a,b){g[b]=new r(a.sessionId,a.sessionName,a.userName,a.versionName)});a({reviewerSessions:g},"onGetReviewerSessionsComplete",c)}}catch(k){b(k,c)}}),function(a,e){b(a,c)});return c},getCustomFieldNames:function(){var a=this._successHandler,b=this._errorHandler,g="BATCHJOBCHECKGROUP CHECKTITLE FEATUREOBJECTCLASS LIFECYCLEPHASE LIFECYCLESTATUS SESSIONID SEVERITY SUBTYPE".split(" "),f=this._appendQueryParams,
c=this._url+"/Dashboard",c=f(c),d=new m;n({callbackParamName:"callback",url:c,content:{f:"json"}}).then(h.hitch(this,function(e,c){if(void 0!==e.error)c=Error(),c.message=e.error.message,c.code=e.error.code,b(c,d);else try{var f=[];void 0===e.reviewerResultsBy&&b(null,d);p.forEach(e.reviewerResultsBy,function(a,b){-1===g.indexOf(a.name)&&f.push(a.name)});a({customFieldNames:f},"onGetCustomFieldNamesComplete",d)}catch(k){b(k,d)}}),function(a,c){b(a,d)});return d},onGetLifecycleStatusStringsComplete:function(a){},
onGetReviewerSessionsComplete:function(a){},onCreateReviewerSessionComplete:function(a){},onGetCustomFieldNamesComplete:function(a){},onError:function(a){}});u("extend-esri")&&h.setObject("tasks.datareviewer.DRSBaseTask",l,v);return l});