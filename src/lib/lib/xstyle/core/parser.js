//>>built
define("xstyle/core/parser",[],function(){function M(){this.push.apply(this,arguments)}function I(c){this.value=c}function P(){var c,h=this.args[0];if("string"==typeof h)c=h.split(/\s*,\s*/);else if(h){c=[];for(var r=0,t=0;t<h.length+1;t++){var u=h[t];if("string"==typeof u||void 0===u)if(u=u&&u.split(/\s*,\s*/),1<c.length||void 0===u){var m=h.slice(r,t);0<r&&m.unshift(c.pop());r=t+1;c.push(m);u&&c.push.apply(c,u.slice(1))}}}else return[];return c}function N(c,h,r){function t(h,z){function r(a){D=
!1;var k=m.lastIndex;a.then(function(){D=!0;e&&(m.lastIndex=k,y())});var e=!0}function y(){function c(a){a&&"string"==typeof a&&y&&(a=y+a);b?b.push?"string"==typeof b[b.length-1]&&"string"==typeof a?b[b.length-1]+=a:a&&b.push(a):"string"==typeof b&&"string"==typeof a?b+=a:b=new M(b,a):b=a}for(D=!0;D;){var k=m.exec(h);if(!k)break;var e=k[5],y=k[1],f=k[2],d=k[3],p=k[4],l,g,b,C,p=p&&J(p),f=f&&J(f);B?(d?(g=f,l=d.charAt(0),C="?"==d.charAt(1),-1<d.indexOf("\n")&&(p=d.slice(1))):p=f,b=p,B=!1):(p=d?f+d:f,
c(p));"{"!=e&&(n+=k[0]);switch(e){case "'":case '"':var E="'"==e?Q:R;E.lastIndex=m.lastIndex;(e=E.exec(h))||w("unterminated string");f=e[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});m.lastIndex=E.lastIndex;c(new I(f));n+=e[0];continue;case "\\":e=E.lastIndex++;c(h.charAt(e));continue;case "(":case "{":case "[":if("{"==e){B=!0;":"==l&&d&&(f+=d);f&&y&&(f=y+f);n=J((n+f).replace(/\s+/g," "));c(d=a.newRule(n));"\x3d"==l&&(F=!1,b.creating=
!0);var A=null,L=G;k[6]&&(p=z.cssRules||z.rules,d.cssRule=A=p[k[6].slice(1)])&&(n=A.selectorText);if(a.root&&F)for(p=z.cssRules||z.rules;A=p[G++];)if(A.selectorText==n||A.selectorText&&A.selectorText.replace(/::/g,":").replace(/'/g,'"')==n.replace(/::/g,":").replace(/'/g,'"')){d.cssRule=A;break}A||(d.ruleIndex=G=L);d.styleSheet=z;b.creating?(d.selector="."+("\x3d"==l?f.match(/[\w-]*$/g,"")[0]:"")+"-x-"+S++,d.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(n)?d.setMediaSelector(n):d.selector=a.root?
n:a.selector+" "+n;n=""}else f=p.match(/(.*?)([\w-]*)$/),c(d=a.newCall(f[2],b,a)),d.ref=a.getDefinition(f[2]),d.getArgs=P,(b.calls||(b.calls=[])).push(d);a.currentName=g;a.currentSequence=b;a.assignmentOperator=l;var H;"{"==e&&(H=d.selector.match(/[@:]\w+/))&&(H=H[0],(g=a.getDefinition(H))&&g.selector&&g.selector(d));q.push(a=d);a.operator=e;a.start=m.lastIndex;b=g=null;continue}if(b)if(f="string"==typeof b?b:b[0],f.charAt&&"@"==f.charAt(0))if(k=f.match(/\w+/)[0],"import"==k)f=N.getStyleSheet((z.cssRules||
z.imports)[G++],b,z),k=m.lastIndex,t(f.localSource,f),m.lastIndex=k;else{if("xstyle"==k){if("start"==f.slice(8,13))d=a?a.newRule(""):O,d.root=a.root,q.push(a=d);else{var O=a||O;q.pop();a=q[q.length-1]}m=a?u:/(@[\w\s])/g}}else if("\x3d"===l)try{var x=a.declareDefinition(g,b,C);x&&x.then&&r(x)}catch(v){w(v)}switch(e){case ":":"\x3d"==l?(B=!0,l=":"):c(":");break;case "}":if(g&&!a.root&&!a.isMediaBlock)try{a[":"==l?"setValue":"declareDefinition"](g,b,C)}catch(v){w(v)}case ")":case "]":T[a.operator]!=
e&&w("Incorrect opening operator "+a.operator+" with closing operator "+e);g=null;g=h.slice(a.start,m.lastIndex-1);a.cssText=a.cssText?a.cssText+";"+g:g;if("}"==e){"}"==K&&(K=a.parent.selector)&&"@"==!K.charAt(0)&&w("A nested rule must end with a semicolon");if(a.root)w("Unmatched "+e);else{try{a.onRule(a.selector,a)}catch(v){w(v)}F=!0}n=""}if(")"==e||"]"==e)a.args=[b];if(")"==e&&!l){try{x=q[q.length-2].onArguments&&q[q.length-2].onArguments(a)}catch(v){w(v)}x&&x.then&&r(x)}q.pop();a=q[q.length-1];
b=a.currentSequence;g=a.currentName;l=a.assignmentOperator;if(a.root&&"}"==e){if(l)try{a[":"==l?"setValue":"declareDefinition"](g,b,C)}catch(v){w(v)}B=!0;l=!1}break;case "":case void 0:return;case ";":if(a&&g){try{(x=a[":"==l?"setValue":"declareDefinition"](g,b,C))&&x.then&&r(x)}catch(v){w(v)}g}b=null;B=!0;l=F=!1;n=""}var K=e}}function w(a){var c=h.slice(0,m.lastIndex).split("\n"),e=c[c.length-1],c=(z.href||"in-page stylesheet")+":"+c.length+":"+e.length+" near:\n"+e.slice(-40);if(t.onerror)t.onerror(a,
c);console.error(a.message||a,c);a.stack&&console.error(a.stack)}h=h.replace(L,function(a){return a.replace(/[^\n]/g,"")});var a=c;m.lastIndex=0;var D,G=0,F=!0,n="",B=!0;y()}r=r||{addRule:function(){},cssRules:[]};var u,m=u=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,q=[c];c.parse=t;t(h,r)}var Q=/((?:\\.|[^'])*)'/g,R=/((?:\\.|[^"])*)"/g,L=/\/\*[\w\W]*?\*\//g,T={"{":"}","[":"]","(":")"},
S=0,J="".trim?function(c){return c.trim()}:function(c){return c.replace(/^\s+|\s+$/g,"")},y=M.prototype=[];y.toString=function(){return this.join("")};y.isSequence=!0;I.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};I.prototype.isLiteralString=!0;return N});