//>>built
define("xstyle/core/Rule",["xstyle/core/expression","xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(n,B,x,y,p){function q(a,b,c){try{a[b]=c}catch(d){}}function l(){}function z(a,b,c,d){if(a.calls){var e;for(c=0;c<a.length;c++){var f=a[c];if(f instanceof r){a.hasOwnProperty(c)||(a[c]=f=t(f));var g=f.ref&&(f.ref.selfResolving?f.ref.apply(b,f.getArgs(),b):n.evaluate(b,[f.caller,f]));void 0!==g&&((e||(e=[])).push(g),f.evaluated=!0)}}}if(e)return b=n.react(function(){for(var b=
0,c=a.slice(),d=0;d<a.length;d++){var e=a[d];e instanceof r&&e.evaluated&&(c[d-1]=a[d-1].slice(0,-e.caller.length),c[d]=arguments[b++])}return c.join("")}),b.skipResolve=!0,d=new B,d.setCompute(b.apply(d,e,d)),d;if(!d)return a.toString()}function r(a){this.caller=a;this.args=[]}function C(a,b,c,d){return p.when(b,function(b){var e=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=e.forRule(a,!0);b&&b.forElement?u(a,b,d):c&&c(b)}),b=b.forRule(a));if(b&&b.forElement)return u(a,
b,d);c&&c(b)})}function u(a,b,c){return require(["xstyle/core/elemental"],function(d){d.addRenderer(a,function(a){var d=b.forElement(a);c&&c(d,a)})})}var t=Object.create||function(a){function b(){}b.prototype=a;return new b},m=p.convertCssNameToJs,D={"{":"}","[":"]","(":")"},v=x("div").style;l.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=
b[c];a.call(this,d||"unnamed",b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new l;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new r(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;try{c.addRule(a,b||" ",e)}catch(f){a.match(/-(moz|webkit|ie)-/)||
console.warn("Unable to add rule",a,b)}return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];q(a.style,c[0],c[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?q(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},
get:function(a){return this.values[a]},elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,b,c){a=a&&m(a);if(!this.disabled){var d=this;if(b.length)if("\x3e"==b[0].toString().charAt(0))a||(this.generator=b,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,c){b=a.forSelector(b,d);c.addRenderer(d,b)}));else{var e=a in v||this.getDefinition(a);if(!c||!e){c=this.definitions||(this.definitions=
{});var f=b[0];if(f.indexOf&&-1<f.indexOf(","))for(var f=b.join("").split(/\s*,\s*/),g=[],h=0;h<f.length;h++)g[h]=n.evaluate(this,f[h]);b[0]&&"{"==b[0].operator?g=b[0]:b[1]&&"{"==b[1].operator&&(g=b[1],p.extend(g,b[0]));g=g||n.evaluate(this,b);if(g.then)var k=g,g={then:function(a){return k.then(function(b){return a(A(b))})}};var A=function(b){b.define&&(b=b.define(d,a));return b};e&&console.warn('Overriding existing property "'+a+'"');return c[a]=A(g)}}else return c=this.definitions||(this.definitions=
{}),c[a]=b}},onArguments:function(a){var b=a.ref;return b&&b.apply(this,a.getArgs(),this)},setValue:function(a,b,c){var d=m(a);if(!this.disabled){var e=this.values||(this.values=[]);e.push(a);e[a]=b;if(a){do{e=(c||this).getDefinition(a);if(void 0!==e){if(this.cssRule&&(!e||!e.keepCSSValue)){var f=this.cssRule.style;d in f&&q(f,d,"")}C(this,e.put(b,this,d))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}d in v&&this._setStyleFromValue(d,b,!0)}},_setStyleFromValue:function(a,b,c){var d=b[0];if(d instanceof
l)for(c=d.values,d=0;d<c.length;d++){var e=c[d];this._setStyleFromValue(a+("main"==e?"":e.charAt(0).toUpperCase()+e.slice(1)),c[e])}else{if(b.calls){var f=this;if(b.expression=z(b,this,a,!0)){var g=b.expression&&b.expression.valueOf(),h=function(b,c){var d=g&&g.forRule?g.forRule(b,!0):g;if(d&&d.forElement)if(c=c&&c.elements)for(var e=0;e<c.length;e++)for(var f=c[e].querySelectorAll(b.selector),h=0;h<f.length;h++){var k=f[h];q(k.style,a,d.forElement(k))}else u(b,d,function(b,c){q(c.style,a,b)});else b.setStyle(a,
d)},k=[f];p.when(g,function(a){(g=a)&&g.forRule&&(f._subRuleListeners||(f._subRuleListeners=[])).push(function(a){k.push(a);h(a)});h(f)});b.expression.dependencyOf({invalidate:function(a){p.when(b.expression.valueOf(),function(b){g=b;for(b=0;b<k.length;b++){var c=!0,d=k[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&h(d,a)}})}})}}c||this.setStyle(a,b)}},put:function(a){var b=this;return{forRule:function(c){b.extend(c);if("defaults"!=a&&a&&"string"==typeof a&&
b.values)for(var d=a.toString().split(/,\s*/),e=0;e<d.length;e++){var f=b.values[e];f&&c.setValue(f,d[e],b)}}}},extend:function(a,b){(this.derivatives||(this.derivatives=[])).push(a);var c=this.extraSelector;c&&(a.selector+=c);for(var d=this.cssRule.style,e=a.getCssRule().style,f=a.inheritedStyles||(a.inheritedStyles={}),c=0;c<d.length;c++){var g=m(d[c]);if(!e[g]||f[g])e[g]=d[g],f[g]=!0}if(c=this.values){var c=t(c),h=a.values;a.values=h?y.copy(c,h):c}if(b){if(c=this.definitions){var c=t(c),k=a.definitions;
a.definitions=k?y.copy(c,k):c}a.tagName=this.tagName||a.tagName}(a.bases||(a.bases=[])).push(this);b=this._subRuleListeners||0;for(c=0;c<b.length;c++)b[c](a);var l=a.getCssRule().style;this.eachProperty(function(b,c){b=m(b);"object"==typeof c&&(c=t(c));b in v&&!l[b]&&a._setStyleFromValue(b,c)});if(h&&a.definitions)for(c=0,b=h.length;c<b;c++)g=h[c],d=m(g),a.definitions[d]!==(k&&k[d])&&a.setValue(g,h[d]);if(h=this.generator){if(h instanceof Array)for(h=h.slice(0),c=0;c<h.length;c++)k=h[c],"{"===k.operator&&
(b=a.newRule(),b.selector=k.selector+a.selector.slice(1),b.styleSheet=a.styleSheet||a.cssRule.parentStyleSheet,k.extend(b,!0),h[c]=b);a.declareDefinition(null,h)}},getDefinition:function(a,b){a=m(a);var c=this;do{var d=c.definitions&&c.definitions[a];void 0===d&&b&&c[b]&&(d=c[b][a]);c=c.parent}while(void 0===d&&c);return d},newElement:function(){return x((this.tagName||"span")+(this.selector||""))},cssText:""};n.evaluateText=z;var w=r.prototype=new l;w.declareDefinition=w.setValue=function(a,b){this.args.push(b)};
w.toString=function(){var a=this.operator;return a+this.args+D[a]};l.updateStaleProperties=function(){};return l});