//>>built
define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(n,t){function u(c,f){var g=f[0];return g&&c?(g=x(g),u(c.property?c.property(g):c[g],f.slice(1))):c}function v(c,f,g){if(y(f,c)){var d={};d[c]=function(b){for(var d=[],a=0,h=f.length;a<h;a++){var e=f[a];e&&"function"==typeof e[c]&&(e=e[c](b));d[a]=e}return g(d)};return d}return g(f)}function r(c,f){return{apply:function(a,d,b){for(var g=0,l=d.length;g<l;g++){var h=d[g];h.dependencyOf&&h.dependencyOf(b)}g=function(){var e=
[];if(c.selfExecuting)return c.apply(a,d,b);for(var k=0,f=d.length;k<f;k++)e[k]=d[k].valueOf();if(c.selfWaiting)return c.apply(a,e,b);e.push(a);return n.whenAll(e,function(e){var d=e.pop();return v("forRule",e,function(e){return v("forElement",e,function(e){return c.apply(d,e,b)})})})};g.reverse=function(b){return f(b,d)};return g}}}function p(c){return w[c]||(w[c]=new Function("a","b","return "+c))}function a(c,a,g,d,b){function f(e){e.skipResolve=!0;e.precedence=a;e.infix=!1!==b}var n=function(e,
c){var a=c[0];c=c[1];if(a&&a.put)e=d(e,c&&c.valueOf()),e!==z&&a.put(e);else if(c&&c.put)c.put(b(e,a&&a.valueOf()));else throw new TypeError("Can not put");},h={apply:function(e,a,h){var k;g=p(g);d=d&&p(d);b=b&&p(b);l[c]=k=r(g,n);f(k);return k.apply(e,a,h)}};f(h);l[c]=h}function q(c,a){function g(b){for(;p<=b.precedence;){var a=h.pop(),c=l[h.pop()],d=new t;d.setCompute(c.apply(null,c.infix?[h.pop(),a]:[a],d));e=h.length?h[h.length-1]:void 0;h.push(d);p=e&&l[e]&&l[e].precedence}}var d,b;a=a.join?a.slice():
[a];for(d=0;d<a.length;d++)if(b=a[d],"string"==typeof b){var f=b.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);b=[d,1];f&&b.push.apply(b,f);a.splice.apply(a,b);d+=b.length-3}var p,h=[],e,f={};for(d=0;d<a.length;d++){b=a[d];if("("==b.operator){var k=h[h.length-1];void 0===k||l.hasOwnProperty(k)?b=q(c,b.getArgs()[0]):(h.pop(),b=function(b,a){function e(e){return n.when(b.valueOf(),function(f){var k=b.parent&&b.parent.valueOf();if(!f.selfResolving){if(!d){d=[];for(var l=0,m=a.length;l<m;l++)d[l]=
q(c,a[l]);h=f.selfReacting?f.apply(k,d,g):r(f).apply(k,d,g)}return h()}f=f.apply(k,a,g);return e?f:f.valueOf()})}var d,h,g=new t(e);g.setReverseCompute(function(){var b=arguments;return n.when(e(!0),function(a){return a.put.apply(a,b)})});return g}(k,b.getArgs()))}else if(l.hasOwnProperty(b))k=l[b],g(k),p=(e||k).precedence;else if(-1<b)b=+b;else if(b.isLiteralString)b=b.value;else{b=b.split(/\s*\/\s*/);var k=b[0],m=c.getDefinition(k);if("string"==typeof m||m instanceof Array)m=q(c,m);else if(void 0===
m)throw Error('Could not find reference "'+k+'"');f[k]=m;1<b.length&&(m=u(m,b.slice(1)));b=m}h.push(b)}g({precedence:100});if(1<h.length)throw Error("Could not reduce expression");b=h[0];b.inputs=f;return b}var x=n.convertCssNameToJs,y=n.someHasProperty,z={},w={},l={};a("+",6,"a+b","a-b","a-b");a("-",6,"a-b","a+b","b-a");a("*",5,"a*b","a/b","a/b");a("/",5,"a/b","a*b","b/a");a("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");a(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");a("!",
4,"!a","!a",!1);a("%",5,"a%b");a("\x3e",8,"a\x3eb");a("\x3e\x3d",8,"a\x3e\x3db");a("\x3c",8,"a\x3cb");a("\x3c\x3d",8,"a\x3c\x3db");a("\x3d\x3d",9,"a\x3d\x3d\x3db");a("\x26",8,"a\x26\x26b");a("|",8,"a||b");return{react:r,evaluate:q,selfResolving:function(a){a.selfResolving=!0;return a}}});