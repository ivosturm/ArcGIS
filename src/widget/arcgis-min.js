var dojoConfig={async:!1,locale:"en",paths:{react:"https://cdnjs.cloudflare.com/ajax/libs/react/15.5.4/react.min","react-dom":"https://cdnjs.cloudflare.com/ajax/libs/react/15.5.4/react-dom.min",openlayers:"https://cdnjs.cloudflare.com/ajax/libs/ol3/4.1.0/ol",dojox:"../../widgets/ArcGIS/lib/dojox",esri:"../../widgets/ArcGIS/lib/esri",moment:"../../widgets/ArcGIS/lib/moment"}};require(dojoConfig,[],function(){return define("ArcGIS/widget/ArcGIS",["dojo/_base/declare","mxui/dom","dojo/dom","dojo/on","dojo/dom-class","dojo/parser","mxui/widget/_WidgetBase","dijit/_TemplatedMixin","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/_base/event","dojo/_base/lang","dojo/_base/unload","dojo/cookie","dojo/json","dijit/registry","dojo/text!./template/ArcGIS.html","ArcGIS/lib/dojox/gfx/Mover","ArcGIS/lib/dojox/gfx/Moveable","ArcGIS/lib/dojox/gfx/_base","ArcGIS/lib/dojox/gfx/matrix","ArcGIS/lib/dojox/gfx/renderer","ArcGIS/lib/dojox/gfx/svg","ArcGIS/lib/dojox/gfx/filters","ArcGIS/lib/dojox/gfx/svgext","ArcGIS/lib/dojox/gfx","ArcGIS/lib/dojox/collections/_base","ArcGIS/lib/dojox/collections/ArrayList","ArcGIS/lib/dojox/grid/util","dojox/main","ArcGIS/lib/dojox/grid/cells/_base","ArcGIS/lib/dojox/grid/cells","ArcGIS/lib/dojox/grid/_Events","ArcGIS/lib/dojox/grid/_Scroller","ArcGIS/lib/dojox/html/metrics","ArcGIS/lib/dojox/grid/_Builder","ArcGIS/lib/dojox/grid/_View","ArcGIS/lib/dojox/grid/Selection","ArcGIS/lib/dojox/grid/_SelectionPreserver","ArcGIS/lib/dojox/grid/DataSelection","ArcGIS/lib/dojox/grid/_RowSelector","ArcGIS/lib/dojox/grid/_Layout","ArcGIS/lib/dojox/grid/_ViewManager","ArcGIS/lib/dojox/grid/_RowManager","ArcGIS/lib/dojox/grid/_FocusManager","ArcGIS/lib/dojox/grid/_EditManager","ArcGIS/lib/dojox/grid/_Grid","ArcGIS/lib/dojox/grid/DataGrid","ArcGIS/lib/dojox/html/entities","ArcGIS/lib/esri/nls/jsapi","ArcGIS/lib/esri/kernel","ArcGIS/lib/esri/lang","ArcGIS/lib/esri/deferredUtils","ArcGIS/lib/esri/config","ArcGIS/lib/esri/SpatialReference","ArcGIS/lib/esri/ImageSpatialReference","ArcGIS/lib/esri/geometry/Geometry","ArcGIS/lib/esri/sniff","ArcGIS/lib/esri/srUtils","ArcGIS/lib/esri/WKIDUnitConversion","ArcGIS/lib/esri/geometry/scaleUtils","ArcGIS/lib/esri/geometry/Point","ArcGIS/lib/esri/geometry/ScreenPoint","ArcGIS/lib/esri/geometry/webMercatorUtils","ArcGIS/lib/esri/geometry/mathUtils","ArcGIS/lib/esri/geometry/Extent","ArcGIS/lib/esri/geometry/Polyline","ArcGIS/lib/esri/geometry/Polygon","ArcGIS/lib/esri/geometry/Multipoint","ArcGIS/lib/esri/geometry/screenUtils","ArcGIS/lib/esri/geometry/geodesicUtils","ArcGIS/lib/esri/geometry/jsonUtils","ArcGIS/lib/esri/geometry/normalizeUtils","ArcGIS/lib/esri/geometry/Rect","ArcGIS/lib/esri/units","ArcGIS/lib/esri/geometry","ArcGIS/lib/esri/basemaps","ArcGIS/lib/esri/Evented","ArcGIS/lib/esri/fx","ArcGIS/lib/esri/tileUtils","ArcGIS/lib/esri/urlUtils","ArcGIS/lib/esri/PluginTarget","ArcGIS/lib/esri/Color","ArcGIS/lib/esri/arcade/ImmutableArray","ArcGIS/lib/esri/core/tsSupport/extendsHelper","ArcGIS/lib/esri/arcade/ImmutablePointArray","ArcGIS/lib/esri/arcade/ImmutablePathArray","ArcGIS/lib/moment/moment","ArcGIS/lib/esri/plugins/moment","ArcGIS/lib/esri/moment","ArcGIS/lib/esri/arcade/FunctionWrapper","ArcGIS/lib/esri/arcade/languageUtils","ArcGIS/lib/esri/arcade/Dictionary","ArcGIS/lib/esri/layers/gfxSniff","ArcGIS/lib/esri/request","ArcGIS/lib/esri/layers/layer","ArcGIS/lib/esri/domUtils","ArcGIS/lib/esri/symbols/Symbol","ArcGIS/lib/esri/symbols/MarkerSymbol","ArcGIS/lib/esri/symbols/LineSymbol","ArcGIS/lib/esri/symbols/SimpleLineSymbol","ArcGIS/lib/esri/symbols/SimpleMarkerSymbol","ArcGIS/lib/esri/layers/GraphicsLayer","ArcGIS/lib/esri/layers/LOD","ArcGIS/lib/esri/layers/TileInfo","ArcGIS/lib/esri/layers/TimeReference","ArcGIS/lib/esri/TimeExtent","ArcGIS/lib/esri/layers/LayerTimeOptions","ArcGIS/lib/esri/layers/TimeInfo","ArcGIS/lib/esri/layers/LayerInfo","ArcGIS/lib/esri/layerUtils","ArcGIS/lib/esri/layers/ArcGISMapServiceLayer","ArcGIS/lib/esri/layers/ImageParameters","ArcGIS/lib/esri/layers/MapImage","ArcGIS/lib/esri/layers/DynamicMapServiceLayer","ArcGIS/lib/esri/layers/LayerSource","ArcGIS/lib/esri/layers/DataSource","ArcGIS/lib/esri/layers/QueryDataSource","ArcGIS/lib/esri/layers/LayerMapSource","ArcGIS/lib/esri/layers/TableDataSource","ArcGIS/lib/esri/layers/RasterDataSource","ArcGIS/lib/esri/layers/JoinDataSource","ArcGIS/lib/esri/layers/LayerDataSource","ArcGIS/lib/esri/layers/DynamicLayerInfo","ArcGIS/lib/esri/layers/ArcGISDynamicMapServiceLayer","ArcGIS/lib/esri/layers/TiledMapServiceLayer","ArcGIS/lib/esri/layers/TileMap","ArcGIS/lib/esri/layers/ArcGISTiledMapServiceLayer","ArcGIS/lib/esri/layers/MapImageLayer","ArcGIS/lib/esri/layers/OpenStreetMapLayer","ArcGIS/lib/esri/ServerInfo","ArcGIS/lib/esri/OAuthCredential","ArcGIS/lib/esri/arcgis/OAuthInfo","ArcGIS/lib/esri/IdentityManagerBase","ArcGIS/lib/esri/Credential","ArcGIS/lib/esri/IdentityManagerDialog","ArcGIS/lib/esri/OAuthSignInHandler","ArcGIS/lib/esri/IdentityManager","ArcGIS/lib/esri/layers/VectorTileLayerImpl","ArcGIS/lib/esri/layers/VectorTileLayerWrapper","ArcGIS/lib/esri/Credential","ArcGIS/lib/esri/InfoTemplate","ArcGIS/lib/esri/InfoWindowBase","ArcGIS/lib/esri/symbols/PictureMarkerSymbol","ArcGIS/lib/esri/symbols/CartographicLineSymbol","ArcGIS/lib/esri/symbols/FillSymbol","ArcGIS/lib/esri/symbols/PictureFillSymbol","ArcGIS/lib/esri/symbols/SimpleFillSymbol","ArcGIS/lib/esri/symbols/Font","ArcGIS/lib/esri/symbols/TextSymbol","ArcGIS/lib/esri/symbols/jsonUtils","ArcGIS/lib/esri/graphic","ArcGIS/lib/esri/tasks/SpatialRelationship","ArcGIS/lib/esri/tasks/query","ArcGIS/lib/esri/PopupBase","ArcGIS/lib/esri/dijit/Popup","ArcGIS/lib/esri/tasks/Task","ArcGIS/lib/esri/graphicsUtils","ArcGIS/lib/esri/tasks/FeatureSet","ArcGIS/lib/esri/tasks/QueryTask","ArcGIS/lib/esri/tasks/RelationshipQuery","ArcGIS/lib/esri/tasks/StatisticDefinition","ArcGIS/lib/esri/dijit/_EventedWidget","ArcGIS/lib/esri/dijit/PopupRenderer","ArcGIS/lib/esri/PopupInfo","ArcGIS/lib/esri/dijit/PopupTemplate","ArcGIS/lib/esri/PopupManager","ArcGIS/lib/esri/plugins/popupManager","ArcGIS/lib/esri/_coremap","ArcGIS/lib/esri/MouseEvents","ArcGIS/lib/esri/TouchEvents","ArcGIS/lib/esri/PointerEvents","ArcGIS/lib/esri/MapNavigationManager","ArcGIS/lib/esri/map","ArcGIS/lib/esri/dijit/Attribution","ArcGIS/lib/esri/OperationBase","ArcGIS/lib/esri/undoManager","ArcGIS/lib/esri/toolbars/_toolbar","ArcGIS/lib/esri/toolbars/navigation","ArcGIS/lib/esri/toolbars/_Box","ArcGIS/lib/esri/toolbars/_GraphicMover","ArcGIS/lib/esri/toolbars/_VertexMover","ArcGIS/lib/esri/toolbars/_VertexEditor","ArcGIS/lib/esri/toolbars/TextEditor","ArcGIS/lib/esri/toolbars/edit","ArcGIS/lib/esri/toolbars/draw","ArcGIS/lib/esri/arcade/Feature","ArcGIS/lib/esri/arcade/functions/string","ArcGIS/lib/esri/arcade/functions/date","ArcGIS/lib/esri/arcade/functions/maths","ArcGIS/lib/esri/arcade/functions/fieldStats","ArcGIS/lib/esri/arcade/functions/stats","ArcGIS/lib/esri/arcade/functions/geometry","ArcGIS/lib/esri/arcade/treeAnalysis","ArcGIS/lib/esri/arcade/arcadeCompiler","ArcGIS/lib/esri/arcade/lib/esprima","ArcGIS/lib/esri/arcade/parser","ArcGIS/lib/esri/arcade/arcadeRuntime","ArcGIS/lib/esri/arcade/arcade","ArcGIS/lib/esri/renderers/arcadeUtils","ArcGIS/lib/esri/renderers/Renderer","ArcGIS/lib/esri/renderers/SimpleRenderer","ArcGIS/lib/esri/renderers/UniqueValueRenderer","ArcGIS/lib/esri/renderers/ClassBreaksRenderer","ArcGIS/lib/esri/renderers/ScaleDependentRenderer","ArcGIS/lib/esri/renderers/DotDensityRenderer","ArcGIS/lib/esri/renderers/HeatmapRenderer","ArcGIS/lib/esri/renderers/TemporalRenderer","ArcGIS/lib/esri/renderers/VectorFieldRenderer","ArcGIS/lib/esri/renderers/SymbolAger","ArcGIS/lib/esri/renderers/TimeClassBreaksAger","ArcGIS/lib/esri/renderers/TimeRampAger","ArcGIS/lib/esri/renderers/jsonUtils","ArcGIS/lib/esri/dijit/_EventedWidget","ArcGIS/lib/esri/dijit/Legend","ArcGIS/lib/esri/tasks/Task","ArcGIS/lib/esri/tasks/IdentifyResult","ArcGIS/lib/esri/tasks/IdentifyParameters","ArcGIS/lib/esri/tasks/IdentifyTask","ArcGIS/lib/esri/layers/Domain","ArcGIS/lib/esri/layers/CodedValueDomain","ArcGIS/lib/esri/layers/RangeDomain","ArcGIS/lib/esri/layers/Field","ArcGIS/lib/esri/layers/InheritedDomain","ArcGIS/lib/esri/layers/FeatureTemplate","ArcGIS/lib/esri/layers/FeatureType","ArcGIS/lib/esri/layers/FeatureEditResult","ArcGIS/lib/esri/symbols/ShieldLabelSymbol","ArcGIS/lib/esri/layers/LabelClass","ArcGIS/lib/esri/layers/RenderMode","ArcGIS/lib/esri/layers/GridLayout","ArcGIS/lib/esri/layers/OnDemandMode","ArcGIS/lib/esri/layers/SnapshotMode","ArcGIS/lib/esri/layers/StreamMode","ArcGIS/lib/esri/layers/SelectionMode","ArcGIS/lib/esri/layers/TrackManager","ArcGIS/lib/esri/layers/HeatmapManager","ArcGIS/lib/esri/layers/FeatureLayer","ArcGIS/lib/esri/dijit/editing/TemplatePickerItem","ArcGIS/lib/esri/dijit/editing/TemplatePicker","ArcGIS/lib/esri/dijit/BasemapToggle","ArcGIS/lib/esri/dijit/BasemapLayer","ArcGIS/lib/esri/styles/basic","ArcGIS/lib/esri/tasks/AddressCandidate","ArcGIS/lib/esri/tasks/locator","ArcGIS/lib/esri/promiseList","dojo/text!../lib/esri/dijit/Search/templates/Search.html","ArcGIS/lib/esri/dijit/Search","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/Toolbar","dijit/form/Button","dijit/layout/AccordionContainer"],function(e,p,i,A,r,t,s,o,n,c,l,a,I,h,d,b,g,y){"use strict";return e("ArcGIS.widget.ArcGIS",[s,o],{templateString:y,_progressID:null,_handle:null,_contextObj:null,_gisMap:null,_defaultPosition:null,_logNode:"ArcGIS Widget: ",visibleLayerIds:[],legendLayers:[],arcGisLayerArr:[],layerArr:[],hostName:null,midFix:"/arcgis/rest/services/",deferred:null,popupTemplate:null,_SpatialReference:null,queryOutFieldsArr:[],fieldInfosArr:[],_singleObjectZoom:12,defaultZoom:3,_editBtn:null,_removeBtn:null,_mfBtn:null,_newMxObjects:[],_queryDefinition:null,_queryLayerObj:null,_originalRenderer:null,constructor:function(e,i){this.consoleLogging&&console.log(this.id+".constructor")},postCreate:function(){this.consoleLogging&&console.log(this.id+".postCreate"),this._gisMap=null,this.layerArr=[],this.arcGisLayerArr=[],this.legendLayers=[],this._referenceMxObject=null,this._referenceMxObjectGUID=0,this._handles=[],this._referenceMxObjectsArr=[],this._initialLoad=!0,this._createTemplate()},update:function(e,i){this.consoleLogging&&console.log(this.id+".update"),this._contextObj=e,this._resetSubscriptions(),this.objectid=this._contextObj?this._contextObj.get(this.objectIDAttr):null,this.centerCoordinates=this._contextObj?this._contextObj.get(this.centerAttr):null,this.geometryType=this._contextObj?this._contextObj.get(this.geometryTypeAttr):null,this._gisMap?this.objectid?(this._referenceMxObjectsArr=[e],this._refreshMap()):this.zoomRow():this._getHostNameMF(i),i()},resize:function(e){this.consoleLogging&&console.log(this.id+".resize"),this._gisMap},_resetSubscriptions:function(){if(this.consoleLogging&&console.log(this.id+".resetSubscriptions"),this._handles){for(var e=0;e<this._handles.length;e++)this.unsubscribe(this._handles[e]);this._handles=[]}var i;this._contextObj&&(i=this.subscribe({guid:this._contextObj.getGuid(),callback:I.hitch(this,function(e){this._getReferenceMxObjects(null,!0)})}),this._handles.push(i))},_loadMap:function(){this.consoleLogging&&console.log(this._logNode+"._loadMap"),this._SpatialReference=new esri.SpatialReference(Number(this.spatialReference)),this._defaultPosition=new esri.geometry.Point(Number(this.defaultX),Number(this.defaultY),this._SpatialReference);var e=new esri.dijit.Popup({fillSymbol:new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([255,0,0]),2),new esri.Color([255,255,0,.25]))},dojo.create("div"));if(this.fieldInfosArr=[],this.queryOutFieldsArr=[],this._infoWindowTitle=null,0<this.attributesArray.length)for(var i=0;i<this.attributesArray.length;i++){var r={fieldName:this.attributesArray[i].attrName,visible:!0,label:this.attributesArray[i].attrLabel};this.fieldInfosArr.push(r),this.queryOutFieldsArr.push(this.attributesArray[i].attrName),this.attributesArray[i].isTitle&&(this._infoWindowTitle=this.attributesArray[i].attrName),this.attributesArray[i].isMxReference&&(this._referenceArcGisAttr=this.attributesArray[i].attrName)}this.popupTemplate=new esri.dijit.PopupTemplate({title:"{"+this._infoWindowTitle+"}",fieldInfos:this.fieldInfosArr}),this.multipleRecordsTemplate=new esri.dijit.PopupTemplate({title:"Multiple objects found where clicked. <br><br> Please zoom in further to single object."}),this.infotemplate=new esri.InfoTemplate,this.infotemplate.setContent(I.hitch(this,function(i){dojo.query(".actionList")[0];this._mfBtn&&dojo.destroy(this._mfBtn);var e,r,t={class:this.onClickButttonClass,type:"button",style:"cursor : pointer; margin-right: 6px;"};return this.onClickMF&&(t.style="cursor : pointer; margin-right: 6px; color: black",(e=p.create("span")).setAttribute("class","glyphicon glyphicon-share-alt"),r=p.create("text"),this._mfBtn=p.create("button",t,e,r),r.textContent=this.onClickButttonLabel,r.style.marginLeft="4px",dojo.query(".actionList")[0].appendChild(this._mfBtn),A(this._mfBtn,"click",I.hitch(this,function(e){this._getMxObject(i,this._execMf,this)}))),this._getTextContent(i)})),this._infoWindowTitle?this.infotemplate.setTitle(this._infoWindowTitle):this.infotemplate.setTitle("Details"),this._gisMap=null,this.baseMapURL_Default?(esri.basemaps.topo.baseMapLayers=[{url:this.baseMapURL_Default}],esri.basemaps.satellite.baseMapLayers=[{url:this.baseMapURL_Satellite}]):(esri.basemaps.topo.baseMapLayers=[{url:"https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer"}],esri.basemaps.satellite.baseMapLayers=[{url:"https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer"}]),this._gisMap=new esri.Map(this.mapContainer,{basemap:"topo",center:this._defaultPosition,zoom:this.defaultZoom,sliderStyle:"small",infoWindow:e}),this._gisMap.on("layers-add-result",I.hitch(this,function(e){for(var i=this.layerArr.filter(I.hitch(this,function(e){return e.queryLayer}))[0],r=e.layers,t=0;t<e.layers.length;t++){var s,o=null==r[t].error?"OK":r[t].error.message;console.log(" - "+r[t].layer.id+": "+o),this.enableCustomStyling&&r[t].layer.id===i.id&&(s=this._updateRenderer(r[t].layer,"point"),r[t].layer.setRenderer(s))}this._layerAddResultsEventHandler()})),new esri.dijit.BasemapToggle({map:this._gisMap,basemap:"satellite",basemaps:{topo:{title:"Normaal",thumbnailUrl:"widgets/ArcGIS/lib/esri/images/basemap/streets.jpg"},satellite:{title:"Sateliet",thumbnailUrl:"widgets/ArcGIS/lib/esri/images/basemap/satellite.jpg"}}},this.BasemapToggleDiv).startup(),this.enableSearch&&new esri.dijit.Search({map:this._gisMap,showInfoWindowOnSelect:!0,enableInfoWindow:!0},this.searchDiv).startup();var t={};(t=new esri.layers.ImageParameters).layerIds=[2],t.layerOption=esri.layers.ImageParameters.LAYER_OPTION_SHOW;var s,o,l={},a={};if(this._queryDefinition=null,0<this.layerArray.length&&0==this.layerArr.length)for(var n=0;n<this.layerArray.length;n++){a={id:(l={serverType:this.layerArray[n].layerServerType,url:this.layerArray[n].layerURL,id:this.layerArray[n].layerID,showAttribution:this.layerArray[n].showAttribution,indexes:this.layerArray[n].visibleLayerIndexes,featureLayerID:this.layerArray[n].featureLayerID,geometryType:this.layerArray[n].layerGeometryType,opacity:this.layerArray[n].opacity,queryLayer:this.layerArray[n].queryLayer,useDynamicFSHostName:this.layerArray[n].useDynamicFSHostName}).id,showAttribution:l.showAttribution,spatialReference:{wkid:Number(this.spatialReference)}},"MapServer"!==l.serverType&&"FeatureServer"!==l.serverType||(o=this._createLayerURL(o,l),this.consoleLogging&&(console.log(this._logNode+this._logNode+"Full URL (HostName + Layer URL): "+o+" and options: "),console.dir(this._logNode+a))),this.layerArr.push(l),l.queryLayer&&(this._queryLayerObj=l,this._queryDefinition=this._createQueryDefinition());try{if("MapServer"===l.serverType){if(a.imageParameters=t,s=new esri.layers.ArcGISDynamicMapServiceLayer(o,a),l.indexes){for(var c=l.indexes.split(","),h=[],d=0;d<c.length;d++){var b=parseInt(c[d]);h.push(b)}l.indexes=h,s.setVisibleLayers(h)}}else"FeatureServer"===l.serverType&&(a.mode=esri.layers.FeatureLayer.MODE_SNAPSHOT,a.outFields=this.queryOutFieldsArr,a.infoTemplate=this.infotemplate,this._token?s=new esri.layers.FeatureLayer(o+"?token="+this._token,a):(s=new esri.layers.FeatureLayer(o,a)).setOpacity(l.opacity),this.showAllObjectsInLayer||this._referenceMxObjectsArr.length<=1e3&&s.setDefinitionExpression(this._queryDefinition));s.id=l.id,s.layerName=l.id,this.arcGisLayerArr.push(s),this.legendLayers.push({layer:s,title:s.id,startLayerTicked:this.layerArray[n].startLayerTicked})}catch(e){console.error(this._logNode+this._logNode+"Error retrieving and creating layer with URL: "+l.url+". Message: "+e)}}this._setupEvents(),this._gisMap.addLayers(this.arcGisLayerArr)},_refreshMap:function(e){var i,r,t=this._gisMap.graphicsLayerIds.filter(I.hitch(this,function(e){return this._queryLayerObj.id}))[0];t&&(i=this._gisMap.getLayer(t),this.enableCustomStyling&&(r=this._updateRenderer(i,this._queryLayerObj.geometryType),i.setRenderer(r)),this._queryDefinition=this._createQueryDefinition(),this.showAllObjectsInLayer||i.setDefinitionExpression(this._queryDefinition),this._getExtentFromQueryDef(this._queryLayerObj,this._queryDefinition))},_createSimpleMarkerSymbol:function(e){switch(e){case"STYLE_CIRCLE":return esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE;case"STYLE_CROSS":return esri.symbol.SimpleMarkerSymbol.STYLE_CROSS;case"STYLE_DIAMOND":return esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND;case"STYLE_SQUARE":return esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE;case"STYLE_X":return esri.symbol.SimpleMarkerSymbol.STYLE_X}},_updateRenderer:function(e,i){this._simpleMarkerSymbol=this._createSimpleMarkerSymbol(this.markerSymbol);var r,t,s,o,l=this.defaultColor,a=l.split(","),n="point"==i?(l+",0.8").split(","):(l+",0.25").split(","),c="point"==i?new esri.symbol.SimpleMarkerSymbol(this._simpleMarkerSymbol,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(a),4),new esri.Color(n)):new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(a),1),new esri.Color(n));o=e.renderer&&e.renderer.symbol?e.renderer.symbol:e.graphics[0]&&e.graphics[0].symbol?e.graphics[0].symbol:c,o=e.renderer&&e.renderer.symbol?e.renderer.symbol:e.graphics[0]&&e.graphics[0].symbol?e.graphics[0].symbol:c,this._originalRenderer||(this._originalRenderer=new esri.renderer.UniqueValueRenderer(o,this.arcGISID)),(s=this._originalRenderer).defaultLabel=this.defaultLabel;for(var h=0;h<this._referenceMxObjectsArr.length;h++){r=this._referenceMxObjectsArr[h].get(this.objectIDAttr);var d,b=(t=this._referenceMxObjectsArr[h].get(this.colorAttr)).split(","),g="point"==i?(t+",0.8").split(","):(t+",0.25").split(","),y="point"==i?new esri.symbol.SimpleMarkerSymbol(this._simpleMarkerSymbol,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(b),4),new esri.Color(g)):new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(b),1),new esri.Color(g)),m=this.colorArray.filter(I.hitch(this,function(e){return e.featureColor==t}))[0];t&&(d=m?{value:r,symbol:y,label:m.featureColorLabel}:{value:r,symbol:y,label:"Label Unknown"},s.addValue(d))}return s},_execMf:function(e,i){i.consoleLogging&&console.log(i._logNode+"._execMf");var r=null;e&&(r=e.getGuid()),r&&mx.data.action({params:{applyto:"selection",actionname:i.onClickMF,guids:[r]},origin:i.mxform,callback:I.hitch(i,function(e){}),error:function(e){console.debug(e.description)}},this)},_getHostNameMF:function(i){this.consoleLogging&&console.log(this.id+"._getHostNameMF"),this.getHostNameMF&&this._initialLoad&&(this._initialLoad=!1,mx.data.action({params:{applyto:"none",actionname:this.getHostNameMF},origin:this.mxform,callback:I.hitch(this,function(e){this.hostName=e,this.getFeatureServerNameMF?mx.data.action({params:{applyto:"none",actionname:this.getFeatureServerNameMF},origin:this.mxform,callback:I.hitch(this,function(e){this._layerName=e,this._getReferenceMxObjects(i,!1)}),error:I.hitch(this,function(e){console.error(this._logNode+e.description)})}):this._getReferenceMxObjects(i,!1)}),error:I.hitch(this,function(e){console.error(this._logNode+e.description)})},this))},_queryLayer:function(e,i){this.consoleLogging&&console.log(this.id+"._queryLayer");var r="",r=i.useDynamicFSName?this.hostName+this.midFix+i.url:i.url;"FeatureServer"===i.serverType?r+="/FeatureServer/"+i.featureLayerID:"MapServer"===i.serverType&&(r+="/MapServer/"+i.visibleLayerIds),new esri.tasks.QueryTask(r).execute(e,I.hitch(this,function(e){var i,r,t,s;e&&e.features&&e.features[0]&&((i=e.features[0].geometry)?(t=(r=this._getCenterCoordinates(i)).x.toFixed(5).toString(),s=r.y.toFixed(5).toString(),this._contextObj&&!this._contextObj.get(this.centerAttr)&&(this._contextObj.set(this.centerAttr,t+","+s),mx.data.commit({mxobj:this._contextObj,callback:I.hitch(this,function(){}),error:function(e){console.error("Could not commit object:",e)}}))):console.log(this._logNode+"query gave empty result")),this._gisMap.centerAndZoom(r,this._singleObjectZoom).then(I.hitch(this,function(){}))}))},_getExtentFromQueryDef:function(e,i){var t,s,o,r=new esri.tasks.Query,l=this._gisMap.spatialReference,a=new esri.geometry.Multipoint;r.outSpatialReference=l,r.returnGeometry=!0,r.outFields=this.queryOutFieldsArr,r.where=i;var n="",n=this._createLayerURL(n,e);new esri.tasks.QueryTask(n).execute(r,I.hitch(this,function(e){if(e&&e.features){for(var i=0;i<e.features.length;i++){var r=e.features[i].geometry;r?(t=this._getCenterCoordinates(r),s=t.x.toFixed(5).toString(),o=t.y.toFixed(5).toString(),a.addPoint(new esri.geometry.Point(s,o))):console.log(this._logNode+"query gave empty result")}1==this._referenceMxObjectsArr.length?this._gisMap.centerAndZoom(t,Number(this._singleObjectZoom)-1):(this._extent=a.getExtent(),this._extent.setSpatialReference(this._gisMap.spatialReference),this._gisMap.setExtent(this._extent))}}))},_createLayerURL:function(e,i){return i.useDynamicFSHostName?(e=this.hostName+this.midFix,this.getFeatureServerNameMF?e+=this._layerName:e+=i.url):e=i.url,"FeatureServer"===i.serverType?e+="/FeatureServer/"+i.featureLayerID:"MapServer"===i.serverType&&(e+="/MapServer/"),e},_getTextContent:function(e){this.consoleLogging&&console.log(this.id+"._getTextContent");for(var i="",r=0;r<this.fieldInfosArr.length;r++){var t=(t=e.attributes[this.fieldInfosArr[r].fieldName])||"";i+="<b>"+this.fieldInfosArr[r].label+"</b> "+t+"<br>"}return i},taskCallbackInfoTemplate:function(e){this.consoleLogging&&console.log(this.id+".taskCallbackInfoTemplate");var i=null;return e.features&&(1==e.features.length?(i=e.features[0]).setInfoTemplate(this.popupTemplate):i.setInfoTemplate(this.multipleRecordsTemplate)),i},_setupEvents:function(){this.consoleLogging&&console.log(this._logNode+"._setupEvents"),this._editToolbar=new esri.toolbars.Edit(this._gisMap);var e=this._gisMap.infoWindow.domNode.querySelector(".title");new dojo.dnd.Moveable(this._gisMap.infoWindow.domNode,{handle:e}).on("FirstMove",I.hitch(this,function(){var e=this._gisMap.infoWindow.domNode.querySelector(".outerPointer");e.classList.add("hidden"),(e=this._gisMap.infoWindow.domNode.querySelector(".pointer")).classList.add("hidden")}).bind(this)),this.enableSearch&&(dojo.query(".searchInputGroup input")[0].placeholder="Search for address or place")},_layerAddResultsEventHandler:function(){if(this._queryLayerObj&&this._queryDefinition?this._getExtentFromQueryDef(this._queryLayerObj,this._queryDefinition):this.objectid?this.zoomRow(this.objectid,this.centerCoordinates,this.geometryType):1==this._referenceMxObjectsArr.length?(this._extent.setSpatialReference(this._gisMap.spatialReference),this._gisMap.centerAndZoom(this._extent.getCenter(),Number(this._singleObjectZoom)-1)):1<this._referenceMxObjectsArr.length?this._gisMap.setExtent(this._extent):this.zoomRow(),this.enableLegend&&new esri.dijit.Legend({map:this._gisMap,layerInfos:this.legendLayers},this.legendDiv).startup(),this.enableToggleLayers)for(var e=[],i=null,r=[],t=[],s=0;s<this.legendLayers.length;s++){e=[],r=(i=this.legendLayers[s]).layer.layerInfos,t=i.layer.visibleLayers;var o=0;if(r&&t){for(var l=0;l<t.length;l++)r[l]&&e.push(r[l]);o=e.length}0!=o&&1!=o||i.layer&&i.layer.graphics&&(o=i.layer.graphics.length);var a=i.title,n=p.create("span",{id:"spanLabel_"+s});this.startSubLayerListCollapsed?n.className="caret caret-left":n.className="caret",this._setCaretCSS(n);var c=p.create("label",{for:"checkBox"+i.layer.id,innerHTML:a,style:{"font-weight":700},class:"layer"+a},"  "+a+" ("+o+") ",n),h=p.create("input",{name:"checkBox"+i.layer.id,value:i.layer.id,checked:i.startLayerTicked,type:"checkbox"}),d=p.create("ul",{style:{"list-style-type":"none",padding:0,margin:0,cursor:"pointer"}},c,h);dojo.place(c,h,"after"),dojo.place(d,this.toggleDiv,"after"),A(h,"click",I.hitch(this,function(e){var i=this._gisMap.getLayer(e.target.value);i.setVisibility(!i.visible),e.target.checked=i.visible})),A(d,"click",I.hitch(this,function(e){var i;"UL"==e.target.parentNode.tagName&&(i=e.target.parentNode,this._toggleSubLayerList(i)),"LI"==e.target.parentNode.tagName&&this.consoleLogging&&console.log(this._logNode+"li clicked")}));for(var b=0;b<e.length;b++){var g=e[b].name,y=e[b].id,m=p.create("label",{for:"checkBox"+y,innerHTML:g,style:{"font-weight":400}},"  "+g),u=p.create("input",{name:"checkBox"+y,value:i.layer.id+"-"+y,checked:e[b].defaultVisibility,type:"checkbox",style:"margin-left:10px"}),S=p.create("li",{},u,m);dojo.place(S,c,"after"),A(u,"click",I.hitch(this,function(e){var i=e.target.value.split("-"),r=this._gisMap.getLayer(i[0]),t=r.visibleLayers,s=Number(i[1]);this.containsObject(s,t)?t=this._removeFromArr(t,s):t.push(s),r.setVisibleLayers(t)}))}i.startLayerTicked?this.startSubLayerListCollapsed&&this._toggleSubLayerList(d):(h.click(),d.click())}},zoomRow:function(e,i,r){this.consoleLogging&&(console.log(this.id+".zoomRow"),console.log(this._logNode+e),console.log(this._logNode+i),console.log(this._logNode+r));var t,s,o=[],l=this.defaultX,a=this.defaultY,n=this._gisMap.spatialReference,c=new esri.geometry.Point(Number(this.defaultX),Number(this.defaultY),n);e?i?(o=i.split(","),l=Number(o[0]),a=Number(o[1]),c=new esri.geometry.Point(l,a,n),this._gisMap.centerAndZoom(c,Number(this._singleObjectZoom)-1)):((t=new esri.tasks.Query).outSpatialReference=n,t.returnGeometry=!0,t.outFields=this.queryOutFieldsArr,t.where=this.arcGISID+"="+e,(s=this.layerArr.filter(I.hitch(this,function(e){return e.geometryType==r}))[0])?this._queryLayer(t,s):console.error(this._logNode+"For zooming a layerObj is needed. This was not found. Do all Layers have the correct geometryType defined in the Modeler?")):this._gisMap.centerAndZoom(this._defaultPosition,Number(this.defaultZoom)-1)},containsObject:function(e,i){var r;for(this.consoleLogging&&console.log(this.id+".zoomRow"),r=0;r<i.length;r++)if(i[r]==e)return!0;return!1},_toggleSubLayerList:function(e){this.consoleLogging&&console.log(this.id+"._toggleSubLayerList");for(var i,r=Array.from(e.childNodes),t=1;t<r.length;t++){"LI"==e.childNodes[t].tagName&&("none"==e.childNodes[t].style.display?e.childNodes[t].style.display="block":e.childNodes[t].style.display="none"),"LABEL"==e.childNodes[t].tagName&&("caret"==(i=e.childNodes[t].lastElementChild).className?i.className+=" caret-left":i.className="caret",this._setCaretCSS(i))}},_setCaretCSS:function(e){this.consoleLogging&&console.log(this.id+"._setCaretCSS"),e&&"caret caret-left"==e.className?(e.style.borderRight="4px solid "+this.customColor,e.style.borderBottom="4px solid transparent",e.style.borderTop="4px solid transparent"):e&&"caret"==e.className&&(e.style.borderRight="4px solid transparent",e.style.borderBottom="4px solid transparent",e.style.borderTop="4px solid "+this.customColor)},_injectVariableStyling:function(){var e,i,r;this.consoleLogging&&console.log(this.id+"._injectVariableStyling"),""!==this.customColor&&((e=document.createElement("style")).type="text/css",e.innerHTML=".claro .dijitAccordionTitleSelected { background-color: "+this.selectedColor+";}",e.innerHTML+=".toggleTemplatePane .dijitAccordionContainer-child .dijitAccordionContainer-dijitContentPane { background-color: "+this.selectedColor+";}",document.body.appendChild(e),(i=document.createElement("style")).type="text/css",i.innerHTML=".claro .dijitAccordionInnerContainer:hover { background-color: "+this.customColor+";}",document.body.appendChild(i),(r=document.createElement("style")).type="text/css",r.innerHTML=".esriPopup .titlePane { background-color: "+this.customColor+";}",document.body.appendChild(r)),n.set(this.domNode,{height:this.mapHeight+"px",width:this.mapWidth+"px"}),1e4==this.mapWidth&&n.set(this.domNode,{width:"95vw"})},_getReferenceMxObjects:function(i,r){var e,t;this.consoleLogging&&console.log(this.id+"._getReferenceMxObjects"),this.objectEntity&&this.xPathConstraint?(this.consoleLogging&&console.info(this._logNode+"get from XPath"),e="//"+this.objectEntity+this.xPathConstraint,this._contextObj&&(e=e.replace("'[%CurrentObject%]'",this._contextObj.getGuid())),this.consoleLogging&&console.log(this._logNode+"XPATH: "+e),mx.data.get({xpath:e,callback:I.hitch(this,function(e){this.consoleLogging&&(console.log(this._logNode+"Received "+e.length+" MxObjects: "),console.dir(this._logNode+e)),this._referenceMxObjectsArr=e,r?this._refreshMap(e):this._loadMap(i)})})):this._getObjectsMF?(this.consoleLogging&&console.log(this._logNode+"get from DS MF set from Modeler"),t=[],this._contextObj&&(t=[this._contextObj.getGuid()]),mx.ui.action(this._getObjectsMF,{params:{applyto:"selection",guids:t},origin:this.mxform,progress:"modal",progressMsg:"Loading objects...",callback:I.hitch(this,function(e){this.consoleLogging&&(console.log(this._logNode+"Received "+e.length+" MxObjects: "),console.dir(this._logNode+e)),this._referenceMxObjectsArr=e,r?this._refreshMap(e):this._loadMap(i)}),error:I.hitch(this,function(e){console.error(this._logNode+e.description)})})):(this.consoleLogging&&console.info(this._logNode+"get object from DataView entity"),this._contextObj&&this._referenceMxObjectsArr.push(this._contextObj),r?this._refreshMap([this._contextObj]):this._loadMap(i))},_getMxObject:function(i,r,t){this.consoleLogging&&console.log(this.id+"._getMxObject");var e,s=null;this._referenceMxObjectsArr&&0<this._referenceMxObjectsArr.length?(s=this._referenceMxObjectsArr.filter(I.hitch(this,function(e){return e.get(this.objectIDAttr)==i.attributes[this.arcGISID]&&e.get(this.geometryTypeAttr)==i.geometry.type}))[0],r&&"function"==typeof r&&r(s,t)):(e="//"+this.objectEntity+"["+this.objectIDAttr+" = "+i.attributes[this.arcGISID]+" and "+this.geometryTypeAttr+" = '"+i.geometry.type+"']",this.consoleLogging&&console.log(this._logNode+e),mx.data.get({xpath:e,callback:I.hitch(this,function(e){this.consoleLogging&&(console.log(this._logNode+"Received "+e.length+" MxObjects: "),console.dir(this._logNode+e)),s=e[0],r(s,t)})}))},_createTemplate:function(){this.consoleLogging&&console.log(this.id+"._createTemplate");var e=new dijit.layout.BorderContainer({className:"content",gutters:!1,design:"headline",style:{height:"100%",width:"100%"}});this.contentPane=e.domNode,n.set(this.contentPane,{height:"100%",width:"100%"});var i,r,t,s,o,l=new dijit.layout.ContentPane({className:"mapDiv",region:"center"}),a=c.create("div",{className:"BasemapToggleDiv"},l.domNode);this.BasemapToggleDiv=a,e.addChild(l),this.mapContainer=l.domNode,n.set(this.mapContainer,{height:"100%",width:"100%",border:"solid 2px "+this.customColor}),c.place(this.contentPane,this.domNode),this.enableToggleLayers|this.enableLegend&&(i=new dijit.layout.ContentPane({className:"rightPane",region:"right",height:"100%"}),r=new dijit.layout.AccordionContainer,this.accordionContainer=i.domNode,n.set(this.mapContainer,{width:"80%"}),n.set(this.accordionContainer,{height:"100%",width:"20%"}),i.addChild(r),e.addChild(i),this.enableLegend&&(t=new dijit.layout.ContentPane({className:"legendPane",title:"Legend",style:{"overflow-x":"auto"}}),this.legendDiv=c.create("div",{className:"legendDiv"},t.domNode),r.addChild(t),this.legendPane=t.domNode),this.enableToggleLayers&&(s=new dijit.layout.ContentPane({className:"toggleLayerPane",title:"Lagen",style:"overflow-y: auto;"}),this.toggleDiv=c.create("div",{className:"toggleDiv",style:"padding: 2px 2px;"},s.domNode),r.addChild(s))),this.enableSearch&&(o=c.create("div",{className:"searchDiv"},l.domNode),this.searchDiv=o),this._injectVariableStyling()},_createButton:function(e,i,r,t,s){this.consoleLogging&&console.log(this.id+"._createButton");var o=new dijit.form.Button({className:i,iconClass:r,innerHTML:t,backgroundImage:s});return null!==e&&(this[e]=o.domNode),o},_createQueryDefinition:function(){var e="";if(0<this._referenceMxObjectsArr.length&&this._referenceMxObjectsArr.length<1e3){e=this.arcGISID+" IN (";var i=null,r=!0;this._objectsWithoutCoordinates=[];for(var t=0;t<this._referenceMxObjectsArr.length;t++)i=this._referenceMxObjectsArr[t].get(this.objectIDAttr),this._referenceMxObjectsArr[t].get(this.centerAttr),i&&(r||(e+=","),r=r&&!1,e+=i);e+=")"}return this.consoleLogging&&console.log(e),e},_getCenterCoordinates:function(e){this.consoleLogging&&console.log(this.id+"._getCenterCoordinates");var i,r,t,s=null,o=null;return"polyline"==e.type||"polygon"==e.type?(t="",e.rings?t=new esri.geometry.Polyline(e.rings).getExtent():e.paths&&(t=new esri.geometry.Polyline(e.paths).getExtent()),i=(t.xmax+t.xmin)/2,r=(t.ymax+t.ymin)/2,o=e.spatialReference,s=new esri.geometry.Point(i,r,o)):"point"==e.type&&(i=e.x,r=e.y,o=e.spatialReference,s=new esri.geometry.Point(i,r,o)),s},_generateError:function(e){console.error(e),mx.ui.info(e,!1)},_removeFromArr:function(e){for(var i,r,t=arguments,s=t.length;1<s&&e.length;)for(i=t[--s];-1!==(r=e.indexOf(i));)e.splice(r,1);return e},uninitialize:function(){this.consoleLogging&&console.log(this.id+".uninitialize")}})})}),require(["ArcGIS/widget/ArcGIS"],function(){});
